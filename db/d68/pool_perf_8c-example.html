<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EM-ODP: pool_perf.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doc-stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EM-ODP
   &#160;<span id="projectnumber">3.8.0-1</span>
   </div>
   <div id="projectbrief">Event Machine on ODP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('db/d68/pool_perf_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">pool_perf.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> *   Copyright (c) 2023, Nokia Solutions and Networks</span></div>
<div class="line"><span class="comment"> *   All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> *   modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment"> *   are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer in the</span></div>
<div class="line"><span class="comment"> *       documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment"> *     * Neither the name of the copyright holder nor the names of its</span></div>
<div class="line"><span class="comment"> *       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment"> *       from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment"> *   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment"> *   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment"> *   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment"> *   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment"> *   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment"> *   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment"> *   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @file</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Event Machine performance test tool for memory pool performance.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Measures time consumed during calls to allocate and free buffers or packets.</span></div>
<div class="line"><span class="comment"> * Command line arguments can be used to try different aspects.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/mman.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdatomic.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d5e/event__machine_8h.html">event_machine.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/d26/environment_8h.html">event_machine/platform/env/environment.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d5/dbf/event__machine__odp__ext_8h.html">event_machine/platform/event_machine_odp_ext.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;cm_setup.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;cm_error_handler.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pool_perf.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> error_handler(em_eo_t eo, <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> error, <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0c0a929399ae33b615f8ca8018d2a69d">em_escope_t</a> escope, va_list args);</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> start(<span class="keywordtype">void</span> *eo_context, em_eo_t eo, <span class="keyword">const</span> <a name="_a0"></a><a class="code" href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a> *conf);</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> stop(<span class="keywordtype">void</span> *eo_context, em_eo_t eo);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> receive_func(<span class="keywordtype">void</span> *eo_context, em_event_t event, <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> type,</div>
<div class="line">                         em_queue_t queue, <span class="keywordtype">void</span> *q_context);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> parse_args(<span class="keywordtype">int</span> first, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> usage(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keyword">static</span> uint64_t try_timestamp_overhead(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_setup(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> update_allocs(test_msg *msg, em_pool_t pool, <span class="keywordtype">size_t</span> size, odp_pool_t odp_pool);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> enqueue_event(test_msg *msg, event_handle_t ev);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> dequeue_event(test_msg *msg, event_handle_t *ev);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> free_ring(test_msg *msg);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_upd_stat(test_msg *msg, uint64_t endt);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> do_work(uint64_t ns);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_global_stat(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> parse_pool(<span class="keywordtype">char</span> *arg);</div>
<div class="line"><span class="keyword">static</span> em_pool_t create_test_pool(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keyword">static</span> em_event_t do_em_event_alloc(int64_t *diff, <span class="keywordtype">size_t</span> size, em_pool_t pool);</div>
<div class="line"><span class="keyword">static</span> odp_event_t do_odp_event_alloc(int64_t *diff, <span class="keywordtype">size_t</span> size, odp_pool_t pool);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> do_odp_pktmulti_alloc(test_msg *msg, odp_pool_t odp_pool, <span class="keywordtype">size_t</span> size,</div>
<div class="line">                                  <span class="keywordtype">int</span> num, int64_t *diff);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> do_odp_bufmulti_alloc(test_msg *msg, odp_pool_t odp_pool, <span class="keywordtype">size_t</span> size,</div>
<div class="line">                                  <span class="keywordtype">int</span> num, int64_t *diff);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> allocate_events(test_msg *msg, em_pool_t pool, <span class="keywordtype">size_t</span> size, odp_pool_t odp_pool,</div>
<div class="line">                            <span class="keywordtype">bool</span> skip);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> allocate_events_multi(test_msg *msg, em_pool_t pool, <span class="keywordtype">size_t</span> size, odp_pool_t odp_pool,</div>
<div class="line">                                  <span class="keywordtype">bool</span> skip);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> free_events(test_msg *msg, <span class="keywordtype">bool</span> skip);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> free_events_multi(test_msg *msg, <span class="keywordtype">bool</span> skip);</div>
<div class="line"><span class="keyword">static</span> int64_t do_em_event_free(em_event_t ev);</div>
<div class="line"><span class="keyword">static</span> int64_t do_odp_event_free(odp_event_t ev);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> add_to_bin(<span class="keywordtype">int</span> bin, int64_t ns);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> flush_data(test_msg *msg);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> init_bins(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_bin(<span class="keywordtype">int</span> bin);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> restart(em_queue_t testq);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_uptime(<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* data */</span></div>
<div class="line"><span class="keyword">static</span> perf_shm_t *perf_shm;</div>
<div class="line"> </div>
<div class="line">config_data g_options = {</div>
<div class="line">        .loops  = 1,</div>
<div class="line">        .perloop = EVENTS_PER_LOOP,</div>
<div class="line">        .events = 1,</div>
<div class="line">        .num_alloc = 1,</div>
<div class="line">        .num_free = 1,</div>
<div class="line">        .window = 2,</div>
<div class="line">        .delay = 0,</div>
<div class="line">        .size = 256,</div>
<div class="line">        .skip = 0,</div>
<div class="line">        .use_multi = <span class="keyword">false</span>,</div>
<div class="line">        .use_odp = <span class="keyword">false</span>,</div>
<div class="line">        .no_first = 1,</div>
<div class="line">        .pool = { .num = 0, .size = 0, .cache = 0, .type = <a name="a1"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a> },</div>
<div class="line">        .flush = 0</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *g_bin_names[NUM_BIN_INST] = { <span class="stringliteral">&quot;alloc&quot;</span>, <span class="stringliteral">&quot;free&quot;</span> };</div>
<div class="line">test_bin_t g_bins[NUM_BIN_INST][NUM_BINS];</div>
<div class="line"><span class="keyword">const</span> int64_t g_bin_limits[NUM_BINS] = { 10, 20, 50, 100, 200, 300, 500, 1000, 2000, -1 };</div>
<div class="line"> </div>
<div class="line"><span class="comment">/***********************************************/</span></div>
<div class="line"><span class="keywordtype">void</span> usage(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;pool_perf %s\n\n%s&quot;</span>, VERSION, instructions);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; ; i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (longopts[i].name == NULL)</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;-%c or --%-16s %s\n&quot;</span>, longopts[i].val, longopts[i].name, descopts[i]);</div>
<div class="line">        }</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> init_bins(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; NUM_BIN_INST; i++)</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> b = 0; b &lt; NUM_BINS; b++)</div>
<div class="line">                        g_bins[i][b].upto_ns = g_bin_limits[b];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> parse_pool(<span class="keywordtype">char</span> *arg)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num, size, cache;</div>
<div class="line">        <span class="keywordtype">char</span> type[64];</div>
<div class="line"> </div>
<div class="line">        type[0] = 0;</div>
<div class="line">        <span class="keywordtype">int</span> parsed = sscanf(arg, <span class="stringliteral">&quot;%u,%u,%u,%s&quot;</span>, &amp;num, &amp;size, &amp;cache, type);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (parsed != 4 || num == 0 || size == 0 || type[0] == 0)</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">        g_options.pool.num = num;</div>
<div class="line">        g_options.pool.size = size;</div>
<div class="line">        g_options.pool.cache = cache;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!strcmp(type, <span class="stringliteral">&quot;SW&quot;</span>))</div>
<div class="line">                g_options.pool.type = <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(type, <span class="stringliteral">&quot;PACKET&quot;</span>))</div>
<div class="line">                g_options.pool.type = <a name="a2"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a3ee5e35cc122532fcbdcd183735463d7">EM_EVENT_TYPE_PACKET</a>;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> parse_args(<span class="keywordtype">int</span> first, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">        optind = first + 1; <span class="comment">/* skip &#39;--&#39; */</span></div>
<div class="line">        <span class="keywordflow">while</span> (1) {</div>
<div class="line">                <span class="keywordtype">int</span> opt;</div>
<div class="line">                <span class="keywordtype">int</span> long_index;</div>
<div class="line">                <span class="keywordtype">char</span> *endptr;</div>
<div class="line">                int64_t num;</div>
<div class="line"> </div>
<div class="line">                opt = getopt_long(argc, argv, shortopts, longopts, &amp;long_index);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (opt == -1)</div>
<div class="line">                        <span class="keywordflow">break</span>;  <span class="comment">/* No more options */</span></div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">switch</span> (opt) {</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 0)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.loops = (int)num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 2)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.perloop = (<span class="keywordtype">unsigned</span> int)num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 1)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.events = (<span class="keywordtype">unsigned</span> int)num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num == 0)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        <span class="keywordflow">if</span> (labs(num) &gt; MAX_ALLOCS) {</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;Max allocs %u\n&quot;</span>, MAX_ALLOCS);</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        }</div>
<div class="line">                        g_options.num_alloc = (int)num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num == 0)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        <span class="keywordflow">if</span> (labs(num) &gt; MAX_ALLOCS) {</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;Max free %u\n&quot;</span>, MAX_ALLOCS);</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        }</div>
<div class="line">                        g_options.num_free = (int)num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 0)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.skip = (<span class="keywordtype">unsigned</span> int)num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 0)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.delay = (uint64_t)num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 0)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.size = (uint64_t)num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;w&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 1)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        <span class="keywordflow">if</span> (num &gt; MAX_ALLOCS) {</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;Max window %u\n&quot;</span>, MAX_ALLOCS);</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        }</div>
<div class="line">                        g_options.window = (<span class="keywordtype">unsigned</span> int)num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 0)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.flush = (<span class="keywordtype">unsigned</span> int)num; <span class="comment">/* kB */</span></div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>: {</div>
<div class="line">                        <span class="keywordflow">if</span> (parse_pool(optarg) == 0)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>: {</div>
<div class="line">                        g_options.use_multi = <span class="keyword">true</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>: {</div>
<div class="line">                        g_options.no_first = 1;</div>
<div class="line">                        <span class="keywordflow">if</span> (optarg != NULL) { <span class="comment">/* optional arg */</span></div>
<div class="line">                                num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                                <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 0)</div>
<div class="line">                                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                                g_options.no_first = (<span class="keywordtype">unsigned</span> int)num;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>: {</div>
<div class="line">                        g_options.use_odp = <span class="keyword">true</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                        opterr = 0;</div>
<div class="line">                        usage();</div>
<div class="line">                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        optind = 1; <span class="comment">/* cm_setup() to parse again */</span></div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> error_handler(em_eo_t eo, <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> error, <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0c0a929399ae33b615f8ca8018d2a69d">em_escope_t</a> escope, va_list args)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">return</span> test_error_handler(eo, error, escope, args);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> do_work(uint64_t ns)</div>
<div class="line">{</div>
<div class="line">        uint64_t t1 = odp_time_local_strict_ns();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* just loop for given time */</span></div>
<div class="line">        <span class="keywordflow">while</span> ((odp_time_local_ns() - t1) &lt; ns)</div>
<div class="line">                ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test_init(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        (void)appl_conf;</div>
<div class="line">        <span class="keywordtype">int</span> core = <a name="a3"></a><a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (core == 0) {</div>
<div class="line">                perf_shm = env_shared_reserve(<span class="stringliteral">&quot;PerfSharedMem&quot;</span>, <span class="keyword">sizeof</span>(perf_shm_t));</div>
<div class="line">                <a name="a4"></a><a class="code" href="../../db/da0/group__em__error.html#gaf7332965c5deaa69411136e8d36089c6">em_register_error_handler</a>(error_handler);</div>
<div class="line">                mlockall(MCL_FUTURE); <span class="comment">/* make sure all memory is mapped at start */</span></div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                perf_shm = env_shared_lookup(<span class="stringliteral">&quot;PerfSharedMem&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (perf_shm == NULL)</div>
<div class="line">                test_error(<a name="a5"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xec0de), 0xdead,</div>
<div class="line">                           <span class="stringliteral">&quot;Test init failed on EM-core: %u\n&quot;</span>,</div>
<div class="line">                           core);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (core == 0) {</div>
<div class="line">                memset(perf_shm, 0, <span class="keyword">sizeof</span>(perf_shm_t));</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;%luB Shared memory initialized\n&quot;</span>, <span class="keyword">sizeof</span>(perf_shm_t));</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">uint64_t try_timestamp_overhead(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define NUM_TS_TRY 20</span></div>
<div class="line"> </div>
<div class="line">        uint64_t oh = UINT64_MAX;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* measure time stamping overhead, take min */</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; NUM_TS_TRY; i++) {</div>
<div class="line">                uint64_t t1 = TIME_FN();</div>
<div class="line">                uint64_t t2 = TIME_FN();</div>
<div class="line">                uint64_t t3 = TIME_FN();</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (t2 - t1 &lt; oh)</div>
<div class="line">                        oh = t2 - t1;</div>
<div class="line">                <span class="keywordflow">if</span> (t3 - t2 &lt; oh)</div>
<div class="line">                        oh = t3 - t2;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> oh ? oh - 1 : oh;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> add_to_bin(<span class="keywordtype">int</span> bin, int64_t ns)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; NUM_BINS; i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (ns &lt;= g_bins[bin][i].upto_ns || g_bins[bin][i].upto_ns &lt; 0) {</div>
<div class="line">                        g_bins[bin][i].count++; <span class="comment">/* atomic_uint */</span></div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> print_bin(<span class="keywordtype">int</span> bin)</div>
<div class="line">{</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\nBin &#39;%s&#39; counts:\n# up to ns\t&quot;</span>, g_bin_names[bin]);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; NUM_BINS; i++)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;%-13ld&quot;</span>, g_bins[bin][i].upto_ns);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\n# \t\t&quot;</span>);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; NUM_BINS; i++)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;%-13lu&quot;</span>, g_bins[bin][i].count);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> enqueue_event(test_msg *msg, event_handle_t ev)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (msg-&gt;top &gt;= MAX_ALLOCS)</div>
<div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">/* full */</span></div>
<div class="line"> </div>
<div class="line">        msg-&gt;events[msg-&gt;top] = ev;</div>
<div class="line">        msg-&gt;top++;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> dequeue_event(test_msg *msg, event_handle_t *ev)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (msg-&gt;top &lt; 1)</div>
<div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">/* empty */</span></div>
<div class="line">        msg-&gt;top--;</div>
<div class="line">        *ev = msg-&gt;events[msg-&gt;top];</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* noinline for profiling */</span></div>
<div class="line">em_event_t __attribute__ ((noinline)) do_em_event_alloc(int64_t *diff, <span class="keywordtype">size_t</span> size, em_pool_t pool)</div>
<div class="line">{</div>
<div class="line">        em_event_t ev;</div>
<div class="line">        uint64_t t1 = TIME_FN();</div>
<div class="line"> </div>
<div class="line">        ev = <a name="a6"></a><a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(size, g_options.pool.type, pool);</div>
<div class="line">        *diff = (int64_t)TIME_FN() - (int64_t)t1;</div>
<div class="line">        <span class="keywordflow">return</span> ev;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">odp_event_t __attribute__ ((noinline)) do_odp_event_alloc(int64_t *diff, <span class="keywordtype">size_t</span> size,</div>
<div class="line">                                                          odp_pool_t pool)</div>
<div class="line">{</div>
<div class="line">        odp_event_t ev;</div>
<div class="line">        uint64_t t1;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.pool.type == <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a3ee5e35cc122532fcbdcd183735463d7">EM_EVENT_TYPE_PACKET</a>) {</div>
<div class="line">                t1 = TIME_FN();</div>
<div class="line">                odp_packet_t pkt = odp_packet_alloc(pool, (uint32_t)size);</div>
<div class="line">                *diff = (int64_t)TIME_FN() - (int64_t)t1;</div>
<div class="line">                ev = odp_packet_to_event(pkt);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                t1 = TIME_FN();</div>
<div class="line">                odp_buffer_t buf = odp_buffer_alloc(pool);</div>
<div class="line">                *diff = (int64_t)TIME_FN() - (int64_t)t1;</div>
<div class="line">                ev = odp_buffer_to_event(buf);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> ev;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> allocate_events(test_msg *msg, em_pool_t pool, <span class="keywordtype">size_t</span> size, odp_pool_t odp_pool, <span class="keywordtype">bool</span> skip)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num = abs(g_options.num_alloc);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.num_alloc &lt; 0) { <span class="comment">/* negative means random up to */</span></div>
<div class="line">                num = rand() % (num + 1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; num; i++) {</div>
<div class="line">                int64_t diff;</div>
<div class="line">                event_handle_t ev;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (g_options.use_odp) {</div>
<div class="line">                        ev.odp_ev = do_odp_event_alloc(&amp;diff, size, odp_pool);</div>
<div class="line">                        <span class="keywordflow">if</span> (ev.odp_ev == ODP_EVENT_INVALID) {</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;!! allocs %lu, stack top %d\n&quot;</span>,</div>
<div class="line">                                           msg-&gt;allocated, msg-&gt;top);</div>
<div class="line">                        }</div>
<div class="line">                        test_fatal_if(ev.odp_ev == ODP_EVENT_INVALID, <span class="stringliteral">&quot;odp alloc failed&quot;</span>);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                        ev.em_ev = do_em_event_alloc(&amp;diff, size, pool);</div>
<div class="line">                        test_fatal_if(ev.em_ev == <a name="a7"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>, <span class="stringliteral">&quot;em_alloc failed&quot;</span>);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                diff -= perf_shm-&gt;ts_overhead;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (!skip) { <span class="comment">/* instance stats */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (diff &lt; msg-&gt;times.alloc.min_ns) {</div>
<div class="line">                                msg-&gt;times.alloc.min_ns = diff;</div>
<div class="line">                                msg-&gt;times.alloc.min_evt = msg-&gt;count;</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">if</span> (diff &gt; msg-&gt;times.alloc.max_ns) {</div>
<div class="line">                                msg-&gt;times.alloc.max_ns = diff;</div>
<div class="line">                                msg-&gt;times.alloc.max_evt = msg-&gt;count;</div>
<div class="line">                        }</div>
<div class="line"> </div>
<div class="line">                        add_to_bin(BIN_ALLOC, diff);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                test_fatal_if(enqueue_event(msg, ev) == <span class="keyword">false</span>, <span class="stringliteral">&quot;Unexpected: event ring full!&quot;</span>);</div>
<div class="line">                msg-&gt;allocated++; <span class="comment">/* current batch */</span></div>
<div class="line">                msg-&gt;times.alloc.tot_allocs++;</div>
<div class="line">                msg-&gt;times.alloc.sum_ns += diff;</div>
<div class="line">                perf_shm-&gt;counts[<a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>()].allocs++;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (msg-&gt;allocated &gt;= g_options.window)</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> do_odp_pktmulti_alloc(test_msg *msg, odp_pool_t odp_pool, <span class="keywordtype">size_t</span> size, <span class="keywordtype">int</span> num, int64_t *diff)</div>
<div class="line">{</div>
<div class="line">        odp_packet_t pkts[MAX_ALLOCS];</div>
<div class="line">        uint64_t t1 = TIME_FN();</div>
<div class="line">        <span class="keywordtype">int</span> got = odp_packet_alloc_multi(odp_pool, (uint32_t)size, pkts, num);</div>
<div class="line"> </div>
<div class="line">        *diff = (int64_t)TIME_FN() - (int64_t)t1;</div>
<div class="line">        test_fatal_if(num != got, <span class="stringliteral">&quot;not enough events from pkt pool&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num; i++)</div>
<div class="line">                test_fatal_if(enqueue_event(msg,</div>
<div class="line">                                            (event_handle_t)odp_packet_to_event(pkts[i])) == <span class="keyword">false</span>,</div>
<div class="line">                                            <span class="stringliteral">&quot;Unexpected: event ring full!&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> do_odp_bufmulti_alloc(test_msg *msg, odp_pool_t odp_pool, <span class="keywordtype">size_t</span> size, <span class="keywordtype">int</span> num, int64_t *diff)</div>
<div class="line">{</div>
<div class="line">        (void)size;</div>
<div class="line"> </div>
<div class="line">        odp_buffer_t bufs[MAX_ALLOCS];</div>
<div class="line">        uint64_t t1 = TIME_FN();</div>
<div class="line">        <span class="keywordtype">int</span> got = odp_buffer_alloc_multi(odp_pool, bufs, num);</div>
<div class="line"> </div>
<div class="line">        *diff = (int64_t)TIME_FN() - (int64_t)t1;</div>
<div class="line">        test_fatal_if(num != got, <span class="stringliteral">&quot;not enough events from bufpool&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num; i++)</div>
<div class="line">                test_fatal_if(enqueue_event(msg,</div>
<div class="line">                                            (event_handle_t)odp_buffer_to_event(bufs[i])) == <span class="keyword">false</span>,</div>
<div class="line">                                            <span class="stringliteral">&quot;Unexpected: event ring full!&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> allocate_events_multi(test_msg *msg, em_pool_t pool, <span class="keywordtype">size_t</span> size, odp_pool_t odp_pool,</div>
<div class="line">                           <span class="keywordtype">bool</span> skip)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> num = abs(g_options.num_alloc);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.num_alloc &lt; 0) { <span class="comment">/* random up to */</span></div>
<div class="line">                num = rand() % (num + 1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* check max window */</span></div>
<div class="line">        <span class="keywordflow">if</span> (msg-&gt;allocated + num &gt; g_options.window)</div>
<div class="line">                num = g_options.window - msg-&gt;allocated;</div>
<div class="line">        <span class="keywordflow">if</span> (!num)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        int64_t diff;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.use_odp) { <span class="comment">/* bypass, use ODP API */</span></div>
<div class="line">                <span class="keywordflow">if</span> (g_options.pool.type == <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a3ee5e35cc122532fcbdcd183735463d7">EM_EVENT_TYPE_PACKET</a>)</div>
<div class="line">                        do_odp_pktmulti_alloc(msg, odp_pool, size, num, &amp;diff);</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        do_odp_bufmulti_alloc(msg, odp_pool, size, num, &amp;diff);</div>
<div class="line">        } <span class="keywordflow">else</span> { <span class="comment">/* use EM API */</span></div>
<div class="line">                em_event_t ev[MAX_ALLOCS];</div>
<div class="line">                uint64_t t1 = TIME_FN();</div>
<div class="line">                <span class="keywordtype">int</span> got = <a name="a8"></a><a class="code" href="../../d5/d33/group__em__event.html#ga3256e7b651fe9e0cf5d3206d8e58f59d">em_alloc_multi</a>(ev, num, size, g_options.pool.type, pool);</div>
<div class="line"> </div>
<div class="line">                diff = (int64_t)TIME_FN() - (int64_t)t1;</div>
<div class="line">                test_fatal_if(num != got, <span class="stringliteral">&quot;not enough events from pool&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num; i++)</div>
<div class="line">                        test_fatal_if(enqueue_event(msg, (event_handle_t)ev[i]) == <span class="keyword">false</span>,</div>
<div class="line">                                      <span class="stringliteral">&quot;Unexpected: event ring full!&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* TS overhead compensation */</span></div>
<div class="line">        diff -= perf_shm-&gt;ts_overhead;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!skip) { <span class="comment">/* per instance stats */</span></div>
<div class="line">                <span class="keywordflow">if</span> (diff &lt; msg-&gt;times.alloc.min_ns) {</div>
<div class="line">                        msg-&gt;times.alloc.min_ns = diff;</div>
<div class="line">                        msg-&gt;times.alloc.min_evt = msg-&gt;count;</div>
<div class="line">                        msg-&gt;times.alloc.min_burst = num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (diff &gt; msg-&gt;times.alloc.max_ns) {</div>
<div class="line">                        msg-&gt;times.alloc.max_ns = diff;</div>
<div class="line">                        msg-&gt;times.alloc.max_evt = msg-&gt;count;</div>
<div class="line">                        msg-&gt;times.alloc.max_burst = num;</div>
<div class="line">                }</div>
<div class="line">                add_to_bin(BIN_ALLOC, diff);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        msg-&gt;allocated += num; <span class="comment">/* current batch */</span></div>
<div class="line">        msg-&gt;times.alloc.tot_allocs += num;</div>
<div class="line">        msg-&gt;times.alloc.sum_ns += diff;</div>
<div class="line">        perf_shm-&gt;counts[<a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>()].allocs += num;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">int64_t __attribute__ ((noinline)) do_em_event_free(em_event_t ev)</div>
<div class="line">{</div>
<div class="line">        test_fatal_if(ev == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>, <span class="stringliteral">&quot;Unexpected, no em event from ring not empty!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        uint64_t t1 = TIME_FN();</div>
<div class="line"> </div>
<div class="line">        <a name="a9"></a><a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(ev);</div>
<div class="line">        <span class="keywordflow">return</span> (int64_t)TIME_FN() - (int64_t)t1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">int64_t __attribute__ ((noinline)) do_odp_event_free(odp_event_t ev)</div>
<div class="line">{</div>
<div class="line">        test_fatal_if(ev == ODP_EVENT_INVALID, <span class="stringliteral">&quot;Unexpected, no odp event from ring not empty!&quot;</span>);</div>
<div class="line">        uint64_t t1 = TIME_FN();</div>
<div class="line"> </div>
<div class="line">        odp_event_free(ev);</div>
<div class="line">        <span class="keywordflow">return</span> (int64_t)TIME_FN() - (int64_t)t1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> free_events(test_msg *msg, <span class="keywordtype">bool</span> skip)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num = abs(g_options.num_free);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.num_free &lt; 0) { <span class="comment">/* random up to */</span></div>
<div class="line">                num = rand() % (num + 1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* there&#39;s always at least one to free if we&#39;re here */</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; num; i++) {</div>
<div class="line">                event_handle_t ev;</div>
<div class="line">                int64_t diff;</div>
<div class="line"> </div>
<div class="line">                test_fatal_if(dequeue_event(msg, &amp;ev) == <span class="keyword">false</span>, <span class="stringliteral">&quot;Unexpected, ring empty!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (g_options.use_odp)</div>
<div class="line">                        diff = do_odp_event_free(ev.odp_ev);</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        diff = do_em_event_free(ev.em_ev);</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* TS overhead */</span></div>
<div class="line">                diff -= perf_shm-&gt;ts_overhead;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (!skip) { <span class="comment">/* instance stats */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (diff &lt; msg-&gt;times.free.min_ns) {</div>
<div class="line">                                msg-&gt;times.free.min_ns = diff;</div>
<div class="line">                                msg-&gt;times.free.min_evt = msg-&gt;count;</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">if</span> (diff &gt; msg-&gt;times.free.max_ns) {</div>
<div class="line">                                msg-&gt;times.free.max_ns = diff;</div>
<div class="line">                                msg-&gt;times.free.max_evt = msg-&gt;count;</div>
<div class="line">                        }</div>
<div class="line">                        add_to_bin(BIN_FREE, diff);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                msg-&gt;allocated--;</div>
<div class="line">                msg-&gt;times.free.tot_free++;</div>
<div class="line">                msg-&gt;times.free.sum_ns += diff;</div>
<div class="line">                perf_shm-&gt;counts[<a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>()].frees++;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (!msg-&gt;allocated)</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> free_events_multi(test_msg *msg, <span class="keywordtype">bool</span> skip)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num = abs(g_options.num_free);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.num_free &lt; 0) { <span class="comment">/* random up to */</span></div>
<div class="line">                num = rand() % (num + 1);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (msg-&gt;allocated &lt; num)</div>
<div class="line">                num = msg-&gt;allocated;</div>
<div class="line">        <span class="keywordflow">if</span> (!num)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        int64_t diff;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.use_odp) {</div>
<div class="line">                odp_event_t events[MAX_ALLOCS];</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* collect for multi first */</span></div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; num; i++)</div>
<div class="line">                        test_fatal_if(dequeue_event(msg, (event_handle_t *)&amp;events[i]) == <span class="keyword">false</span>,</div>
<div class="line">                                      <span class="stringliteral">&quot;Unexpected, ring empty!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                uint64_t t1 = TIME_FN();</div>
<div class="line"> </div>
<div class="line">                odp_event_free_multi(events, num);</div>
<div class="line">                diff = (int64_t)TIME_FN() - (int64_t)t1;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                em_event_t events[MAX_ALLOCS];</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; num; i++)</div>
<div class="line">                        test_fatal_if(dequeue_event(msg, (event_handle_t *)&amp;events[i]) == <span class="keyword">false</span>,</div>
<div class="line">                                      <span class="stringliteral">&quot;Unexpected, ring empty!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                uint64_t t1 = TIME_FN();</div>
<div class="line"> </div>
<div class="line">                <a name="a10"></a><a class="code" href="../../d5/d33/group__em__event.html#ga824c1dee097236d554918d6702431beb">em_free_multi</a>(events, num);</div>
<div class="line">                diff = (int64_t)TIME_FN() - (int64_t)t1;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* TS overhead */</span></div>
<div class="line">        diff -= perf_shm-&gt;ts_overhead;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!skip) { <span class="comment">/* instance stats */</span></div>
<div class="line">                <span class="keywordflow">if</span> (diff &lt; msg-&gt;times.free.min_ns) {</div>
<div class="line">                        msg-&gt;times.free.min_ns = diff;</div>
<div class="line">                        msg-&gt;times.free.min_evt = msg-&gt;count;</div>
<div class="line">                        msg-&gt;times.free.min_burst = num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (diff &gt; msg-&gt;times.free.max_ns) {</div>
<div class="line">                        msg-&gt;times.free.max_ns = diff;</div>
<div class="line">                        msg-&gt;times.free.max_evt = msg-&gt;count;</div>
<div class="line">                        msg-&gt;times.free.max_burst = num;</div>
<div class="line">                }</div>
<div class="line">                add_to_bin(BIN_FREE, diff);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        msg-&gt;allocated -= num;</div>
<div class="line">        msg-&gt;times.free.tot_free += num;</div>
<div class="line">        msg-&gt;times.free.sum_ns += diff;</div>
<div class="line">        perf_shm-&gt;counts[<a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>()].frees -= num;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> update_allocs(test_msg *msg, em_pool_t pool, <span class="keywordtype">size_t</span> size, odp_pool_t odp_pool)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* operation is per context, event contains all state */</span></div>
<div class="line"> </div>
<div class="line">        perf_shm-&gt;counts[<a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>()].events++;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (msg-&gt;times.alloc.tot_allocs == 0)</div>
<div class="line">                msg-&gt;start_ns = TIME_FN(); <span class="comment">/* start of cycle */</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">bool</span> skip = g_options.skip &amp;&amp; (msg-&gt;times.alloc.tot_allocs &lt; g_options.skip) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* first do some allocations */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(msg-&gt;count &amp; 1)) { <span class="comment">/* on even counts */</span></div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (g_options.no_first &amp;&amp;</div>
<div class="line">                    perf_shm-&gt;counts[<a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>()].events &lt;= g_options.no_first)</div>
<div class="line">                        skip = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (msg-&gt;allocated &lt; g_options.window) {</div>
<div class="line">                        <span class="keywordflow">if</span> (g_options.use_multi)</div>
<div class="line">                                allocate_events_multi(msg, pool, size, odp_pool, skip);</div>
<div class="line">                        <span class="keywordflow">else</span></div>
<div class="line">                                allocate_events(msg, pool, size, odp_pool, skip);</div>
<div class="line">                }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="comment">/* then frees on odd counts */</span></div>
<div class="line">                <span class="keywordflow">if</span> (msg-&gt;allocated) {</div>
<div class="line">                        <span class="keywordflow">if</span> (g_options.use_multi)</div>
<div class="line">                                free_events_multi(msg, skip);</div>
<div class="line">                        <span class="keywordflow">else</span></div>
<div class="line">                                free_events(msg, skip);</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> flush_data(test_msg *msg)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* simple simulated cache flushing, copy 2nd half of buffer to begin */</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">size_t</span> len =  msg-&gt;flush_b / 2;</div>
<div class="line">        uint8_t *b1 = (uint8_t *)msg-&gt;flush_buf;</div>
<div class="line">        uint8_t *b2 = b1 + len;</div>
<div class="line"> </div>
<div class="line">        memcpy(b1, b2, len);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">em_pool_t create_test_pool(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <a name="_a11"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html">em_pool_cfg_t</a> cfg;</div>
<div class="line"> </div>
<div class="line">        <a name="a12"></a><a class="code" href="../../d1/d85/group__em__pool.html#ga0a0585d9c293ce9d93d2b7235935313a">em_pool_cfg_init</a>(&amp;cfg);</div>
<div class="line">        cfg.<a name="a13"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html#a3929a4fcd68d78ef12347bb6f230fd3a">num_subpools</a> = 1; <span class="comment">/* simple single subpool for now */</span></div>
<div class="line">        cfg.<a name="a14"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html#a8df13d5f2195860c030809996ca4f493">event_type</a> = g_options.pool.type;</div>
<div class="line">        cfg.<a name="a15"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html#aa67ebf1bba1e9239f2332030aaf39e2a">subpool</a>[0].<a name="a16"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html#a3f8e331ebdc0f001c76e4b89b40124e6">num</a> = g_options.pool.num;</div>
<div class="line">        cfg.<a class="code" href="../../d2/db5/structem__pool__cfg__t.html#aa67ebf1bba1e9239f2332030aaf39e2a">subpool</a>[0].<a name="a17"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html#aa74d6a49cffa671532948eaac1dadfc2">size</a> = g_options.pool.size;</div>
<div class="line">        cfg.<a class="code" href="../../d2/db5/structem__pool__cfg__t.html#aa67ebf1bba1e9239f2332030aaf39e2a">subpool</a>[0].<a name="a18"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html#a783e3e9dafe05be89ccfe13b3949842d">cache_size</a> = g_options.pool.cache;</div>
<div class="line"> </div>
<div class="line">        em_pool_t pool = <a name="a19"></a><a class="code" href="../../d1/d85/group__em__pool.html#ga05acc37c035cef81910e8ea77e5db158">em_pool_create</a>(<span class="stringliteral">&quot;TestPool&quot;</span>, <a name="a20"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a67fed61187c93569c92da0647970a29f">EM_POOL_UNDEF</a>, &amp;cfg);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> pool;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> free_ring(test_msg *msg)</div>
<div class="line">{</div>
<div class="line">        event_handle_t ev;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">while</span> (dequeue_event(msg, &amp;ev)) {</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.use_odp)</div>
<div class="line">                        odp_event_free(ev.odp_ev);</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(ev.em_ev);</div>
<div class="line">        }</div>
<div class="line">        msg-&gt;allocated = 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> print_uptime(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        uint64_t ns = TIME_FN() - perf_shm-&gt;start_time;</div>
<div class="line">        uint64_t ms = ns / 1000000ULL;</div>
<div class="line">        uint64_t seconds = ms / 1000ULL;</div>
<div class="line">        uint64_t minutes = seconds / 60;</div>
<div class="line">        uint64_t hours = minutes / 60;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%lu:%02lu:%02lu.%03lu&quot;</span>, hours, minutes % 60, seconds % 60, ms % 1000);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> print_setup(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\n Cores:             %u\n&quot;</span>, perf_shm-&gt;core_count);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Loops:             %u\n&quot;</span>, g_options.loops);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Batch per loop:    %u\n&quot;</span>, g_options.perloop);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Parallel events:   %u\n&quot;</span>, g_options.events);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Num burst alloc:   %u%s\n&quot;</span>,</div>
<div class="line">                   abs(g_options.num_alloc), g_options.num_alloc &lt; 0 ? <span class="stringliteral">&quot;(max rnd)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Num burst free:    %u%s\n&quot;</span>,</div>
<div class="line">                   abs(g_options.num_free), g_options.num_free &lt; 0 ? <span class="stringliteral">&quot;(max rnd)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Alloc window:      %u\n&quot;</span>, g_options.window);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Delay after alloc: %luns\n&quot;</span>, g_options.delay);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Event size:        %u\n&quot;</span>, g_options.size);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Bypass EM:         %s\n&quot;</span>, g_options.use_odp ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Flush/copy:        %ukB\n&quot;</span>, g_options.flush);</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.skip)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; Skip first:        %u\n&quot;</span>, g_options.skip);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Skip N per core:   %u\n&quot;</span>, g_options.no_first);</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.pool.num) {</div>
<div class="line">                <span class="keywordtype">char</span> type[10] = {0};</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (g_options.pool.type == <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>)</div>
<div class="line">                        strncpy(type, <span class="stringliteral">&quot;SW&quot;</span>, <span class="keyword">sizeof</span>(type));</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        strncpy(type, <span class="stringliteral">&quot;PACKET&quot;</span>, <span class="keyword">sizeof</span>(type));</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; Test pool:         %u * %uB, cache %u, %s\n&quot;</span>,</div>
<div class="line">                           g_options.pool.num, g_options.pool.size,</div>
<div class="line">                           g_options.pool.cache, type);</div>
<div class="line">        }</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Use _multi:        %s\n\n&quot;</span>, g_options.use_multi ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Using test pool:\n&quot;</span>);</div>
<div class="line">        <a name="a21"></a><a class="code" href="../../d1/d85/group__em__pool.html#ga7e5d4bfa167258fa53ff26c0ab34341b">em_pool_info_print</a>(perf_shm-&gt;eo_ctx.test_pool);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> restart(em_queue_t testq)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* start new round */</span></div>
<div class="line">        perf_shm-&gt;events_left = g_options.events;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; g_options.events; i++) {</div>
<div class="line">                em_event_t ev = <a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(test_msg), <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>, <a name="a22"></a><a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a>);</div>
<div class="line"> </div>
<div class="line">                test_fatal_if(ev == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>, <span class="stringliteral">&quot;Event alloc fail&quot;</span>);</div>
<div class="line">                test_msg *msg = <a name="a23"></a><a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(ev);</div>
<div class="line"> </div>
<div class="line">                memset(msg, 0, <span class="keyword">sizeof</span>(test_msg));</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; MAX_ALLOCS; j++) {</div>
<div class="line">                        <span class="keywordflow">if</span> (g_options.use_odp)</div>
<div class="line">                                msg-&gt;events[j].odp_ev = ODP_EVENT_INVALID;</div>
<div class="line">                        <span class="keywordflow">else</span></div>
<div class="line">                                msg-&gt;events[j].em_ev = <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>;</div>
<div class="line">                }</div>
<div class="line">                msg-&gt;times.alloc.min_ns = INT64_MAX;</div>
<div class="line">                msg-&gt;times.alloc.max_ns = INT64_MIN;</div>
<div class="line">                msg-&gt;instance = i + 1;</div>
<div class="line">                msg-&gt;flush_b = g_options.flush * 1024;</div>
<div class="line">                msg-&gt;flush_buf = NULL;</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.flush) {</div>
<div class="line">                        msg-&gt;flush_buf = malloc(msg-&gt;flush_b);</div>
<div class="line">                        test_fatal_if(msg-&gt;flush_buf == NULL, <span class="stringliteral">&quot;Malloc fail&quot;</span>);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret = <a name="a24"></a><a class="code" href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a>(ev, testq);</div>
<div class="line"> </div>
<div class="line">                test_fatal_if(ret != <a name="a25"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Send fail&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Start, sent %u context events\n&quot;</span>, g_options.events);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test_start(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        test_fatal_if(appl_conf-&gt;core_count &gt; MAX_CORES, <span class="stringliteral">&quot;Too many cores&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Store the number of EM-cores running the application */</span></div>
<div class="line">        perf_shm-&gt;core_count = appl_conf-&gt;core_count;</div>
<div class="line"> </div>
<div class="line">        perf_shm-&gt;ts_overhead = try_timestamp_overhead();</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;time stamp pair overhead seems to be %lu ns\n&quot;</span>,</div>
<div class="line">                   perf_shm-&gt;ts_overhead);</div>
<div class="line"> </div>
<div class="line">        init_bins();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Create EO */</span></div>
<div class="line">        perf_shm-&gt;eo = <a name="a26"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga196c7caa1177575fd424e9a0d2854da6">em_eo_create</a>(<span class="stringliteral">&quot;pool test eo&quot;</span>, start, NULL, stop, NULL, receive_func,</div>
<div class="line">                                    &amp;perf_shm-&gt;eo_ctx);</div>
<div class="line">        test_fatal_if(perf_shm-&gt;eo == <a name="a27"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#af28fb8daf62b942ced417e158ed7e1c7">EM_EO_UNDEF</a>, <span class="stringliteral">&quot;EO create failed&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Queues */</span></div>
<div class="line">        em_queue_t q = <a name="a28"></a><a class="code" href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a>(<span class="stringliteral">&quot;testQ&quot;</span>, <a name="a29"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea">EM_QUEUE_TYPE_PARALLEL</a>,</div>
<div class="line">                                       <a name="a30"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca">EM_QUEUE_PRIO_NORMAL</a>, <a name="a31"></a><a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a>, NULL);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(q == <a name="a32"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#ae8ba676fb5528d220363edad0aeef1ff">EM_QUEUE_UNDEF</a>, <span class="stringliteral">&quot;Q create fail&quot;</span>);</div>
<div class="line">        <a name="a33"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a>(perf_shm-&gt;eo, q);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Pool */</span></div>
<div class="line">        <span class="keywordflow">if</span> (g_options.pool.num) { <span class="comment">/* create specific test pool */</span></div>
<div class="line">                em_pool_t pool = create_test_pool();</div>
<div class="line"> </div>
<div class="line">                test_fatal_if(pool == <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a67fed61187c93569c92da0647970a29f">EM_POOL_UNDEF</a>, <span class="stringliteral">&quot;Can&#39;t create test pool!&quot;</span>);</div>
<div class="line">                perf_shm-&gt;eo_ctx.test_pool = pool;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">if</span> (appl_conf-&gt;num_pools &gt;= 1)</div>
<div class="line">                        perf_shm-&gt;eo_ctx.test_pool = appl_conf-&gt;pools[0];</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        perf_shm-&gt;eo_ctx.test_pool = <a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        odp_pool_t opool;</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(<a name="a34"></a><a class="code" href="../../d5/d72/group__em__odp__ext.html#ga0c02065ab01fe73e2eaf5f0dfd428ace">em_odp_pool2odp</a>(perf_shm-&gt;eo_ctx.test_pool, &amp;opool, 1) &lt; 1,</div>
<div class="line">                      <span class="stringliteral">&quot;Unexpected: can&#39;t get odp pool from test pool&quot;</span>);</div>
<div class="line">        perf_shm-&gt;eo_ctx.odp_pool = opool; <span class="comment">/* ignores subpools */</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* adjust window to fit allocs */</span></div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxval = abs(g_options.num_alloc);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)abs(g_options.num_free) &gt; maxval)</div>
<div class="line">                maxval = abs(g_options.num_free);</div>
<div class="line">        <span class="keywordflow">if</span> (maxval &gt; g_options.window) {</div>
<div class="line">                g_options.window = maxval;</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;Increased alloc window to %u\n&quot;</span>, g_options.window);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        print_setup();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Start EO */</span></div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> start_ret = <a name="a35"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a740919266fbb41b8a8127a9ef215eea0afac5dceb8d327a1cbff66cdfa3a93a81">EM_ERR</a>, ret;</div>
<div class="line"> </div>
<div class="line">        perf_shm-&gt;eo_ctx.test_q = q;</div>
<div class="line">        perf_shm-&gt;stopping = <span class="keyword">false</span>;</div>
<div class="line">        odp_spinlock_init(&amp;perf_shm-&gt;lock);</div>
<div class="line">        perf_shm-&gt;times.min_alloc = INT64_MAX;</div>
<div class="line">        perf_shm-&gt;times.min_free = INT64_MAX;</div>
<div class="line"> </div>
<div class="line">        ret = <a name="a36"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gabe4f7a789ec9523367c086793061562d">em_eo_start_sync</a>(perf_shm-&gt;eo, &amp;start_ret, NULL);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a> || start_ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO start:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; %&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>, ret, start_ret);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test_stop(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        em_eo_t eo;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line"> </div>
<div class="line">        (void)appl_conf;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%s() on EM-core %d\n&quot;</span>, __func__, <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>());</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Stop EOs */</span></div>
<div class="line">        eo = perf_shm-&gt;eo;</div>
<div class="line">        ret = <a name="a37"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gadce026621953114bd26e5836d9693465">em_eo_stop_sync</a>(eo);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO:%&quot;</span> <a name="a38"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; stop:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>, eo, ret);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Remove and delete all of the EO&#39;s queues, then delete the EO */</span></div>
<div class="line">        eo = perf_shm-&gt;eo;</div>
<div class="line">        ret = <a name="a39"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga10cf8094caa56026eb0a402d3d22da23">em_eo_remove_queue_all_sync</a>(eo, <a name="a40"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a419c8373b72a8c5ed1c3e3ded3e262e0">EM_TRUE</a>);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO remove queue all:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot;&quot;</span>, ret, eo);</div>
<div class="line">        ret = <a name="a41"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gae769b19e613b24487beb943cfb926977">em_eo_delete</a>(eo);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; delete:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>, eo, ret);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test_term(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        (void)appl_conf;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%s() on EM-core %d\n&quot;</span>, __func__, <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>());</div>
<div class="line">        <a name="a42"></a><a class="code" href="../../db/da0/group__em__error.html#gab6b469100e5f60670a742d944a6f530b">em_unregister_error_handler</a>();</div>
<div class="line">        env_shared_free(perf_shm);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> start(<span class="keywordtype">void</span> *eo_context, em_eo_t eo, <span class="keyword">const</span> <a class="code" href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a> *conf)</div>
<div class="line">{</div>
<div class="line">        (void)conf;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;EO %&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; starting\n&quot;</span>, eo);</div>
<div class="line"> </div>
<div class="line">        perf_shm-&gt;start_time = TIME_FN();</div>
<div class="line">        restart(((app_eo_ctx *)eo_context)-&gt;test_q);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> print_global_stat(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Test time &quot;</span>);</div>
<div class="line">        print_uptime();</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\nGLOBAL stats, loops completed %d/%d:\n&quot;</span>,</div>
<div class="line">                   perf_shm-&gt;loopcount, g_options.loops);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# global min alloc: %ld ns&quot;</span>, perf_shm-&gt;times.min_alloc);</div>
<div class="line">        <span class="keywordflow">if</span> (perf_shm-&gt;times.min_alloc &lt;= perf_shm-&gt;ts_overhead)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; (oh comp. %ld)&quot;</span>, perf_shm-&gt;ts_overhead);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\n# global max alloc: %ld ns\n&quot;</span>, perf_shm-&gt;times.max_alloc);</div>
<div class="line"> </div>
<div class="line">        int64_t avg = perf_shm-&gt;times.time_allocs / perf_shm-&gt;times.num_alloc;</div>
<div class="line">        <span class="keywordtype">double</span> run_us = (double)(TIME_FN() - perf_shm-&gt;start_time) / 1000.0;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# global avg alloc: %ld ns (per buf/pkt)\n&quot;</span>, avg);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# global alloc rate: %f M alloc/s\n\n&quot;</span>,</div>
<div class="line">                   (<span class="keywordtype">double</span>)perf_shm-&gt;times.num_alloc / (<span class="keywordtype">double</span>)run_us);</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# global min free: %ld ns&quot;</span>, perf_shm-&gt;times.min_free);</div>
<div class="line">        <span class="keywordflow">if</span> (perf_shm-&gt;times.min_free &lt;= perf_shm-&gt;ts_overhead)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; (oh comp. %ld)&quot;</span>, perf_shm-&gt;ts_overhead);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\n# global max free: %ld ns\n&quot;</span>, perf_shm-&gt;times.max_free);</div>
<div class="line"> </div>
<div class="line">        avg = perf_shm-&gt;times.time_free / perf_shm-&gt;times.num_free;</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# global avg free: %ld ns (per buf/pkt)\n\n&quot;</span>, avg);</div>
<div class="line"> </div>
<div class="line">        print_bin(BIN_ALLOC);</div>
<div class="line">        print_bin(BIN_FREE);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* per core */</span></div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\ncore#   #allocs     #frees      #events     #burst avg\n&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;------------------------------------------------------\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; perf_shm-&gt;core_count; i++)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;%-8d%-12lu%-12lu%-12lu%-12.2f\n&quot;</span>,</div>
<div class="line">                           i, perf_shm-&gt;counts[i].allocs,</div>
<div class="line">                           perf_shm-&gt;counts[i].frees,</div>
<div class="line">                           perf_shm-&gt;counts[i].events,</div>
<div class="line">                           (<span class="keywordtype">double</span>)perf_shm-&gt;counts[i].allocs /</div>
<div class="line">                           (<span class="keywordtype">double</span>)perf_shm-&gt;counts[i].events * 2);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> print_upd_stat(test_msg *msg, uint64_t endt)</div>
<div class="line">{</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# Instance #%lu:\n&quot;</span>, msg-&gt;instance);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.use_multi)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;MULTI alloc mode (times are one burst!)\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* alloc */</span></div>
<div class="line">        <span class="keywordflow">if</span> (msg-&gt;times.alloc.min_ns &lt;= perf_shm-&gt;ts_overhead)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;# Min alloc: %ld ns (oh compensation -%ld)\n&quot;</span>,</div>
<div class="line">                           msg-&gt;times.alloc.min_ns, perf_shm-&gt;ts_overhead);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;# Min alloc: %ld ns\n&quot;</span>, msg-&gt;times.alloc.min_ns);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# Min alloc evt#: %lu\n&quot;</span>, msg-&gt;times.alloc.min_evt);</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.use_multi)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;# Min alloc burst#: %lu\n&quot;</span>, msg-&gt;times.alloc.min_burst);</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# Max alloc: %ld ns\n&quot;</span>, msg-&gt;times.alloc.max_ns);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# Max alloc evt#: %lu\n&quot;</span>, msg-&gt;times.alloc.max_evt);</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.use_multi)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;# Max alloc burst#: %lu\n&quot;</span>, msg-&gt;times.alloc.max_burst);</div>
<div class="line"> </div>
<div class="line">        int64_t avg = msg-&gt;times.alloc.sum_ns / msg-&gt;times.alloc.tot_allocs;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# Avg alloc: %ld ns\n&quot;</span>, avg);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Total allocs: %lu\n&quot;</span>, msg-&gt;times.alloc.tot_allocs);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Total events: %lu\n&quot;</span>, msg-&gt;count);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* free */</span></div>
<div class="line">        <span class="keywordflow">if</span> (msg-&gt;times.free.min_ns &lt;= perf_shm-&gt;ts_overhead)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;# Min free: %ld ns (oh compensation -%ld)\n&quot;</span>,</div>
<div class="line">                           msg-&gt;times.free.min_ns, perf_shm-&gt;ts_overhead);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;# Min free: %ld ns\n&quot;</span>, msg-&gt;times.free.min_ns);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# Min free evt#: %lu\n&quot;</span>, msg-&gt;times.free.min_evt);</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# Max free: %ld ns\n&quot;</span>, msg-&gt;times.free.max_ns);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# Max free evt#: %lu\n&quot;</span>, msg-&gt;times.free.max_evt);</div>
<div class="line"> </div>
<div class="line">        avg = msg-&gt;times.free.sum_ns / msg-&gt;times.free.tot_free;</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# Avg free: %ld ns\n&quot;</span>, avg);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Total free: %lu\n&quot;</span>, msg-&gt;times.free.tot_free);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">double</span> secs = (double)(endt - msg-&gt;start_ns) / 1000000000.0;</div>
<div class="line">        <span class="keywordtype">double</span> rate = (double)msg-&gt;times.alloc.tot_allocs / secs;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Run time, s: %.6f\n&quot;</span>, secs);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;# Alloc rate (M a/sec): %.5f\n\n&quot;</span>, rate / 1000000);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* update global stats */</span></div>
<div class="line">        odp_spinlock_lock(&amp;perf_shm-&gt;lock);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (msg-&gt;times.alloc.min_ns &lt; perf_shm-&gt;times.min_alloc)</div>
<div class="line">                perf_shm-&gt;times.min_alloc = msg-&gt;times.alloc.min_ns;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (msg-&gt;times.alloc.max_ns &gt; perf_shm-&gt;times.max_alloc)</div>
<div class="line">                perf_shm-&gt;times.max_alloc = msg-&gt;times.alloc.max_ns;</div>
<div class="line"> </div>
<div class="line">        perf_shm-&gt;times.num_alloc += msg-&gt;times.alloc.tot_allocs;</div>
<div class="line">        perf_shm-&gt;times.time_allocs += msg-&gt;times.alloc.sum_ns;</div>
<div class="line">        perf_shm-&gt;times.num_updates++;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (msg-&gt;times.free.min_ns &lt; perf_shm-&gt;times.min_free)</div>
<div class="line">                perf_shm-&gt;times.min_free = msg-&gt;times.free.min_ns;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (msg-&gt;times.free.max_ns &gt; perf_shm-&gt;times.max_free)</div>
<div class="line">                perf_shm-&gt;times.max_free = msg-&gt;times.free.max_ns;</div>
<div class="line">        perf_shm-&gt;times.num_free += msg-&gt;times.free.tot_free;</div>
<div class="line">        perf_shm-&gt;times.time_free += msg-&gt;times.free.sum_ns;</div>
<div class="line">        perf_shm-&gt;times.num_updates++;</div>
<div class="line"> </div>
<div class="line">        odp_spinlock_unlock(&amp;perf_shm-&gt;lock);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> stop(<span class="keywordtype">void</span> *eo_context, em_eo_t eo)</div>
<div class="line">{</div>
<div class="line">        (void)eo_context;</div>
<div class="line"> </div>
<div class="line">        perf_shm-&gt;stopping = <span class="keyword">true</span>;</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;EO %&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; stopping\n&quot;</span>, eo);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> receive_func(<span class="keywordtype">void</span> *eo_context, em_event_t event, <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> type,</div>
<div class="line">                  em_queue_t queue, <span class="keywordtype">void</span> *q_context)</div>
<div class="line">{</div>
<div class="line">        app_eo_ctx *ctx = (app_eo_ctx *)eo_context;</div>
<div class="line">        test_msg *msg = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line"> </div>
<div class="line">        (void)type;</div>
<div class="line">        (void)q_context;</div>
<div class="line">        (void)queue;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (perf_shm-&gt;stopping) {</div>
<div class="line">                <span class="keywordflow">if</span> (msg-&gt;flush_buf)</div>
<div class="line">                        free(msg-&gt;flush_buf);</div>
<div class="line">                free_ring(msg);</div>
<div class="line">                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* allocate or free some buffers */</span></div>
<div class="line">        update_allocs(msg, ctx-&gt;test_pool, g_options.size, ctx-&gt;odp_pool);</div>
<div class="line">        msg-&gt;count++;</div>
<div class="line"> </div>
<div class="line">         <span class="comment">/* optional simulated processing time */</span></div>
<div class="line">        <span class="keywordflow">if</span> (g_options.delay)</div>
<div class="line">                do_work(g_options.delay);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* optional cache flush simulation */</span></div>
<div class="line">        <span class="keywordflow">if</span> (msg-&gt;flush_buf)</div>
<div class="line">                flush_data(msg);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* one instance loop done? -&gt; collect statistics */</span></div>
<div class="line">        <span class="keywordflow">if</span> (msg-&gt;count &gt;= g_options.perloop) {</div>
<div class="line">                uint64_t endt = TIME_FN();</div>
<div class="line"> </div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;Loop complete for instance #%lu at core %d\n&quot;</span>,</div>
<div class="line">                           msg-&gt;instance, <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>());</div>
<div class="line">                print_upd_stat(msg, endt);</div>
<div class="line">                <span class="keywordflow">if</span> (msg-&gt;flush_buf)</div>
<div class="line">                        free(msg-&gt;flush_buf);</div>
<div class="line">                free_ring(msg);</div>
<div class="line">                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (atomic_fetch_sub(&amp;perf_shm-&gt;events_left, 1) == 1) {</div>
<div class="line">                        <span class="comment">/* last instance now done */</span></div>
<div class="line">                        perf_shm-&gt;loopcount++;</div>
<div class="line">                        print_global_stat();</div>
<div class="line">                        <span class="keywordflow">if</span> (g_options.loops &amp;&amp; perf_shm-&gt;loopcount &gt;= g_options.loops) {</div>
<div class="line">                                perf_shm-&gt;stopping = <span class="keyword">true</span>;</div>
<div class="line">                                <span class="keyword">raise</span>(SIGINT);</div>
<div class="line">                                <span class="keywordflow">return</span>;</div>
<div class="line">                        }</div>
<div class="line">                        restart(ctx-&gt;test_q);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* not done, keep going */</span></div>
<div class="line">        ret = <a class="code" href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a>(event, ctx-&gt;test_q);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Event send fail&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/***** MAIN *****/</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* pick app-specific arguments after &#39;--&#39; */</span></div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (!strcmp(argv[i], <span class="stringliteral">&quot;--&quot;</span>))</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (i &lt; argc) {</div>
<div class="line">                <span class="keywordflow">if</span> (!parse_args(i, argc, argv)) {</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;Invalid application arguments\n&quot;</span>);</div>
<div class="line">                        <span class="keywordflow">return</span> 1;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> cm_setup(argc, argv);</div>
<div class="line">}</div>
<div class="ttc" id="aenvironment_8h_html"><div class="ttname"><a href="../../de/d26/environment_8h.html">environment.h</a></div></div>
<div class="ttc" id="aevent__machine_8h_html"><div class="ttname"><a href="../../d7/d5e/event__machine_8h.html">event_machine.h</a></div></div>
<div class="ttc" id="aevent__machine__hw__config_8h_html_aaa0a290a45f4b1280f3330fadde6bfde"><div class="ttname"><a href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a></div><div class="ttdeci">#define EM_POOL_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6d/event__machine__hw__config_8h_source.html#l00191">event_machine_hw_config.h:191</a></div></div>
<div class="ttc" id="aevent__machine__hw__config_8h_html_ae56af1c575498ec19f0836ee916d0eb9"><div class="ttname"><a href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a></div><div class="ttdeci">#define EM_QUEUE_GROUP_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6d/event__machine__hw__config_8h_source.html#l00147">event_machine_hw_config.h:147</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea">EM_QUEUE_TYPE_PARALLEL</a></div><div class="ttdeci">@ EM_QUEUE_TYPE_PARALLEL</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00117">event_machine_hw_types.h:117</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a67fed61187c93569c92da0647970a29f"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a67fed61187c93569c92da0647970a29f">EM_POOL_UNDEF</a></div><div class="ttdeci">#define EM_POOL_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00060">event_machine_hw_types.h:60</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a740919266fbb41b8a8127a9ef215eea0afac5dceb8d327a1cbff66cdfa3a93a81"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a740919266fbb41b8a8127a9ef215eea0afac5dceb8d327a1cbff66cdfa3a93a81">EM_ERR</a></div><div class="ttdeci">@ EM_ERR</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00313">event_machine_hw_types.h:312</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca">EM_QUEUE_PRIO_NORMAL</a></div><div class="ttdeci">@ EM_QUEUE_PRIO_NORMAL</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00153">event_machine_hw_types.h:153</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_ac341b7db29d8127e864a45c9bd2a4aa3"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a></div><div class="ttdeci">#define EM_ERROR_SET_FATAL(error)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00428">event_machine_hw_types.h:428</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a></div><div class="ttdeci">@ EM_EVENT_TYPE_SW</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00072">event_machine_hw_types.h:72</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_ace0fe27049350469ff1be8188acfea89a3ee5e35cc122532fcbdcd183735463d7"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a3ee5e35cc122532fcbdcd183735463d7">EM_EVENT_TYPE_PACKET</a></div><div class="ttdeci">@ EM_EVENT_TYPE_PACKET</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00075">event_machine_hw_types.h:75</a></div></div>
<div class="ttc" id="aevent__machine__odp__ext_8h_html"><div class="ttname"><a href="../../d5/dbf/event__machine__odp__ext_8h.html">event_machine_odp_ext.h</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a03546e6a7e93665c52d479831e0a6dca"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a></div><div class="ttdeci">#define EM_OK</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00329">event_machine_types.h:329</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a0bf4a25d46e18ee918e684e5deb27fa4"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a></div><div class="ttdeci">#define PRI_EO</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00097">event_machine_types.h:97</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a0c0a929399ae33b615f8ca8018d2a69d"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a0c0a929399ae33b615f8ca8018d2a69d">em_escope_t</a></div><div class="ttdeci">uint32_t em_escope_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00348">event_machine_types.h:348</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a419c8373b72a8c5ed1c3e3ded3e262e0"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a419c8373b72a8c5ed1c3e3ded3e262e0">EM_TRUE</a></div><div class="ttdeci">#define EM_TRUE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00053">event_machine_types.h:53</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a49fd700da185b0f64834bf967479a992"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a></div><div class="ttdeci">uint32_t em_event_type_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00085">event_machine_types.h:85</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a8542d9c2c9a29e35ff042b1d59cc479b"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a></div><div class="ttdeci">#define EM_EVENT_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00062">event_machine_types.h:62</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_adddd88868f7aa0d32b3e40245eb4ef8f"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div><div class="ttdeci">uint32_t em_status_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00321">event_machine_types.h:321</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_ae8ba676fb5528d220363edad0aeef1ff"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#ae8ba676fb5528d220363edad0aeef1ff">EM_QUEUE_UNDEF</a></div><div class="ttdeci">#define EM_QUEUE_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00107">event_machine_types.h:107</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_af28fb8daf62b942ced417e158ed7e1c7"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#af28fb8daf62b942ced417e158ed7e1c7">EM_EO_UNDEF</a></div><div class="ttdeci">#define EM_EO_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00095">event_machine_types.h:95</a></div></div>
<div class="ttc" id="agroup__em__core_html_ga13d21af31382ec2c3d45010645707e9c"><div class="ttname"><a href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a></div><div class="ttdeci">int em_core_id(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df9/event__machine__core_8c_source.html#l00034">event_machine_core.c:34</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga10cf8094caa56026eb0a402d3d22da23"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga10cf8094caa56026eb0a402d3d22da23">em_eo_remove_queue_all_sync</a></div><div class="ttdeci">em_status_t em_eo_remove_queue_all_sync(em_eo_t eo, int delete_queues)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00517">event_machine_eo.c:517</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga196c7caa1177575fd424e9a0d2854da6"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga196c7caa1177575fd424e9a0d2854da6">em_eo_create</a></div><div class="ttdeci">em_eo_t em_eo_create(const char *name, em_start_func_t start, em_start_local_func_t local_start, em_stop_func_t stop, em_stop_local_func_t local_stop, em_receive_func_t receive, const void *eo_ctx)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00040">event_machine_eo.c:40</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gabe4f7a789ec9523367c086793061562d"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gabe4f7a789ec9523367c086793061562d">em_eo_start_sync</a></div><div class="ttdeci">em_status_t em_eo_start_sync(em_eo_t eo, em_status_t *result, const em_eo_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00725">event_machine_eo.c:725</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gac9b818edd466228b6fb653bd9337da3e"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a></div><div class="ttdeci">em_status_t em_eo_add_queue_sync(em_eo_t eo, em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00344">event_machine_eo.c:344</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gadce026621953114bd26e5836d9693465"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gadce026621953114bd26e5836d9693465">em_eo_stop_sync</a></div><div class="ttdeci">em_status_t em_eo_stop_sync(em_eo_t eo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00897">event_machine_eo.c:897</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gae769b19e613b24487beb943cfb926977"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gae769b19e613b24487beb943cfb926977">em_eo_delete</a></div><div class="ttdeci">em_status_t em_eo_delete(em_eo_t eo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00205">event_machine_eo.c:205</a></div></div>
<div class="ttc" id="agroup__em__error_html_gab6b469100e5f60670a742d944a6f530b"><div class="ttname"><a href="../../db/da0/group__em__error.html#gab6b469100e5f60670a742d944a6f530b">em_unregister_error_handler</a></div><div class="ttdeci">em_status_t em_unregister_error_handler(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/de9/event__machine__error_8c_source.html#l00050">event_machine_error.c:50</a></div></div>
<div class="ttc" id="agroup__em__error_html_gaf7332965c5deaa69411136e8d36089c6"><div class="ttname"><a href="../../db/da0/group__em__error.html#gaf7332965c5deaa69411136e8d36089c6">em_register_error_handler</a></div><div class="ttdeci">em_status_t em_register_error_handler(em_error_handler_t handler)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/de9/event__machine__error_8c_source.html#l00034">event_machine_error.c:34</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga3256e7b651fe9e0cf5d3206d8e58f59d"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga3256e7b651fe9e0cf5d3206d8e58f59d">em_alloc_multi</a></div><div class="ttdeci">int em_alloc_multi(em_event_t events[], int num, uint32_t size, em_event_type_t type, em_pool_t pool)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00092">event_machine_event.c:92</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga5f0e40f1b0b4892ee16aafe07ba4c90c"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a></div><div class="ttdeci">em_event_t em_alloc(uint32_t size, em_event_type_t type, em_pool_t pool)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00033">event_machine_event.c:33</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga824c1dee097236d554918d6702431beb"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga824c1dee097236d554918d6702431beb">em_free_multi</a></div><div class="ttdeci">void em_free_multi(em_event_t events[], int num)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00370">event_machine_event.c:370</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga8f701c3a5901fc81d922b9d1d02691e3"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a></div><div class="ttdeci">void * em_event_pointer(em_event_t event)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00750">event_machine_event.c:750</a></div></div>
<div class="ttc" id="agroup__em__event_html_gaca4584a01b71429dfbb045342454b464"><div class="ttname"><a href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a></div><div class="ttdeci">em_status_t em_send(em_event_t event, em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00661">event_machine_event.c:661</a></div></div>
<div class="ttc" id="agroup__em__event_html_gad4f97ba217518d967f8078c56023c4d4"><div class="ttname"><a href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a></div><div class="ttdeci">void em_free(em_event_t event)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00261">event_machine_event.c:261</a></div></div>
<div class="ttc" id="agroup__em__odp__ext_html_ga0c02065ab01fe73e2eaf5f0dfd428ace"><div class="ttname"><a href="../../d5/d72/group__em__odp__ext.html#ga0c02065ab01fe73e2eaf5f0dfd428ace">em_odp_pool2odp</a></div><div class="ttdeci">int em_odp_pool2odp(em_pool_t pool, odp_pool_t odp_pools[], int num)</div><div class="ttdoc">Get the ODP pools used as subpools in a given EM event pool.</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/df0/event__machine__odp__ext_8c_source.html#l00270">event_machine_odp_ext.c:270</a></div></div>
<div class="ttc" id="agroup__em__pool_html_ga05acc37c035cef81910e8ea77e5db158"><div class="ttname"><a href="../../d1/d85/group__em__pool.html#ga05acc37c035cef81910e8ea77e5db158">em_pool_create</a></div><div class="ttdeci">em_pool_t em_pool_create(const char *name, em_pool_t pool, const em_pool_cfg_t *pool_cfg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d7a/event__machine__pool_8c_source.html#l00076">event_machine_pool.c:76</a></div></div>
<div class="ttc" id="agroup__em__pool_html_ga0a0585d9c293ce9d93d2b7235935313a"><div class="ttname"><a href="../../d1/d85/group__em__pool.html#ga0a0585d9c293ce9d93d2b7235935313a">em_pool_cfg_init</a></div><div class="ttdeci">void em_pool_cfg_init(em_pool_cfg_t *const pool_cfg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d7a/event__machine__pool_8c_source.html#l00043">event_machine_pool.c:43</a></div></div>
<div class="ttc" id="agroup__em__pool_html_ga7e5d4bfa167258fa53ff26c0ab34341b"><div class="ttname"><a href="../../d1/d85/group__em__pool.html#ga7e5d4bfa167258fa53ff26c0ab34341b">em_pool_info_print</a></div><div class="ttdeci">void em_pool_info_print(em_pool_t pool)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d7a/event__machine__pool_8c_source.html#l00287">event_machine_pool.c:287</a></div></div>
<div class="ttc" id="agroup__em__queue_html_gaef257858d1fa660524f198dba20fa9eb"><div class="ttname"><a href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a></div><div class="ttdeci">em_queue_t em_queue_create(const char *name, em_queue_type_t type, em_queue_prio_t prio, em_queue_group_t group, const em_queue_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dba/event__machine__queue_8c_source.html#l00041">event_machine_queue.c:41</a></div></div>
<div class="ttc" id="astructem__eo__conf__t_html"><div class="ttname"><a href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00242">event_machine_types.h:242</a></div></div>
<div class="ttc" id="astructem__pool__cfg__t_html"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html">em_pool_cfg_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00141">event_machine_pool.h:141</a></div></div>
<div class="ttc" id="astructem__pool__cfg__t_html_a3929a4fcd68d78ef12347bb6f230fd3a"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html#a3929a4fcd68d78ef12347bb6f230fd3a">em_pool_cfg_t::num_subpools</a></div><div class="ttdeci">int num_subpools</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00264">event_machine_pool.h:264</a></div></div>
<div class="ttc" id="astructem__pool__cfg__t_html_a3f8e331ebdc0f001c76e4b89b40124e6"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html#a3f8e331ebdc0f001c76e4b89b40124e6">em_pool_cfg_t::num</a></div><div class="ttdeci">uint32_t num</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00281">event_machine_pool.h:281</a></div></div>
<div class="ttc" id="astructem__pool__cfg__t_html_a783e3e9dafe05be89ccfe13b3949842d"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html#a783e3e9dafe05be89ccfe13b3949842d">em_pool_cfg_t::cache_size</a></div><div class="ttdeci">uint32_t cache_size</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00294">event_machine_pool.h:294</a></div></div>
<div class="ttc" id="astructem__pool__cfg__t_html_a8df13d5f2195860c030809996ca4f493"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html#a8df13d5f2195860c030809996ca4f493">em_pool_cfg_t::event_type</a></div><div class="ttdeci">em_event_type_t event_type</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00156">event_machine_pool.h:156</a></div></div>
<div class="ttc" id="astructem__pool__cfg__t_html_aa67ebf1bba1e9239f2332030aaf39e2a"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html#aa67ebf1bba1e9239f2332030aaf39e2a">em_pool_cfg_t::subpool</a></div><div class="ttdeci">struct em_pool_cfg_t::@11 subpool[EM_MAX_SUBPOOLS]</div></div>
<div class="ttc" id="astructem__pool__cfg__t_html_aa74d6a49cffa671532948eaac1dadfc2"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html#aa74d6a49cffa671532948eaac1dadfc2">em_pool_cfg_t::size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00224">event_machine_pool.h:224</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
  <div id="footer" class="tabs">
   <div class="headertitle"> 
     &copy; 2017 Nokia Networks
   </div>
  </div>
 </body>
</html>
