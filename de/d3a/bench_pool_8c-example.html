<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EM-ODP: bench_pool.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doc-stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EM-ODP
   &#160;<span id="projectnumber">3.8.0-1</span>
   </div>
   <div id="projectbrief">Event Machine on ODP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('de/d3a/bench_pool_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">bench_pool.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/* Copyright (c) 2023, Nokia</span></div>
<div class="line"><span class="comment"> * All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * SPDX-License-Identifier:     BSD-3-Clause</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;bench_common.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include&lt;time.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* User area size in bytes */</span></div>
<div class="line"><span class="preprocessor">#define UAREA_SIZE 8</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Default event size */</span></div>
<div class="line"><span class="preprocessor">#define EVENT_SIZE 1024</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Number of events in EM_POOL_DEFAULT */</span></div>
<div class="line"><span class="preprocessor">#define NUM_EVENTS 1024</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Maximum number of pool statistics to get */</span></div>
<div class="line"><span class="preprocessor">#define MAX_POOL_STATS 1024u</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Number of EM core count */</span></div>
<div class="line"><span class="preprocessor">#define CORE_COUNT 2</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        <span class="comment">/* Command line options and benchmark info */</span></div>
<div class="line">        run_bench_arg_t run_bench_arg;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Test case input / output data */</span></div>
<div class="line">        <span class="keywordtype">int</span> subpools[<a name="a0"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ad90f05ee400eaa4f639d46805c4d019d">EM_MAX_SUBPOOLS</a>];</div>
<div class="line">        <a name="_a1"></a><a class="code" href="../../d7/daa/unionem__pool__stats__opt__t.html">em_pool_stats_opt_t</a> stats_opt;</div>
<div class="line">        odp_pool_stats_opt_t stats_opt_odp;</div>
<div class="line">        <a name="_a2"></a><a class="code" href="../../d4/d3e/structem__pool__info__t.html">em_pool_info_t</a> pool_info[MAX_POOL_STATS];</div>
<div class="line">        <a name="_a3"></a><a class="code" href="../../d5/d3f/structem__pool__stats__t.html">em_pool_stats_t</a> pool_stats[MAX_POOL_STATS];</div>
<div class="line">        <a name="_a4"></a><a class="code" href="../../d1/d6f/structem__pool__subpool__stats__t.html">em_pool_subpool_stats_t</a> subpool_stats[MAX_POOL_STATS];</div>
<div class="line">        <a name="_a5"></a><a class="code" href="../../d3/d2f/structem__pool__stats__selected__t.html">em_pool_stats_selected_t</a> pool_stats_selected[MAX_POOL_STATS];</div>
<div class="line">        <a name="_a6"></a><a class="code" href="../../d8/d6f/structem__pool__subpool__stats__selected__t.html">em_pool_subpool_stats_selected_t</a> subpool_stats_selected[MAX_POOL_STATS];</div>
<div class="line"> </div>
<div class="line">} gbl_args_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> gbl_args_t *gbl_args;</div>
<div class="line"> </div>
<div class="line">ODP_STATIC_ASSERT(REPEAT_COUNT &lt;= MAX_POOL_STATS, <span class="stringliteral">&quot;REPEAT_COUNT is bigger than MAX_POOL_STATS\n&quot;</span>);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Test functions</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> pool_stats(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; REPEAT_COUNT; i++)</div>
<div class="line">                <a name="a7"></a><a class="code" href="../../d1/d85/group__em__pool.html#gac56a8d04682e799e1690056d62679c73">em_pool_stats</a>(<a name="a8"></a><a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a>, &amp;gbl_args-&gt;pool_stats[i]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> i;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> set_stats_opt(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        gbl_args-&gt;stats_opt.all = 0;</div>
<div class="line">        gbl_args-&gt;stats_opt.available = 1;</div>
<div class="line">        gbl_args-&gt;stats_opt.alloc_ops = 1;</div>
<div class="line">        gbl_args-&gt;stats_opt.alloc_fails = 1;</div>
<div class="line">        gbl_args-&gt;stats_opt.cache_alloc_ops = 1;</div>
<div class="line">        gbl_args-&gt;stats_opt.cache_free_ops = 1;</div>
<div class="line">        gbl_args-&gt;stats_opt.free_ops = 1;</div>
<div class="line">        gbl_args-&gt;stats_opt.total_ops = 1;</div>
<div class="line">        gbl_args-&gt;stats_opt.cache_available = 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Don&#39;t read statistics about cache_available */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> set_stats_opt_no_cache_avail(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        gbl_args-&gt;stats_opt.all = 0;</div>
<div class="line">        gbl_args-&gt;stats_opt.available = 1;</div>
<div class="line">        gbl_args-&gt;stats_opt.alloc_ops = 1;</div>
<div class="line">        gbl_args-&gt;stats_opt.alloc_fails = 1;</div>
<div class="line">        gbl_args-&gt;stats_opt.cache_alloc_ops = 1;</div>
<div class="line">        gbl_args-&gt;stats_opt.cache_free_ops = 1;</div>
<div class="line">        gbl_args-&gt;stats_opt.free_ops = 1;</div>
<div class="line">        gbl_args-&gt;stats_opt.total_ops = 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> pool_stats_selected(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; REPEAT_COUNT; i++)</div>
<div class="line">                <a name="a9"></a><a class="code" href="../../d1/d85/group__em__pool.html#ga5d1ef7d07efcd99c2a8c6729eed91e0b">em_pool_stats_selected</a>(<a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a>, &amp;gbl_args-&gt;pool_stats_selected[i],</div>
<div class="line">                                       &amp;gbl_args-&gt;stats_opt);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> i;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> set_subpools(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        gbl_args-&gt;subpools[0] = 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> subpool_stats(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; REPEAT_COUNT; i++)</div>
<div class="line">                <a name="a10"></a><a class="code" href="../../d1/d85/group__em__pool.html#ga8f0ba2aa2a3ff0eaa5b4a072db3f1027">em_pool_subpool_stats</a>(<a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a>, gbl_args-&gt;subpools, 1,</div>
<div class="line">                                      &amp;gbl_args-&gt;subpool_stats[i]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> i;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> subpool_stats_selected(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; REPEAT_COUNT; i++)</div>
<div class="line">                <a name="a11"></a><a class="code" href="../../d1/d85/group__em__pool.html#ga1da78c8bb4b76f9234b1b3ee8f534661">em_pool_subpool_stats_selected</a>(<a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a>, gbl_args-&gt;subpools, 1,</div>
<div class="line">                                               &amp;gbl_args-&gt;subpool_stats_selected[i],</div>
<div class="line">                                               &amp;gbl_args-&gt;stats_opt);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> i;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> pool_info(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; REPEAT_COUNT; i++)</div>
<div class="line">                <a name="a12"></a><a class="code" href="../../d1/d85/group__em__pool.html#ga7926181e9c357cf3365b554a6f8b4492">em_pool_info</a>(<a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a>, &amp;gbl_args-&gt;pool_info[i]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> i;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">bench_info_t test_suite[] = {</div>
<div class="line">        BENCH_INFO(pool_info, NULL, NULL, 0, <span class="stringliteral">&quot;em_pool_info&quot;</span>),</div>
<div class="line">        BENCH_INFO(pool_stats, NULL, NULL, 0, <span class="stringliteral">&quot;em_pool_stats&quot;</span>),</div>
<div class="line">        BENCH_INFO(subpool_stats, set_subpools, NULL, 0, <span class="stringliteral">&quot;em_pool_subpool_stats&quot;</span>),</div>
<div class="line">        BENCH_INFO(pool_stats_selected, set_stats_opt, NULL, 0, <span class="stringliteral">&quot;em_pool_stats_selected&quot;</span>),</div>
<div class="line">        BENCH_INFO(pool_stats_selected, set_stats_opt_no_cache_avail, NULL, 0,</div>
<div class="line">                   <span class="stringliteral">&quot;em_pool_stats_selected(no cache_availeble)&quot;</span>),</div>
<div class="line">        BENCH_INFO(subpool_stats_selected, set_stats_opt, NULL, 0,</div>
<div class="line">                   <span class="stringliteral">&quot;em_pool_subpool_stats_selected&quot;</span>),</div>
<div class="line">        BENCH_INFO(subpool_stats_selected, set_stats_opt_no_cache_avail, NULL, 0,</div>
<div class="line">                   <span class="stringliteral">&quot;em_pool_subpool_stats_selected(no cache_available)&quot;</span>)</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Print usage information */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> usage(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;EM event API micro benchmarks\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;Options:\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;  -t, --time &lt;opt&gt;        Time measurement.\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;                          0: measure CPU cycles (default)\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;                          1: measure time\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;  -i, --index &lt;idx&gt;       Benchmark index to run indefinitely.\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;  -r, --rounds &lt;num&gt;      Run each test case &#39;num&#39; times (default %u).\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;  -w, --write-csv         Write result to csv files(used in CI) or not.\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;                          default: not write\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;  -h, --help              Display help and exit.\n\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;\n&quot;</span>, ROUNDS);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Parse command line arguments */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> parse_args(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[], <span class="keywordtype">int</span> num_bench, cmd_opt_t *cmd_opt<span class="comment">/*out*/</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> opt;</div>
<div class="line">        <span class="keywordtype">int</span> long_index;</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>option longopts[] = {</div>
<div class="line">                {<span class="stringliteral">&quot;time&quot;</span>, required_argument, NULL, <span class="charliteral">&#39;t&#39;</span>},</div>
<div class="line">                {<span class="stringliteral">&quot;index&quot;</span>, required_argument, NULL, <span class="charliteral">&#39;i&#39;</span>},</div>
<div class="line">                {<span class="stringliteral">&quot;rounds&quot;</span>, required_argument, NULL, <span class="charliteral">&#39;r&#39;</span>},</div>
<div class="line">                {<span class="stringliteral">&quot;write-csv&quot;</span>, no_argument, NULL, <span class="charliteral">&#39;w&#39;</span>},</div>
<div class="line">                {<span class="stringliteral">&quot;help&quot;</span>, no_argument, NULL, <span class="charliteral">&#39;h&#39;</span>},</div>
<div class="line">                {NULL, 0, NULL, 0}</div>
<div class="line">        };</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *shortopts =  <span class="stringliteral">&quot;t:i:r:wh&quot;</span>;</div>
<div class="line"> </div>
<div class="line">        cmd_opt-&gt;time = 0; <span class="comment">/* Measure CPU cycles */</span></div>
<div class="line">        cmd_opt-&gt;bench_idx = 0; <span class="comment">/* Run all benchmarks */</span></div>
<div class="line">        cmd_opt-&gt;rounds = ROUNDS;</div>
<div class="line">        cmd_opt-&gt;write_csv = 0; <span class="comment">/* Do not write result to csv files */</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">while</span> (1) {</div>
<div class="line">                opt = getopt_long(argc, argv, shortopts, longopts, &amp;long_index);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (opt == -1)</div>
<div class="line">                        <span class="keywordflow">break</span>;  <span class="comment">/* No more options */</span></div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">switch</span> (opt) {</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div>
<div class="line">                        cmd_opt-&gt;time = atoi(optarg);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:</div>
<div class="line">                        cmd_opt-&gt;bench_idx = atoi(optarg);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div>
<div class="line">                        cmd_opt-&gt;rounds = atoi(optarg);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;w&#39;</span>:</div>
<div class="line">                        cmd_opt-&gt;write_csv = 1;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div>
<div class="line">                        usage();</div>
<div class="line">                        <span class="keywordflow">return</span> 1;</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                        ODPH_ERR(<span class="stringliteral">&quot;Bad option. Use -h for help.\n&quot;</span>);</div>
<div class="line">                        <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (cmd_opt-&gt;rounds &lt; 1) {</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;Invalid test cycle repeat count: %u\n&quot;</span>, cmd_opt-&gt;rounds);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (cmd_opt-&gt;bench_idx &lt; 0 || cmd_opt-&gt;bench_idx &gt; num_bench) {</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;Bad bench index %i\n&quot;</span>, cmd_opt-&gt;bench_idx);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        optind = 1; <span class="comment">/* Reset &#39;extern optind&#39; from the getopt lib */</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Print system and application info */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_info(<span class="keyword">const</span> <span class="keywordtype">char</span> *cpumask_str, <span class="keyword">const</span> cmd_opt_t *com_opt)</div>
<div class="line">{</div>
<div class="line">        odp_sys_info_print();</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;bench_pool options\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;-------------------\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;Worker CPU mask:   %s\n&quot;</span>, cpumask_str);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Measurement unit:  %s\n&quot;</span>, com_opt-&gt;time ? <span class="stringliteral">&quot;nsec&quot;</span> : <span class="stringliteral">&quot;CPU cycles&quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Test rounds:       %u\n&quot;</span>, com_opt-&gt;rounds);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> init_default_pool_config(<a name="_a13"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html">em_pool_cfg_t</a> *pool_conf)</div>
<div class="line">{</div>
<div class="line">        <a name="a14"></a><a class="code" href="../../d1/d85/group__em__pool.html#ga0a0585d9c293ce9d93d2b7235935313a">em_pool_cfg_init</a>(pool_conf);</div>
<div class="line"> </div>
<div class="line">        pool_conf-&gt;<a name="a15"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html#a8df13d5f2195860c030809996ca4f493">event_type</a> = <a name="a16"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>;</div>
<div class="line">        pool_conf-&gt;<a name="a17"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html#af05251345624f789214a15dd627d0bba">user_area</a>.<a name="a18"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html#aaf3a99d80aa7a7dfa9fb5b52144d3b33">in_use</a> = <span class="keyword">true</span>;</div>
<div class="line">        pool_conf-&gt;<a class="code" href="../../d2/db5/structem__pool__cfg__t.html#af05251345624f789214a15dd627d0bba">user_area</a>.<a name="a19"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html#aa74d6a49cffa671532948eaac1dadfc2">size</a> = UAREA_SIZE;</div>
<div class="line">        pool_conf-&gt;<a name="a20"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html#a3929a4fcd68d78ef12347bb6f230fd3a">num_subpools</a> = 1;</div>
<div class="line">        pool_conf-&gt;<a name="a21"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html#aa67ebf1bba1e9239f2332030aaf39e2a">subpool</a>[0].<a class="code" href="../../d2/db5/structem__pool__cfg__t.html#aa74d6a49cffa671532948eaac1dadfc2">size</a> = EVENT_SIZE;</div>
<div class="line">        pool_conf-&gt;<a class="code" href="../../d2/db5/structem__pool__cfg__t.html#aa67ebf1bba1e9239f2332030aaf39e2a">subpool</a>[0].<a name="a22"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html#a3f8e331ebdc0f001c76e4b89b40124e6">num</a> = NUM_EVENTS;</div>
<div class="line">        pool_conf-&gt;<a class="code" href="../../d2/db5/structem__pool__cfg__t.html#aa67ebf1bba1e9239f2332030aaf39e2a">subpool</a>[0].<a name="a23"></a><a class="code" href="../../d2/db5/structem__pool__cfg__t.html#a783e3e9dafe05be89ccfe13b3949842d">cache_size</a> = 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Allocate and free events to create more realistic statistics than a band new pool */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> alloc_free_event(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* Alloc 10 extra events than the pool has to create some statistics about</span></div>
<div class="line"><span class="comment">         * alloc_fails, so 10 EM ERROR prints about em_alloc() are expected.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> event_tbl_size = NUM_EVENTS + 10;</div>
<div class="line">        em_event_t event_tbl[event_tbl_size];</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; event_tbl_size; i++) {</div>
<div class="line">                event_tbl[i] = <a name="a24"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>;</div>
<div class="line">                event_tbl[i] = <a name="a25"></a><a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(EVENT_SIZE, <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>, <a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Free all allocated events */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; event_tbl_size; i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (event_tbl[i] != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>)</div>
<div class="line">                        <a name="a26"></a><a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event_tbl[i]);</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Write selected pool stats without cache_available counters to a different csv</span></div>
<div class="line"><span class="comment"> * file than the csv file for pool stats with cache_available. since selected</span></div>
<div class="line"><span class="comment"> * pool stats with and without cache_available are in different scale. Different</span></div>
<div class="line"><span class="comment"> * file means they will be plotted in different charts in our benchmark website.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> write_result_to_csv(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        FILE *file;</div>
<div class="line">        <span class="keywordtype">char</span> time_str[72] = {0};</div>
<div class="line">        <span class="keywordtype">char</span> bench4_desc[60] = {0};</div>
<div class="line">        <span class="keywordtype">char</span> bench5_desc[60] = {0};</div>
<div class="line">        <span class="keywordtype">char</span> bench6_desc[60] = {0};</div>
<div class="line">        <span class="keywordtype">double</span> *result = gbl_args-&gt;run_bench_arg.result;</div>
<div class="line">        bench_info_t *bench = gbl_args-&gt;run_bench_arg.bench;</div>
<div class="line"> </div>
<div class="line">        fill_time_str(time_str);</div>
<div class="line"> </div>
<div class="line">        file = fopen(<span class="stringliteral">&quot;em_pool.csv&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (file == NULL) {</div>
<div class="line">                perror(<span class="stringliteral">&quot;Failed to open file em_pool.csv&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Remove substring from long desc so it can be fit in the website chart */</span></div>
<div class="line">        strncpy(bench4_desc, bench[4].desc, 22); <span class="comment">/*em_pool_stats_selected(no cache_availeble)*/</span></div>
<div class="line">        strncpy(bench5_desc, bench[5].desc + 8, 22);<span class="comment">/*em_pool_subpool_stats_selected*/</span></div>
<div class="line">        <span class="comment">/* em_pool_subpool_stats_selected(no cache_available) */</span></div>
<div class="line">        strncpy(bench6_desc, bench[6].desc + 8, 22);</div>
<div class="line"> </div>
<div class="line">        fprintf(file, <span class="stringliteral">&quot;Date,%s,%s,%s,%s,%s\n&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;%s,%.2f,%.2f,%.2f,%.2f,%.2f\n&quot;</span>,</div>
<div class="line">                bench[0].desc, bench[1].desc, bench[2].desc, bench[3].desc, bench5_desc,</div>
<div class="line">                time_str, result[0], result[1], result[2], result[3], result[5]);</div>
<div class="line"> </div>
<div class="line">        fclose(file);</div>
<div class="line"> </div>
<div class="line">        file = fopen(<span class="stringliteral">&quot;em_pool_no_cache_available.csv&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (file == NULL) {</div>
<div class="line">                perror(<span class="stringliteral">&quot;Failed to open file em_pool_no_cache_available.csv&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        fprintf(file, <span class="stringliteral">&quot;Date,%s,%s\n%s,%.2f,%.2f\n&quot;</span>, bench4_desc, bench6_desc,</div>
<div class="line">                time_str, result[4], result[6]);</div>
<div class="line">        fclose(file);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">        <a name="_a27"></a><a class="code" href="../../d6/de0/structem__conf__t.html">em_conf_t</a> conf;</div>
<div class="line">        cmd_opt_t cmd_opt;</div>
<div class="line">        <a class="code" href="../../d2/db5/structem__pool__cfg__t.html">em_pool_cfg_t</a> pool_conf;</div>
<div class="line">        <a name="_a28"></a><a class="code" href="../../df/d81/structem__core__mask__t.html">em_core_mask_t</a> core_mask;</div>
<div class="line">        odph_helper_options_t helper_options;</div>
<div class="line">        odph_thread_t worker_thread;</div>
<div class="line">        odph_thread_common_param_t thr_common;</div>
<div class="line">        odph_thread_param_t thr_param;</div>
<div class="line">        odp_shm_t shm;</div>
<div class="line">        odp_cpumask_t cpumask, worker_mask;</div>
<div class="line">        odp_instance_t instance;</div>
<div class="line">        odp_init_t init_param;</div>
<div class="line">        <span class="keywordtype">int</span> worker_cpu;</div>
<div class="line">        <span class="keywordtype">char</span> cpumask_str[ODP_CPUMASK_STR_SIZE];</div>
<div class="line">        <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">        <span class="keywordtype">int</span> num_bench = ARRAY_SIZE(test_suite);</div>
<div class="line">        <span class="keywordtype">double</span> result[ARRAY_SIZE(test_suite)] = {0};</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Let helper collect its own arguments (e.g. --odph_proc) */</span></div>
<div class="line">        argc = odph_parse_options(argc, argv);</div>
<div class="line">        <span class="keywordflow">if</span> (odph_options(&amp;helper_options)) {</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;Reading ODP helper options failed\n&quot;</span>);</div>
<div class="line">                exit(EXIT_FAILURE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Parse and store the application arguments */</span></div>
<div class="line">        ret = parse_args(argc, argv, num_bench, &amp;cmd_opt);</div>
<div class="line">        <span class="keywordflow">if</span> (ret)</div>
<div class="line">                exit(EXIT_FAILURE);</div>
<div class="line"> </div>
<div class="line">        odp_init_param_init(&amp;init_param);</div>
<div class="line">        init_param.mem_model = helper_options.mem_model;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Init ODP before calling anything else */</span></div>
<div class="line">        <span class="keywordflow">if</span> (odp_init_global(&amp;instance, &amp;init_param, NULL)) {</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;Global init failed\n&quot;</span>);</div>
<div class="line">                exit(EXIT_FAILURE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Init this thread */</span></div>
<div class="line">        <span class="keywordflow">if</span> (odp_init_local(instance, ODP_THREAD_CONTROL)) {</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;Local init failed\n&quot;</span>);</div>
<div class="line">                exit(EXIT_FAILURE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        odp_schedule_config(NULL);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Get worker CPU */</span></div>
<div class="line">        <span class="keywordflow">if</span> (odp_cpumask_default_worker(&amp;worker_mask, 1) != 1) {</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;Unable to allocate worker thread\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> odp_term;</div>
<div class="line">        }</div>
<div class="line">        worker_cpu = odp_cpumask_first(&amp;worker_mask);</div>
<div class="line">        (void)odp_cpumask_to_str(&amp;worker_mask, cpumask_str, ODP_CPUMASK_STR_SIZE);</div>
<div class="line"> </div>
<div class="line">        print_info(cpumask_str, &amp;cmd_opt);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Init EM */</span></div>
<div class="line">        <a name="a29"></a><a class="code" href="../../d3/d7b/event__machine__hw__specific_8h.html#af950c0bca4c115cd0896785d2a138979">em_core_mask_zero</a>(&amp;core_mask);</div>
<div class="line">        <a name="a30"></a><a class="code" href="../../d3/d7b/event__machine__hw__specific_8h.html#a71101da80fc4d14e0bda24dd0408495c">em_core_mask_set</a>(odp_cpu_id(), &amp;core_mask);</div>
<div class="line">        <a class="code" href="../../d3/d7b/event__machine__hw__specific_8h.html#a71101da80fc4d14e0bda24dd0408495c">em_core_mask_set</a>(worker_cpu, &amp;core_mask);</div>
<div class="line">        <span class="keywordflow">if</span> (odp_cpumask_count(&amp;core_mask.<a name="a31"></a>odp_cpumask) != CORE_COUNT)</div>
<div class="line">                <span class="keywordflow">goto</span> odp_term;</div>
<div class="line"> </div>
<div class="line">        init_default_pool_config(&amp;pool_conf);</div>
<div class="line"> </div>
<div class="line">        <a name="a32"></a><a class="code" href="../../d9/d54/group__init.html#gab61231bb75481392cf01d8fa9148a3f4">em_conf_init</a>(&amp;conf);</div>
<div class="line">        <span class="keywordflow">if</span> (helper_options.mem_model == ODP_MEM_MODEL_PROCESS)</div>
<div class="line">                conf.<a name="a33"></a><a class="code" href="../../d6/de0/structem__conf__t.html#a015219b5645d176f61b1ad2fd5c107df">process_per_core</a> = 1;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                conf.<a name="a34"></a><a class="code" href="../../d6/de0/structem__conf__t.html#a997dcef8b68b0fb6b70818f3294df257">thread_per_core</a> = 1;</div>
<div class="line">        conf.<a name="a35"></a><a class="code" href="../../d6/de0/structem__conf__t.html#a71f2731ae3925d7e9a5e8876f27eb096">default_pool_cfg</a> = pool_conf;</div>
<div class="line">        conf.<a name="a36"></a><a class="code" href="../../d6/de0/structem__conf__t.html#ad678461bc3be17aba6c71b9883639ea5">core_count</a> = CORE_COUNT;</div>
<div class="line">        conf.<a name="a37"></a><a class="code" href="../../d6/de0/structem__conf__t.html#ab98de6374d48237cbb8cd14a03e02485">phys_mask</a> = core_mask;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a38"></a><a class="code" href="../../d9/d54/group__init.html#gaba6bc23a21241443d7592b16eb735493">em_init</a>(&amp;conf) != <a name="a39"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>) {</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;EM init failed\n&quot;</span>);</div>
<div class="line">                exit(EXIT_FAILURE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a40"></a><a class="code" href="../../d9/d54/group__init.html#gaf18adb46bd144341c22be62619ec3a4e">em_init_core</a>() != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>) {</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;EM core init failed\n&quot;</span>);</div>
<div class="line">                exit(EXIT_FAILURE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (setup_sig_handler()) {</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;Signal handler setup failed\n&quot;</span>);</div>
<div class="line">                exit(EXIT_FAILURE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Reserve memory for args from shared mem */</span></div>
<div class="line">        shm = odp_shm_reserve(<span class="stringliteral">&quot;shm_args&quot;</span>, <span class="keyword">sizeof</span>(gbl_args_t), ODP_CACHE_LINE_SIZE, 0);</div>
<div class="line">        <span class="keywordflow">if</span> (shm == ODP_SHM_INVALID) {</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;Shared mem reserve failed\n&quot;</span>);</div>
<div class="line">                exit(EXIT_FAILURE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        gbl_args = odp_shm_addr(shm);</div>
<div class="line">        <span class="keywordflow">if</span> (gbl_args == NULL) {</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;Shared mem alloc failed\n&quot;</span>);</div>
<div class="line">                exit(EXIT_FAILURE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        odp_atomic_init_u32(&amp;exit_thread, 0);</div>
<div class="line"> </div>
<div class="line">        memset(gbl_args, 0, <span class="keyword">sizeof</span>(gbl_args_t));</div>
<div class="line">        gbl_args-&gt;run_bench_arg.bench = test_suite;</div>
<div class="line">        gbl_args-&gt;run_bench_arg.num_bench = num_bench;</div>
<div class="line">        gbl_args-&gt;run_bench_arg.opt = cmd_opt;</div>
<div class="line">        gbl_args-&gt;run_bench_arg.result = result;</div>
<div class="line"> </div>
<div class="line">        alloc_free_event();</div>
<div class="line"> </div>
<div class="line">        memset(&amp;worker_thread, 0, <span class="keyword">sizeof</span>(odph_thread_t));</div>
<div class="line">        odp_cpumask_zero(&amp;cpumask);</div>
<div class="line">        odp_cpumask_set(&amp;cpumask, worker_cpu);</div>
<div class="line"> </div>
<div class="line">        odph_thread_common_param_init(&amp;thr_common);</div>
<div class="line">        thr_common.instance = instance;</div>
<div class="line">        thr_common.cpumask = &amp;cpumask;</div>
<div class="line">        thr_common.share_param = 1;</div>
<div class="line"> </div>
<div class="line">        odph_thread_param_init(&amp;thr_param);</div>
<div class="line">        thr_param.start = run_benchmarks;</div>
<div class="line">        thr_param.arg = &amp;gbl_args-&gt;run_bench_arg;</div>
<div class="line">        thr_param.thr_type = ODP_THREAD_WORKER;</div>
<div class="line"> </div>
<div class="line">        odph_thread_create(&amp;worker_thread, &amp;thr_common, &amp;thr_param, 1);</div>
<div class="line"> </div>
<div class="line">        odph_thread_join(&amp;worker_thread, 1);</div>
<div class="line"> </div>
<div class="line">        ret = gbl_args-&gt;run_bench_arg.bench_failed;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (cmd_opt.write_csv)</div>
<div class="line">                write_result_to_csv();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a41"></a><a class="code" href="../../d9/d54/group__init.html#ga9d01080e69d9a8d5c3a6e47264b68d78">em_term_core</a>() != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;EM core terminate failed\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a42"></a><a class="code" href="../../d9/d54/group__init.html#ga40839004db9b67c23360d7b64197bd82">em_term</a>(&amp;conf) != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;EM terminate failed\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (odp_shm_free(shm)) {</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;Shared mem free failed\n&quot;</span>);</div>
<div class="line">                exit(EXIT_FAILURE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">odp_term:</div>
<div class="line">        <span class="keywordflow">if</span> (odp_term_local()) {</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;Local term failed\n&quot;</span>);</div>
<div class="line">                exit(EXIT_FAILURE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (odp_term_global(instance)) {</div>
<div class="line">                ODPH_ERR(<span class="stringliteral">&quot;Global term failed\n&quot;</span>);</div>
<div class="line">                exit(EXIT_FAILURE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">                <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> EXIT_SUCCESS;</div>
<div class="line">}</div>
<div class="ttc" id="aevent__machine__hw__config_8h_html_aaa0a290a45f4b1280f3330fadde6bfde"><div class="ttname"><a href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a></div><div class="ttdeci">#define EM_POOL_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6d/event__machine__hw__config_8h_source.html#l00191">event_machine_hw_config.h:191</a></div></div>
<div class="ttc" id="aevent__machine__hw__specific_8h_html_a71101da80fc4d14e0bda24dd0408495c"><div class="ttname"><a href="../../d3/d7b/event__machine__hw__specific_8h.html#a71101da80fc4d14e0bda24dd0408495c">em_core_mask_set</a></div><div class="ttdeci">void em_core_mask_set(int core, em_core_mask_t *mask)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d26/event__machine__hw__specific_8c_source.html#l00048">event_machine_hw_specific.c:48</a></div></div>
<div class="ttc" id="aevent__machine__hw__specific_8h_html_af950c0bca4c115cd0896785d2a138979"><div class="ttname"><a href="../../d3/d7b/event__machine__hw__specific_8h.html#af950c0bca4c115cd0896785d2a138979">em_core_mask_zero</a></div><div class="ttdeci">void em_core_mask_zero(em_core_mask_t *mask)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d26/event__machine__hw__specific_8c_source.html#l00043">event_machine_hw_specific.c:43</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a></div><div class="ttdeci">@ EM_EVENT_TYPE_SW</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00072">event_machine_hw_types.h:72</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_ad90f05ee400eaa4f639d46805c4d019d"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#ad90f05ee400eaa4f639d46805c4d019d">EM_MAX_SUBPOOLS</a></div><div class="ttdeci">#define EM_MAX_SUBPOOLS</div><div class="ttdoc">The number of subpools in each EM pool. The subpool is a pool with buffers of only one size.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00254">event_machine_hw_types.h:254</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a03546e6a7e93665c52d479831e0a6dca"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a></div><div class="ttdeci">#define EM_OK</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00329">event_machine_types.h:329</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a8542d9c2c9a29e35ff042b1d59cc479b"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a></div><div class="ttdeci">#define EM_EVENT_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00062">event_machine_types.h:62</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga5f0e40f1b0b4892ee16aafe07ba4c90c"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a></div><div class="ttdeci">em_event_t em_alloc(uint32_t size, em_event_type_t type, em_pool_t pool)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00033">event_machine_event.c:33</a></div></div>
<div class="ttc" id="agroup__em__event_html_gad4f97ba217518d967f8078c56023c4d4"><div class="ttname"><a href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a></div><div class="ttdeci">void em_free(em_event_t event)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00261">event_machine_event.c:261</a></div></div>
<div class="ttc" id="agroup__em__pool_html_ga0a0585d9c293ce9d93d2b7235935313a"><div class="ttname"><a href="../../d1/d85/group__em__pool.html#ga0a0585d9c293ce9d93d2b7235935313a">em_pool_cfg_init</a></div><div class="ttdeci">void em_pool_cfg_init(em_pool_cfg_t *const pool_cfg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d7a/event__machine__pool_8c_source.html#l00043">event_machine_pool.c:43</a></div></div>
<div class="ttc" id="agroup__em__pool_html_ga1da78c8bb4b76f9234b1b3ee8f534661"><div class="ttname"><a href="../../d1/d85/group__em__pool.html#ga1da78c8bb4b76f9234b1b3ee8f534661">em_pool_subpool_stats_selected</a></div><div class="ttdeci">int em_pool_subpool_stats_selected(em_pool_t pool, const int subpools[], int num_subpools, em_pool_subpool_stats_selected_t subpool_stats[], const em_pool_stats_opt_t *opt)</div><div class="ttdoc">Retrieve selected statistics about subpool(s) of an EM pool.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d7a/event__machine__pool_8c_source.html#l00554">event_machine_pool.c:554</a></div></div>
<div class="ttc" id="agroup__em__pool_html_ga5d1ef7d07efcd99c2a8c6729eed91e0b"><div class="ttname"><a href="../../d1/d85/group__em__pool.html#ga5d1ef7d07efcd99c2a8c6729eed91e0b">em_pool_stats_selected</a></div><div class="ttdeci">em_status_t em_pool_stats_selected(em_pool_t pool, em_pool_stats_selected_t *pool_stats, const em_pool_stats_opt_t *opt)</div><div class="ttdoc">Retrieve selected statistics about an EM pool.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d7a/event__machine__pool_8c_source.html#l00501">event_machine_pool.c:501</a></div></div>
<div class="ttc" id="agroup__em__pool_html_ga7926181e9c357cf3365b554a6f8b4492"><div class="ttname"><a href="../../d1/d85/group__em__pool.html#ga7926181e9c357cf3365b554a6f8b4492">em_pool_info</a></div><div class="ttdeci">em_status_t em_pool_info(em_pool_t pool, em_pool_info_t *pool_info)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d7a/event__machine__pool_8c_source.html#l00216">event_machine_pool.c:216</a></div></div>
<div class="ttc" id="agroup__em__pool_html_ga8f0ba2aa2a3ff0eaa5b4a072db3f1027"><div class="ttname"><a href="../../d1/d85/group__em__pool.html#ga8f0ba2aa2a3ff0eaa5b4a072db3f1027">em_pool_subpool_stats</a></div><div class="ttdeci">int em_pool_subpool_stats(em_pool_t pool, const int subpools[], int num_subpools, em_pool_subpool_stats_t subpool_stats[])</div><div class="ttdoc">Retrieve statistics about subpool(s) of an EM pool.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d7a/event__machine__pool_8c_source.html#l00399">event_machine_pool.c:399</a></div></div>
<div class="ttc" id="agroup__em__pool_html_gac56a8d04682e799e1690056d62679c73"><div class="ttname"><a href="../../d1/d85/group__em__pool.html#gac56a8d04682e799e1690056d62679c73">em_pool_stats</a></div><div class="ttdeci">em_status_t em_pool_stats(em_pool_t pool, em_pool_stats_t *pool_stats)</div><div class="ttdoc">Retrieve statistics about an EM pool.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d7a/event__machine__pool_8c_source.html#l00327">event_machine_pool.c:327</a></div></div>
<div class="ttc" id="agroup__init_html_ga40839004db9b67c23360d7b64197bd82"><div class="ttname"><a href="../../d9/d54/group__init.html#ga40839004db9b67c23360d7b64197bd82">em_term</a></div><div class="ttdeci">em_status_t em_term(const em_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d0b/event__machine__init_8c_source.html#l00356">event_machine_init.c:356</a></div></div>
<div class="ttc" id="agroup__init_html_ga9d01080e69d9a8d5c3a6e47264b68d78"><div class="ttname"><a href="../../d9/d54/group__init.html#ga9d01080e69d9a8d5c3a6e47264b68d78">em_term_core</a></div><div class="ttdeci">em_status_t em_term_core(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d0b/event__machine__init_8c_source.html#l00425">event_machine_init.c:425</a></div></div>
<div class="ttc" id="agroup__init_html_gab61231bb75481392cf01d8fa9148a3f4"><div class="ttname"><a href="../../d9/d54/group__init.html#gab61231bb75481392cf01d8fa9148a3f4">em_conf_init</a></div><div class="ttdeci">void em_conf_init(em_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d0b/event__machine__init_8c_source.html#l00054">event_machine_init.c:54</a></div></div>
<div class="ttc" id="agroup__init_html_gaba6bc23a21241443d7592b16eb735493"><div class="ttname"><a href="../../d9/d54/group__init.html#gaba6bc23a21241443d7592b16eb735493">em_init</a></div><div class="ttdeci">em_status_t em_init(const em_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d0b/event__machine__init_8c_source.html#l00066">event_machine_init.c:66</a></div></div>
<div class="ttc" id="agroup__init_html_gaf18adb46bd144341c22be62619ec3a4e"><div class="ttname"><a href="../../d9/d54/group__init.html#gaf18adb46bd144341c22be62619ec3a4e">em_init_core</a></div><div class="ttdeci">em_status_t em_init_core(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d0b/event__machine__init_8c_source.html#l00252">event_machine_init.c:252</a></div></div>
<div class="ttc" id="astructem__conf__t_html"><div class="ttname"><a href="../../d6/de0/structem__conf__t.html">em_conf_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d78/event__machine__init_8h_source.html#l00093">event_machine_init.h:93</a></div></div>
<div class="ttc" id="astructem__conf__t_html_a015219b5645d176f61b1ad2fd5c107df"><div class="ttname"><a href="../../d6/de0/structem__conf__t.html#a015219b5645d176f61b1ad2fd5c107df">em_conf_t::process_per_core</a></div><div class="ttdeci">int process_per_core</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d78/event__machine__init_8h_source.html#l00123">event_machine_init.h:123</a></div></div>
<div class="ttc" id="astructem__conf__t_html_a71f2731ae3925d7e9a5e8876f27eb096"><div class="ttname"><a href="../../d6/de0/structem__conf__t.html#a71f2731ae3925d7e9a5e8876f27eb096">em_conf_t::default_pool_cfg</a></div><div class="ttdeci">em_pool_cfg_t default_pool_cfg</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d78/event__machine__init_8h_source.html#l00160">event_machine_init.h:160</a></div></div>
<div class="ttc" id="astructem__conf__t_html_a997dcef8b68b0fb6b70818f3294df257"><div class="ttname"><a href="../../d6/de0/structem__conf__t.html#a997dcef8b68b0fb6b70818f3294df257">em_conf_t::thread_per_core</a></div><div class="ttdeci">int thread_per_core</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d78/event__machine__init_8h_source.html#l00115">event_machine_init.h:115</a></div></div>
<div class="ttc" id="astructem__conf__t_html_ab98de6374d48237cbb8cd14a03e02485"><div class="ttname"><a href="../../d6/de0/structem__conf__t.html#ab98de6374d48237cbb8cd14a03e02485">em_conf_t::phys_mask</a></div><div class="ttdeci">em_core_mask_t phys_mask</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d78/event__machine__init_8h_source.html#l00149">event_machine_init.h:149</a></div></div>
<div class="ttc" id="astructem__conf__t_html_ad678461bc3be17aba6c71b9883639ea5"><div class="ttname"><a href="../../d6/de0/structem__conf__t.html#ad678461bc3be17aba6c71b9883639ea5">em_conf_t::core_count</a></div><div class="ttdeci">int core_count</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d78/event__machine__init_8h_source.html#l00132">event_machine_init.h:132</a></div></div>
<div class="ttc" id="astructem__core__mask__t_html"><div class="ttname"><a href="../../df/d81/structem__core__mask__t.html">em_core_mask_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00242">event_machine_hw_types.h:242</a></div></div>
<div class="ttc" id="astructem__pool__cfg__t_html"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html">em_pool_cfg_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00141">event_machine_pool.h:141</a></div></div>
<div class="ttc" id="astructem__pool__cfg__t_html_a3929a4fcd68d78ef12347bb6f230fd3a"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html#a3929a4fcd68d78ef12347bb6f230fd3a">em_pool_cfg_t::num_subpools</a></div><div class="ttdeci">int num_subpools</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00264">event_machine_pool.h:264</a></div></div>
<div class="ttc" id="astructem__pool__cfg__t_html_a3f8e331ebdc0f001c76e4b89b40124e6"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html#a3f8e331ebdc0f001c76e4b89b40124e6">em_pool_cfg_t::num</a></div><div class="ttdeci">uint32_t num</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00281">event_machine_pool.h:281</a></div></div>
<div class="ttc" id="astructem__pool__cfg__t_html_a783e3e9dafe05be89ccfe13b3949842d"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html#a783e3e9dafe05be89ccfe13b3949842d">em_pool_cfg_t::cache_size</a></div><div class="ttdeci">uint32_t cache_size</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00294">event_machine_pool.h:294</a></div></div>
<div class="ttc" id="astructem__pool__cfg__t_html_a8df13d5f2195860c030809996ca4f493"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html#a8df13d5f2195860c030809996ca4f493">em_pool_cfg_t::event_type</a></div><div class="ttdeci">em_event_type_t event_type</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00156">event_machine_pool.h:156</a></div></div>
<div class="ttc" id="astructem__pool__cfg__t_html_aa67ebf1bba1e9239f2332030aaf39e2a"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html#aa67ebf1bba1e9239f2332030aaf39e2a">em_pool_cfg_t::subpool</a></div><div class="ttdeci">struct em_pool_cfg_t::@11 subpool[EM_MAX_SUBPOOLS]</div></div>
<div class="ttc" id="astructem__pool__cfg__t_html_aa74d6a49cffa671532948eaac1dadfc2"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html#aa74d6a49cffa671532948eaac1dadfc2">em_pool_cfg_t::size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00224">event_machine_pool.h:224</a></div></div>
<div class="ttc" id="astructem__pool__cfg__t_html_aaf3a99d80aa7a7dfa9fb5b52144d3b33"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html#aaf3a99d80aa7a7dfa9fb5b52144d3b33">em_pool_cfg_t::in_use</a></div><div class="ttdeci">bool in_use</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00185">event_machine_pool.h:185</a></div></div>
<div class="ttc" id="astructem__pool__cfg__t_html_af05251345624f789214a15dd627d0bba"><div class="ttname"><a href="../../d2/db5/structem__pool__cfg__t.html#af05251345624f789214a15dd627d0bba">em_pool_cfg_t::user_area</a></div><div class="ttdeci">struct em_pool_cfg_t::@9 user_area</div></div>
<div class="ttc" id="astructem__pool__info__t_html"><div class="ttname"><a href="../../d4/d3e/structem__pool__info__t.html">em_pool_info_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00325">event_machine_pool.h:325</a></div></div>
<div class="ttc" id="astructem__pool__stats__selected__t_html"><div class="ttname"><a href="../../d3/d2f/structem__pool__stats__selected__t.html">em_pool_stats_selected_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00441">event_machine_pool.h:441</a></div></div>
<div class="ttc" id="astructem__pool__stats__t_html"><div class="ttname"><a href="../../d5/d3f/structem__pool__stats__t.html">em_pool_stats_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00399">event_machine_pool.h:399</a></div></div>
<div class="ttc" id="astructem__pool__subpool__stats__selected__t_html"><div class="ttname"><a href="../../d8/d6f/structem__pool__subpool__stats__selected__t.html">em_pool_subpool_stats_selected_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00409">event_machine_pool.h:409</a></div></div>
<div class="ttc" id="astructem__pool__subpool__stats__t_html"><div class="ttname"><a href="../../d1/d6f/structem__pool__subpool__stats__t.html">em_pool_subpool_stats_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00364">event_machine_pool.h:364</a></div></div>
<div class="ttc" id="aunionem__pool__stats__opt__t_html"><div class="ttname"><a href="../../d7/daa/unionem__pool__stats__opt__t.html">em_pool_stats_opt_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d8f/event__machine__pool_8h_source.html#l00098">event_machine_pool.h:98</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
  <div id="footer" class="tabs">
   <div class="headertitle"> 
     &copy; 2017 Nokia Networks
   </div>
  </div>
 </body>
</html>
