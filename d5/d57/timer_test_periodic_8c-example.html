<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EM-ODP: timer_test_periodic.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doc-stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EM-ODP
   &#160;<span id="projectnumber">3.8.0-1</span>
   </div>
   <div id="projectbrief">Event Machine on ODP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d5/d57/timer_test_periodic_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">timer_test_periodic.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> *   Copyright (c) 2020-2021, Nokia Solutions and Networks</span></div>
<div class="line"><span class="comment"> *   All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> *   modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment"> *   are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer in the</span></div>
<div class="line"><span class="comment"> *       documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment"> *     * Neither the name of the copyright holder nor the names of its</span></div>
<div class="line"><span class="comment"> *       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment"> *       from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment"> *   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment"> *   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment"> *   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment"> *   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment"> *   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment"> *   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment"> *   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @file</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Event Machine timer test for periodic timeouts.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * see instructions - string at timer_test_periodic.h.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Exception/error management is simplified and aborts on any error.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#ifndef _GNU_SOURCE</span></div>
<div class="line"><span class="preprocessor">#define _GNU_SOURCE</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;limits.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/mman.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d5e/event__machine_8h.html">event_machine.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/d26/environment_8h.html">event_machine/platform/env/environment.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;odp_api.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;cm_setup.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;cm_error_handler.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;timer_test_periodic.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERSION &quot;v1.3&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>{</div>
<div class="line">        <span class="keywordtype">int</span> num_periodic;</div>
<div class="line">        uint64_t res_ns;</div>
<div class="line">        uint64_t res_hz;</div>
<div class="line">        uint64_t period_ns;</div>
<div class="line">        int64_t first_ns;</div>
<div class="line">        uint64_t max_period_ns;</div>
<div class="line">        uint64_t min_period_ns;</div>
<div class="line">        uint64_t min_work_ns;</div>
<div class="line">        uint64_t max_work_ns;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> work_prop;</div>
<div class="line">        <span class="keywordtype">int</span> clock_src;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *csv;</div>
<div class="line">        <span class="keywordtype">int</span> num_runs;</div>
<div class="line">        <span class="keywordtype">int</span> tracebuf;</div>
<div class="line">        <span class="keywordtype">int</span> trcstop;</div>
<div class="line">        <span class="keywordtype">int</span> noskip;</div>
<div class="line">        <span class="keywordtype">int</span> profile;</div>
<div class="line">        <span class="keywordtype">int</span> dispatch;</div>
<div class="line">        <span class="keywordtype">int</span> jobs;</div>
<div class="line">        <span class="keywordtype">int</span> info_only;</div>
<div class="line">        <span class="keywordtype">int</span> usehuge;            <span class="comment">/* for trace buffer */</span></div>
<div class="line">        <span class="keywordtype">int</span> bg_events;</div>
<div class="line">        uint64_t bg_time_ns;</div>
<div class="line">        <span class="keywordtype">int</span> bg_size;</div>
<div class="line">        <span class="keywordtype">int</span> bg_chunk;</div>
<div class="line">        <span class="keywordtype">int</span> mz_mb;</div>
<div class="line">        <span class="keywordtype">int</span> mz_huge;</div>
<div class="line">        uint64_t mz_ns;</div>
<div class="line">        <span class="keywordtype">int</span> abort;              <span class="comment">/* for testing abnormal exit */</span></div>
<div class="line">        <span class="keywordtype">int</span> num_timers;</div>
<div class="line">        <span class="keywordtype">int</span> no_del;</div>
<div class="line">        <span class="keywordtype">int</span> same_tick;</div>
<div class="line">        <span class="keywordtype">int</span> recreate;</div>
<div class="line">        uint64_t stop_limit;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> etype;</div>
<div class="line"> </div>
<div class="line">} g_options = { .num_periodic =  1,     <span class="comment">/* defaults for basic check */</span></div>
<div class="line">                .res_ns =        DEF_RES_NS,</div>
<div class="line">                .res_hz =        0,</div>
<div class="line">                .period_ns =     DEF_PERIOD * DEF_RES_NS,</div>
<div class="line">                .first_ns =      0,</div>
<div class="line">                .max_period_ns = 0, <span class="comment">/* max,min updated in init if not given cmdline */</span></div>
<div class="line">                .min_period_ns = 0,</div>
<div class="line">                .min_work_ns =   0,</div>
<div class="line">                .max_work_ns =   0,</div>
<div class="line">                .work_prop =     0,</div>
<div class="line">                .clock_src =     <a name="a0"></a><a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#ad2afe10951c01b6511a18d9e82f2c0a3">EM_TIMER_CLKSRC_DEFAULT</a>,</div>
<div class="line">                .csv =           NULL,</div>
<div class="line">                .num_runs =      1,</div>
<div class="line">                .tracebuf =      DEF_TMO_DATA,</div>
<div class="line">                .trcstop =       ((STOP_THRESHOLD * DEF_TMO_DATA) / 100),</div>
<div class="line">                .noskip =        1,</div>
<div class="line">                .profile =       0,</div>
<div class="line">                .dispatch =      0,</div>
<div class="line">                .jobs =          0,</div>
<div class="line">                .info_only =     0,</div>
<div class="line">                .usehuge =       0,</div>
<div class="line">                .bg_events =     0,</div>
<div class="line">                .bg_time_ns =    10000,</div>
<div class="line">                .bg_size =       5000 * 1024,</div>
<div class="line">                .bg_chunk =      50 * 1024,</div>
<div class="line">                .mz_mb =         0,</div>
<div class="line">                .mz_huge =       0,</div>
<div class="line">                .mz_ns =         0,</div>
<div class="line">                .abort =         0,</div>
<div class="line">                .num_timers =    1,</div>
<div class="line">                .no_del =        0,</div>
<div class="line">                .same_tick =     0,</div>
<div class="line">                .recreate =      0,</div>
<div class="line">                .stop_limit =    0,</div>
<div class="line">                .etype = <a name="a1"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a></div>
<div class="line">                };</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>global_stats_t {</div>
<div class="line">        uint64_t num_late;      <span class="comment">/* ack late */</span></div>
<div class="line">        int64_t  max_dev_ns;    <span class="comment">/* +- max deviation form target */</span></div>
<div class="line">        int64_t  max_early_ns;  <span class="comment">/* max arrival before target time */</span></div>
<div class="line">        uint64_t num_tmo;       <span class="comment">/* total received tmo count */</span></div>
<div class="line">        <span class="keywordtype">int</span>      max_cpu;       <span class="comment">/* max CPU load % (any single) */</span></div>
<div class="line">        uint64_t max_dispatch;  <span class="comment">/* max EO receive time */</span></div>
<div class="line">} global_stats_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>app_eo_ctx_t {</div>
<div class="line">        e_state state;</div>
<div class="line">        <a name="_a2"></a><a class="code" href="../../dd/d32/structem__timer__timeout__t.html">em_tmo_t</a> heartbeat_tmo;</div>
<div class="line">        <a name="_a3"></a><a class="code" href="../../d4/d00/structem__timer__attr__t.html">em_timer_attr_t</a> tmr_attr;</div>
<div class="line">        em_queue_t hb_q;</div>
<div class="line">        em_queue_t test_q;</div>
<div class="line">        em_queue_t stop_q;</div>
<div class="line">        em_queue_t bg_q;</div>
<div class="line">        <span class="keywordtype">int</span> cooloff;</div>
<div class="line">        <span class="keywordtype">int</span> last_hbcount;</div>
<div class="line">        uint64_t hb_hz;</div>
<div class="line">        uint64_t test_hz;</div>
<div class="line">        uint64_t time_hz;</div>
<div class="line">        uint64_t meas_test_hz;</div>
<div class="line">        uint64_t meas_time_hz;</div>
<div class="line">        uint64_t linux_hz;</div>
<div class="line">        uint64_t max_period;</div>
<div class="line">        uint64_t started;</div>
<div class="line">        uint64_t stopped;</div>
<div class="line">        uint64_t appstart;</div>
<div class="line">        uint64_t start_loop_ns;</div>
<div class="line">        <span class="keywordtype">void</span> *bg_data;</div>
<div class="line">        <span class="keywordtype">void</span> *mz_data;</div>
<div class="line">        uint64_t mz_count;</div>
<div class="line">        <span class="keywordtype">int</span> stop_sent;</div>
<div class="line">        em_atomic_group_t agrp;</div>
<div class="line">        global_stats_t global_stat;</div>
<div class="line">        tmo_setup *tmo_data;</div>
<div class="line">        core_data cdat[MAX_CORES];</div>
<div class="line">} app_eo_ctx_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>timer_app_shm_t {</div>
<div class="line">        <span class="comment">/* Number of EM cores running the application */</span></div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> core_count;</div>
<div class="line">        em_pool_t pool;</div>
<div class="line">        app_eo_ctx_t eo_context;</div>
<div class="line">        em_timer_t hb_tmr;</div>
<div class="line">        em_timer_t test_tmr[MAX_TEST_TIMERS];</div>
<div class="line">} timer_app_shm_t;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* EM-thread locals */</span></div>
<div class="line"><span class="keyword">static</span> __thread timer_app_shm_t *m_shm;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> start_periodic(app_eo_ctx_t *eo_context);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> handle_periodic(app_eo_ctx_t *eo_context, em_event_t event);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> send_stop(app_eo_ctx_t *eo_context);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> handle_heartbeat(app_eo_ctx_t *eo_context, em_event_t event);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> usage(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> parse_my_args(<span class="keywordtype">int</span> first, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> analyze(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> write_trace(app_eo_ctx_t *eo_ctx, <span class="keyword">const</span> <span class="keywordtype">char</span> *name);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> cleanup(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> add_trace(app_eo_ctx_t *eo_ctx, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, e_op op, uint64_t ns, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> tidx);</div>
<div class="line"><span class="keyword">static</span> uint64_t linux_time_ns(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> app_eo_start(<span class="keywordtype">void</span> *eo_context, em_eo_t eo, <span class="keyword">const</span> <a name="_a4"></a><a class="code" href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a> *conf);</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> app_eo_start_local(<span class="keywordtype">void</span> *eo_context, em_eo_t eo);</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> app_eo_stop(<span class="keywordtype">void</span> *eo_context, em_eo_t eo);</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> app_eo_stop_local(<span class="keywordtype">void</span> *eo_context, em_eo_t eo);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_eo_receive(<span class="keywordtype">void</span> *eo_context, em_event_t event,</div>
<div class="line">                           <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> type, em_queue_t queue, <span class="keywordtype">void</span> *q_context);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> arg_to_ns(<span class="keyword">const</span> <span class="keywordtype">char</span> *s, int64_t *val);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> profile_statistics(e_op op, <span class="keywordtype">int</span> cores, app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> profile_all_stats(<span class="keywordtype">int</span> cores, app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> analyze_measure(app_eo_ctx_t *eo_ctx, uint64_t linuxns,</div>
<div class="line">                            uint64_t tmrtick, uint64_t timetick);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> timing_statistics(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> add_prof(app_eo_ctx_t *eo_ctx, uint64_t t1, e_op op, app_msg_t *msg);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> do_one_tmo(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, app_eo_ctx_t *eo_ctx,</div>
<div class="line">                      uint64_t *min, uint64_t *max, uint64_t *first,</div>
<div class="line">                      int64_t *tgt_max_ns, int64_t *max_early_ns, <span class="keywordtype">int</span> *evnum);</div>
<div class="line"><span class="keyword">static</span> tmo_trace *find_tmo(app_eo_ctx_t *eo_ctx, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> *last);</div>
<div class="line"><span class="keyword">static</span> uint64_t random_tmo_ns(uint64_t minval, uint64_t maxval);</div>
<div class="line"><span class="keyword">static</span> uint64_t random_work_ns(rnd_state_t *rng);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> enter_cb(em_eo_t eo, <span class="keywordtype">void</span> **eo_ctx, em_event_t events[], <span class="keywordtype">int</span> num,</div>
<div class="line">                     em_queue_t *queue, <span class="keywordtype">void</span> **q_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> exit_cb(em_eo_t eo);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> send_bg_events(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> do_bg_work(em_event_t evt, app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> do_memzero(app_msg_t *msg, app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> my_error_handler(em_eo_t eo, <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> error,</div>
<div class="line">                                    <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0c0a929399ae33b615f8ca8018d2a69d">em_escope_t</a> escope, va_list args);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *allocate_tracebuf(<span class="keywordtype">int</span> numbuf, <span class="keywordtype">size_t</span> bufsize, <span class="keywordtype">size_t</span> *realsize);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> free_tracebuf(<span class="keywordtype">void</span> *ptr, <span class="keywordtype">size_t</span> realsize);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> prefault(<span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> size);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> show_global_stats(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> create_timers(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> delete_timers(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> first_timer_create(app_eo_ctx_t *eo_ctx);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* --------------------------------------- */</span></div>
<div class="line"><a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> my_error_handler(em_eo_t eo, <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> error,</div>
<div class="line">                             <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0c0a929399ae33b615f8ca8018d2a69d">em_escope_t</a> escope, va_list args)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (escope == 0xDEAD) { <span class="comment">/* test_fatal_if */</span></div>
<div class="line">                va_list my_args;</div>
<div class="line"> </div>
<div class="line">                va_copy(my_args, args);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordtype">char</span> *file = va_arg(my_args, <span class="keywordtype">char</span>*);</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">char</span> *func = va_arg(my_args, <span class="keyword">const</span> <span class="keywordtype">char</span>*);</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">int</span> line = va_arg(my_args, <span class="keyword">const</span> <span class="keywordtype">int</span>);</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">char</span> *format = va_arg(my_args, <span class="keyword">const</span> <span class="keywordtype">char</span>*);</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">char</span> *base = basename(file);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">                #pragma GCC diagnostic push</span></div>
<div class="line"><span class="preprocessor">                #pragma GCC diagnostic ignored &quot;-Wformat-nonliteral&quot;</span></div>
<div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;FATAL - %s:%d, %s():\n&quot;</span>,</div>
<div class="line">                                base, line, func);</div>
<div class="line">                        vfprintf(stderr, format, my_args);</div>
<div class="line"><span class="preprocessor">                #pragma GCC diagnostic pop</span></div>
<div class="line">                va_end(my_args);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> test_error_handler(eo, error, escope, args);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> enter_cb(em_eo_t eo, <span class="keywordtype">void</span> **eo_ctx, em_event_t events[], <span class="keywordtype">int</span> num,</div>
<div class="line">              em_queue_t *queue, <span class="keywordtype">void</span> **q_ctx)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">int</span> count;</div>
<div class="line">        app_eo_ctx_t *<span class="keyword">const</span> my_eo_ctx = *eo_ctx;</div>
<div class="line"> </div>
<div class="line">        (void)eo;</div>
<div class="line">        (void)queue;</div>
<div class="line">        (void)q_ctx;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (unlikely(!my_eo_ctx))</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.dispatch) {</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num; i++) {</div>
<div class="line">                        app_msg_t *msg = <a name="a5"></a><a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(events[i]);</div>
<div class="line"> </div>
<div class="line">                        add_trace(my_eo_ctx, msg-&gt;id, OP_PROF_ENTER_CB,</div>
<div class="line">                                  0, count++, -1);</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        my_eo_ctx-&gt;cdat[<a name="a6"></a><a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>()].enter = TIME_STAMP_FN();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> exit_cb(em_eo_t eo)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">int</span> count;</div>
<div class="line">        app_eo_ctx_t *<span class="keyword">const</span> my_eo_ctx = <a name="a7"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga1262b0eefaf7840f9c2b44b7fe3ff93e">em_eo_get_context</a>(eo);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (unlikely(!my_eo_ctx))</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.dispatch)</div>
<div class="line">                add_trace(my_eo_ctx, -1, OP_PROF_EXIT_CB, 0, count++, -1);</div>
<div class="line"> </div>
<div class="line">        core_data *cdat = &amp;my_eo_ctx-&gt;cdat[<a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>()];</div>
<div class="line">        uint64_t took;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (__atomic_load_n(&amp;my_eo_ctx-&gt;state, __ATOMIC_ACQUIRE) == STATE_RUN) {</div>
<div class="line">                took = TIME_STAMP_FN() - cdat-&gt;enter;</div>
<div class="line">                cdat-&gt;acc_time += took;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> prefault(<span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> size)</div>
<div class="line">{</div>
<div class="line">        uint8_t *ptr = (uint8_t *)buf;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* write all pages to allocate and pre-fault (reduce runtime jitter) */</span></div>
<div class="line">        <span class="keywordflow">if</span> (EXTRA_PRINTS)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;Pre-faulting %lu bytes at %p (EM core %d)\n&quot;</span>, size, buf, <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>());</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; size; i += 4096)</div>
<div class="line">                *(ptr + i) = (uint8_t)i;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> *allocate_tracebuf(<span class="keywordtype">int</span> numbuf, <span class="keywordtype">size_t</span> bufsize, <span class="keywordtype">size_t</span> *realsize)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.usehuge) {</div>
<div class="line">                *realsize = (numbuf + 1) * bufsize;</div>
<div class="line">                <span class="keywordtype">void</span> *ptr = mmap(NULL, *realsize, PROT_READ | PROT_WRITE,</div>
<div class="line">                            MAP_PRIVATE | MAP_ANONYMOUS | MAP_POPULATE | MAP_HUGETLB | MAP_LOCKED,</div>
<div class="line">                            -1, 0);</div>
<div class="line">                <span class="keywordflow">if</span> (ptr == MAP_FAILED) {</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;Huge page mapping failed for trace buffer (%lu bytes)\n&quot;</span>,</div>
<div class="line">                                   *realsize);</div>
<div class="line">                        <span class="keywordflow">return</span> NULL;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                        <span class="keywordflow">return</span> ptr;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordtype">void</span> *buf = calloc(numbuf + 1, bufsize);</div>
<div class="line"> </div>
<div class="line">                *realsize = numbuf * bufsize;</div>
<div class="line">                prefault(buf, *realsize);</div>
<div class="line">                <span class="keywordflow">return</span> buf;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> free_tracebuf(<span class="keywordtype">void</span> *ptr, <span class="keywordtype">size_t</span> realsize)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.usehuge)</div>
<div class="line">                munmap(ptr, realsize);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                free(ptr);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">uint64_t linux_time_ns(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">struct </span>timespec ts;</div>
<div class="line">        uint64_t ns;</div>
<div class="line"> </div>
<div class="line">        clock_gettime(CLOCK_MONOTONIC_RAW, &amp;ts);</div>
<div class="line">        ns = ts.tv_nsec + (ts.tv_sec * 1000000000ULL);</div>
<div class="line">        <span class="keywordflow">return</span> ns;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> arg_to_ns(<span class="keyword">const</span> <span class="keywordtype">char</span> *s, int64_t *val)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">char</span> *endp;</div>
<div class="line">        int64_t num, mul = 1;</div>
<div class="line"> </div>
<div class="line">        num = strtol(s, &amp;endp, 0);</div>
<div class="line">        <span class="keywordflow">if</span> (num == 0 &amp;&amp; *s != <span class="charliteral">&#39;0&#39;</span>)</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (*endp != <span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line">                <span class="keywordflow">switch</span> (*endp) {</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div>
<div class="line">                        mul = 1; <span class="comment">/* ns */</span></div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;u&#39;</span>:</div>
<div class="line">                        mul = 1000; <span class="comment">/* us */</span></div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:</div>
<div class="line">                        mul = 1000 * 1000; <span class="comment">/* ms */</span></div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line">                        mul = 1000 * 1000 * 1000; <span class="comment">/* s */</span></div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">        *val = num * mul;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> send_stop(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!eo_ctx-&gt;stop_sent) { <span class="comment">/* in case state change gets delayed on event overload */</span></div>
<div class="line">                em_event_t <span class="keyword">event</span> = <a name="a8"></a><a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(app_msg_t), <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>, m_shm-&gt;pool);</div>
<div class="line"> </div>
<div class="line">                test_fatal_if(event == <a name="a9"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>, <span class="stringliteral">&quot;Can&#39;t allocate stop event!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                app_msg_t *msg = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line"> </div>
<div class="line">                msg-&gt;command = CMD_DONE;</div>
<div class="line">                msg-&gt;id = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line">                ret = <a name="a10"></a><a class="code" href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a>(event, eo_ctx-&gt;stop_q);</div>
<div class="line">                test_fatal_if(ret != <a name="a11"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;em_send(): %s %&quot;</span> PRI_STAT, __func__, ret);</div>
<div class="line">                eo_ctx-&gt;stop_sent++;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> cleanup(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> cores = m_shm-&gt;core_count;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; cores; i++) {</div>
<div class="line">                eo_ctx-&gt;cdat[i].count = 0;</div>
<div class="line">                eo_ctx-&gt;cdat[i].cancelled = 0;</div>
<div class="line">                eo_ctx-&gt;cdat[i].jobs_deleted = 0;</div>
<div class="line">                eo_ctx-&gt;cdat[i].jobs = 0;</div>
<div class="line">                eo_ctx-&gt;cdat[i].acc_time = 0;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> write_trace(app_eo_ctx_t *eo_ctx, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> cores = m_shm-&gt;core_count;</div>
<div class="line">        FILE *file = stdout;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;stdout&quot;</span>))</div>
<div class="line">                file = fopen(g_options.csv, <span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (file == NULL) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;FAILED to open trace file\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        fprintf(file, <span class="stringliteral">&quot;\n\n#BEGIN TRACE FORMAT 2\n&quot;</span>); <span class="comment">/* for offline analyzers */</span></div>
<div class="line">        fprintf(file, <span class="stringliteral">&quot;res_ns,res_hz,period_ns,max_period_ns,clksrc,num_tmo,loops,&quot;</span>);</div>
<div class="line">        fprintf(file, <span class="stringliteral">&quot;traces,noskip,SW-ver,bg,mz,timers\n&quot;</span>);</div>
<div class="line">        fprintf(file, <span class="stringliteral">&quot;%lu,%lu,%lu,%lu,%d,%d,%d,%d,%d,%s,\&quot;%d/%lu\&quot;,\&quot;%d/%lu\&quot;,%d\n&quot;</span>,</div>
<div class="line">                g_options.res_ns,</div>
<div class="line">                g_options.res_hz,</div>
<div class="line">                g_options.period_ns,</div>
<div class="line">                g_options.max_period_ns,</div>
<div class="line">                g_options.clock_src,</div>
<div class="line">                g_options.num_periodic,</div>
<div class="line">                g_options.num_runs,</div>
<div class="line">                g_options.tracebuf,</div>
<div class="line">                g_options.noskip,</div>
<div class="line">                VERSION,</div>
<div class="line">                g_options.bg_events, g_options.bg_time_ns / 1000UL,</div>
<div class="line">                g_options.mz_mb, g_options.mz_ns / 1000000UL,</div>
<div class="line">                g_options.num_timers);</div>
<div class="line">        fprintf(file, <span class="stringliteral">&quot;time_hz,meas_time_hz,timer_hz,meas_timer_hz,linux_hz\n&quot;</span>);</div>
<div class="line">        fprintf(file, <span class="stringliteral">&quot;%lu,%lu,%lu,%lu,%lu\n&quot;</span>,</div>
<div class="line">                eo_ctx-&gt;time_hz,</div>
<div class="line">                eo_ctx-&gt;meas_time_hz,</div>
<div class="line">                eo_ctx-&gt;test_hz,</div>
<div class="line">                eo_ctx-&gt;meas_test_hz,</div>
<div class="line">                eo_ctx-&gt;linux_hz);</div>
<div class="line"> </div>
<div class="line">        fprintf(file, <span class="stringliteral">&quot;tmo_id,period_ns,period_ticks,ack_late&quot;</span>);</div>
<div class="line">        fprintf(file, <span class="stringliteral">&quot;,start_tick,start_ns,first_ns,first\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; g_options.num_periodic; i++) {</div>
<div class="line">                fprintf(file, <span class="stringliteral">&quot;%d,%lu,%lu,%lu,%lu,%lu,%lu,%lu\n&quot;</span>,</div>
<div class="line">                        i, eo_ctx-&gt;tmo_data[i].period_ns,</div>
<div class="line">                        eo_ctx-&gt;tmo_data[i].ticks,</div>
<div class="line">                        eo_ctx-&gt;tmo_data[i].ack_late,</div>
<div class="line">                        eo_ctx-&gt;tmo_data[i].start,</div>
<div class="line">                        eo_ctx-&gt;tmo_data[i].start_ts,</div>
<div class="line">                        eo_ctx-&gt;tmo_data[i].first_ns,</div>
<div class="line">                        eo_ctx-&gt;tmo_data[i].first);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        fprintf(file, <span class="stringliteral">&quot;id,op,tick,time_ns,linux_time_ns,counter,core,timer\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; cores; c++) {</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; eo_ctx-&gt;cdat[c].count; i++) {</div>
<div class="line">                        fprintf(file, <span class="stringliteral">&quot;%d,%s,%lu,%lu,%lu,%d,%d,%d\n&quot;</span>,</div>
<div class="line">                                eo_ctx-&gt;cdat[c].trc[i].id,</div>
<div class="line">                                op_labels[eo_ctx-&gt;cdat[c].trc[i].op],</div>
<div class="line">                                eo_ctx-&gt;cdat[c].trc[i].tick,</div>
<div class="line">                                eo_ctx-&gt;cdat[c].trc[i].ts,</div>
<div class="line">                                eo_ctx-&gt;cdat[c].trc[i].linuxt,</div>
<div class="line">                                eo_ctx-&gt;cdat[c].trc[i].count,</div>
<div class="line">                                c,</div>
<div class="line">                                eo_ctx-&gt;cdat[c].trc[i].tidx);</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        fprintf(file, <span class="stringliteral">&quot;#END TRACE\n\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (file != stdout)</div>
<div class="line">                fclose(file);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> show_global_stats(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\nTOTAL STATS:\n&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;  Num tmo:           %lu\n&quot;</span>, eo_ctx-&gt;global_stat.num_tmo);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;  Num late ack:      %lu&quot;</span>, eo_ctx-&gt;global_stat.num_late);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; (%lu %%)\n&quot;</span>,</div>
<div class="line">                   (eo_ctx-&gt;global_stat.num_late * 100) / eo_ctx-&gt;global_stat.num_tmo);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;  Max early arrival: %.1f us %s\n&quot;</span>,</div>
<div class="line">                   ((<span class="keywordtype">double</span>)eo_ctx-&gt;global_stat.max_early_ns) / 1000.0,</div>
<div class="line">                   (uint64_t)llabs(eo_ctx-&gt;global_stat.max_early_ns) &gt; g_options.res_ns ? <span class="stringliteral">&quot;!&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;  Max diff from tgt: %.1f us (res %.1f us) %s\n&quot;</span>,</div>
<div class="line">                   ((<span class="keywordtype">double</span>)eo_ctx-&gt;global_stat.max_dev_ns) / 1000.0,</div>
<div class="line">                   (<span class="keywordtype">double</span>)g_options.res_ns / 1000.0,</div>
<div class="line">                   (uint64_t)llabs(eo_ctx-&gt;global_stat.max_dev_ns) &gt; (2 * g_options.res_ns) ?</div>
<div class="line">                   <span class="stringliteral">&quot;&gt;2x res!&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;  Max CPU load:      %d %%\n&quot;</span>, eo_ctx-&gt;global_stat.max_cpu);</div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;global_stat.max_dispatch)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;  Max EO rcv time:   %lu ns\n&quot;</span>, eo_ctx-&gt;global_stat.max_dispatch);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">uint64_t random_tmo_ns(uint64_t minval, uint64_t maxval)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (maxval == 0)</div>
<div class="line">                maxval = g_options.max_period_ns;</div>
<div class="line">        <span class="keywordflow">if</span> (minval == 0)</div>
<div class="line">                minval = g_options.min_period_ns;</div>
<div class="line"> </div>
<div class="line">        uint64_t r = random() % (maxval - minval + 1);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> r + minval; <span class="comment">/* ns between min/max */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">uint64_t random_work_ns(rnd_state_t *rng)</div>
<div class="line">{</div>
<div class="line">        uint64_t r;</div>
<div class="line">        int32_t r1;</div>
<div class="line"> </div>
<div class="line">        random_r(&amp;rng-&gt;rdata, &amp;r1);</div>
<div class="line">        r = (uint64_t)r1;</div>
<div class="line">        <span class="keywordflow">if</span> (r % 100 &gt;= g_options.work_prop) <span class="comment">/* probability of work roughly */</span></div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">        random_r(&amp;rng-&gt;rdata, &amp;r1);</div>
<div class="line">        r = (uint64_t)r1 % (g_options.max_work_ns - g_options.min_work_ns + 1);</div>
<div class="line">        <span class="keywordflow">return</span> r + g_options.min_work_ns;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">tmo_trace *find_tmo(app_eo_ctx_t *eo_ctx, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> *last)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> cores = m_shm-&gt;core_count;</div>
<div class="line">        tmo_trace *trc = NULL;</div>
<div class="line">        <span class="keywordtype">int</span> last_count = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; cores; c++) {</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; eo_ctx-&gt;cdat[c].count; i++) { <span class="comment">/* find id */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (eo_ctx-&gt;cdat[c].trc[i].op == OP_TMO &amp;&amp;</div>
<div class="line">                            eo_ctx-&gt;cdat[c].trc[i].id == <span class="keywordtype">id</span>) { <span class="comment">/* this TMO */</span></div>
<div class="line">                                <span class="keywordflow">if</span> (eo_ctx-&gt;cdat[c].trc[i].count == count)</div>
<div class="line">                                        trc = &amp;eo_ctx-&gt;cdat[c].trc[i];</div>
<div class="line">                                <span class="comment">/* always run through for last_count */</span></div>
<div class="line">                                <span class="keywordflow">if</span> (eo_ctx-&gt;cdat[c].trc[i].count &gt; last_count)</div>
<div class="line">                                        last_count = eo_ctx-&gt;cdat[c].trc[i].count;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        *last = last_count;</div>
<div class="line">        <span class="keywordflow">return</span> trc;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> do_one_tmo(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, app_eo_ctx_t *eo_ctx,</div>
<div class="line">               uint64_t *min, uint64_t *max, uint64_t *first,</div>
<div class="line">               int64_t *tgt_max, int64_t *max_early_ns, <span class="keywordtype">int</span> *evnum)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> num = 0;</div>
<div class="line">        uint64_t diff;</div>
<div class="line">        uint64_t prev = 0;</div>
<div class="line">        <span class="keywordtype">int</span> last = 0;</div>
<div class="line">        <span class="keywordtype">int</span> last_num;</div>
<div class="line">        uint64_t period_ns = eo_ctx-&gt;tmo_data[id].period_ns;</div>
<div class="line">        uint64_t start_ns = eo_ctx-&gt;tmo_data[id].start_ts;</div>
<div class="line">        int64_t max_tgt_diff = 0;</div>
<div class="line"> </div>
<div class="line">        *max = 0;</div>
<div class="line">        *min = INT64_MAX;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* find in sequential order for diff to work. TODO this gets very slow with many tmos */</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> count = 1; count &lt; g_options.tracebuf; count++) {</div>
<div class="line">                tmo_trace *tmo = find_tmo(eo_ctx, <span class="keywordtype">id</span>, count, &amp;last_num);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (!tmo) {</div>
<div class="line">                        <span class="keywordflow">if</span> (last != count - 1)</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;MISSING TMO: id %d, count %d\n&quot;</span>, <span class="keywordtype">id</span>, count);</div>
<div class="line">                        *tgt_max = max_tgt_diff;</div>
<div class="line">                        <span class="keywordflow">return</span> num;</div>
<div class="line">                }</div>
<div class="line">                last++;</div>
<div class="line">                <span class="keywordflow">if</span> (count == 1) { <span class="comment">/* first period may be different */</span></div>
<div class="line">                        uint64_t tgt = start_ns + eo_ctx-&gt;tmo_data[id].first_ns;</div>
<div class="line">                        int64_t tgtdiff = (int64_t)tmo-&gt;ts - (int64_t)tgt;</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span> (llabs(max_tgt_diff) &lt; llabs(tgtdiff)) {</div>
<div class="line">                                max_tgt_diff = tgtdiff;</div>
<div class="line">                                *evnum = count;</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">if</span> (tgtdiff &lt; *max_early_ns)</div>
<div class="line">                                *max_early_ns = tgtdiff;</div>
<div class="line"> </div>
<div class="line">                        diff = tmo-&gt;ts - eo_ctx-&gt;tmo_data[id].start_ts;</div>
<div class="line">                        *first = diff;</div>
<div class="line">                        start_ns += eo_ctx-&gt;tmo_data[id].first_ns; <span class="comment">/* from now constant period */</span></div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                        diff = tmo-&gt;ts - prev;</div>
<div class="line">                        <span class="comment">/*skip last, could be while stopping */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (last_num &gt; count &amp;&amp; tmo-&gt;ts &lt; eo_ctx-&gt;stopped) {</div>
<div class="line">                                <span class="keywordflow">if</span> (diff &gt; *max)</div>
<div class="line">                                        *max = diff;</div>
<div class="line">                                <span class="keywordflow">if</span> (diff &lt; *min)</div>
<div class="line">                                        *min = diff;</div>
<div class="line"> </div>
<div class="line">                                <span class="comment">/* calculate distance to target */</span></div>
<div class="line">                                uint64_t tgt = start_ns + (count - 1) * period_ns;</div>
<div class="line">                                int64_t tgtdiff = (int64_t)tmo-&gt;ts - (int64_t)tgt;</div>
<div class="line"> </div>
<div class="line">                                <span class="keywordflow">if</span> (llabs(max_tgt_diff) &lt; llabs(tgtdiff)) {</div>
<div class="line">                                        max_tgt_diff = tgtdiff;</div>
<div class="line">                                        *evnum = count;</div>
<div class="line">                                }</div>
<div class="line">                                <span class="keywordflow">if</span> (tgtdiff &lt; *max_early_ns)</div>
<div class="line">                                        *max_early_ns = tgtdiff;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">                prev = tmo-&gt;ts;</div>
<div class="line">                num++;</div>
<div class="line">        }</div>
<div class="line">        *tgt_max = max_tgt_diff;</div>
<div class="line">        <span class="keywordflow">return</span> num;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> timing_statistics(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* basic statistics, more with offline tools (-w) */</span></div>
<div class="line">        uint64_t max_ts = 0, min_ts = 0, first_ts = 0;</div>
<div class="line">        int64_t tgt_max = 0;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> cores = m_shm-&gt;core_count;</div>
<div class="line">        uint64_t system_used = eo_ctx-&gt;stopped - eo_ctx-&gt;started;</div>
<div class="line">        <span class="keywordtype">bool</span> stop_loops = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; cores; c++) {</div>
<div class="line">                core_data *cdat = &amp;eo_ctx-&gt;cdat[c];</div>
<div class="line">                uint64_t eo_used = cdat-&gt;acc_time;</div>
<div class="line">                <span class="keywordtype">double</span> perc = (double)eo_used / (<span class="keywordtype">double</span>)system_used * 100;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (perc &gt; 100)</div>
<div class="line">                        perc = 100;</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;STAT_CORE [%d]: %d tmos, %d jobs, EO used %.1f %% CPU time\n&quot;</span>,</div>
<div class="line">                           c, cdat-&gt;count, cdat-&gt;jobs, perc);</div>
<div class="line">                <span class="keywordflow">if</span> (perc &gt; eo_ctx-&gt;global_stat.max_cpu)</div>
<div class="line">                        eo_ctx-&gt;global_stat.max_cpu = round(perc);</div>
<div class="line">                eo_ctx-&gt;global_stat.num_tmo += cdat-&gt;count;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; g_options.num_periodic; <span class="keywordtype">id</span>++) { <span class="comment">/* each timeout */</span></div>
<div class="line">                tmo_setup *tmo_data = &amp;eo_ctx-&gt;tmo_data[id];</div>
<div class="line">                int64_t max_early = 0;</div>
<div class="line">                <span class="keywordtype">int</span> evnum = 0;</div>
<div class="line">                <span class="keywordtype">int</span> num = do_one_tmo(<span class="keywordtype">id</span>, eo_ctx,</div>
<div class="line">                                     &amp;min_ts, &amp;max_ts, &amp;first_ts, &amp;tgt_max, &amp;max_early, &amp;evnum);</div>
<div class="line"> </div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;STAT-TMO [%d]: %d tmos (tmr#%d), period %lu ns (&quot;</span>,</div>
<div class="line">                           <span class="keywordtype">id</span>, num, tmo_data-&gt;tidx, tmo_data-&gt;period_ns);</div>
<div class="line">                <span class="keywordflow">if</span> (num) {</div>
<div class="line">                        int64_t maxdiff = (int64_t)max_ts -</div>
<div class="line">                                          (int64_t)tmo_data-&gt;period_ns;</div>
<div class="line">                        int64_t mindiff = (int64_t)min_ts -</div>
<div class="line">                                          (int64_t)tmo_data-&gt;period_ns;</div>
<div class="line">                        int64_t firstdiff = (int64_t)first_ts -</div>
<div class="line">                                            (int64_t)tmo_data-&gt;first_ns;</div>
<div class="line"> </div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;%lu ticks), interval %ld ns ... +%ld ns&quot;</span>,</div>
<div class="line">                                   tmo_data-&gt;ticks, mindiff, maxdiff);</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot; (%ld us ... +%ld us)\n&quot;</span>, mindiff / 1000, maxdiff / 1000);</div>
<div class="line">                        <span class="keywordflow">if</span> (tmo_data-&gt;first_ns != tmo_data-&gt;period_ns)</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;  - 1st period set %lu ns, was %ld ns (diff %.2f us)\n&quot;</span>,</div>
<div class="line">                                           tmo_data-&gt;first_ns, first_ts, (<span class="keywordtype">double</span>)firstdiff / 1000);</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;  - Max diff from target %.2f us, ev #%d\n&quot;</span>,</div>
<div class="line">                                   (<span class="keywordtype">double</span>)tgt_max / 1000, evnum);</div>
<div class="line">                        <span class="keywordflow">if</span> (llabs(tgt_max) &gt; llabs(eo_ctx-&gt;global_stat.max_dev_ns))</div>
<div class="line">                                eo_ctx-&gt;global_stat.max_dev_ns = tgt_max;</div>
<div class="line">                        <span class="keywordflow">if</span> (g_options.stop_limit &amp;&amp;</div>
<div class="line">                            ((uint64_t)llabs(tgt_max) &gt; g_options.stop_limit))</div>
<div class="line">                                stop_loops = <span class="keyword">true</span>;</div>
<div class="line">                        <span class="keywordflow">if</span> (max_early &lt; eo_ctx-&gt;global_stat.max_early_ns)</div>
<div class="line">                                eo_ctx-&gt;global_stat.max_early_ns = max_early;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;    ERROR - no timeouts received\n&quot;</span>);</div>
<div class="line">                        <span class="keywordflow">if</span> (g_options.stop_limit)</div>
<div class="line">                                stop_loops = <span class="keyword">true</span>;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Starting timeout loop took %lu us (%lu per tmo)\n&quot;</span>,</div>
<div class="line">                   eo_ctx-&gt;start_loop_ns / 1000,</div>
<div class="line">                   eo_ctx-&gt;start_loop_ns / 1000 / g_options.num_periodic);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!g_options.dispatch)</div>
<div class="line">                <span class="keywordflow">return</span> stop_loops;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * g_options.dispatch set</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * Calculate EO rcv min-max-avg:</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        uint64_t min = UINT64_MAX, max = 0, avg = 0;</div>
<div class="line">        uint64_t prev_ts = 0;</div>
<div class="line">        <span class="keywordtype">int</span> prev_count = 0;</div>
<div class="line">        <span class="keywordtype">int</span> num = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; cores; c++) {</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; g_options.tracebuf; i++) {</div>
<div class="line">                        core_data *cdat = &amp;eo_ctx-&gt;cdat[c];</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span> (cdat-&gt;trc[i].op == OP_PROF_ENTER_CB) {</div>
<div class="line">                                prev_ts = cdat-&gt;trc[i].ts;</div>
<div class="line">                                prev_count = cdat-&gt;trc[i].count;</div>
<div class="line">                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cdat-&gt;trc[i].op == OP_PROF_EXIT_CB) {</div>
<div class="line">                                uint64_t diff_ts;</div>
<div class="line">                                uint64_t ns;</div>
<div class="line"> </div>
<div class="line">                                <span class="keywordflow">if</span> (prev_count != cdat-&gt;trc[i].count)</div>
<div class="line">                                        APPL_PRINT(<span class="stringliteral">&quot;No enter cnt=%d\n&quot;</span>, prev_count);</div>
<div class="line"> </div>
<div class="line">                                diff_ts = cdat-&gt;trc[i].ts - prev_ts;</div>
<div class="line">                                ns = diff_ts;</div>
<div class="line"> </div>
<div class="line">                                <span class="keywordflow">if</span> (ns &lt; min)</div>
<div class="line">                                        min = ns;</div>
<div class="line">                                <span class="keywordflow">if</span> (ns &gt; max)</div>
<div class="line">                                        max = ns;</div>
<div class="line">                                avg += ns;</div>
<div class="line">                                num++;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%d dispatcher enter-exit samples\n&quot;</span>, num);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;PROF-DISPATCH rcv time: min %lu ns, max %lu ns, avg %lu ns\n&quot;</span>,</div>
<div class="line">                   min, max, num &gt; 0 ? avg / num : 0);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (max &gt; eo_ctx-&gt;global_stat.max_dispatch)</div>
<div class="line">                eo_ctx-&gt;global_stat.max_dispatch = max;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> stop_loops;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> profile_statistics(e_op op, <span class="keywordtype">int</span> cores, app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        uint64_t min = UINT64_MAX;</div>
<div class="line">        uint64_t max = 0, avg = 0, num = 0;</div>
<div class="line">        uint64_t t;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; cores; c++) {</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; g_options.tracebuf; i++) {</div>
<div class="line">                        <span class="keywordflow">if</span> (eo_ctx-&gt;cdat[c].trc[i].op == op) {</div>
<div class="line">                                t = eo_ctx-&gt;cdat[c].trc[i].linuxt;</div>
<div class="line">                                <span class="keywordflow">if</span> (min &gt; t)</div>
<div class="line">                                        min = t;</div>
<div class="line">                                <span class="keywordflow">if</span> (max &lt; t)</div>
<div class="line">                                        max = t;</div>
<div class="line">                                avg += t;</div>
<div class="line">                                num++;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (num)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;%-15s %-15lu %-15lu %-15lu %-15lu\n&quot;</span>, op_labels[op],</div>
<div class="line">                           num, min, max, avg / num);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> profile_all_stats(<span class="keywordtype">int</span> cores, app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;API timing profiles:\n&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;api             count           min             max             avg (ns)\n&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;------------------------------------------------------------------------\n&quot;</span>);</div>
<div class="line">        profile_statistics(OP_PROF_CREATE, cores, eo_ctx);</div>
<div class="line">        profile_statistics(OP_PROF_SET, cores, eo_ctx);</div>
<div class="line">        profile_statistics(OP_PROF_ACK, cores, eo_ctx);</div>
<div class="line">        profile_statistics(OP_PROF_DELETE, cores, eo_ctx);</div>
<div class="line">        profile_statistics(OP_PROF_CANCEL, cores, eo_ctx);</div>
<div class="line">        profile_statistics(OP_PROF_TMR_CREATE, cores, eo_ctx);</div>
<div class="line">        profile_statistics(OP_PROF_TMR_DELETE, cores, eo_ctx);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> analyze(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> cores = m_shm-&gt;core_count;</div>
<div class="line">        <span class="keywordtype">int</span> cancelled = 0;</div>
<div class="line">        <span class="keywordtype">int</span> job_del = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">bool</span> stop = timing_statistics(eo_ctx);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.profile)</div>
<div class="line">                profile_all_stats(cores, eo_ctx);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; cores; c++) {</div>
<div class="line">                cancelled += eo_ctx-&gt;cdat[c].cancelled;</div>
<div class="line">                job_del += eo_ctx-&gt;cdat[c].jobs_deleted;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        show_global_stats(eo_ctx);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* write trace file */</span></div>
<div class="line">        <span class="keywordflow">if</span> (g_options.csv != NULL)</div>
<div class="line">                write_trace(eo_ctx, g_options.csv);</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%d/%d timeouts were cancelled\n&quot;</span>, cancelled, g_options.num_periodic);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.bg_events)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;%d/%d bg jobs were deleted\n&quot;</span>, job_del, g_options.bg_events);</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.mz_mb)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;%lu memzeros\n&quot;</span>, eo_ctx-&gt;mz_count);</div>
<div class="line">        <span class="keywordtype">double</span> span = eo_ctx-&gt;stopped - eo_ctx-&gt;started;</div>
<div class="line"> </div>
<div class="line">        span /= 1000000000;</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Timer runtime %f s\n&quot;</span>, span);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(cancelled != g_options.num_periodic,</div>
<div class="line">                      <span class="stringliteral">&quot;Not all tmos deleted (did not arrive at all?)\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (stop) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;STOP due to timing error larger than limit! (%f s)\n&quot;</span>,</div>
<div class="line">                           (<span class="keywordtype">double</span>)g_options.stop_limit / 1000000000);</div>
<div class="line">                <span class="keyword">raise</span>(SIGINT);</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> add_trace(app_eo_ctx_t *eo_ctx, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, e_op op, uint64_t ns, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> tidx)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;cdat[core].trc == NULL)</div>
<div class="line">                <span class="keywordflow">return</span> 1; <span class="comment">/* skip during early startup */</span></div>
<div class="line"> </div>
<div class="line">        tmo_trace *tmo = &amp;eo_ctx-&gt;cdat[core].trc[eo_ctx-&gt;cdat[core].count];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;cdat[core].count &lt; g_options.tracebuf) {</div>
<div class="line">                <span class="keywordflow">if</span> (op &lt; OP_PROF_ACK &amp;&amp; (tidx != -1)) <span class="comment">/* to be a bit faster for profiling */</span></div>
<div class="line">                        tmo-&gt;tick = <a name="a12"></a><a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;test_tmr[tidx]);</div>
<div class="line">                tmo-&gt;op = op;</div>
<div class="line">                tmo-&gt;id = id;</div>
<div class="line">                tmo-&gt;ts = TIME_STAMP_FN();</div>
<div class="line">                tmo-&gt;linuxt = ns;</div>
<div class="line">                tmo-&gt;count = count;</div>
<div class="line">                tmo-&gt;tidx = tidx;</div>
<div class="line">                eo_ctx-&gt;cdat[core].count++;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> (eo_ctx-&gt;cdat[core].count &gt;= g_options.trcstop) ? 0 : 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> send_bg_events(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; g_options.bg_events; n++) {</div>
<div class="line">                em_event_t <span class="keyword">event</span> = <a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(app_msg_t),</div>
<div class="line">                                            <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>, m_shm-&gt;pool);</div>
<div class="line">                test_fatal_if(event == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>, <span class="stringliteral">&quot;Can&#39;t allocate bg event!\n&quot;</span>);</div>
<div class="line">                app_msg_t *msg = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line"> </div>
<div class="line">                msg-&gt;command = CMD_BGWORK;</div>
<div class="line">                msg-&gt;count = 0;</div>
<div class="line">                msg-&gt;id = n + 1;</div>
<div class="line">                msg-&gt;arg = g_options.bg_time_ns;</div>
<div class="line">                test_fatal_if(<a class="code" href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a>(event, eo_ctx-&gt;bg_q) != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Can&#39;t allocate bg event!\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> start_periodic(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        app_msg_t *msg;</div>
<div class="line">        em_event_t event;</div>
<div class="line">        <a class="code" href="../../dd/d32/structem__timer__timeout__t.html">em_tmo_t</a> tmo;</div>
<div class="line">        <a class="code" href="../../de/dc2/group__em__timer.html#gaade0f99e694a2f999abe467bc05fde61">em_tmo_flag_t</a> flag = <a name="a13"></a><a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#gaade0f99e694a2f999abe467bc05fde61aac8e81389e6feaf233eff357c4ece5f0">EM_TMO_FLAG_PERIODIC</a>;</div>
<div class="line">        uint64_t t1 = 0;</div>
<div class="line">        uint64_t max_period = 0;</div>
<div class="line">        <span class="keywordtype">int</span> tidx;</div>
<div class="line">        uint64_t first_same_tick = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.noskip)</div>
<div class="line">                flag |= <a name="a14"></a><a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#gaade0f99e694a2f999abe467bc05fde61a6eb7050f533988c44b9b9ee783903c44">EM_TMO_FLAG_NOSKIP</a>;</div>
<div class="line">        eo_ctx-&gt;stop_sent = 0;</div>
<div class="line">        eo_ctx-&gt;started = TIME_STAMP_FN();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; g_options.num_periodic; i++) {</div>
<div class="line">                <span class="keyword">event</span> = <a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(app_msg_t), g_options.etype, m_shm-&gt;pool);</div>
<div class="line">                test_fatal_if(event == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>,</div>
<div class="line">                              <span class="stringliteral">&quot;Can&#39;t allocate test event (%ldB)!\n&quot;</span>,</div>
<div class="line">                              <span class="keyword">sizeof</span>(app_msg_t));</div>
<div class="line"> </div>
<div class="line">                msg = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line">                msg-&gt;command = CMD_TMO;</div>
<div class="line">                msg-&gt;count = 0;</div>
<div class="line">                msg-&gt;id = i;</div>
<div class="line">                tidx = random() % g_options.num_timers;</div>
<div class="line">                msg-&gt;tidx = tidx;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (eo_ctx-&gt;tmo_data[i].handle == <a name="a15"></a><a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>) { <span class="comment">/* not -q */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (g_options.profile)</div>
<div class="line">                                t1 = TIME_STAMP_FN();</div>
<div class="line">                        tmo = <a name="a16"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga4fc3dd338b784ce9b122eeb3fbf4ea07">em_tmo_create</a>(m_shm-&gt;test_tmr[tidx], flag, eo_ctx-&gt;test_q);</div>
<div class="line">                        <span class="keywordflow">if</span> (g_options.profile)</div>
<div class="line">                                add_prof(eo_ctx, t1, OP_PROF_CREATE, msg);</div>
<div class="line">                        test_fatal_if(tmo == <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>, <span class="stringliteral">&quot;Can&#39;t allocate test_tmo!\n&quot;</span>);</div>
<div class="line">                        eo_ctx-&gt;tmo_data[i].handle = tmo;</div>
<div class="line">                }</div>
<div class="line">                msg-&gt;tmo = eo_ctx-&gt;tmo_data[i].handle;</div>
<div class="line">                eo_ctx-&gt;tmo_data[i].tidx = tidx;</div>
<div class="line"> </div>
<div class="line">                uint64_t period_ticks;</div>
<div class="line">                uint64_t first = 0;</div>
<div class="line">                <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> stat;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (g_options.period_ns) {</div>
<div class="line">                        eo_ctx-&gt;tmo_data[i].period_ns = g_options.period_ns;</div>
<div class="line">                } <span class="keywordflow">else</span> { <span class="comment">/* 0: use random */</span></div>
<div class="line">                        eo_ctx-&gt;tmo_data[i].period_ns = random_tmo_ns(0, 0);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (max_period &lt; eo_ctx-&gt;tmo_data[i].period_ns)</div>
<div class="line">                        max_period = eo_ctx-&gt;tmo_data[i].period_ns;</div>
<div class="line">                period_ticks = <a name="a17"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga443bd3c10af754ddc03fcee1d52fca05">em_timer_ns_to_tick</a>(m_shm-&gt;test_tmr[tidx],</div>
<div class="line">                                                   eo_ctx-&gt;tmo_data[i].period_ns);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (EXTRA_PRINTS &amp;&amp; i == 0)</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;Timer Hz %lu\n&quot;</span>, eo_ctx-&gt;test_hz);</div>
<div class="line"> </div>
<div class="line">                test_fatal_if(period_ticks &lt; 1, <span class="stringliteral">&quot;timer resolution is too low!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (g_options.first_ns &lt; 0) <span class="comment">/* use random */</span></div>
<div class="line">                        eo_ctx-&gt;tmo_data[i].first_ns = random_tmo_ns(0, llabs(g_options.first_ns));</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (g_options.first_ns == 0) <span class="comment">/* use period */</span></div>
<div class="line">                        eo_ctx-&gt;tmo_data[i].first_ns = eo_ctx-&gt;tmo_data[i].period_ns;</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        eo_ctx-&gt;tmo_data[i].first_ns = g_options.first_ns;</div>
<div class="line"> </div>
<div class="line">                first = <a class="code" href="../../de/dc2/group__em__timer.html#ga443bd3c10af754ddc03fcee1d52fca05">em_timer_ns_to_tick</a>(m_shm-&gt;test_tmr[tidx], eo_ctx-&gt;tmo_data[i].first_ns);</div>
<div class="line">                eo_ctx-&gt;tmo_data[i].ack_late = 0;</div>
<div class="line">                eo_ctx-&gt;tmo_data[i].ticks = period_ticks;</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* store start time */</span></div>
<div class="line">                eo_ctx-&gt;tmo_data[i].start_ts = TIME_STAMP_FN();</div>
<div class="line">                eo_ctx-&gt;tmo_data[i].start = <a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;test_tmr[tidx]);</div>
<div class="line">                first += eo_ctx-&gt;tmo_data[i].start; <span class="comment">/* ticks from now */</span></div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (i == 0) { <span class="comment">/* save tick from first tmo */</span></div>
<div class="line">                        first_same_tick = first;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.same_tick) {</div>
<div class="line">                        first = first_same_tick;</div>
<div class="line">                        <span class="comment">/* this is not accurate, but makes summary analysis work better */</span></div>
<div class="line">                        eo_ctx-&gt;tmo_data[i].start_ts = eo_ctx-&gt;tmo_data[0].start_ts;</div>
<div class="line">                }</div>
<div class="line">                eo_ctx-&gt;tmo_data[i].first = first;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (g_options.profile)</div>
<div class="line">                        t1 = TIME_STAMP_FN();</div>
<div class="line">                stat = <a name="a18"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga8f1f88a05b9e366f3b31447dead90b5e">em_tmo_set_periodic</a>(eo_ctx-&gt;tmo_data[i].handle, first, period_ticks, event);</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.profile)</div>
<div class="line">                        add_prof(eo_ctx, t1, OP_PROF_SET, msg);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (unlikely(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)) {</div>
<div class="line">                        <span class="keywordflow">if</span> (EXTRA_PRINTS) {</div>
<div class="line">                                <a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a> now = <a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;test_tmr[tidx]);</div>
<div class="line"> </div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;FAILED to set tmo, stat=%d: first=%lu, &quot;</span>, stat, first);</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;now %lu (diff %ld), period=%lu\n&quot;</span>,</div>
<div class="line">                                           now, (int64_t)first - (int64_t)now, period_ticks);</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;(first_ns %lu)\n&quot;</span>, eo_ctx-&gt;tmo_data[i].first_ns);</div>
<div class="line">                        }</div>
<div class="line">                        test_fatal_if(1, <span class="stringliteral">&quot;Can&#39;t activate test tmo!\n&quot;</span>);</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        eo_ctx-&gt;start_loop_ns = TIME_STAMP_FN() - eo_ctx-&gt;started;</div>
<div class="line">        eo_ctx-&gt;max_period = max_period;</div>
<div class="line">        <span class="comment">/* time window to detect possible late timeouts before cleanup */</span></div>
<div class="line">        eo_ctx-&gt;cooloff = ((max_period / 1000000000ULL) * 2) + 1;</div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;cooloff &lt; MIN_COOLOFF)</div>
<div class="line">                eo_ctx-&gt;cooloff = MIN_COOLOFF; <span class="comment">/* HB periods (secs) */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> add_prof(app_eo_ctx_t *eo_ctx, uint64_t t1, e_op op, app_msg_t *msg)</div>
<div class="line">{</div>
<div class="line">        uint64_t dif = TIME_STAMP_FN() - t1;</div>
<div class="line">        <span class="keywordtype">int</span> id, count;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (unlikely(msg == NULL)) {</div>
<div class="line">                <span class="keywordtype">id</span> = -1;</div>
<div class="line">                count = -1;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordtype">id</span> = msg-&gt;id;</div>
<div class="line">                count = msg-&gt;count;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        add_trace(eo_ctx, <span class="keywordtype">id</span>, op, dif, count, -1);</div>
<div class="line">        <span class="comment">/* if this filled the buffer it&#39;s handled on next tmo */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> handle_periodic(app_eo_ctx_t *eo_ctx, em_event_t event)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line">        app_msg_t *msg = (app_msg_t *)<a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line">        <span class="keywordtype">int</span> reuse = 1;</div>
<div class="line">        e_state state = __atomic_load_n(&amp;eo_ctx-&gt;state, __ATOMIC_ACQUIRE);</div>
<div class="line">        uint64_t t1 = 0;</div>
<div class="line">        <a name="_a19"></a><a class="code" href="../../dc/dd0/structem__tmo__stats__t.html">em_tmo_stats_t</a> ctrs = { 0 }; <span class="comment">/* init to avoid gcc warning with LTO */</span></div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line"> </div>
<div class="line">        msg-&gt;count++;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* this is to optionally test abnormal exits only */</span></div>
<div class="line">        <span class="keywordflow">if</span> (unlikely(g_options.abort != 0) &amp;&amp; abs(g_options.abort) &lt;= msg-&gt;count) {</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.abort &lt; 0) { <span class="comment">/* cause segfault to test exception here */</span></div>
<div class="line">                        uint64_t *fault = NULL;</div>
<div class="line">                        <span class="comment">/* coverity[FORWARD_NULL] */</span></div>
<div class="line">                        msg-&gt;arg = *fault;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                        abort();</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (likely(state == STATE_RUN)) { <span class="comment">/* add tmo trace */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!add_trace(eo_ctx, msg-&gt;id, OP_TMO, 0, msg-&gt;count, msg-&gt;tidx))</div>
<div class="line">                        send_stop(eo_ctx); <span class="comment">/* triggers state change to stop */</span></div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (unlikely(<a name="a20"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga20a84e2f8b65dbaf916ec45a1ade1ee3">em_tmo_get_type</a>(event, NULL, <span class="keyword">false</span>) != <a name="a21"></a><a class="code" href="../../de/dc2/group__em__timer.html#ggafc12eb3000ea78f2493b1e36b832f63badea7e33cc1c34e598f387f0909ca471c">EM_TMO_TYPE_PERIODIC</a>))</div>
<div class="line">                        test_error(<a name="a22"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF, <span class="stringliteral">&quot;Unexpected, event is not tmo\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (g_options.work_prop) {</div>
<div class="line">                        uint64_t work = random_work_ns(&amp;eo_ctx-&gt;cdat[core].rng);</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span> (work) { <span class="comment">/* add extra delay */</span></div>
<div class="line">                                uint64_t t2;</div>
<div class="line">                                uint64_t ns = TIME_STAMP_FN();</div>
<div class="line"> </div>
<div class="line">                                <span class="keywordflow">do</span> {</div>
<div class="line">                                        t2 = TIME_STAMP_FN();</div>
<div class="line">                                } <span class="keywordflow">while</span> (t2 &lt; (ns + work));</div>
<div class="line">                                add_trace(eo_ctx, msg-&gt;id, OP_WORK, work, msg-&gt;count, -1);</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* only ack while in running state */</span></div>
<div class="line">                add_trace(eo_ctx, msg-&gt;id, OP_ACK, 0, msg-&gt;count, msg-&gt;tidx);</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.profile)</div>
<div class="line">                        t1 = TIME_STAMP_FN();</div>
<div class="line">                <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> stat = <a name="a23"></a><a class="code" href="../../de/dc2/group__em__timer.html#gaf65f50c383b579720a31154b04ea610e">em_tmo_ack</a>(msg-&gt;tmo, event);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (g_options.profile)</div>
<div class="line">                        add_prof(eo_ctx, t1, OP_PROF_ACK, msg);</div>
<div class="line">                <span class="keywordflow">if</span> (unlikely(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>))</div>
<div class="line">                        test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF, <span class="stringliteral">&quot;ack() fail!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state == STATE_COOLOFF) { <span class="comment">/* trace, but cancel */</span></div>
<div class="line">                em_event_t tmo_event = <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>;</div>
<div class="line"> </div>
<div class="line">                add_trace(eo_ctx, msg-&gt;id, OP_TMO, 0, msg-&gt;count, msg-&gt;tidx);</div>
<div class="line">                <a name="a24"></a><a class="code" href="../../de/dc2/group__em__timer.html#gaa192f52e47f2995d2af1175ae456c19f">em_tmo_get_stats</a>(msg-&gt;tmo, &amp;ctrs);</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;STAT-ACK [%d]:  %lu acks, %lu late, %lu skips\n&quot;</span>,</div>
<div class="line">                           msg-&gt;id, ctrs.<a name="a25"></a><a class="code" href="../../dc/dd0/structem__tmo__stats__t.html#a989f8e63270acdbf23e715e7ebe7ce23">num_acks</a>, ctrs.<a name="a26"></a><a class="code" href="../../dc/dd0/structem__tmo__stats__t.html#a35394de2a812bdc005b79a6a132aa235">num_late_ack</a>, ctrs.<a name="a27"></a><a class="code" href="../../dc/dd0/structem__tmo__stats__t.html#ad518945885276d7c1b1fe1e4d9023367">num_period_skips</a>);</div>
<div class="line">                eo_ctx-&gt;tmo_data[msg-&gt;id].ack_late = ctrs.<a class="code" href="../../dc/dd0/structem__tmo__stats__t.html#a35394de2a812bdc005b79a6a132aa235">num_late_ack</a>;</div>
<div class="line">                eo_ctx-&gt;global_stat.num_late += ctrs.<a class="code" href="../../dc/dd0/structem__tmo__stats__t.html#a35394de2a812bdc005b79a6a132aa235">num_late_ack</a>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (unlikely(msg-&gt;id &gt;= g_options.num_periodic))</div>
<div class="line">                        test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF, <span class="stringliteral">&quot;Corrupted tmo msg?\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (g_options.profile)</div>
<div class="line">                        t1 = TIME_STAMP_FN();</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.no_del) { <span class="comment">/* don&#39;t delete each round */</span></div>
<div class="line">                        ret = <a name="a28"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga786f0cc89e9bdfda1c1274165600f0ef">em_tmo_cancel</a>(msg-&gt;tmo, &amp;tmo_event);</div>
<div class="line">                        <span class="keywordflow">if</span> (g_options.profile)</div>
<div class="line">                                add_prof(eo_ctx, t1, OP_PROF_CANCEL, msg);</div>
<div class="line">                        test_fatal_if(ret == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;tmo_cancel ok, expecting fail here!\n&quot;</span>);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                        <span class="keywordflow">if</span> (<a name="a29"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga66476f77546996eea9acebaa471c1b52">em_tmo_get_state</a>(msg-&gt;tmo) == <a name="a30"></a><a class="code" href="../../de/dc2/group__em__timer.html#gga3857ab06946e6b4047352d5d84ffff4daa54abf62265d1c2beaeeadb6a1ee240f">EM_TMO_STATE_ACTIVE</a>)</div>
<div class="line">                                <a class="code" href="../../de/dc2/group__em__timer.html#ga786f0cc89e9bdfda1c1274165600f0ef">em_tmo_cancel</a>(msg-&gt;tmo, &amp;tmo_event);</div>
<div class="line">                        ret = <a name="a31"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga67d2db5f72ccdd285649ce05b0a22a92">em_tmo_delete</a>(msg-&gt;tmo);</div>
<div class="line">                        <span class="keywordflow">if</span> (g_options.profile)</div>
<div class="line">                                add_prof(eo_ctx, t1, OP_PROF_DELETE, msg);</div>
<div class="line">                        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;tmo_delete failed, ret %&quot;</span> PRI_STAT <span class="stringliteral">&quot;!\n&quot;</span>, ret);</div>
<div class="line">                        eo_ctx-&gt;tmo_data[msg-&gt;id].handle = <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                eo_ctx-&gt;cdat[core].cancelled++;</div>
<div class="line">                <span class="keywordflow">if</span> (unlikely(tmo_event != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>)) { <span class="comment">/* not expected as we have the event */</span></div>
<div class="line">                        test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                                   <span class="stringliteral">&quot;periodic tmo delete returned evt!\n&quot;</span>);</div>
<div class="line">                }</div>
<div class="line">                add_trace(eo_ctx, msg-&gt;id, OP_CANCEL, 0, msg-&gt;count, msg-&gt;tidx);</div>
<div class="line">                reuse = 0; <span class="comment">/* free this last tmo event of canceled tmo */</span></div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                           <span class="stringliteral">&quot;Timeout in state %s!\n&quot;</span>, state_labels[state]);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> reuse;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> analyze_measure(app_eo_ctx_t *eo_ctx, uint64_t linuxns, uint64_t tmrtick,</div>
<div class="line">                     uint64_t timetick)</div>
<div class="line">{</div>
<div class="line">        uint64_t linux_t2 = linux_time_ns();</div>
<div class="line">        uint64_t time_t2 = TIME_STAMP_FN();</div>
<div class="line">        uint64_t tmr_t2 = <a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;test_tmr[0]);</div>
<div class="line"> </div>
<div class="line">        linux_t2 = linux_t2 - linuxns;</div>
<div class="line">        time_t2 = time_t2 - timetick;</div>
<div class="line">        tmr_t2 = tmr_t2 - tmrtick;</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%lu timer ticks in %lu ns (linux time) &quot;</span>, tmr_t2, linux_t2);</div>
<div class="line">        <span class="keywordtype">double</span> hz = 1000000000 /</div>
<div class="line">                    ((double)linux_t2 / (<span class="keywordtype">double</span>)tmr_t2);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;=&gt; %.1f Hz (%.1f MHz). Timer reports %lu Hz\n&quot;</span>,</div>
<div class="line">                   hz, hz / 1000000, eo_ctx-&gt;test_hz);</div>
<div class="line">        eo_ctx-&gt;meas_test_hz = round(hz);</div>
<div class="line">        hz = 1000000000 / ((double)linux_t2 / (<span class="keywordtype">double</span>)time_t2);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Timestamp measured: %.1f Hz (%.1f MHz)\n&quot;</span>, hz, hz / 1000000);</div>
<div class="line">        eo_ctx-&gt;meas_time_hz = round(hz);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(tmr_t2 &lt; 1, <span class="stringliteral">&quot;TIMER SEEMS NOT RUNNING AT ALL!?&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> do_memzero(app_msg_t *msg, app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">int</span> count;</div>
<div class="line"> </div>
<div class="line">        add_trace(eo_ctx, -1, OP_MEMZERO, g_options.mz_mb, msg-&gt;count, -1);</div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;mz_data == NULL) { <span class="comment">/* first time we only allocate */</span></div>
<div class="line">                <span class="keywordflow">if</span> (g_options.mz_huge) {</div>
<div class="line">                        eo_ctx-&gt;mz_data = mmap(NULL, g_options.mz_mb * 1024UL * 1024UL,</div>
<div class="line">                                               PROT_READ | PROT_WRITE,</div>
<div class="line">                                               MAP_PRIVATE | MAP_ANONYMOUS | MAP_POPULATE |</div>
<div class="line">                                               MAP_HUGETLB | MAP_LOCKED,</div>
<div class="line">                                               -1, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (eo_ctx-&gt;mz_data == MAP_FAILED)</div>
<div class="line">                                eo_ctx-&gt;mz_data = NULL;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                        eo_ctx-&gt;mz_data = malloc(g_options.mz_mb * 1024UL * 1024UL);</div>
<div class="line">                }</div>
<div class="line">                test_fatal_if(eo_ctx-&gt;mz_data == NULL, <span class="stringliteral">&quot;mz_mem reserve failed!&quot;</span>);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                memset(eo_ctx-&gt;mz_data, 0, g_options.mz_mb * 1024UL * 1024UL);</div>
<div class="line">                eo_ctx-&gt;mz_count++;</div>
<div class="line">        }</div>
<div class="line">        add_trace(eo_ctx, -1, OP_MEMZERO_END, g_options.mz_mb, count, -1);</div>
<div class="line">        __atomic_fetch_add(&amp;count, 1, __ATOMIC_RELAXED);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> do_bg_work(em_event_t evt, app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        app_msg_t *msg = (app_msg_t *)<a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(evt);</div>
<div class="line">        uint64_t t1 = TIME_STAMP_FN();</div>
<div class="line">        uint64_t ts;</div>
<div class="line">        int32_t rnd;</div>
<div class="line">        <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line">        uint64_t sum = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (__atomic_load_n(&amp;eo_ctx-&gt;state, __ATOMIC_ACQUIRE) != STATE_RUN) {</div>
<div class="line">                eo_ctx-&gt;cdat[core].jobs_deleted++;</div>
<div class="line">                <span class="keywordflow">if</span> (EXTRA_PRINTS)</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;Deleting job after %u iterations\n&quot;</span>, msg-&gt;count);</div>
<div class="line">                <span class="keywordflow">return</span> 0; <span class="comment">/* stop &amp; delete */</span></div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.jobs)</div>
<div class="line">                add_trace(eo_ctx, -1, OP_BGWORK, msg-&gt;arg, msg-&gt;count, -1);</div>
<div class="line"> </div>
<div class="line">        msg-&gt;count++;</div>
<div class="line">        eo_ctx-&gt;cdat[core].jobs++;</div>
<div class="line">        <span class="keywordtype">int</span> blocks = g_options.bg_size / g_options.bg_chunk;</div>
<div class="line"> </div>
<div class="line">        random_r(&amp;eo_ctx-&gt;cdat[core].rng.rdata, &amp;rnd);</div>
<div class="line">        rnd = rnd % blocks;</div>
<div class="line">        uint64_t *dptr = (uint64_t *)((uintptr_t)eo_ctx-&gt;bg_data + rnd * g_options.bg_chunk);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">do</span> {</div>
<div class="line">                <span class="comment">/* jump around memory reading from selected chunk */</span></div>
<div class="line">                random_r(&amp;eo_ctx-&gt;cdat[core].rng.rdata, &amp;rnd);</div>
<div class="line">                rnd = rnd % (g_options.bg_chunk / <span class="keyword">sizeof</span>(uint64_t));</div>
<div class="line">                sum += *(dptr + rnd);</div>
<div class="line">                ts = TIME_STAMP_FN() - t1;</div>
<div class="line">        } <span class="keywordflow">while</span> (ts &lt; msg-&gt;arg);</div>
<div class="line"> </div>
<div class="line">        *dptr = sum;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.mz_mb &amp;&amp; msg-&gt;id == 1) { <span class="comment">/* use only one job stream for memzero */</span></div>
<div class="line">                <span class="keyword">static</span> uint64_t last_mz;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (msg-&gt;count &lt; 10)    <span class="comment">/* don&#39;t do mz before some time */</span></div>
<div class="line">                        last_mz = TIME_STAMP_FN();</div>
<div class="line">                ts = TIME_STAMP_FN() - last_mz;</div>
<div class="line">                <span class="keywordflow">if</span> (ts &gt; g_options.mz_ns) {</div>
<div class="line">                        do_memzero(msg, eo_ctx);</div>
<div class="line">                        last_mz = TIME_STAMP_FN();</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(<a class="code" href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a>(evt, eo_ctx-&gt;bg_q) != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Failed to send BG job event!&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handle_heartbeat(app_eo_ctx_t *eo_ctx, em_event_t event)</div>
<div class="line">{</div>
<div class="line">        app_msg_t *msg = (app_msg_t *)<a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line">        <span class="keywordtype">int</span> cores = m_shm-&gt;core_count;</div>
<div class="line">        <span class="keywordtype">int</span> done = 0;</div>
<div class="line">        e_state state = __atomic_load_n(&amp;eo_ctx-&gt;state, __ATOMIC_SEQ_CST);</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">int</span> runs;</div>
<div class="line">        <span class="keyword">static</span> uint64_t linuxns;</div>
<div class="line">        <span class="keyword">static</span> uint64_t tmrtick;</div>
<div class="line">        <span class="keyword">static</span> uint64_t timetick;</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">bool</span> startup = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* heartbeat runs states of the test */</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (startup) {</div>
<div class="line">                first_timer_create(eo_ctx);</div>
<div class="line">                startup = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        msg-&gt;count++;</div>
<div class="line">        add_trace(eo_ctx, -1, OP_HB, linux_time_ns(), msg-&gt;count, -1);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (EXTRA_PRINTS)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">switch</span> (state) {</div>
<div class="line">        <span class="keywordflow">case</span> STATE_INIT:</div>
<div class="line">                <span class="keywordflow">if</span> (msg-&gt;count &gt; eo_ctx-&gt;last_hbcount + INIT_WAIT) {</div>
<div class="line">                        __atomic_fetch_add(&amp;eo_ctx-&gt;state, 1, __ATOMIC_SEQ_CST);</div>
<div class="line">                        eo_ctx-&gt;last_hbcount = msg-&gt;count;</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;ROUND %d\n&quot;</span>, runs + 1);</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;-&gt;Starting tick measurement\n&quot;</span>);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> STATE_MEASURE:     <span class="comment">/* measure timer frequencies */</span></div>
<div class="line">                <span class="keywordflow">if</span> (linuxns == 0) {</div>
<div class="line">                        linuxns = linux_time_ns();</div>
<div class="line">                        timetick = TIME_STAMP_FN();</div>
<div class="line">                        <span class="comment">/* use timer[0] for this always */</span></div>
<div class="line">                        tmrtick = <a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;test_tmr[0]);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (msg-&gt;count &gt; eo_ctx-&gt;last_hbcount + MEAS_PERIOD) {</div>
<div class="line">                        analyze_measure(eo_ctx, linuxns, tmrtick, timetick);</div>
<div class="line">                        linuxns = 0;</div>
<div class="line">                        <span class="comment">/* start new run */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (g_options.num_runs &gt; 1)</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;** Round %d\n&quot;</span>, runs + 1);</div>
<div class="line">                        __atomic_fetch_add(&amp;eo_ctx-&gt;state, 1, __ATOMIC_SEQ_CST);</div>
<div class="line">                        add_trace(eo_ctx, -1, OP_STATE, linux_time_ns(), eo_ctx-&gt;state, -1);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> STATE_STABILIZE:   <span class="comment">/* give some time to get up */</span></div>
<div class="line">                <span class="keywordflow">if</span> (g_options.bg_events)</div>
<div class="line">                        send_bg_events(eo_ctx);</div>
<div class="line">                __atomic_fetch_add(&amp;eo_ctx-&gt;state, 1, __ATOMIC_SEQ_CST);</div>
<div class="line">                add_trace(eo_ctx, -1, OP_STATE, linux_time_ns(), eo_ctx-&gt;state, -1);</div>
<div class="line">                <span class="keywordflow">if</span> (EXTRA_PRINTS)</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;-&gt;Starting tmos\n&quot;</span>);</div>
<div class="line">                start_periodic(eo_ctx);</div>
<div class="line">                eo_ctx-&gt;last_hbcount = msg-&gt;count;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> STATE_RUN: <span class="comment">/* run the test, avoid prints */</span></div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; cores; i++) {</div>
<div class="line">                        <span class="keywordflow">if</span> (eo_ctx-&gt;cdat[i].count &gt;=</div>
<div class="line">                           g_options.tracebuf) {</div>
<div class="line">                                done++;</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (done) {</div>
<div class="line">                        __atomic_fetch_add(&amp;eo_ctx-&gt;state, 1, __ATOMIC_SEQ_CST);</div>
<div class="line">                        add_trace(eo_ctx, -1, OP_STATE, linux_time_ns(), eo_ctx-&gt;state, -1);</div>
<div class="line">                        eo_ctx-&gt;last_hbcount = msg-&gt;count;</div>
<div class="line">                        <span class="keywordflow">if</span> (EXTRA_PRINTS)</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;-&gt;All cores done\n&quot;</span>);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> STATE_COOLOFF:     <span class="comment">/* stop further timeouts */</span></div>
<div class="line">                <span class="keywordflow">if</span> (msg-&gt;count &gt; (eo_ctx-&gt;last_hbcount + eo_ctx-&gt;cooloff)) {</div>
<div class="line">                        __atomic_fetch_add(&amp;eo_ctx-&gt;state, 1, __ATOMIC_SEQ_CST);</div>
<div class="line">                        add_trace(eo_ctx, -1, OP_STATE, linux_time_ns(), eo_ctx-&gt;state, -1);</div>
<div class="line">                        eo_ctx-&gt;last_hbcount = msg-&gt;count;</div>
<div class="line">                        <span class="keywordflow">if</span> (EXTRA_PRINTS)</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;-&gt;Starting analyze\n&quot;</span>);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> STATE_ANALYZE:     <span class="comment">/* expected to be stopped, analyze data */</span></div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.recreate)</div>
<div class="line">                        delete_timers(eo_ctx);</div>
<div class="line">                analyze(eo_ctx);</div>
<div class="line">                cleanup(eo_ctx);</div>
<div class="line">                <span class="comment">/* re-start test cycle */</span></div>
<div class="line">                __atomic_store_n(&amp;eo_ctx-&gt;state, STATE_INIT, __ATOMIC_SEQ_CST);</div>
<div class="line">                runs++;</div>
<div class="line">                <span class="keywordflow">if</span> (runs &gt;= g_options.num_runs &amp;&amp; g_options.num_runs != 0) {</div>
<div class="line">                        <span class="comment">/* terminate test app */</span></div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;%d runs done\n&quot;</span>, runs);</div>
<div class="line">                        <span class="keyword">raise</span>(SIGINT);</div>
<div class="line">                }</div>
<div class="line">                eo_ctx-&gt;last_hbcount = msg-&gt;count;</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.recreate)</div>
<div class="line">                        create_timers(eo_ctx);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">                test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF, <span class="stringliteral">&quot;Invalid test state&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* heartbeat never stops */</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="../../de/dc2/group__em__timer.html#gaf65f50c383b579720a31154b04ea610e">em_tmo_ack</a>(eo_ctx-&gt;heartbeat_tmo, event) != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF, <span class="stringliteral">&quot;HB ack() fail!\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> usage(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        printf(<span class="stringliteral">&quot;%s\n&quot;</span>, instructions);</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;Usage:\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; ; i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (longopts[i].name == NULL || descopts[i] == NULL)</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                printf(<span class="stringliteral">&quot;--%s or -%c: %s\n&quot;</span>, longopts[i].name, longopts[i].val, descopts[i]);</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> parse_my_args(<span class="keywordtype">int</span> first, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">        optind = first + 1; <span class="comment">/* skip &#39;--&#39; */</span></div>
<div class="line">        <span class="keywordflow">while</span> (1) {</div>
<div class="line">                <span class="keywordtype">int</span> opt;</div>
<div class="line">                <span class="keywordtype">int</span> long_index;</div>
<div class="line">                <span class="keywordtype">char</span> *endptr;</div>
<div class="line">                int64_t num;</div>
<div class="line"> </div>
<div class="line">                opt = getopt_long(argc, argv, shortopts, longopts, &amp;long_index);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (opt == -1)</div>
<div class="line">                        <span class="keywordflow">break</span>;  <span class="comment">/* No more options */</span></div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">switch</span> (opt) {</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>: {</div>
<div class="line">                        g_options.noskip = 0;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>: {</div>
<div class="line">                        g_options.profile = 1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>: {</div>
<div class="line">                        g_options.jobs = 1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>: {</div>
<div class="line">                        g_options.dispatch = 1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>: {</div>
<div class="line">                        g_options.info_only = 1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;u&#39;</span>: {</div>
<div class="line">                        g_options.usehuge = 1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>: {</div>
<div class="line">                        g_options.no_del = 1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>: {</div>
<div class="line">                        g_options.same_tick = 1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;R&#39;</span>: {</div>
<div class="line">                        g_options.recreate = 1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;w&#39;</span>: { <span class="comment">/* optional arg */</span></div>
<div class="line">                        g_options.csv = <span class="stringliteral">&quot;stdout&quot;</span>;</div>
<div class="line">                        <span class="keywordflow">if</span> (optarg != NULL)</div>
<div class="line">                                g_options.csv = optarg;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>: {</div>
<div class="line">                        <span class="keywordflow">if</span> (!arg_to_ns(optarg, &amp;num))</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        <span class="keywordflow">if</span> (num &lt; 1)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.max_period_ns = (uint64_t)num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;L&#39;</span>: {</div>
<div class="line">                        <span class="keywordflow">if</span> (!arg_to_ns(optarg, &amp;num))</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        <span class="keywordflow">if</span> (num &lt; 0)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.stop_limit = (uint64_t)num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>: {</div>
<div class="line">                        <span class="keywordflow">if</span> (!arg_to_ns(optarg, &amp;num))</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        <span class="keywordflow">if</span> (num &lt; 1)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.min_period_ns = num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>: {</div>
<div class="line">                        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> size, perc;</div>
<div class="line"> </div>
<div class="line">                        num = sscanf(optarg, <span class="stringliteral">&quot;%lu,%lu&quot;</span>, &amp;size, &amp;perc);</div>
<div class="line">                        <span class="keywordflow">if</span> (num == 0 || size &lt; 10 ||</div>
<div class="line">                            <span class="keyword">sizeof</span>(tmo_trace) * size &gt; MAX_TMO_BYTES)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.tracebuf = size;</div>
<div class="line">                        <span class="keywordflow">if</span> (num == 2 &amp;&amp; perc &gt; 100)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        <span class="keywordflow">if</span> (num == 2)</div>
<div class="line">                                g_options.trcstop = ((perc * size) / 100);</div>
<div class="line">                        <span class="keywordflow">else</span></div>
<div class="line">                                g_options.trcstop = ((STOP_THRESHOLD * size) / 100);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>: {</div>
<div class="line">                        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> min_us, max_us, prop;</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span> (sscanf(optarg, <span class="stringliteral">&quot;%u,%u,%u&quot;</span>, &amp;min_us, &amp;max_us, &amp;prop) != 3)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        <span class="keywordflow">if</span> (prop &gt; 100 || max_us &lt; 1)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.min_work_ns = 1000ULL * min_us;</div>
<div class="line">                        g_options.max_work_ns = 1000ULL * max_us;</div>
<div class="line">                        g_options.work_prop = prop;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;o&#39;</span>: {</div>
<div class="line">                        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mb;</div>
<div class="line">                        uint64_t ms;</div>
<div class="line">                        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hp = 0;</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span> (sscanf(optarg, <span class="stringliteral">&quot;%u,%lu,%u&quot;</span>, &amp;mb, &amp;ms, &amp;hp) &lt; 2)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        <span class="keywordflow">if</span> (mb &lt; 1 || ms &lt; 1)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.mz_mb = mb;</div>
<div class="line">                        g_options.mz_ns = ms * 1000UL * 1000UL;</div>
<div class="line">                        <span class="keywordflow">if</span> (hp)</div>
<div class="line">                                g_options.mz_huge = 1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;j&#39;</span>: {</div>
<div class="line">                        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> evts, us, kb, chunk;</div>
<div class="line"> </div>
<div class="line">                        num = sscanf(optarg, <span class="stringliteral">&quot;%u,%u,%u,%u&quot;</span>, &amp;evts, &amp;us, &amp;kb, &amp;chunk);</div>
<div class="line">                        <span class="keywordflow">if</span> (num == 0 || evts &lt; 1)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.bg_events = evts;</div>
<div class="line">                        <span class="keywordflow">if</span> (num &gt; 1 &amp;&amp; us)</div>
<div class="line">                                g_options.bg_time_ns = us * 1000ULL;</div>
<div class="line">                        <span class="keywordflow">if</span> (num &gt; 2 &amp;&amp; kb)</div>
<div class="line">                                g_options.bg_size = kb * 1024;</div>
<div class="line">                        <span class="keywordflow">if</span> (num &gt; 3 &amp;&amp; chunk)</div>
<div class="line">                                g_options.bg_chunk = chunk * 1024;</div>
<div class="line">                        <span class="keywordflow">if</span> (g_options.bg_chunk &gt; g_options.bg_size)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 1)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.num_periodic = num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>: {</div>
<div class="line">                        <span class="keywordflow">if</span> (!arg_to_ns(optarg, &amp;num))</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        <span class="keywordflow">if</span> (num &lt; 0)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.period_ns = num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>: {</div>
<div class="line">                        <span class="keywordflow">if</span> (!arg_to_ns(optarg, &amp;num))</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.first_ns = num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 0)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.clock_src = num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>: {</div>
<div class="line">                        <span class="keywordflow">if</span> (!arg_to_ns(optarg, &amp;num))</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        <span class="keywordflow">if</span> (num &lt; 0)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.res_ns = num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;z&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 1)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.res_hz = num;</div>
<div class="line">                        g_options.res_ns = 0;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 0)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.num_runs = num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;k&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.abort = num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;y&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 1)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.num_timers = num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;g&#39;</span>: {</div>
<div class="line">                        num = strtol(optarg, &amp;endptr, 0);</div>
<div class="line">                        <span class="keywordflow">if</span> (*endptr != <span class="charliteral">&#39;\0&#39;</span> || num &lt; 0)</div>
<div class="line">                                <span class="keywordflow">return</span> 0;</div>
<div class="line">                        g_options.etype = (<a name="a32"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a>)num;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                        opterr = 0;</div>
<div class="line">                        usage();</div>
<div class="line">                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        optind = 1; <span class="comment">/* cm_setup() to parse again */</span></div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Before EM - Init</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> test_init(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        (void)appl_conf;</div>
<div class="line">        <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* first core creates ShMem */</span></div>
<div class="line">        <span class="keywordflow">if</span> (core == 0) {</div>
<div class="line">                m_shm = env_shared_reserve(<span class="stringliteral">&quot;Timer_test&quot;</span>, <span class="keyword">sizeof</span>(timer_app_shm_t));</div>
<div class="line">                <span class="comment">/* initialize it */</span></div>
<div class="line">                <span class="keywordflow">if</span> (m_shm)</div>
<div class="line">                        memset(m_shm, 0, <span class="keyword">sizeof</span>(timer_app_shm_t));</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (EXTRA_PRINTS)</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;%ldk shared memory for app context\n&quot;</span>,</div>
<div class="line">                                   <span class="keyword">sizeof</span>(timer_app_shm_t) / 1000);</div>
<div class="line"> </div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                m_shm = env_shared_lookup(<span class="stringliteral">&quot;Timer_test&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (m_shm == NULL) {</div>
<div class="line">                test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                           <span class="stringliteral">&quot;ShMem init failed on EM-core: %u&quot;</span>,</div>
<div class="line">                           <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>());</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;core %d: %s done\n&quot;</span>, core, __func__);</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Startup of the timer test EM application</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> test_start(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        em_eo_t eo;</div>
<div class="line">        em_queue_t queue;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> stat;</div>
<div class="line">        <a class="code" href="../../d4/d00/structem__timer__attr__t.html">em_timer_attr_t</a> attr;</div>
<div class="line">        app_eo_ctx_t *eo_ctx;</div>
<div class="line">        <a name="_a33"></a><a class="code" href="../../d8/d93/structem__timer__res__param__t.html">em_timer_res_param_t</a> res_capa;</div>
<div class="line">        <a name="_a34"></a><a class="code" href="../../de/d00/structem__timer__capability__t.html">em_timer_capability_t</a> capa = { 0 }; <span class="comment">/* init to avoid gcc warning with LTO */</span></div>
<div class="line">        <a name="_a35"></a><a class="code" href="../../df/d81/structem__core__mask__t.html">em_core_mask_t</a> mask;</div>
<div class="line">        em_queue_group_t grp;</div>
<div class="line">        em_atomic_group_t agrp;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Store the number of EM-cores running the application */</span></div>
<div class="line">        m_shm-&gt;core_count = appl_conf-&gt;core_count;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (appl_conf-&gt;num_procs &gt; 1) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;\n!! Multiple PROCESS MODE NOT SUPPORTED !!\n\n&quot;</span>);</div>
<div class="line">                <span class="keyword">raise</span>(SIGINT);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (appl_conf-&gt;num_pools &gt;= 1)</div>
<div class="line">                m_shm-&gt;pool = appl_conf-&gt;pools[0];</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                m_shm-&gt;pool = <a name="a36"></a><a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a>;</div>
<div class="line"> </div>
<div class="line">        eo_ctx = &amp;m_shm-&gt;eo_context;</div>
<div class="line">        memset(eo_ctx, 0, <span class="keyword">sizeof</span>(app_eo_ctx_t));</div>
<div class="line">        eo_ctx-&gt;tmo_data = calloc(g_options.num_periodic, <span class="keyword">sizeof</span>(tmo_setup));</div>
<div class="line">        test_fatal_if(eo_ctx-&gt;tmo_data == NULL, <span class="stringliteral">&quot;Can&#39;t alloc tmo_setups&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        eo = <a name="a37"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga196c7caa1177575fd424e9a0d2854da6">em_eo_create</a>(APP_EO_NAME, app_eo_start, app_eo_start_local,</div>
<div class="line">                          app_eo_stop, app_eo_stop_local, app_eo_receive,</div>
<div class="line">                          eo_ctx);</div>
<div class="line">        test_fatal_if(eo == <a name="a38"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#af28fb8daf62b942ced417e158ed7e1c7">EM_EO_UNDEF</a>, <span class="stringliteral">&quot;Failed to create EO!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        stat = <a name="a39"></a><a class="code" href="../../db/da0/group__em__error.html#gaf7332965c5deaa69411136e8d36089c6">em_register_error_handler</a>(my_error_handler);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Failed to register error handler&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Create atomic group and queues for control messages */</span></div>
<div class="line">        stat = <a name="a40"></a><a class="code" href="../../d9/d01/group__em__queue__group.html#ga0a861d268d820d2b6de1341749b4011a">em_queue_group_get_mask</a>(<a name="a41"></a><a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a>, &amp;mask);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Failed to get default Q grp mask!&quot;</span>);</div>
<div class="line">        grp = <a name="a42"></a><a class="code" href="../../d9/d01/group__em__queue__group.html#ga6f3e8e31f260f65abc902aad59c4497d">em_queue_group_create_sync</a>(<span class="stringliteral">&quot;CTRL_GRP&quot;</span>, &amp;mask);</div>
<div class="line">        test_fatal_if(grp == <a name="a43"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a3f2bef96eaf8b2855699d6adee7758f4">EM_QUEUE_GROUP_UNDEF</a>, <span class="stringliteral">&quot;Failed to create Q grp!&quot;</span>);</div>
<div class="line">        agrp = <a name="a44"></a><a class="code" href="../../d3/dc1/group__em__atomic__group.html#gab52d49a543562163a904f86fd9f18866">em_atomic_group_create</a>(<span class="stringliteral">&quot;CTRL_AGRP&quot;</span>, grp);</div>
<div class="line">        test_fatal_if(agrp == <a name="a45"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a8aa7220ee288baa2ef461f400679fa48">EM_ATOMIC_GROUP_UNDEF</a>, <span class="stringliteral">&quot;Failed to create atomic grp!&quot;</span>);</div>
<div class="line">        eo_ctx-&gt;agrp = agrp;</div>
<div class="line"> </div>
<div class="line">        queue = <a name="a46"></a><a class="code" href="../../d3/dc1/group__em__atomic__group.html#ga0ac321a585ce74c3cf79a7459c91095c">em_queue_create_ag</a>(<span class="stringliteral">&quot;Control Q&quot;</span>, <a name="a47"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca">EM_QUEUE_PRIO_NORMAL</a>, agrp, NULL);</div>
<div class="line">        stat = <a name="a48"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a>(eo, queue);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Failed to create hb queue!&quot;</span>);</div>
<div class="line">        eo_ctx-&gt;hb_q = queue;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Highest priority queue for stop msg to handle tmo overload */</span></div>
<div class="line">        queue = <a class="code" href="../../d3/dc1/group__em__atomic__group.html#ga0ac321a585ce74c3cf79a7459c91095c">em_queue_create_ag</a>(<span class="stringliteral">&quot;Stop Q&quot;</span>, <a name="a49"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa621ca7c9a90044e11dad3060006dc450">EM_QUEUE_PRIO_HIGHEST</a>, agrp, NULL);</div>
<div class="line">        stat = <a class="code" href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a>(eo, queue);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Failed to create stop queue!&quot;</span>);</div>
<div class="line">        eo_ctx-&gt;stop_q = queue;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* parallel high priority for timeout handling*/</span></div>
<div class="line">        queue = <a name="a50"></a><a class="code" href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a>(<span class="stringliteral">&quot;Tmo Q&quot;</span>,</div>
<div class="line">                                <a name="a51"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea">EM_QUEUE_TYPE_PARALLEL</a>,</div>
<div class="line">                                <a name="a52"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fac38f313458eaca8b4a7f1c04fb20fdf1">EM_QUEUE_PRIO_HIGH</a>,</div>
<div class="line">                                <a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a>, NULL);</div>
<div class="line">        stat = <a class="code" href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a>(eo, queue);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Failed to create queue!&quot;</span>);</div>
<div class="line">        eo_ctx-&gt;test_q = queue;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* another parallel low priority for background work*/</span></div>
<div class="line">        queue = <a class="code" href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a>(<span class="stringliteral">&quot;BG Q&quot;</span>,</div>
<div class="line">                                <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea">EM_QUEUE_TYPE_PARALLEL</a>,</div>
<div class="line">                                <a name="a53"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa5e6d33c32d6dcd3bf02802e7af102d94">EM_QUEUE_PRIO_LOWEST</a>,</div>
<div class="line">                                <a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a>, NULL);</div>
<div class="line">        stat = <a class="code" href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a>(eo, queue);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Failed to add queue!&quot;</span>);</div>
<div class="line">        eo_ctx-&gt;bg_q = queue;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* create two timers so HB and tests can be independent */</span></div>
<div class="line">        <a name="a54"></a><a class="code" href="../../de/dc2/group__em__timer.html#gad6023dd3c79d0a45221d9245c604c2e3">em_timer_attr_init</a>(&amp;attr);</div>
<div class="line">        strncpy(attr.<a name="a55"></a><a class="code" href="../../d4/d00/structem__timer__attr__t.html#a03fc2b0569742931ed610f0bd1af43ad">name</a>, <span class="stringliteral">&quot;HBTimer&quot;</span>, EM_TIMER_NAME_LEN);</div>
<div class="line">        m_shm-&gt;hb_tmr = <a name="a56"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga56968bda0ecacf996d6ce623e3e372ab">em_timer_create</a>(&amp;attr);</div>
<div class="line">        test_fatal_if(m_shm-&gt;hb_tmr == <a name="a57"></a><a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#aa373a94a9084c3bd6c5b23ac6bd6b176">EM_TIMER_UNDEF</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;Failed to create HB timer!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* test timer preparation, timer(s) created later */</span></div>
<div class="line">        test_fatal_if(g_options.res_ns &amp;&amp; g_options.res_hz, <span class="stringliteral">&quot;Give resolution in ns OR hz!&quot;</span>);</div>
<div class="line">        test_fatal_if(g_options.recreate &amp;&amp; g_options.no_del, <span class="stringliteral">&quot;Can&#39;t keep tmo but delete timers!&quot;</span>);</div>
<div class="line">        test_fatal_if(g_options.same_tick &amp;&amp; (g_options.num_timers &gt; 1),</div>
<div class="line">                      <span class="stringliteral">&quot;Same tick currently supports only one timer&quot;</span>);</div>
<div class="line">        test_fatal_if(g_options.same_tick &amp;&amp; (g_options.first_ns &lt; 0),</div>
<div class="line">                      <span class="stringliteral">&quot;Same tick (-S) can&#39;t do random first timeout&quot;</span>);</div>
<div class="line">        test_fatal_if(g_options.num_timers &gt; MAX_TEST_TIMERS, <span class="stringliteral">&quot;Too many test timers&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="../../de/dc2/group__em__timer.html#gad6023dd3c79d0a45221d9245c604c2e3">em_timer_attr_init</a>(&amp;eo_ctx-&gt;tmr_attr);</div>
<div class="line">        stat = <a name="a58"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga002c51ef0da36f83ce4e28f0e486c7e6">em_timer_capability</a>(&amp;capa, g_options.clock_src);</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Timer capability for clksrc %d:\n&quot;</span>, g_options.clock_src);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; maximum timers: %d\n&quot;</span>, capa.<a name="a59"></a><a class="code" href="../../de/d00/structem__timer__capability__t.html#a6fbaee4a7e9b7cce0a623ca569c66e37">max_timers</a>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; max_res %lu ns %lu hz min_tmo %lu max_tmo %lu\n&quot;</span>,</div>
<div class="line">                   capa.<a name="a60"></a><a class="code" href="../../de/d00/structem__timer__capability__t.html#aad723b535c9cce55a9fae069882c09a1">max_res</a>.<a name="a61"></a><a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">res_ns</a>, capa.<a class="code" href="../../de/d00/structem__timer__capability__t.html#aad723b535c9cce55a9fae069882c09a1">max_res</a>.<a name="a62"></a><a class="code" href="../../d8/d93/structem__timer__res__param__t.html#ab8065c326f16df1abfbb756ae50038cb">res_hz</a>,</div>
<div class="line">                   capa.<a class="code" href="../../de/d00/structem__timer__capability__t.html#aad723b535c9cce55a9fae069882c09a1">max_res</a>.<a name="a63"></a><a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a94b92c7b60c5a8cd9ac357b488292fa4">min_tmo</a>, capa.<a class="code" href="../../de/d00/structem__timer__capability__t.html#aad723b535c9cce55a9fae069882c09a1">max_res</a>.<a name="a64"></a><a class="code" href="../../d8/d93/structem__timer__res__param__t.html#abb8211175d76213b77c952c1608fbded">max_tmo</a>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; max_tmo %lu ns %lu hz min_tmo %lu max_tmo %lu\n&quot;</span>,</div>
<div class="line">                   capa.<a name="a65"></a><a class="code" href="../../de/d00/structem__timer__capability__t.html#a2d324c44c1abd50dd2182d83fff27e0c">max_tmo</a>.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">res_ns</a>, capa.<a class="code" href="../../de/d00/structem__timer__capability__t.html#a2d324c44c1abd50dd2182d83fff27e0c">max_tmo</a>.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#ab8065c326f16df1abfbb756ae50038cb">res_hz</a>,</div>
<div class="line">                   capa.<a class="code" href="../../de/d00/structem__timer__capability__t.html#a2d324c44c1abd50dd2182d83fff27e0c">max_tmo</a>.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a94b92c7b60c5a8cd9ac357b488292fa4">min_tmo</a>, capa.<a class="code" href="../../de/d00/structem__timer__capability__t.html#a2d324c44c1abd50dd2182d83fff27e0c">max_tmo</a>.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#abb8211175d76213b77c952c1608fbded">max_tmo</a>);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Given clk_src is not supported\n&quot;</span>);</div>
<div class="line">        memset(&amp;res_capa, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d93/structem__timer__res__param__t.html">em_timer_res_param_t</a>));</div>
<div class="line">        <span class="keywordflow">if</span> (!g_options.res_hz) {</div>
<div class="line">                res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">res_ns</a> = g_options.res_ns == 0 ? capa.<a class="code" href="../../de/d00/structem__timer__capability__t.html#aad723b535c9cce55a9fae069882c09a1">max_res</a>.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">res_ns</a> : g_options.res_ns;</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;Trying %lu ns resolution capability on clk %d\n&quot;</span>,</div>
<div class="line">                           res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">res_ns</a>, g_options.clock_src);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#ab8065c326f16df1abfbb756ae50038cb">res_hz</a> = g_options.res_hz;</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;Trying %lu Hz resolution capability on clk %d\n&quot;</span>,</div>
<div class="line">                           res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#ab8065c326f16df1abfbb756ae50038cb">res_hz</a>, g_options.clock_src);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Asking timer capability for clksrc %d:\n&quot;</span>, g_options.clock_src);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%lu ns %lu hz min_tmo %lu max_tmo %lu\n&quot;</span>,</div>
<div class="line">                   res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">res_ns</a>, res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#ab8065c326f16df1abfbb756ae50038cb">res_hz</a>,</div>
<div class="line">                   res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a94b92c7b60c5a8cd9ac357b488292fa4">min_tmo</a>, res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#abb8211175d76213b77c952c1608fbded">max_tmo</a>);</div>
<div class="line">        stat = <a name="a66"></a><a class="code" href="../../de/dc2/group__em__timer.html#gafe76b458292862809030194da9462b4c">em_timer_res_capability</a>(&amp;res_capa, g_options.clock_src);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;-&gt; Timer res_capability:\n&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;max_res %lu ns %lu hz min_tmo %lu max_tmo %lu\n&quot;</span>,</div>
<div class="line">                   res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">res_ns</a>, res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#ab8065c326f16df1abfbb756ae50038cb">res_hz</a>,</div>
<div class="line">                   res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a94b92c7b60c5a8cd9ac357b488292fa4">min_tmo</a>, res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#abb8211175d76213b77c952c1608fbded">max_tmo</a>);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Given resolution is not supported (ret %d)\n&quot;</span>, stat);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!g_options.max_period_ns) {</div>
<div class="line">                g_options.max_period_ns = DEF_MAX_PERIOD;</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.max_period_ns &gt; res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#abb8211175d76213b77c952c1608fbded">max_tmo</a>)</div>
<div class="line">                        g_options.max_period_ns = res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#abb8211175d76213b77c952c1608fbded">max_tmo</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (!g_options.min_period_ns) {</div>
<div class="line">                g_options.min_period_ns = res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">res_ns</a> * DEF_MIN_PERIOD;</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.min_period_ns &lt; res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a94b92c7b60c5a8cd9ac357b488292fa4">min_tmo</a>)</div>
<div class="line">                        g_options.min_period_ns = res_capa.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a94b92c7b60c5a8cd9ac357b488292fa4">min_tmo</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.first_ns &amp;&amp; (uint64_t)llabs(g_options.first_ns) &lt; g_options.min_period_ns) {</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.first_ns &lt; 0)</div>
<div class="line">                        g_options.first_ns = 0 - g_options.min_period_ns;</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        g_options.first_ns = g_options.min_period_ns;</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;NOTE: First period too short, updated to %ld ns\n&quot;</span>, g_options.first_ns);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        eo_ctx-&gt;tmr_attr.resparam = res_capa;</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.res_hz) <span class="comment">/* can only have one */</span></div>
<div class="line">                eo_ctx-&gt;tmr_attr.resparam.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">res_ns</a> = 0;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                eo_ctx-&gt;tmr_attr.resparam.res_hz = 0;</div>
<div class="line">        eo_ctx-&gt;tmr_attr.num_tmo = g_options.num_periodic;</div>
<div class="line">        eo_ctx-&gt;tmr_attr.resparam.max_tmo = g_options.max_period_ns +</div>
<div class="line">                                            eo_ctx-&gt;tmr_attr.resparam.min_tmo;</div>
<div class="line">        strncpy(eo_ctx-&gt;tmr_attr.name, <span class="stringliteral">&quot;TestTimer&quot;</span>, EM_TIMER_NAME_LEN);</div>
<div class="line">        g_options.res_ns = eo_ctx-&gt;tmr_attr.resparam.res_ns;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Start EO */</span></div>
<div class="line">        stat = <a name="a67"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gabe4f7a789ec9523367c086793061562d">em_eo_start_sync</a>(eo, NULL, NULL);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Failed to start EO!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.info_only) { <span class="comment">/* signal stop here */</span></div>
<div class="line">                <span class="keyword">raise</span>(SIGINT);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        mlockall(MCL_FUTURE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">create_timers(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        uint64_t t1 = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; g_options.num_timers; i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.profile)</div>
<div class="line">                        t1 = TIME_STAMP_FN();</div>
<div class="line">                m_shm-&gt;test_tmr[i] = <a class="code" href="../../de/dc2/group__em__timer.html#ga56968bda0ecacf996d6ce623e3e372ab">em_timer_create</a>(&amp;eo_ctx-&gt;tmr_attr);</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.profile)</div>
<div class="line">                        add_prof(eo_ctx, t1, OP_PROF_TMR_CREATE, NULL);</div>
<div class="line">                test_fatal_if(m_shm-&gt;test_tmr[i] == <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#aa373a94a9084c3bd6c5b23ac6bd6b176">EM_TIMER_UNDEF</a>,</div>
<div class="line">                              <span class="stringliteral">&quot;Failed to create test timer #%d!&quot;</span>, i + 1);</div>
<div class="line">        }</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%d test timers created\n&quot;</span>, g_options.num_timers);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">delete_timers(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        uint64_t t1 = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; g_options.num_timers; i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (m_shm-&gt;test_tmr[i] != <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#aa373a94a9084c3bd6c5b23ac6bd6b176">EM_TIMER_UNDEF</a>) {</div>
<div class="line">                        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span> (g_options.profile)</div>
<div class="line">                                t1 = TIME_STAMP_FN();</div>
<div class="line">                        ret = <a name="a68"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga2bac1530b021bbbd1f0f924414c2485e">em_timer_delete</a>(m_shm-&gt;test_tmr[i]);</div>
<div class="line">                        <span class="keywordflow">if</span> (g_options.profile)</div>
<div class="line">                                add_prof(eo_ctx, t1, OP_PROF_TMR_DELETE, NULL);</div>
<div class="line">                        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Timer:%&quot;</span> <a name="a69"></a><a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#a31cd14adb32c94ed0f2e27d263ad6eb1">PRI_TMR</a> <span class="stringliteral">&quot; delete:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                                      m_shm-&gt;test_tmr[i], ret);</div>
<div class="line">                        m_shm-&gt;test_tmr[i] = <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#aa373a94a9084c3bd6c5b23ac6bd6b176">EM_TIMER_UNDEF</a>;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%d test timers deleted\n&quot;</span>, g_options.num_timers);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">first_timer_create(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        em_timer_t tmr[PRINT_MAX_TMRS];</div>
<div class="line">        <a class="code" href="../../d4/d00/structem__timer__attr__t.html">em_timer_attr_t</a> attr;</div>
<div class="line"> </div>
<div class="line">        create_timers(eo_ctx);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">int</span> num_timers = <a name="a70"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga25b88dbbb772090d6caa5622c7017889">em_timer_get_all</a>(tmr, PRINT_MAX_TMRS);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(num_timers &lt; 2, <span class="stringliteral">&quot;Not all timers created&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (num_timers &gt; PRINT_MAX_TMRS ? PRINT_MAX_TMRS : num_timers); i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (<a name="a71"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga01e680281f0ae40bce6c6786fc0bcdc3">em_timer_get_attr</a>(tmr[i], &amp;attr) != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>) {</div>
<div class="line">                        APPL_ERROR(<span class="stringliteral">&quot;Can&#39;t get timer info\n&quot;</span>);</div>
<div class="line">                        <span class="keywordflow">return</span>;</div>
<div class="line">                }</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;Timer \&quot;%s\&quot; info:\n&quot;</span>, attr.<a class="code" href="../../d4/d00/structem__timer__attr__t.html#a03fc2b0569742931ed610f0bd1af43ad">name</a>);</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;  -resolution: %&quot;</span> PRIu64 <span class="stringliteral">&quot; ns\n&quot;</span>, attr.<a name="a72"></a><a class="code" href="../../d4/d00/structem__timer__attr__t.html#adf7a24e643b381f39fec354caf5a4bc0">resparam</a>.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">res_ns</a>);</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;  -max_tmo: %&quot;</span> PRIu64 <span class="stringliteral">&quot; ms\n&quot;</span>, attr.<a class="code" href="../../d4/d00/structem__timer__attr__t.html#adf7a24e643b381f39fec354caf5a4bc0">resparam</a>.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#abb8211175d76213b77c952c1608fbded">max_tmo</a> / 1000);</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;  -num_tmo: %d\n&quot;</span>, attr.<a name="a73"></a><a class="code" href="../../d4/d00/structem__timer__attr__t.html#ae6afcdeed8fe620636b1f0391f908afc">num_tmo</a>);</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;  -clk_src: %d\n&quot;</span>, attr.<a class="code" href="../../d4/d00/structem__timer__attr__t.html#adf7a24e643b381f39fec354caf5a4bc0">resparam</a>.<a name="a74"></a><a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a07ed3b3b2e89e83ca36fb2efbc731c45">clk_src</a>);</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;  -tick Hz: %&quot;</span> PRIu64 <span class="stringliteral">&quot; hz\n&quot;</span>,</div>
<div class="line">                           <a name="a75"></a><a class="code" href="../../de/dc2/group__em__timer.html#gae97b08e2b1468de76a7d92342a5860ed">em_timer_get_freq</a>(tmr[i]));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        eo_ctx-&gt;test_hz = <a class="code" href="../../de/dc2/group__em__timer.html#gae97b08e2b1468de76a7d92342a5860ed">em_timer_get_freq</a>(m_shm-&gt;test_tmr[0]); <span class="comment">/* use timer[0] */</span></div>
<div class="line">        test_fatal_if(eo_ctx-&gt;test_hz == 0,</div>
<div class="line">                      <span class="stringliteral">&quot;get_freq() failed, timer:%&quot;</span> <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#a31cd14adb32c94ed0f2e27d263ad6eb1">PRI_TMR</a> <span class="stringliteral">&quot;&quot;</span>, m_shm-&gt;test_tmr[0]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test_stop(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        (void)appl_conf;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line">        em_eo_t eo;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (appl_conf-&gt;num_procs &gt; 1) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;%s(): skip\n&quot;</span>, __func__);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%s() on EM-core %d\n&quot;</span>, __func__, core);</div>
<div class="line"> </div>
<div class="line">        eo = <a name="a76"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga9ac21d82f671fff3e31e83410e72d406">em_eo_find</a>(APP_EO_NAME);</div>
<div class="line">        test_fatal_if(eo == <a class="code" href="../../d4/d11/event__machine__types_8h.html#af28fb8daf62b942ced417e158ed7e1c7">EM_EO_UNDEF</a>, <span class="stringliteral">&quot;Could not find EO:%s&quot;</span>, APP_EO_NAME);</div>
<div class="line"> </div>
<div class="line">        ret = <a name="a77"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gadce026621953114bd26e5836d9693465">em_eo_stop_sync</a>(eo);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;EO:%&quot;</span> <a name="a78"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; stop:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>, eo, ret);</div>
<div class="line">        ret = <a name="a79"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gae769b19e613b24487beb943cfb926977">em_eo_delete</a>(eo);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; delete:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>, eo, ret);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.info_only)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        ret = <a class="code" href="../../de/dc2/group__em__timer.html#ga2bac1530b021bbbd1f0f924414c2485e">em_timer_delete</a>(m_shm-&gt;hb_tmr);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Timer:%&quot;</span> <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#a31cd14adb32c94ed0f2e27d263ad6eb1">PRI_TMR</a> <span class="stringliteral">&quot; delete:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                      m_shm-&gt;hb_tmr, ret);</div>
<div class="line">        delete_timers(&amp;m_shm-&gt;eo_context);</div>
<div class="line">        free(m_shm-&gt;eo_context.tmo_data);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test_term(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        (void)appl_conf;</div>
<div class="line">        <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%s() on EM-core %d\n&quot;</span>, __func__, core);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (m_shm != NULL) {</div>
<div class="line">                <a name="a80"></a><a class="code" href="../../db/da0/group__em__error.html#gab6b469100e5f60670a742d944a6f530b">em_unregister_error_handler</a>();</div>
<div class="line">                env_shared_free(m_shm);</div>
<div class="line">                m_shm = NULL;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> app_eo_start(<span class="keywordtype">void</span> *eo_context, em_eo_t eo, <span class="keyword">const</span> <a class="code" href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a> *conf)</div>
<div class="line">{</div>
<div class="line">        app_msg_t *msg;</div>
<div class="line">        <span class="keyword">struct </span>timespec ts;</div>
<div class="line">        uint64_t period;</div>
<div class="line">        em_event_t event;</div>
<div class="line">        app_eo_ctx_t *eo_ctx = (app_eo_ctx_t *)eo_context;</div>
<div class="line"> </div>
<div class="line">        (void)eo;</div>
<div class="line">        (void)conf;</div>
<div class="line"> </div>
<div class="line">        eo_ctx-&gt;appstart = TIME_STAMP_FN();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.info_only)</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\nActive run options:\n&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; num timers:   %d\n&quot;</span>, g_options.num_timers);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; num timeouts: %d\n&quot;</span>, g_options.num_periodic);</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.res_hz) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; resolution:   %lu Hz (%f MHz)\n&quot;</span>, g_options.res_hz,</div>
<div class="line">                           (<span class="keywordtype">double</span>)g_options.res_hz / 1000000);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; resolution:   %lu ns (%f s)\n&quot;</span>, g_options.res_ns,</div>
<div class="line">                           (<span class="keywordtype">double</span>)g_options.res_ns / 1000000000);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.period_ns == 0)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; period:       random\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; period:       %lu ns (%f s%s)\n&quot;</span>, g_options.period_ns,</div>
<div class="line">                           (<span class="keywordtype">double</span>)g_options.period_ns / 1000000000,</div>
<div class="line">                           g_options.period_ns == 0 ? <span class="stringliteral">&quot; (random)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.first_ns &lt; 0)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; first period: random up to %lld ns\n&quot;</span>, llabs(g_options.first_ns));</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; first period: %ld ns (%fs%s)\n&quot;</span>, g_options.first_ns,</div>
<div class="line">                           (<span class="keywordtype">double</span>)g_options.first_ns / 1000000000,</div>
<div class="line">                           g_options.first_ns == 0 ? <span class="stringliteral">&quot; (=period)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; max period:   %lu ns (%f s)\n&quot;</span>, g_options.max_period_ns,</div>
<div class="line">                   (<span class="keywordtype">double</span>)g_options.max_period_ns / 1000000000);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; min period:   %lu ns (%f s)\n&quot;</span>, g_options.min_period_ns,</div>
<div class="line">                   (<span class="keywordtype">double</span>)g_options.min_period_ns / 1000000000);</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.num_runs &gt; 1)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; diff err lim: %lu ns (%f s)\n&quot;</span>, g_options.stop_limit,</div>
<div class="line">                           (<span class="keywordtype">double</span>)g_options.stop_limit / 1000000000);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; csv:          %s\n&quot;</span>,</div>
<div class="line">                   g_options.csv == NULL ? <span class="stringliteral">&quot;(no)&quot;</span> : g_options.csv);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; tracebuffer:  %d events (%luKiB)\n&quot;</span>,</div>
<div class="line">                   g_options.tracebuf,</div>
<div class="line">                   g_options.tracebuf * <span class="keyword">sizeof</span>(tmo_trace) / 1024);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; stop limit:   %d events\n&quot;</span>, g_options.trcstop);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; use NOSKIP:   %s\n&quot;</span>, g_options.noskip ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; profile API:  %s\n&quot;</span>, g_options.profile ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; dispatch prof:%s\n&quot;</span>, g_options.dispatch ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; work probability:%u %%\n&quot;</span>, g_options.work_prop);</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.work_prop) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; min_work:     %luns\n&quot;</span>, g_options.min_work_ns);</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; max_work:     %luns\n&quot;</span>, g_options.max_work_ns);</div>
<div class="line">        }</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; bg events:    %u\n&quot;</span>, g_options.bg_events);</div>
<div class="line">        eo_ctx-&gt;bg_data = NULL;</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.bg_events) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; bg work:      %lu us\n&quot;</span>, g_options.bg_time_ns / 1000);</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; bg data:      %u kiB\n&quot;</span>, g_options.bg_size / 1024);</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; bg chunk:     %u kiB (%u blks)\n&quot;</span>,</div>
<div class="line">                           g_options.bg_chunk / 1024,</div>
<div class="line">                           g_options.bg_size / g_options.bg_chunk);</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; bg trace:     %s\n&quot;</span>, g_options.jobs ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                eo_ctx-&gt;bg_data = malloc(g_options.bg_size);</div>
<div class="line">                test_fatal_if(eo_ctx-&gt;bg_data == NULL,</div>
<div class="line">                              <span class="stringliteral">&quot;Can&#39;t allocate bg work data (%dkiB)!\n&quot;</span>,</div>
<div class="line">                              g_options.bg_size / 1024);</div>
<div class="line">        }</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; memzero:      &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.mz_mb)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;%u MB %severy %lu ms\n&quot;</span>,</div>
<div class="line">                           g_options.mz_mb,</div>
<div class="line">                           g_options.mz_huge ? <span class="stringliteral">&quot;(mmap huge) &quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                           g_options.mz_ns / 1000000UL);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;no\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.abort != 0) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; abort after:  &quot;</span>);</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.abort)</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;%d%s\n&quot;</span>,</div>
<div class="line">                                   g_options.abort, g_options.abort &lt; 0 ? <span class="stringliteral">&quot;(segfault)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;0 (no)\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.num_runs != 1) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; delete tmos:  %s\n&quot;</span>, g_options.no_del ? <span class="stringliteral">&quot;no&quot;</span> : <span class="stringliteral">&quot;yes&quot;</span>);</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; recreate tmr: %s\n&quot;</span>, g_options.recreate ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.etype != <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; using evtype: %u (0x%X)\n&quot;</span>, g_options.etype, g_options.etype);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; same start tick: %s&quot;</span>, g_options.same_tick ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\nTracing first %d tmo events\n&quot;</span>, g_options.tracebuf);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.bg_events)</div>
<div class="line">                prefault(eo_ctx-&gt;bg_data, g_options.bg_size);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* create periodic timeout for heartbeat */</span></div>
<div class="line">        eo_ctx-&gt;heartbeat_tmo = <a class="code" href="../../de/dc2/group__em__timer.html#ga4fc3dd338b784ce9b122eeb3fbf4ea07">em_tmo_create</a>(m_shm-&gt;hb_tmr, <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#gaade0f99e694a2f999abe467bc05fde61aac8e81389e6feaf233eff357c4ece5f0">EM_TMO_FLAG_PERIODIC</a>, eo_ctx-&gt;hb_q);</div>
<div class="line">        test_fatal_if(eo_ctx-&gt;heartbeat_tmo == <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;Can&#39;t allocate heartbeat_tmo!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">event</span> = <a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(app_msg_t), <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>, m_shm-&gt;pool);</div>
<div class="line">        test_fatal_if(event == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>, <span class="stringliteral">&quot;Can&#39;t allocate event (%ldB)!\n&quot;</span>,</div>
<div class="line">                      <span class="keyword">sizeof</span>(app_msg_t));</div>
<div class="line"> </div>
<div class="line">        msg = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line">        msg-&gt;command = CMD_HEARTBEAT;</div>
<div class="line">        msg-&gt;count = 0;</div>
<div class="line">        msg-&gt;id = -1;</div>
<div class="line">        eo_ctx-&gt;hb_hz = <a class="code" href="../../de/dc2/group__em__timer.html#gae97b08e2b1468de76a7d92342a5860ed">em_timer_get_freq</a>(m_shm-&gt;hb_tmr);</div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;hb_hz &lt; 10)</div>
<div class="line">                APPL_ERROR(<span class="stringliteral">&quot;WARNING: HB timer hz very low!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;HB timer frequency is %lu\n&quot;</span>, eo_ctx-&gt;hb_hz);</div>
<div class="line"> </div>
<div class="line">        period = eo_ctx-&gt;hb_hz; <span class="comment">/* 1s */</span></div>
<div class="line">        test_fatal_if(period &lt; 1, <span class="stringliteral">&quot;timer resolution is too low!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* linux time check */</span></div>
<div class="line">        test_fatal_if(clock_getres(CLOCK_MONOTONIC, &amp;ts) != 0,</div>
<div class="line">                      <span class="stringliteral">&quot;clock_getres() failed!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        period = ts.tv_nsec + (ts.tv_sec * 1000000000ULL);</div>
<div class="line">        eo_ctx-&gt;linux_hz = 1000000000ULL / period;</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Linux reports clock running at %&quot;</span> PRIu64 <span class="stringliteral">&quot; hz\n&quot;</span>, eo_ctx-&gt;linux_hz);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;ODP says time_global runs at %lu Hz\n&quot;</span>, odp_time_global_res());</div>
<div class="line">        eo_ctx-&gt;time_hz = odp_time_global_res();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* start heartbeat */</span></div>
<div class="line">        __atomic_store_n(&amp;eo_ctx-&gt;state, STATE_INIT, __ATOMIC_SEQ_CST);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> stat = <a class="code" href="../../de/dc2/group__em__timer.html#ga8f1f88a05b9e366f3b31447dead90b5e">em_tmo_set_periodic</a>(eo_ctx-&gt;heartbeat_tmo, 0, eo_ctx-&gt;hb_hz, event);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (EXTRA_PRINTS &amp;&amp; stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;FAILED to set HB tmo, stat=%d: period=%lu\n&quot;</span>, stat, eo_ctx-&gt;hb_hz);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Can&#39;t activate heartbeat tmo!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        stat = <a name="a81"></a><a class="code" href="../../d3/db8/group__em__dispatcher.html#ga50a0ef57733fbe0bf06ccfd0e3c2a665">em_dispatch_register_enter_cb</a>(enter_cb);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;enter_cb() register failed!&quot;</span>);</div>
<div class="line">        stat = <a name="a82"></a><a class="code" href="../../d3/db8/group__em__dispatcher.html#ga867519ecfc13f60713d54b419cdc2f25">em_dispatch_register_exit_cb</a>(exit_cb);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;exit_cb() register failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        srandom(time(NULL));</div>
<div class="line">        <span class="keywordflow">if</span> (g_options.max_work_ns &gt; RAND_MAX ||</div>
<div class="line">            g_options.max_period_ns &gt; RAND_MAX) {</div>
<div class="line">                <span class="keywordtype">double</span> s = (double)RAND_MAX / (<span class="keywordtype">double</span>)eo_ctx-&gt;test_hz;</div>
<div class="line"> </div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;WARNING: rnd number range is less than max values (up to %.4fs)\n&quot;</span>, s);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (EXTRA_PRINTS)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;WARNING: extra prints enabled, expect some jitter\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO per thread start function.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> app_eo_start_local(<span class="keywordtype">void</span> *eo_context, em_eo_t eo)</div>
<div class="line">{</div>
<div class="line">        app_eo_ctx_t *<span class="keyword">const</span> eo_ctx = eo_context;</div>
<div class="line">        <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line"> </div>
<div class="line">        (void)eo;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (EXTRA_PRINTS)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;EO local start\n&quot;</span>);</div>
<div class="line">        test_fatal_if(core &gt;= MAX_CORES, <span class="stringliteral">&quot;Too many cores!&quot;</span>);</div>
<div class="line">        eo_ctx-&gt;cdat[core].trc = allocate_tracebuf(g_options.tracebuf, <span class="keyword">sizeof</span>(tmo_trace),</div>
<div class="line">                                                   &amp;eo_ctx-&gt;cdat[core].trc_size);</div>
<div class="line">        test_fatal_if(eo_ctx-&gt;cdat[core].trc == NULL, <span class="stringliteral">&quot;Failed to allocate trace buffer!&quot;</span>);</div>
<div class="line">        eo_ctx-&gt;cdat[core].count = 0;</div>
<div class="line">        eo_ctx-&gt;cdat[core].cancelled = 0;</div>
<div class="line">        eo_ctx-&gt;cdat[core].jobs_deleted = 0;</div>
<div class="line">        eo_ctx-&gt;cdat[core].jobs = 0;</div>
<div class="line"> </div>
<div class="line">        memset(&amp;eo_ctx-&gt;cdat[core].rng, 0, <span class="keyword">sizeof</span>(rnd_state_t));</div>
<div class="line">        initstate_r(time(NULL), eo_ctx-&gt;cdat[core].rng.rndstate, RND_STATE_BUF,</div>
<div class="line">                    &amp;eo_ctx-&gt;cdat[core].rng.rdata);</div>
<div class="line">        srandom_r(time(NULL), &amp;eo_ctx-&gt;cdat[core].rng.rdata);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO stop function.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> app_eo_stop(<span class="keywordtype">void</span> *eo_context, em_eo_t eo)</div>
<div class="line">{</div>
<div class="line">        app_eo_ctx_t *<span class="keyword">const</span> eo_ctx = eo_context;</div>
<div class="line">        em_event_t <span class="keyword">event</span> = <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (EXTRA_PRINTS)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;EO stop\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_options.info_only)</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;heartbeat_tmo != <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>) {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="../../de/dc2/group__em__timer.html#ga66476f77546996eea9acebaa471c1b52">em_tmo_get_state</a>(eo_ctx-&gt;heartbeat_tmo) == <a class="code" href="../../de/dc2/group__em__timer.html#gga3857ab06946e6b4047352d5d84ffff4daa54abf62265d1c2beaeeadb6a1ee240f">EM_TMO_STATE_ACTIVE</a>)</div>
<div class="line">                        <a class="code" href="../../de/dc2/group__em__timer.html#ga786f0cc89e9bdfda1c1274165600f0ef">em_tmo_cancel</a>(eo_ctx-&gt;heartbeat_tmo, &amp;event);</div>
<div class="line">                <a class="code" href="../../de/dc2/group__em__timer.html#ga67d2db5f72ccdd285649ce05b0a22a92">em_tmo_delete</a>(eo_ctx-&gt;heartbeat_tmo);</div>
<div class="line">                eo_ctx-&gt;heartbeat_tmo = <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (event != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>)</div>
<div class="line">                        <a name="a83"></a><a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* cancel all test timers in case test didn&#39;t complete */</span></div>
<div class="line">        <span class="keywordtype">int</span> dcount = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; g_options.num_periodic; i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (eo_ctx-&gt;tmo_data[i].handle != <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>) {</div>
<div class="line">                        <span class="keyword">event</span> = <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>;</div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="../../de/dc2/group__em__timer.html#ga66476f77546996eea9acebaa471c1b52">em_tmo_get_state</a>(eo_ctx-&gt;tmo_data[i].handle) == <a class="code" href="../../de/dc2/group__em__timer.html#gga3857ab06946e6b4047352d5d84ffff4daa54abf62265d1c2beaeeadb6a1ee240f">EM_TMO_STATE_ACTIVE</a>)</div>
<div class="line">                                <a class="code" href="../../de/dc2/group__em__timer.html#ga786f0cc89e9bdfda1c1274165600f0ef">em_tmo_cancel</a>(eo_ctx-&gt;tmo_data[i].handle, &amp;event);</div>
<div class="line">                        <a class="code" href="../../de/dc2/group__em__timer.html#ga67d2db5f72ccdd285649ce05b0a22a92">em_tmo_delete</a>(eo_ctx-&gt;tmo_data[i].handle);</div>
<div class="line">                        eo_ctx-&gt;tmo_data[i].handle = <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>;</div>
<div class="line">                        <span class="keywordflow">if</span> (event != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>)</div>
<div class="line">                                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">                        dcount++;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (dcount)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;NOTE: deleted %d still active tmos\n&quot;</span>, dcount);</div>
<div class="line"> </div>
<div class="line">        ret = <a name="a84"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga10cf8094caa56026eb0a402d3d22da23">em_eo_remove_queue_all_sync</a>(eo, <a name="a85"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a419c8373b72a8c5ed1c3e3ded3e262e0">EM_TRUE</a>); <span class="comment">/* remove and delete */</span></div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO remove queue all:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot;&quot;</span>, ret, eo);</div>
<div class="line"> </div>
<div class="line">        ret = <a name="a86"></a><a class="code" href="../../d3/dc1/group__em__atomic__group.html#gaa253b47f920a4fd27532c9e0246e0d8b">em_atomic_group_delete</a>(((app_eo_ctx_t *)eo_context)-&gt;agrp);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO remove atomic grp:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot;&quot;</span>, ret, eo);</div>
<div class="line"> </div>
<div class="line">        ret = <a name="a87"></a><a class="code" href="../../d3/db8/group__em__dispatcher.html#gaaa150b80e664ea595e0e0820c8c80860">em_dispatch_unregister_enter_cb</a>(enter_cb);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;enter_cb() unregister:%&quot;</span> PRI_STAT, ret);</div>
<div class="line">        ret = <a name="a88"></a><a class="code" href="../../d3/db8/group__em__dispatcher.html#ga4196836cb6f8fa4ad23be15c8951e89d">em_dispatch_unregister_exit_cb</a>(exit_cb);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;exit_cb() unregister:%&quot;</span> PRI_STAT, ret);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;bg_data != NULL)</div>
<div class="line">                free(eo_ctx-&gt;bg_data);</div>
<div class="line">        eo_ctx-&gt;bg_data = NULL;</div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;mz_data != NULL) {</div>
<div class="line">                <span class="keywordflow">if</span> (g_options.mz_huge)</div>
<div class="line">                        munmap(eo_ctx-&gt;mz_data, g_options.mz_mb * 1024UL * 1024UL);</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        free(eo_ctx-&gt;mz_data);</div>
<div class="line"> </div>
<div class="line">                eo_ctx-&gt;mz_data = NULL;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">double</span> rt = TIME_STAMP_FN() - eo_ctx-&gt;appstart;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;EO runtime was %.2f min\n&quot;</span>, rt / 1e9 / 60);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO stop local function.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> app_eo_stop_local(<span class="keywordtype">void</span> *eo_context, em_eo_t eo)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line">        app_eo_ctx_t *<span class="keyword">const</span> eo_ctx = eo_context;</div>
<div class="line"> </div>
<div class="line">        (void)eo;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (EXTRA_PRINTS)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;EO local stop\n&quot;</span>);</div>
<div class="line">        free_tracebuf(eo_ctx-&gt;cdat[core].trc, eo_ctx-&gt;cdat[core].trc_size);</div>
<div class="line">        eo_ctx-&gt;cdat[core].trc = NULL;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO receive function</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_eo_receive(<span class="keywordtype">void</span> *eo_context, em_event_t event,</div>
<div class="line">                           <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> type, em_queue_t queue,</div>
<div class="line">                           <span class="keywordtype">void</span> *q_context)</div>
<div class="line">{</div>
<div class="line">        app_eo_ctx_t *<span class="keyword">const</span> eo_ctx = eo_context;</div>
<div class="line">        <span class="keywordtype">int</span> reuse = 0;</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">int</span> last_count;</div>
<div class="line"> </div>
<div class="line">        (void)q_context;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (type == <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a> || type == g_options.etype) {</div>
<div class="line">                app_msg_t *msgin = (app_msg_t *)<a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">switch</span> (msgin-&gt;command) {</div>
<div class="line">                <span class="keywordflow">case</span> CMD_TMO:</div>
<div class="line">                        reuse = handle_periodic(eo_ctx, event);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> CMD_HEARTBEAT: <span class="comment">/* uses atomic queue */</span></div>
<div class="line">                        handle_heartbeat(eo_ctx, event);</div>
<div class="line">                        last_count = msgin-&gt;count;</div>
<div class="line">                        reuse = 1;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> CMD_BGWORK:</div>
<div class="line">                        reuse = do_bg_work(event, eo_ctx);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> CMD_DONE:  <span class="comment">/* HB atomic queue */</span> {</div>
<div class="line">                        e_state state = __atomic_load_n(&amp;eo_ctx-&gt;state, __ATOMIC_ACQUIRE);</div>
<div class="line"> </div>
<div class="line">                        <span class="comment">/* only do this once */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (state == STATE_RUN &amp;&amp; queue == eo_ctx-&gt;stop_q) {</div>
<div class="line">                                __atomic_store_n(&amp;eo_ctx-&gt;state, STATE_COOLOFF, __ATOMIC_SEQ_CST);</div>
<div class="line">                                add_trace(eo_ctx, -1, OP_STATE, linux_time_ns(), STATE_COOLOFF, -1);</div>
<div class="line">                                eo_ctx-&gt;last_hbcount = last_count;</div>
<div class="line">                                eo_ctx-&gt;stopped = TIME_STAMP_FN();</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;Core %d reported DONE\n&quot;</span>, msgin-&gt;id);</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                        test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF, <span class="stringliteral">&quot;Invalid event!\n&quot;</span>);</div>
<div class="line">                }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF, <span class="stringliteral">&quot;Invalid event type!\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!reuse)</div>
<div class="line">                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* pick app-specific arguments after &#39;--&#39; */</span></div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;EM periodic timer test %s\n\n&quot;</span>, VERSION);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (!strcmp(argv[i], <span class="stringliteral">&quot;--&quot;</span>))</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (i &lt; argc) {</div>
<div class="line">                <span class="keywordflow">if</span> (!parse_my_args(i, argc, argv)) {</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;Invalid application arguments\n&quot;</span>);</div>
<div class="line">                        <span class="keywordflow">return</span> 1;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> cm_setup(argc, argv);</div>
<div class="line">}</div>
<div class="ttc" id="aenvironment_8h_html"><div class="ttname"><a href="../../de/d26/environment_8h.html">environment.h</a></div></div>
<div class="ttc" id="aevent__machine_8h_html"><div class="ttname"><a href="../../d7/d5e/event__machine_8h.html">event_machine.h</a></div></div>
<div class="ttc" id="aevent__machine__hw__config_8h_html_aaa0a290a45f4b1280f3330fadde6bfde"><div class="ttname"><a href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a></div><div class="ttdeci">#define EM_POOL_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6d/event__machine__hw__config_8h_source.html#l00191">event_machine_hw_config.h:191</a></div></div>
<div class="ttc" id="aevent__machine__hw__config_8h_html_ae56af1c575498ec19f0836ee916d0eb9"><div class="ttname"><a href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a></div><div class="ttdeci">#define EM_QUEUE_GROUP_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6d/event__machine__hw__config_8h_source.html#l00147">event_machine_hw_config.h:147</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea">EM_QUEUE_TYPE_PARALLEL</a></div><div class="ttdeci">@ EM_QUEUE_TYPE_PARALLEL</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00117">event_machine_hw_types.h:117</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca">EM_QUEUE_PRIO_NORMAL</a></div><div class="ttdeci">@ EM_QUEUE_PRIO_NORMAL</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00153">event_machine_hw_types.h:153</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a8171ccd1b7a0df99a6c7d0f3ec82e52fa5e6d33c32d6dcd3bf02802e7af102d94"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa5e6d33c32d6dcd3bf02802e7af102d94">EM_QUEUE_PRIO_LOWEST</a></div><div class="ttdeci">@ EM_QUEUE_PRIO_LOWEST</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00151">event_machine_hw_types.h:151</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a8171ccd1b7a0df99a6c7d0f3ec82e52fa621ca7c9a90044e11dad3060006dc450"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa621ca7c9a90044e11dad3060006dc450">EM_QUEUE_PRIO_HIGHEST</a></div><div class="ttdeci">@ EM_QUEUE_PRIO_HIGHEST</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00156">event_machine_hw_types.h:155</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a8171ccd1b7a0df99a6c7d0f3ec82e52fac38f313458eaca8b4a7f1c04fb20fdf1"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fac38f313458eaca8b4a7f1c04fb20fdf1">EM_QUEUE_PRIO_HIGH</a></div><div class="ttdeci">@ EM_QUEUE_PRIO_HIGH</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00154">event_machine_hw_types.h:154</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_ac341b7db29d8127e864a45c9bd2a4aa3"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a></div><div class="ttdeci">#define EM_ERROR_SET_FATAL(error)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00428">event_machine_hw_types.h:428</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a></div><div class="ttdeci">@ EM_EVENT_TYPE_SW</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00072">event_machine_hw_types.h:72</a></div></div>
<div class="ttc" id="aevent__machine__timer__hw__specific_8h_html_a31cd14adb32c94ed0f2e27d263ad6eb1"><div class="ttname"><a href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#a31cd14adb32c94ed0f2e27d263ad6eb1">PRI_TMR</a></div><div class="ttdeci">#define PRI_TMR</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1f/event__machine__timer__hw__specific_8h_source.html#l00049">event_machine_timer_hw_specific.h:49</a></div></div>
<div class="ttc" id="aevent__machine__timer__hw__specific_8h_html_aa373a94a9084c3bd6c5b23ac6bd6b176"><div class="ttname"><a href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#aa373a94a9084c3bd6c5b23ac6bd6b176">EM_TIMER_UNDEF</a></div><div class="ttdeci">#define EM_TIMER_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1f/event__machine__timer__hw__specific_8h_source.html#l00120">event_machine_timer_hw_specific.h:120</a></div></div>
<div class="ttc" id="aevent__machine__timer__hw__specific_8h_html_ad2afe10951c01b6511a18d9e82f2c0a3"><div class="ttname"><a href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#ad2afe10951c01b6511a18d9e82f2c0a3">EM_TIMER_CLKSRC_DEFAULT</a></div><div class="ttdeci">#define EM_TIMER_CLKSRC_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1f/event__machine__timer__hw__specific_8h_source.html#l00106">event_machine_timer_hw_specific.h:106</a></div></div>
<div class="ttc" id="aevent__machine__timer__hw__specific_8h_html_af7917fb5bc546e1339ad6e1135fd8c6d"><div class="ttname"><a href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a></div><div class="ttdeci">#define EM_TMO_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1f/event__machine__timer__hw__specific_8h_source.html#l00125">event_machine_timer_hw_specific.h:125</a></div></div>
<div class="ttc" id="aevent__machine__timer__hw__specific_8h_html_gaade0f99e694a2f999abe467bc05fde61a6eb7050f533988c44b9b9ee783903c44"><div class="ttname"><a href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#gaade0f99e694a2f999abe467bc05fde61a6eb7050f533988c44b9b9ee783903c44">EM_TMO_FLAG_NOSKIP</a></div><div class="ttdeci">@ EM_TMO_FLAG_NOSKIP</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1f/event__machine__timer__hw__specific_8h_source.html#l00083">event_machine_timer_hw_specific.h:83</a></div></div>
<div class="ttc" id="aevent__machine__timer__hw__specific_8h_html_gaade0f99e694a2f999abe467bc05fde61aac8e81389e6feaf233eff357c4ece5f0"><div class="ttname"><a href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#gaade0f99e694a2f999abe467bc05fde61aac8e81389e6feaf233eff357c4ece5f0">EM_TMO_FLAG_PERIODIC</a></div><div class="ttdeci">@ EM_TMO_FLAG_PERIODIC</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1f/event__machine__timer__hw__specific_8h_source.html#l00082">event_machine_timer_hw_specific.h:82</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a03546e6a7e93665c52d479831e0a6dca"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a></div><div class="ttdeci">#define EM_OK</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00329">event_machine_types.h:329</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a0bf4a25d46e18ee918e684e5deb27fa4"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a></div><div class="ttdeci">#define PRI_EO</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00097">event_machine_types.h:97</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a0c0a929399ae33b615f8ca8018d2a69d"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a0c0a929399ae33b615f8ca8018d2a69d">em_escope_t</a></div><div class="ttdeci">uint32_t em_escope_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00348">event_machine_types.h:348</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a3f2bef96eaf8b2855699d6adee7758f4"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a3f2bef96eaf8b2855699d6adee7758f4">EM_QUEUE_GROUP_UNDEF</a></div><div class="ttdeci">#define EM_QUEUE_GROUP_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00127">event_machine_types.h:127</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a419c8373b72a8c5ed1c3e3ded3e262e0"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a419c8373b72a8c5ed1c3e3ded3e262e0">EM_TRUE</a></div><div class="ttdeci">#define EM_TRUE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00053">event_machine_types.h:53</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a49fd700da185b0f64834bf967479a992"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a></div><div class="ttdeci">uint32_t em_event_type_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00085">event_machine_types.h:85</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a8542d9c2c9a29e35ff042b1d59cc479b"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a></div><div class="ttdeci">#define EM_EVENT_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00062">event_machine_types.h:62</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a8aa7220ee288baa2ef461f400679fa48"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a8aa7220ee288baa2ef461f400679fa48">EM_ATOMIC_GROUP_UNDEF</a></div><div class="ttdeci">#define EM_ATOMIC_GROUP_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00156">event_machine_types.h:156</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_adddd88868f7aa0d32b3e40245eb4ef8f"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div><div class="ttdeci">uint32_t em_status_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00321">event_machine_types.h:321</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_af28fb8daf62b942ced417e158ed7e1c7"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#af28fb8daf62b942ced417e158ed7e1c7">EM_EO_UNDEF</a></div><div class="ttdeci">#define EM_EO_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00095">event_machine_types.h:95</a></div></div>
<div class="ttc" id="agroup__em__atomic__group_html_ga0ac321a585ce74c3cf79a7459c91095c"><div class="ttname"><a href="../../d3/dc1/group__em__atomic__group.html#ga0ac321a585ce74c3cf79a7459c91095c">em_queue_create_ag</a></div><div class="ttdeci">em_queue_t em_queue_create_ag(const char *name, em_queue_prio_t prio, em_atomic_group_t atomic_group, const em_queue_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9e/event__machine__atomic__group_8c_source.html#l00224">event_machine_atomic_group.c:224</a></div></div>
<div class="ttc" id="agroup__em__atomic__group_html_gaa253b47f920a4fd27532c9e0246e0d8b"><div class="ttname"><a href="../../d3/dc1/group__em__atomic__group.html#gaa253b47f920a4fd27532c9e0246e0d8b">em_atomic_group_delete</a></div><div class="ttdeci">em_status_t em_atomic_group_delete(em_atomic_group_t atomic_group)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9e/event__machine__atomic__group_8c_source.html#l00181">event_machine_atomic_group.c:181</a></div></div>
<div class="ttc" id="agroup__em__atomic__group_html_gab52d49a543562163a904f86fd9f18866"><div class="ttname"><a href="../../d3/dc1/group__em__atomic__group.html#gab52d49a543562163a904f86fd9f18866">em_atomic_group_create</a></div><div class="ttdeci">em_atomic_group_t em_atomic_group_create(const char *name, em_queue_group_t queue_group)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9e/event__machine__atomic__group_8c_source.html#l00040">event_machine_atomic_group.c:40</a></div></div>
<div class="ttc" id="agroup__em__core_html_ga13d21af31382ec2c3d45010645707e9c"><div class="ttname"><a href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a></div><div class="ttdeci">int em_core_id(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df9/event__machine__core_8c_source.html#l00034">event_machine_core.c:34</a></div></div>
<div class="ttc" id="agroup__em__dispatcher_html_ga4196836cb6f8fa4ad23be15c8951e89d"><div class="ttname"><a href="../../d3/db8/group__em__dispatcher.html#ga4196836cb6f8fa4ad23be15c8951e89d">em_dispatch_unregister_exit_cb</a></div><div class="ttdeci">em_status_t em_dispatch_unregister_exit_cb(em_dispatch_exit_func_t func)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d0d/event__machine__dispatcher_8c_source.html#l00330">event_machine_dispatcher.c:330</a></div></div>
<div class="ttc" id="agroup__em__dispatcher_html_ga50a0ef57733fbe0bf06ccfd0e3c2a665"><div class="ttname"><a href="../../d3/db8/group__em__dispatcher.html#ga50a0ef57733fbe0bf06ccfd0e3c2a665">em_dispatch_register_enter_cb</a></div><div class="ttdeci">em_status_t em_dispatch_register_enter_cb(em_dispatch_enter_func_t func)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d0d/event__machine__dispatcher_8c_source.html#l00274">event_machine_dispatcher.c:274</a></div></div>
<div class="ttc" id="agroup__em__dispatcher_html_ga867519ecfc13f60713d54b419cdc2f25"><div class="ttname"><a href="../../d3/db8/group__em__dispatcher.html#ga867519ecfc13f60713d54b419cdc2f25">em_dispatch_register_exit_cb</a></div><div class="ttdeci">em_status_t em_dispatch_register_exit_cb(em_dispatch_exit_func_t func)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d0d/event__machine__dispatcher_8c_source.html#l00312">event_machine_dispatcher.c:312</a></div></div>
<div class="ttc" id="agroup__em__dispatcher_html_gaaa150b80e664ea595e0e0820c8c80860"><div class="ttname"><a href="../../d3/db8/group__em__dispatcher.html#gaaa150b80e664ea595e0e0820c8c80860">em_dispatch_unregister_enter_cb</a></div><div class="ttdeci">em_status_t em_dispatch_unregister_enter_cb(em_dispatch_enter_func_t func)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d0d/event__machine__dispatcher_8c_source.html#l00293">event_machine_dispatcher.c:293</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga10cf8094caa56026eb0a402d3d22da23"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga10cf8094caa56026eb0a402d3d22da23">em_eo_remove_queue_all_sync</a></div><div class="ttdeci">em_status_t em_eo_remove_queue_all_sync(em_eo_t eo, int delete_queues)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00517">event_machine_eo.c:517</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga1262b0eefaf7840f9c2b44b7fe3ff93e"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga1262b0eefaf7840f9c2b44b7fe3ff93e">em_eo_get_context</a></div><div class="ttdeci">void * em_eo_get_context(em_eo_t eo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l01002">event_machine_eo.c:1002</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga196c7caa1177575fd424e9a0d2854da6"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga196c7caa1177575fd424e9a0d2854da6">em_eo_create</a></div><div class="ttdeci">em_eo_t em_eo_create(const char *name, em_start_func_t start, em_start_local_func_t local_start, em_stop_func_t stop, em_stop_local_func_t local_stop, em_receive_func_t receive, const void *eo_ctx)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00040">event_machine_eo.c:40</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga9ac21d82f671fff3e31e83410e72d406"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga9ac21d82f671fff3e31e83410e72d406">em_eo_find</a></div><div class="ttdeci">em_eo_t em_eo_find(const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00265">event_machine_eo.c:265</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gabe4f7a789ec9523367c086793061562d"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gabe4f7a789ec9523367c086793061562d">em_eo_start_sync</a></div><div class="ttdeci">em_status_t em_eo_start_sync(em_eo_t eo, em_status_t *result, const em_eo_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00725">event_machine_eo.c:725</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gac9b818edd466228b6fb653bd9337da3e"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a></div><div class="ttdeci">em_status_t em_eo_add_queue_sync(em_eo_t eo, em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00344">event_machine_eo.c:344</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gadce026621953114bd26e5836d9693465"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gadce026621953114bd26e5836d9693465">em_eo_stop_sync</a></div><div class="ttdeci">em_status_t em_eo_stop_sync(em_eo_t eo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00897">event_machine_eo.c:897</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gae769b19e613b24487beb943cfb926977"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gae769b19e613b24487beb943cfb926977">em_eo_delete</a></div><div class="ttdeci">em_status_t em_eo_delete(em_eo_t eo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00205">event_machine_eo.c:205</a></div></div>
<div class="ttc" id="agroup__em__error_html_gab6b469100e5f60670a742d944a6f530b"><div class="ttname"><a href="../../db/da0/group__em__error.html#gab6b469100e5f60670a742d944a6f530b">em_unregister_error_handler</a></div><div class="ttdeci">em_status_t em_unregister_error_handler(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/de9/event__machine__error_8c_source.html#l00050">event_machine_error.c:50</a></div></div>
<div class="ttc" id="agroup__em__error_html_gaf7332965c5deaa69411136e8d36089c6"><div class="ttname"><a href="../../db/da0/group__em__error.html#gaf7332965c5deaa69411136e8d36089c6">em_register_error_handler</a></div><div class="ttdeci">em_status_t em_register_error_handler(em_error_handler_t handler)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/de9/event__machine__error_8c_source.html#l00034">event_machine_error.c:34</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga5f0e40f1b0b4892ee16aafe07ba4c90c"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a></div><div class="ttdeci">em_event_t em_alloc(uint32_t size, em_event_type_t type, em_pool_t pool)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00033">event_machine_event.c:33</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga8f701c3a5901fc81d922b9d1d02691e3"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a></div><div class="ttdeci">void * em_event_pointer(em_event_t event)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00750">event_machine_event.c:750</a></div></div>
<div class="ttc" id="agroup__em__event_html_gaca4584a01b71429dfbb045342454b464"><div class="ttname"><a href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a></div><div class="ttdeci">em_status_t em_send(em_event_t event, em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00661">event_machine_event.c:661</a></div></div>
<div class="ttc" id="agroup__em__event_html_gad4f97ba217518d967f8078c56023c4d4"><div class="ttname"><a href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a></div><div class="ttdeci">void em_free(em_event_t event)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00261">event_machine_event.c:261</a></div></div>
<div class="ttc" id="agroup__em__queue__group_html_ga0a861d268d820d2b6de1341749b4011a"><div class="ttname"><a href="../../d9/d01/group__em__queue__group.html#ga0a861d268d820d2b6de1341749b4011a">em_queue_group_get_mask</a></div><div class="ttdeci">em_status_t em_queue_group_get_mask(em_queue_group_t queue_group, em_core_mask_t *mask)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dd9/event__machine__queue__group_8c_source.html#l00260">event_machine_queue_group.c:260</a></div></div>
<div class="ttc" id="agroup__em__queue__group_html_ga6f3e8e31f260f65abc902aad59c4497d"><div class="ttname"><a href="../../d9/d01/group__em__queue__group.html#ga6f3e8e31f260f65abc902aad59c4497d">em_queue_group_create_sync</a></div><div class="ttdeci">em_queue_group_t em_queue_group_create_sync(const char *name, const em_core_mask_t *mask)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dd9/event__machine__queue__group_8c_source.html#l00076">event_machine_queue_group.c:76</a></div></div>
<div class="ttc" id="agroup__em__queue_html_gaef257858d1fa660524f198dba20fa9eb"><div class="ttname"><a href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a></div><div class="ttdeci">em_queue_t em_queue_create(const char *name, em_queue_type_t type, em_queue_prio_t prio, em_queue_group_t group, const em_queue_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dba/event__machine__queue_8c_source.html#l00041">event_machine_queue.c:41</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga002c51ef0da36f83ce4e28f0e486c7e6"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga002c51ef0da36f83ce4e28f0e486c7e6">em_timer_capability</a></div><div class="ttdeci">em_status_t em_timer_capability(em_timer_capability_t *capa, em_timer_clksrc_t clk_src)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l00502">event_machine_timer.c:502</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga01e680281f0ae40bce6c6786fc0bcdc3"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga01e680281f0ae40bce6c6786fc0bcdc3">em_timer_get_attr</a></div><div class="ttdeci">em_status_t em_timer_get_attr(em_timer_t tmr, em_timer_attr_t *tmr_attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01752">event_machine_timer.c:1752</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga20a84e2f8b65dbaf916ec45a1ade1ee3"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga20a84e2f8b65dbaf916ec45a1ade1ee3">em_tmo_get_type</a></div><div class="ttdeci">em_tmo_type_t em_tmo_get_type(em_event_t event, em_tmo_t *tmo, bool reset)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01874">event_machine_timer.c:1874</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga25b88dbbb772090d6caa5622c7017889"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga25b88dbbb772090d6caa5622c7017889">em_timer_get_all</a></div><div class="ttdeci">int em_timer_get_all(em_timer_t *tmr_list, int max)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01728">event_machine_timer.c:1728</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga2bac1530b021bbbd1f0f924414c2485e"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga2bac1530b021bbbd1f0f924414c2485e">em_timer_delete</a></div><div class="ttdeci">em_status_t em_timer_delete(em_timer_t tmr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l00980">event_machine_timer.c:980</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga443bd3c10af754ddc03fcee1d52fca05"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga443bd3c10af754ddc03fcee1d52fca05">em_timer_ns_to_tick</a></div><div class="ttdeci">em_timer_tick_t em_timer_ns_to_tick(em_timer_t tmr, uint64_t ns)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01824">event_machine_timer.c:1824</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga4fc3dd338b784ce9b122eeb3fbf4ea07"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga4fc3dd338b784ce9b122eeb3fbf4ea07">em_tmo_create</a></div><div class="ttdeci">em_tmo_t em_tmo_create(em_timer_t tmr, em_tmo_flag_t flags, em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01056">event_machine_timer.c:1056</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga56968bda0ecacf996d6ce623e3e372ab"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga56968bda0ecacf996d6ce623e3e372ab">em_timer_create</a></div><div class="ttdeci">em_timer_t em_timer_create(const em_timer_attr_t *tmr_attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l00616">event_machine_timer.c:616</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga66476f77546996eea9acebaa471c1b52"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga66476f77546996eea9acebaa471c1b52">em_tmo_get_state</a></div><div class="ttdeci">em_tmo_state_t em_tmo_get_state(em_tmo_t tmo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01837">event_machine_timer.c:1837</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga67d2db5f72ccdd285649ce05b0a22a92"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga67d2db5f72ccdd285649ce05b0a22a92">em_tmo_delete</a></div><div class="ttdeci">em_status_t em_tmo_delete(em_tmo_t tmo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01161">event_machine_timer.c:1161</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga786f0cc89e9bdfda1c1274165600f0ef"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga786f0cc89e9bdfda1c1274165600f0ef">em_tmo_cancel</a></div><div class="ttdeci">em_status_t em_tmo_cancel(em_tmo_t tmo, em_event_t *cur_event)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01533">event_machine_timer.c:1533</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga8f1f88a05b9e366f3b31447dead90b5e"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga8f1f88a05b9e366f3b31447dead90b5e">em_tmo_set_periodic</a></div><div class="ttdeci">em_status_t em_tmo_set_periodic(em_tmo_t tmo, em_timer_tick_t start_abs, em_timer_tick_t period, em_event_t tmo_ev)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01372">event_machine_timer.c:1372</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gaa192f52e47f2995d2af1175ae456c19f"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gaa192f52e47f2995d2af1175ae456c19f">em_tmo_get_stats</a></div><div class="ttdeci">em_status_t em_tmo_get_stats(em_tmo_t tmo, em_tmo_stats_t *stat)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01851">event_machine_timer.c:1851</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gaabb77ed31727a32d041f9d308a0a3886"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a></div><div class="ttdeci">em_timer_tick_t em_timer_current_tick(em_timer_t tmr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01045">event_machine_timer.c:1045</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gaade0f99e694a2f999abe467bc05fde61"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gaade0f99e694a2f999abe467bc05fde61">em_tmo_flag_t</a></div><div class="ttdeci">em_tmo_flag_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1f/event__machine__timer__hw__specific_8h_source.html#l00080">event_machine_timer_hw_specific.h:80</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gad6023dd3c79d0a45221d9245c604c2e3"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gad6023dd3c79d0a45221d9245c604c2e3">em_timer_attr_init</a></div><div class="ttdeci">void em_timer_attr_init(em_timer_attr_t *tmr_attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l00378">event_machine_timer.c:378</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gae97b08e2b1468de76a7d92342a5860ed"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gae97b08e2b1468de76a7d92342a5860ed">em_timer_get_freq</a></div><div class="ttdeci">uint64_t em_timer_get_freq(em_timer_t tmr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01797">event_machine_timer.c:1797</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gaf65f50c383b579720a31154b04ea610e"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gaf65f50c383b579720a31154b04ea610e">em_tmo_ack</a></div><div class="ttdeci">em_status_t em_tmo_ack(em_tmo_t tmo, em_event_t next_tmo_ev)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01612">event_machine_timer.c:1612</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gafe7128676f8f4ad4800fd204a34ac8d3"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a></div><div class="ttdeci">uint64_t em_timer_tick_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00255">api/event_machine_timer.h:255</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gafe76b458292862809030194da9462b4c"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gafe76b458292862809030194da9462b4c">em_timer_res_capability</a></div><div class="ttdeci">em_status_t em_timer_res_capability(em_timer_res_param_t *res, em_timer_clksrc_t clk_src)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l00544">event_machine_timer.c:544</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gga3857ab06946e6b4047352d5d84ffff4daa54abf62265d1c2beaeeadb6a1ee240f"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gga3857ab06946e6b4047352d5d84ffff4daa54abf62265d1c2beaeeadb6a1ee240f">EM_TMO_STATE_ACTIVE</a></div><div class="ttdeci">@ EM_TMO_STATE_ACTIVE</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00237">api/event_machine_timer.h:237</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ggafc12eb3000ea78f2493b1e36b832f63badea7e33cc1c34e598f387f0909ca471c"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ggafc12eb3000ea78f2493b1e36b832f63badea7e33cc1c34e598f387f0909ca471c">EM_TMO_TYPE_PERIODIC</a></div><div class="ttdeci">@ EM_TMO_TYPE_PERIODIC</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00247">api/event_machine_timer.h:247</a></div></div>
<div class="ttc" id="astructem__core__mask__t_html"><div class="ttname"><a href="../../df/d81/structem__core__mask__t.html">em_core_mask_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00242">event_machine_hw_types.h:242</a></div></div>
<div class="ttc" id="astructem__eo__conf__t_html"><div class="ttname"><a href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00242">event_machine_types.h:242</a></div></div>
<div class="ttc" id="astructem__timer__attr__t_html"><div class="ttname"><a href="../../d4/d00/structem__timer__attr__t.html">em_timer_attr_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00332">api/event_machine_timer.h:332</a></div></div>
<div class="ttc" id="astructem__timer__attr__t_html_a03fc2b0569742931ed610f0bd1af43ad"><div class="ttname"><a href="../../d4/d00/structem__timer__attr__t.html#a03fc2b0569742931ed610f0bd1af43ad">em_timer_attr_t::name</a></div><div class="ttdeci">char name[EM_TIMER_NAME_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00346">api/event_machine_timer.h:346</a></div></div>
<div class="ttc" id="astructem__timer__attr__t_html_adf7a24e643b381f39fec354caf5a4bc0"><div class="ttname"><a href="../../d4/d00/structem__timer__attr__t.html#adf7a24e643b381f39fec354caf5a4bc0">em_timer_attr_t::resparam</a></div><div class="ttdeci">em_timer_res_param_t resparam</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00339">api/event_machine_timer.h:339</a></div></div>
<div class="ttc" id="astructem__timer__attr__t_html_ae6afcdeed8fe620636b1f0391f908afc"><div class="ttname"><a href="../../d4/d00/structem__timer__attr__t.html#ae6afcdeed8fe620636b1f0391f908afc">em_timer_attr_t::num_tmo</a></div><div class="ttdeci">uint32_t num_tmo</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00342">api/event_machine_timer.h:342</a></div></div>
<div class="ttc" id="astructem__timer__capability__t_html"><div class="ttname"><a href="../../de/d00/structem__timer__capability__t.html">em_timer_capability_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00382">api/event_machine_timer.h:382</a></div></div>
<div class="ttc" id="astructem__timer__capability__t_html_a2d324c44c1abd50dd2182d83fff27e0c"><div class="ttname"><a href="../../de/d00/structem__timer__capability__t.html#a2d324c44c1abd50dd2182d83fff27e0c">em_timer_capability_t::max_tmo</a></div><div class="ttdeci">em_timer_res_param_t max_tmo</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00390">api/event_machine_timer.h:390</a></div></div>
<div class="ttc" id="astructem__timer__capability__t_html_a6fbaee4a7e9b7cce0a623ca569c66e37"><div class="ttname"><a href="../../de/d00/structem__timer__capability__t.html#a6fbaee4a7e9b7cce0a623ca569c66e37">em_timer_capability_t::max_timers</a></div><div class="ttdeci">uint32_t max_timers</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00384">api/event_machine_timer.h:384</a></div></div>
<div class="ttc" id="astructem__timer__capability__t_html_aad723b535c9cce55a9fae069882c09a1"><div class="ttname"><a href="../../de/d00/structem__timer__capability__t.html#aad723b535c9cce55a9fae069882c09a1">em_timer_capability_t::max_res</a></div><div class="ttdeci">em_timer_res_param_t max_res</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00388">api/event_machine_timer.h:388</a></div></div>
<div class="ttc" id="astructem__timer__res__param__t_html"><div class="ttname"><a href="../../d8/d93/structem__timer__res__param__t.html">em_timer_res_param_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00281">api/event_machine_timer.h:281</a></div></div>
<div class="ttc" id="astructem__timer__res__param__t_html_a07ed3b3b2e89e83ca36fb2efbc731c45"><div class="ttname"><a href="../../d8/d93/structem__timer__res__param__t.html#a07ed3b3b2e89e83ca36fb2efbc731c45">em_timer_res_param_t::clk_src</a></div><div class="ttdeci">em_timer_clksrc_t clk_src</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00283">api/event_machine_timer.h:283</a></div></div>
<div class="ttc" id="astructem__timer__res__param__t_html_a6a48acfe30394982686a96f1f402ac0c"><div class="ttname"><a href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">em_timer_res_param_t::res_ns</a></div><div class="ttdeci">uint64_t res_ns</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00285">api/event_machine_timer.h:285</a></div></div>
<div class="ttc" id="astructem__timer__res__param__t_html_a94b92c7b60c5a8cd9ac357b488292fa4"><div class="ttname"><a href="../../d8/d93/structem__timer__res__param__t.html#a94b92c7b60c5a8cd9ac357b488292fa4">em_timer_res_param_t::min_tmo</a></div><div class="ttdeci">uint64_t min_tmo</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00289">api/event_machine_timer.h:289</a></div></div>
<div class="ttc" id="astructem__timer__res__param__t_html_ab8065c326f16df1abfbb756ae50038cb"><div class="ttname"><a href="../../d8/d93/structem__timer__res__param__t.html#ab8065c326f16df1abfbb756ae50038cb">em_timer_res_param_t::res_hz</a></div><div class="ttdeci">uint64_t res_hz</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00287">api/event_machine_timer.h:287</a></div></div>
<div class="ttc" id="astructem__timer__res__param__t_html_abb8211175d76213b77c952c1608fbded"><div class="ttname"><a href="../../d8/d93/structem__timer__res__param__t.html#abb8211175d76213b77c952c1608fbded">em_timer_res_param_t::max_tmo</a></div><div class="ttdeci">uint64_t max_tmo</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00291">api/event_machine_timer.h:291</a></div></div>
<div class="ttc" id="astructem__timer__timeout__t_html"><div class="ttname"><a href="../../dd/d32/structem__timer__timeout__t.html">em_timer_timeout_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d2f/em__timer__types_8h_source.html#l00076">em_timer_types.h:76</a></div></div>
<div class="ttc" id="astructem__tmo__stats__t_html"><div class="ttname"><a href="../../dc/dd0/structem__tmo__stats__t.html">em_tmo_stats_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00370">api/event_machine_timer.h:370</a></div></div>
<div class="ttc" id="astructem__tmo__stats__t_html_a35394de2a812bdc005b79a6a132aa235"><div class="ttname"><a href="../../dc/dd0/structem__tmo__stats__t.html#a35394de2a812bdc005b79a6a132aa235">em_tmo_stats_t::num_late_ack</a></div><div class="ttdeci">uint64_t num_late_ack</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00374">api/event_machine_timer.h:374</a></div></div>
<div class="ttc" id="astructem__tmo__stats__t_html_a989f8e63270acdbf23e715e7ebe7ce23"><div class="ttname"><a href="../../dc/dd0/structem__tmo__stats__t.html#a989f8e63270acdbf23e715e7ebe7ce23">em_tmo_stats_t::num_acks</a></div><div class="ttdeci">uint64_t num_acks</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00372">api/event_machine_timer.h:372</a></div></div>
<div class="ttc" id="astructem__tmo__stats__t_html_ad518945885276d7c1b1fe1e4d9023367"><div class="ttname"><a href="../../dc/dd0/structem__tmo__stats__t.html#ad518945885276d7c1b1fe1e4d9023367">em_tmo_stats_t::num_period_skips</a></div><div class="ttdeci">uint64_t num_period_skips</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00376">api/event_machine_timer.h:376</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
  <div id="footer" class="tabs">
   <div class="headertitle"> 
     &copy; 2017 Nokia Networks
   </div>
  </div>
 </body>
</html>
