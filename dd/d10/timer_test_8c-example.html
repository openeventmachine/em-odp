<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EM-ODP: timer_test.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doc-stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EM-ODP
   &#160;<span id="projectnumber">3.8.0-1</span>
   </div>
   <div id="projectbrief">Event Machine on ODP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('dd/d10/timer_test_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">timer_test.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> *   Copyright (c) 2017-2020, Nokia Solutions and Networks</span></div>
<div class="line"><span class="comment"> *   All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> *   modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment"> *   are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer in the</span></div>
<div class="line"><span class="comment"> *       documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment"> *     * Neither the name of the copyright holder nor the names of its</span></div>
<div class="line"><span class="comment"> *       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment"> *       from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment"> *   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment"> *   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment"> *   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment"> *   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment"> *   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment"> *   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment"> *   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @file</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Event Machine timer basic test.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Simple test for timer (does not test everything). Creates and deletes random</span></div>
<div class="line"><span class="comment"> * timers and checks how accurate the timeout indications are against timer</span></div>
<div class="line"><span class="comment"> * itself and also linux time (clock_gettime). Single EO, but receiving queue</span></div>
<div class="line"><span class="comment"> * is parallel so multiple threads can process timeouts concurrently.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Exception/error management is simplified and aborts on most errors.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#ifndef _GNU_SOURCE</span></div>
<div class="line"><span class="preprocessor">#define _GNU_SOURCE</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;limits.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdatomic.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d5e/event__machine_8h.html">event_machine.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/d26/environment_8h.html">event_machine/platform/env/environment.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;cm_setup.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;cm_error_handler.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define TEST_VERSION &quot;v1.4&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Test app defines.</span></div>
<div class="line"><span class="comment"> * Be careful, conflicting values may not be checked!</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#define APP_TIMER_RESOLUTION_US 1000 </span><span class="comment">/* requested em-timer resolution */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_TIMEOUT_MAX_US      (10000ULL * 1000ULL) </span><span class="comment">/* max random timeout */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_TIMEOUT_MIN_US      5000 </span><span class="comment">/* minimum random timeout */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_MAX_TMOS            1000 </span><span class="comment">/* simultaneous oneshots */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_MAX_PERIODIC        300  </span><span class="comment">/* simultaneous periodic */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_PRINT_EACH_TMO      0 </span><span class="comment">/* 0 to only print summary */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_PRINT_DOTS          1 </span><span class="comment">/* visual progress dots */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_VISUAL_DEBUG        0 </span><span class="comment">/* 0|1, for testing only. Slow, but visual */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_EXTRA_PRINTS        0 </span><span class="comment">/* debugging helper */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_PER_CANCEL_CHK      0 </span><span class="comment">/* do not use yet, WIP */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define APP_SHMEM_NAME          &quot;TimerTestShMem&quot;</span></div>
<div class="line"><span class="preprocessor">#define APP_HEARTBEAT_MS        2000 </span><span class="comment">/* heartbeat tick period */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_CHECK_COUNT         (APP_TIMEOUT_MAX_US / 1000 / APP_HEARTBEAT_MS)</span></div>
<div class="line"><span class="preprocessor">#define APP_CHECK_LIMIT         (3 * (APP_CHECK_COUNT + 1)) </span><span class="comment">/* num HB */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_CHECK_GUARD         6 </span><span class="comment">/* num HB */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define APP_CANCEL_MODULO_P     (APP_MAX_PERIODIC * 50) </span><span class="comment">/* cancel probability */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_CANCEL_MODULO       (APP_MAX_TMOS * 5) </span><span class="comment">/* cancel probability */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_CANCEL_MARGIN_NS    100000 </span><span class="comment">/* check limit for cancel fail ok */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_LINUX_CLOCK_SRC     CLOCK_MONOTONIC </span><span class="comment">/* for clock_gettime */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_INCREASING_DLY      7 </span><span class="comment">/* if not 0, add this to increasing</span></div>
<div class="line"><span class="comment">                                   * delay before calling periodic timer ack</span></div>
<div class="line"><span class="comment">                                   */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define APP_INC_DLY_MODULO      15 </span><span class="comment">/* apply increasing delay to every Nth tmo */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if APP_VISUAL_DEBUG</span></div>
<div class="line"><span class="preprocessor">#define VISUAL_DBG(x)           APPL_PRINT(x)</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#define VISUAL_DBG(x)           do {} while (0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define APP_EO_NAME             &quot;Test EO&quot;</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Test application message event</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> app_cmd_t {</div>
<div class="line">        APP_CMD_HEARTBEAT,</div>
<div class="line">        APP_CMD_TMO_SINGLE,</div>
<div class="line">        APP_CMD_TMO_PERIODIC</div>
<div class="line">} app_cmd_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>app_msg_t {</div>
<div class="line">        app_cmd_t command;</div>
<div class="line">        <span class="keywordtype">int</span> index;</div>
<div class="line">        <span class="keywordtype">int</span> dummy_delay;</div>
<div class="line">} app_msg_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>app_tmo_data_t {</div>
<div class="line">        <a name="_a0"></a><a class="code" href="../../dd/d32/structem__timer__timeout__t.html">em_tmo_t</a> tmo <a name="a1"></a><a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">        em_event_t event;</div>
<div class="line">        <a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a> when;</div>
<div class="line">        <a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a> howmuch;</div>
<div class="line">        <a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a> appeared;</div>
<div class="line">        <span class="keyword">struct </span>timespec linux_when;</div>
<div class="line">        <span class="keyword">struct </span>timespec linux_appeared;</div>
<div class="line">        <a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a> canceled;       <span class="comment">/* acts as flag, but also stores tick when done */</span></div>
<div class="line">        <a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a> waitevt;        <span class="comment">/* acts as flag, but also stores tick when done */</span></div>
<div class="line">        atomic_flag lock;               <span class="comment">/* used when adding timestamps or cancelling */</span></div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_dummy;</div>
<div class="line">} app_tmo_data_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> app_test_state_t {</div>
<div class="line">        APP_STATE_IDLE = 0,</div>
<div class="line">        APP_STATE_RUNNING,</div>
<div class="line">        APP_STATE_STOPPING,</div>
<div class="line">        APP_STATE_CHECKING</div>
<div class="line">} app_test_state_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *dot_marks = <span class="stringliteral">&quot; .-#&quot;</span>; <span class="comment">/* per state above */</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * EO context</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Shared data. Concurrently manipulated fields use C atomics</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>app_eo_ctx_t {</div>
<div class="line">        <a class="code" href="../../dd/d32/structem__timer__timeout__t.html">em_tmo_t</a> heartbeat_tmo;</div>
<div class="line">        uint64_t heartbeat_count;</div>
<div class="line">        uint64_t heartbeat_target;</div>
<div class="line">        em_queue_t my_q;</div>
<div class="line">        em_queue_t my_prio_q;</div>
<div class="line">        uint64_t hz;</div>
<div class="line">        uint64_t linux_hz;</div>
<div class="line">        uint64_t rounds;</div>
<div class="line">        <span class="keywordtype">int</span> nocancel;</div>
<div class="line"> </div>
<div class="line">        atomic_int state;</div>
<div class="line">        atomic_uint errors;</div>
<div class="line">        atomic_uint ack_errors;</div>
<div class="line"> </div>
<div class="line">        int64_t min_diff;</div>
<div class="line">        int64_t max_diff;</div>
<div class="line">        int64_t min_diff_l;</div>
<div class="line">        int64_t max_diff_l;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_dummy;</div>
<div class="line">        uint64_t min_tmo;</div>
<div class="line">        uint64_t res_ns;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">struct </span>{</div>
<div class="line">                app_tmo_data_t tmo[APP_MAX_TMOS];</div>
<div class="line"> </div>
<div class="line">                atomic_uint_fast64_t received <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">                atomic_uint_fast64_t cancelled;</div>
<div class="line">                atomic_uint_fast64_t cancel_fail;</div>
<div class="line">        } oneshot;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">struct </span>{</div>
<div class="line">                app_tmo_data_t tmo[APP_MAX_PERIODIC];</div>
<div class="line"> </div>
<div class="line">                atomic_uint_fast64_t received <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">                atomic_uint_fast64_t cancelled;</div>
<div class="line">                atomic_uint_fast64_t cancel_fail;</div>
<div class="line">        } periodic;</div>
<div class="line">} app_eo_ctx_t;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Timer test shared memory data</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>timer_app_shm_t {</div>
<div class="line">        <span class="comment">/* Event pool used by this application */</span></div>
<div class="line">        em_pool_t pool;</div>
<div class="line">        <span class="comment">/* EO context data */</span></div>
<div class="line">        app_eo_ctx_t eo_context;</div>
<div class="line">        <span class="comment">/* Event timer handle */</span></div>
<div class="line">        em_timer_t tmr;</div>
<div class="line">        <span class="comment">/* Pad size to a multiple of cache line size */</span></div>
<div class="line">        <span class="keywordtype">void</span> *end[0] <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">} timer_app_shm_t;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* EM-thread locals */</span></div>
<div class="line"><span class="keyword">static</span> <a name="a2"></a><a class="code" href="../../de/d26/environment_8h.html#a2b2462b2491461a5c14adb1eb4493a8c">ENV_LOCAL</a> timer_app_shm_t *m_shm;</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../de/d26/environment_8h.html#a2b2462b2491461a5c14adb1eb4493a8c">ENV_LOCAL</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m_randseed;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Local function prototypes */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> app_eo_start(<span class="keywordtype">void</span> *eo_context, em_eo_t eo,</div>
<div class="line">                                <span class="keyword">const</span> <a name="_a3"></a><a class="code" href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a> *conf);</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> app_eo_start_local(<span class="keywordtype">void</span> *eo_context, em_eo_t eo);</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> app_eo_stop(<span class="keywordtype">void</span> *eo_context, em_eo_t eo);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_eo_receive(<span class="keywordtype">void</span> *eo_context, em_event_t event,</div>
<div class="line">                           <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> type, em_queue_t queue,</div>
<div class="line">                           <span class="keywordtype">void</span> *q_context);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a> rand_timeout(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *seed, app_eo_ctx_t *eo_ctx,</div>
<div class="line">                                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fixed);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> set_timeouts(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> start_test(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> check_test(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> stop_test(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> cleanup_test(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> int64_t ts_diff_ns(<span class="keyword">struct</span> timespec *ts1, <span class="keyword">struct</span> timespec *ts2);</div>
<div class="line"><span class="keyword">static</span> int64_t tick_diff_ns(<a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a> t1, <a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a> t2,</div>
<div class="line">                            uint64_t hz);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> random_cancel(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> em_event_t random_cancel_periodic(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> check_single(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> check_periodic(app_eo_ctx_t *eo_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> dummy_processing(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> us);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> handle_periodic_event(app_eo_ctx_t *eo_ctx, em_event_t event,</div>
<div class="line">                                 app_msg_t *msgin);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> handle_single_event(app_eo_ctx_t *eo_ctx, em_event_t event,</div>
<div class="line">                                app_msg_t *msgin);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> handle_heartbeat(app_eo_ctx_t *eo_ctx, em_queue_t queue);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Main function</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Call cm_setup() to perform test &amp; EM setup common for all the</span></div>
<div class="line"><span class="comment"> * test applications.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * cm_setup() will call test_init() and test_start() and launch</span></div>
<div class="line"><span class="comment"> * the EM dispatch loop on every EM-core.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">return</span> cm_setup(argc, argv);</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Local EO error handler. Prevents error when ack() is done after cancel()</span></div>
<div class="line"><span class="comment"> * since it&#39;s normal here.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param eo            Execution object id</span></div>
<div class="line"><span class="comment"> * @param error         The error code</span></div>
<div class="line"><span class="comment"> * @param escope        Error scope</span></div>
<div class="line"><span class="comment"> * @param args          List of arguments (__FILE__, __func__, __LINE__,</span></div>
<div class="line"><span class="comment"> *                                         (format), ## __VA_ARGS__)</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return The original error code.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> eo_error_handler(em_eo_t eo, <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> error,</div>
<div class="line">                                    <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0c0a929399ae33b615f8ca8018d2a69d">em_escope_t</a> escope, va_list args)</div>
<div class="line">{</div>
<div class="line">        VISUAL_DBG(<span class="stringliteral">&quot;E&quot;</span>);</div>
<div class="line">        atomic_fetch_add_explicit(&amp;m_shm-&gt;eo_context.errors, 1, memory_order_relaxed);</div>
<div class="line">        <span class="keywordflow">return</span> test_error_handler(eo, error, escope, args);</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Before EM - Init of the test application.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The shared memory is needed if EM instance runs on multiple processes.</span></div>
<div class="line"><span class="comment"> * Doing it like this makes it possible to run the app both as threads (-t)</span></div>
<div class="line"><span class="comment"> * as well as processes (-p).</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @attention Run on all cores.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @see cm_setup() for setup and dispatch.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> test_init(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        (void)appl_conf;</div>
<div class="line">        <span class="keywordtype">int</span> core = <a name="a4"></a><a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* first core creates ShMem */</span></div>
<div class="line">        <span class="keywordflow">if</span> (core == 0) {</div>
<div class="line">                m_shm = env_shared_reserve(APP_SHMEM_NAME,</div>
<div class="line">                                           <span class="keyword">sizeof</span>(timer_app_shm_t));</div>
<div class="line">                <span class="comment">/* initialize it */</span></div>
<div class="line">                <span class="keywordflow">if</span> (m_shm)</div>
<div class="line">                        memset(m_shm, 0, <span class="keyword">sizeof</span>(timer_app_shm_t));</div>
<div class="line"> </div>
<div class="line">                <a name="a5"></a><a class="code" href="../../db/da0/group__em__error.html#gaf7332965c5deaa69411136e8d36089c6">em_register_error_handler</a>(test_error_handler);</div>
<div class="line">                <span class="keywordflow">if</span> (APP_EXTRA_PRINTS)</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;%ldk shared memory for app context\n&quot;</span>,</div>
<div class="line">                                   <span class="keyword">sizeof</span>(timer_app_shm_t) / 1000);</div>
<div class="line"> </div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                m_shm = env_shared_lookup(APP_SHMEM_NAME);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (m_shm == NULL) {</div>
<div class="line">                test_error(<a name="a6"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                           <span class="stringliteral">&quot;ShMem init failed on EM-core: %u&quot;</span>,</div>
<div class="line">                           <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>());</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;core %d: %s done\n&quot;</span>, core, __func__);</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Startup of the timer test EM application.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * At this point EM is up, but no EOs exist. EM API can be used to create</span></div>
<div class="line"><span class="comment"> * queues, EOs etc.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @attention Run only on one EM core.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param appl_conf Application configuration</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @see cm_setup() for setup and dispatch.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> test_start(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        em_eo_t eo;</div>
<div class="line">        <a name="_a7"></a><a class="code" href="../../d4/d00/structem__timer__attr__t.html">em_timer_attr_t</a> attr;</div>
<div class="line">        <a name="_a8"></a><a class="code" href="../../d8/d93/structem__timer__res__param__t.html">em_timer_res_param_t</a> resparam;</div>
<div class="line">        em_queue_t queue;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> stat;</div>
<div class="line">        app_eo_ctx_t *eo_ctx;</div>
<div class="line">        em_event_t event;</div>
<div class="line">        app_msg_t *msg;</div>
<div class="line">        <span class="keyword">struct </span>timespec ts;</div>
<div class="line">        uint64_t period;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Store the event pool to use, use the EM default pool if no other</span></div>
<div class="line"><span class="comment">         * pool is provided through the appl_conf.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">if</span> (appl_conf-&gt;num_pools &gt;= 1)</div>
<div class="line">                m_shm-&gt;pool = appl_conf-&gt;pools[0];</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                m_shm-&gt;pool = <a name="a9"></a><a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a>;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;***********************************************************\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;EM APPLICATION: &#39;%s&#39; initializing:\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;  %s: %s() - EM-core:%d\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;  Application running on %u EM-cores (procs:%u, threads:%u)\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;  using event pool:%&quot;</span> <a name="a10"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a5f1ebfb654b7ec3169e068aa3776ff79">PRI_POOL</a> <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;***********************************************************\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">                   appl_conf-&gt;name, NO_PATH(__FILE__), __func__, <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>(),</div>
<div class="line">                   appl_conf-&gt;core_count, appl_conf-&gt;num_procs, appl_conf-&gt;num_threads,</div>
<div class="line">                   m_shm-&gt;pool);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(m_shm-&gt;pool == <a name="a11"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a67fed61187c93569c92da0647970a29f">EM_POOL_UNDEF</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;Undefined application event pool!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Create EO */</span></div>
<div class="line">        eo_ctx = &amp;m_shm-&gt;eo_context;</div>
<div class="line">        eo = <a name="a12"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga196c7caa1177575fd424e9a0d2854da6">em_eo_create</a>(APP_EO_NAME, app_eo_start, app_eo_start_local,</div>
<div class="line">                          app_eo_stop, NULL, app_eo_receive, eo_ctx);</div>
<div class="line">        test_fatal_if(eo == <a name="a13"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#af28fb8daf62b942ced417e158ed7e1c7">EM_EO_UNDEF</a>, <span class="stringliteral">&quot;Failed to create EO!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* atomic queue for control */</span></div>
<div class="line">        queue = <a name="a14"></a><a class="code" href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a>(<span class="stringliteral">&quot;Control Q&quot;</span>,</div>
<div class="line">                                <a name="a15"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965a43e0ef6f7a63caf0b225a52412ef3032">EM_QUEUE_TYPE_ATOMIC</a>,</div>
<div class="line">                                <a name="a16"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca">EM_QUEUE_PRIO_NORMAL</a>,</div>
<div class="line">                                <a name="a17"></a><a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a>, NULL);</div>
<div class="line">        stat = <a name="a18"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a>(eo, queue);</div>
<div class="line">        test_fatal_if(stat != <a name="a19"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Failed to create queue!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        eo_ctx-&gt;my_q = queue;</div>
<div class="line">        <span class="comment">/* another parallel high priority for timeout handling*/</span></div>
<div class="line">        queue = <a class="code" href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a>(<span class="stringliteral">&quot;Tmo Q&quot;</span>,</div>
<div class="line">                                <a name="a20"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea">EM_QUEUE_TYPE_PARALLEL</a>,</div>
<div class="line">                                <a name="a21"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa621ca7c9a90044e11dad3060006dc450">EM_QUEUE_PRIO_HIGHEST</a>,</div>
<div class="line">                                <a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a>, NULL);</div>
<div class="line">        stat = <a class="code" href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a>(eo, queue);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Failed to create queue!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        eo_ctx-&gt;my_prio_q = queue;</div>
<div class="line"> </div>
<div class="line">        stat = <a name="a22"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga1020917f6061bf56da36773946eece72">em_eo_register_error_handler</a>(eo, eo_error_handler);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Failed to register EO error handler&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* create shared timer and store handle in</span></div>
<div class="line"><span class="comment">         * shared memory. Require the configured app values</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <a name="a23"></a><a class="code" href="../../de/dc2/group__em__timer.html#gad6023dd3c79d0a45221d9245c604c2e3">em_timer_attr_init</a>(&amp;attr);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* going to change resolution, so need to check limits */</span></div>
<div class="line">        memset(&amp;resparam, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d93/structem__timer__res__param__t.html">em_timer_res_param_t</a>));</div>
<div class="line">        resparam.<a name="a24"></a><a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">res_ns</a> = APP_TIMER_RESOLUTION_US * 1000ULL;</div>
<div class="line">        stat = <a name="a25"></a><a class="code" href="../../de/dc2/group__em__timer.html#gafe76b458292862809030194da9462b4c">em_timer_res_capability</a>(&amp;resparam, <a name="a26"></a><a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#ad2afe10951c01b6511a18d9e82f2c0a3">EM_TIMER_CLKSRC_DEFAULT</a>);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Timer does not support the resolution&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        strncpy(attr.<a name="a27"></a><a class="code" href="../../d4/d00/structem__timer__attr__t.html#a03fc2b0569742931ed610f0bd1af43ad">name</a>, <span class="stringliteral">&quot;TestTimer&quot;</span>, EM_TIMER_NAME_LEN);</div>
<div class="line">        attr.<a name="a28"></a><a class="code" href="../../d4/d00/structem__timer__attr__t.html#ae6afcdeed8fe620636b1f0391f908afc">num_tmo</a> = APP_MAX_TMOS + APP_MAX_PERIODIC + 1;</div>
<div class="line">        attr.<a name="a29"></a><a class="code" href="../../d4/d00/structem__timer__attr__t.html#adf7a24e643b381f39fec354caf5a4bc0">resparam</a> = resparam;</div>
<div class="line">        attr.<a class="code" href="../../d4/d00/structem__timer__attr__t.html#adf7a24e643b381f39fec354caf5a4bc0">resparam</a>.<a name="a30"></a><a class="code" href="../../d8/d93/structem__timer__res__param__t.html#ab8065c326f16df1abfbb756ae50038cb">res_hz</a> = 0;</div>
<div class="line">        m_shm-&gt;tmr = <a name="a31"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga56968bda0ecacf996d6ce623e3e372ab">em_timer_create</a>(&amp;attr);</div>
<div class="line">        test_fatal_if(m_shm-&gt;tmr == <a name="a32"></a><a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#aa373a94a9084c3bd6c5b23ac6bd6b176">EM_TIMER_UNDEF</a>, <span class="stringliteral">&quot;Failed to create timer!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        eo_ctx-&gt;min_tmo = resparam.<a name="a33"></a><a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a94b92c7b60c5a8cd9ac357b488292fa4">min_tmo</a>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Start EO */</span></div>
<div class="line">        stat = <a name="a34"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gabe4f7a789ec9523367c086793061562d">em_eo_start_sync</a>(eo, NULL, NULL);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Failed to start EO!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* create periodic timeout for heartbeat */</span></div>
<div class="line">        eo_ctx-&gt;heartbeat_tmo = <a name="a35"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga4fc3dd338b784ce9b122eeb3fbf4ea07">em_tmo_create</a>(m_shm-&gt;tmr, <a name="a36"></a><a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#gaade0f99e694a2f999abe467bc05fde61aac8e81389e6feaf233eff357c4ece5f0">EM_TMO_FLAG_PERIODIC</a>,</div>
<div class="line">                                              eo_ctx-&gt;my_q);</div>
<div class="line">        test_fatal_if(eo_ctx-&gt;heartbeat_tmo == <a name="a37"></a><a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;Can&#39;t allocate heartbeat_tmo!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">event</span> = <a name="a38"></a><a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(app_msg_t), <a name="a39"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>, m_shm-&gt;pool);</div>
<div class="line">        test_fatal_if(event == <a name="a40"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>, <span class="stringliteral">&quot;Can&#39;t allocate event (%ldB)!\n&quot;</span>,</div>
<div class="line">                      <span class="keyword">sizeof</span>(app_msg_t));</div>
<div class="line"> </div>
<div class="line">        msg = <a name="a41"></a><a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line">        msg-&gt;command = APP_CMD_HEARTBEAT;</div>
<div class="line">        eo_ctx-&gt;hz = <a name="a42"></a><a class="code" href="../../de/dc2/group__em__timer.html#gae97b08e2b1468de76a7d92342a5860ed">em_timer_get_freq</a>(m_shm-&gt;tmr);</div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;hz &lt; 100)</div>
<div class="line">                APPL_ERROR(<span class="stringliteral">&quot;WARNING - timer hz very low!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* linux time check */</span></div>
<div class="line">        test_fatal_if(clock_getres(APP_LINUX_CLOCK_SRC, &amp;ts) != 0,</div>
<div class="line">                      <span class="stringliteral">&quot;clock_getres() failed!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        period = ts.tv_nsec + (ts.tv_sec * 1000000000ULL);</div>
<div class="line">        eo_ctx-&gt;linux_hz = 1000000000ULL / period;</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Linux reports clock running at %&quot;</span> PRIu64 <span class="stringliteral">&quot; hz\n&quot;</span>, eo_ctx-&gt;linux_hz);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* start heartbeat, will later start the test */</span></div>
<div class="line">        period = (APP_HEARTBEAT_MS * eo_ctx-&gt;hz) / 1000;</div>
<div class="line">        test_fatal_if(period &lt; 1, <span class="stringliteral">&quot;timer resolution is too low!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        stat = <a name="a43"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga8f1f88a05b9e366f3b31447dead90b5e">em_tmo_set_periodic</a>(eo_ctx-&gt;heartbeat_tmo, 0, period, event);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;Can&#39;t activate heartbeat tmo!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%s done, test repetition interval %ds\n\n&quot;</span>, __func__,</div>
<div class="line">                   (<span class="keywordtype">int</span>)((APP_HEARTBEAT_MS * APP_CHECK_LIMIT) / 1000));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test_stop(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line">        em_eo_t eo;</div>
<div class="line"> </div>
<div class="line">        (void)appl_conf;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%s() on EM-core %d\n&quot;</span>, __func__, core);</div>
<div class="line"> </div>
<div class="line">        eo = <a name="a44"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga9ac21d82f671fff3e31e83410e72d406">em_eo_find</a>(APP_EO_NAME);</div>
<div class="line">        test_fatal_if(eo == <a class="code" href="../../d4/d11/event__machine__types_8h.html#af28fb8daf62b942ced417e158ed7e1c7">EM_EO_UNDEF</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;Could not find EO:%s&quot;</span>, APP_EO_NAME);</div>
<div class="line"> </div>
<div class="line">        ret = <a name="a45"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gadce026621953114bd26e5836d9693465">em_eo_stop_sync</a>(eo);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO:%&quot;</span> <a name="a46"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; stop:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>, eo, ret);</div>
<div class="line"> </div>
<div class="line">        ret = <a name="a47"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga2bac1530b021bbbd1f0f924414c2485e">em_timer_delete</a>(m_shm-&gt;tmr);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;Timer:%&quot;</span> <a name="a48"></a><a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#a31cd14adb32c94ed0f2e27d263ad6eb1">PRI_TMR</a> <span class="stringliteral">&quot; delete:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                      m_shm-&gt;tmr, ret);</div>
<div class="line"> </div>
<div class="line">        ret = <a name="a49"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gae769b19e613b24487beb943cfb926977">em_eo_delete</a>(eo);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; delete:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>, eo, ret);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test_term(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        (void)appl_conf;</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%s() on EM-core %d\n&quot;</span>, __func__, <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>());</div>
<div class="line">        <span class="keywordflow">if</span> (m_shm != NULL) {</div>
<div class="line">                env_shared_free(m_shm);</div>
<div class="line">                m_shm = NULL;</div>
<div class="line">                <a name="a50"></a><a class="code" href="../../db/da0/group__em__error.html#gab6b469100e5f60670a742d944a6f530b">em_unregister_error_handler</a>();</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO start function.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> app_eo_start(<span class="keywordtype">void</span> *eo_context, em_eo_t eo,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code" href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a> *conf)</div>
<div class="line">{</div>
<div class="line">        app_eo_ctx_t *<span class="keyword">const</span> eo_ctx = eo_context;</div>
<div class="line">        <a class="code" href="../../d4/d00/structem__timer__attr__t.html">em_timer_attr_t</a> attr;</div>
<div class="line">        em_timer_t tmr;</div>
<div class="line">        <span class="keywordtype">int</span> num_timers;</div>
<div class="line"> </div>
<div class="line">        (void)eo;</div>
<div class="line">        (void)conf;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;timer_test %s\n&quot;</span>, TEST_VERSION);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;EO start\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        num_timers = <a name="a51"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga25b88dbbb772090d6caa5622c7017889">em_timer_get_all</a>(&amp;tmr, 1);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;System has %d timer(s)\n&quot;</span>, num_timers);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (APP_EXTRA_PRINTS) {</div>
<div class="line">                <span class="keywordflow">if</span> (__atomic_always_lock_free(<span class="keyword">sizeof</span>(uint64_t), NULL))</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;64b atomics are lock-free\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;64b atomics may use locks\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a52"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga01e680281f0ae40bce6c6786fc0bcdc3">em_timer_get_attr</a>(m_shm-&gt;tmr, &amp;attr) != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>) {</div>
<div class="line">                APPL_ERROR(<span class="stringliteral">&quot;Can&#39;t get timer info\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> <a name="a53"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a740919266fbb41b8a8127a9ef215eea0a5d88fb8b70a4b3edf790b3d650e7213e">EM_ERR_BAD_ID</a>;</div>
<div class="line">        }</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Timer \&quot;%s\&quot; info:\n&quot;</span>, attr.<a class="code" href="../../d4/d00/structem__timer__attr__t.html#a03fc2b0569742931ed610f0bd1af43ad">name</a>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;  -resolution: %&quot;</span> PRIu64 <span class="stringliteral">&quot; ns\n&quot;</span>, attr.<a class="code" href="../../d4/d00/structem__timer__attr__t.html#adf7a24e643b381f39fec354caf5a4bc0">resparam</a>.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">res_ns</a>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;  -max_tmo: %&quot;</span> PRIu64 <span class="stringliteral">&quot; ms\n&quot;</span>, attr.<a class="code" href="../../d4/d00/structem__timer__attr__t.html#adf7a24e643b381f39fec354caf5a4bc0">resparam</a>.<a name="a54"></a><a class="code" href="../../d8/d93/structem__timer__res__param__t.html#abb8211175d76213b77c952c1608fbded">max_tmo</a> / 1000);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;  -num_tmo: %d\n&quot;</span>, attr.<a class="code" href="../../d4/d00/structem__timer__attr__t.html#ae6afcdeed8fe620636b1f0391f908afc">num_tmo</a>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;  -clk_src: %d\n&quot;</span>, attr.<a class="code" href="../../d4/d00/structem__timer__attr__t.html#adf7a24e643b381f39fec354caf5a4bc0">resparam</a>.<a name="a55"></a><a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a07ed3b3b2e89e83ca36fb2efbc731c45">clk_src</a>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;  -tick Hz: %&quot;</span> PRIu64 <span class="stringliteral">&quot; hz\n&quot;</span>,</div>
<div class="line">                   <a class="code" href="../../de/dc2/group__em__timer.html#gae97b08e2b1468de76a7d92342a5860ed">em_timer_get_freq</a>(m_shm-&gt;tmr));</div>
<div class="line"> </div>
<div class="line">        eo_ctx-&gt;res_ns = attr.<a class="code" href="../../d4/d00/structem__timer__attr__t.html#adf7a24e643b381f39fec354caf5a4bc0">resparam</a>.<a class="code" href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">res_ns</a>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (APP_INCREASING_DLY) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;Using increasing processing delay (%d, 1/%d)\n&quot;</span>,</div>
<div class="line">                           APP_INCREASING_DLY, APP_INC_DLY_MODULO);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* init other local EO context */</span></div>
<div class="line">        eo_ctx-&gt;min_diff = INT64_MAX;</div>
<div class="line">        eo_ctx-&gt;max_diff = 0;</div>
<div class="line">        eo_ctx-&gt;min_diff_l = INT64_MAX;</div>
<div class="line">        eo_ctx-&gt;max_diff_l = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO per thread start function.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> app_eo_start_local(<span class="keywordtype">void</span> *eo_context, em_eo_t eo)</div>
<div class="line">{</div>
<div class="line">        app_eo_ctx_t *<span class="keyword">const</span> eo_ctx = eo_context;</div>
<div class="line"> </div>
<div class="line">        (void)eo_ctx;</div>
<div class="line">        (void)eo;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* per-thread random seed */</span></div>
<div class="line">        m_randseed = time(NULL);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO stop function.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> app_eo_stop(<span class="keywordtype">void</span> *eo_context, em_eo_t eo)</div>
<div class="line">{</div>
<div class="line">        app_eo_ctx_t *<span class="keyword">const</span> eo_ctx = eo_context;</div>
<div class="line">        em_event_t <span class="keyword">event</span> = <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;EO stop\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;heartbeat_tmo != <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>) {</div>
<div class="line">                <span class="keywordflow">if</span> (<a name="a56"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga66476f77546996eea9acebaa471c1b52">em_tmo_get_state</a>(eo_ctx-&gt;heartbeat_tmo) == <a name="a57"></a><a class="code" href="../../de/dc2/group__em__timer.html#gga3857ab06946e6b4047352d5d84ffff4daa54abf62265d1c2beaeeadb6a1ee240f">EM_TMO_STATE_ACTIVE</a>)</div>
<div class="line">                        <a name="a58"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga786f0cc89e9bdfda1c1274165600f0ef">em_tmo_cancel</a>(eo_ctx-&gt;heartbeat_tmo, &amp;event);</div>
<div class="line"> </div>
<div class="line">                <a name="a59"></a><a class="code" href="../../de/dc2/group__em__timer.html#ga67d2db5f72ccdd285649ce05b0a22a92">em_tmo_delete</a>(eo_ctx-&gt;heartbeat_tmo);</div>
<div class="line"> </div>
<div class="line">                eo_ctx-&gt;heartbeat_tmo = <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (event != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>)</div>
<div class="line">                        <a name="a60"></a><a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        cleanup_test(eo_ctx);</div>
<div class="line"> </div>
<div class="line">        ret = <a name="a61"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga10cf8094caa56026eb0a402d3d22da23">em_eo_remove_queue_all_sync</a>(eo, <a name="a62"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a419c8373b72a8c5ed1c3e3ded3e262e0">EM_TRUE</a>);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO remove queue all:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                      ret, eo);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO receive function. Runs the example test app after initialization.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_eo_receive(<span class="keywordtype">void</span> *eo_context, em_event_t event,</div>
<div class="line">                           <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> type, em_queue_t queue,</div>
<div class="line">                           <span class="keywordtype">void</span> *q_context)</div>
<div class="line">{</div>
<div class="line">        app_eo_ctx_t *<span class="keyword">const</span> eo_ctx = eo_context;</div>
<div class="line">        <span class="keywordtype">int</span> reuse = 0;</div>
<div class="line"> </div>
<div class="line">        (void)q_context;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (unlikely(appl_shm-&gt;exit_flag)) {</div>
<div class="line">                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        VISUAL_DBG(<span class="stringliteral">&quot;e&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (type == <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>) {</div>
<div class="line">                app_msg_t *msgin = (app_msg_t *)<a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">switch</span> (msgin-&gt;command) {</div>
<div class="line">                <span class="keywordflow">case</span> APP_CMD_HEARTBEAT: <span class="comment">/* uses atomic queue */</span></div>
<div class="line">                        VISUAL_DBG(<span class="stringliteral">&quot;H&quot;</span>);</div>
<div class="line">                        handle_heartbeat(eo_ctx, queue);</div>
<div class="line">                        <span class="keywordflow">if</span> (<a name="a63"></a><a class="code" href="../../de/dc2/group__em__timer.html#gaf65f50c383b579720a31154b04ea610e">em_tmo_ack</a>(eo_ctx-&gt;heartbeat_tmo, event) != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                                test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                                           <span class="stringliteral">&quot;Heartbeat ack() failed!\n&quot;</span>);</div>
<div class="line">                        reuse = 1;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> APP_CMD_TMO_SINGLE: <span class="comment">/* parallel queue */</span></div>
<div class="line">                        VISUAL_DBG(<span class="stringliteral">&quot;s&quot;</span>);</div>
<div class="line">                        <span class="keywordflow">if</span> (queue != eo_ctx-&gt;my_prio_q)</div>
<div class="line">                                test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                                           <span class="stringliteral">&quot;tmo from wrong queue!\n&quot;</span>);</div>
<div class="line">                        handle_single_event(eo_ctx, event, msgin);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> APP_CMD_TMO_PERIODIC: <span class="comment">/* parallel queue */</span></div>
<div class="line">                        VISUAL_DBG(<span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line">                        <span class="keywordflow">if</span> (queue != eo_ctx-&gt;my_prio_q)</div>
<div class="line">                                test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                                           <span class="stringliteral">&quot;tmo from wrong queue!\n&quot;</span>);</div>
<div class="line">                        reuse = handle_periodic_event(eo_ctx, event, msgin);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                        test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                                   <span class="stringliteral">&quot;Invalid event received!\n&quot;</span>);</div>
<div class="line">                }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                           <span class="stringliteral">&quot;Invalid event type received!\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!reuse)</div>
<div class="line">                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handle_single_event(app_eo_ctx_t *eo_ctx, em_event_t event,</div>
<div class="line">                         app_msg_t *msgin)</div>
<div class="line">{</div>
<div class="line">        (void)event;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* not expecting oneshot after run state */</span></div>
<div class="line">        <span class="keywordflow">if</span> (atomic_load_explicit(&amp;eo_ctx-&gt;state, memory_order_acquire) != APP_STATE_RUNNING) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;ERR: Tmo received after test finish\n&quot;</span>);</div>
<div class="line">                eo_ctx-&gt;errors++;</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (msgin-&gt;index &lt; 0 || msgin-&gt;index &gt;= APP_MAX_TMOS) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;ERR: tmo index out of range. Corrupted event?\n&quot;</span>);</div>
<div class="line">                eo_ctx-&gt;errors++;</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;oneshot.tmo[msgin-&gt;index].appeared) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;ERR: Single Tmo received twice\n&quot;</span>);</div>
<div class="line">                eo_ctx-&gt;errors++;</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* lock tmo to avoid race with random cancel by another core */</span></div>
<div class="line">        <span class="keywordflow">while</span> (atomic_flag_test_and_set_explicit(&amp;eo_ctx-&gt;oneshot.tmo[msgin-&gt;index].lock,</div>
<div class="line">                                                 memory_order_acquire))</div>
<div class="line">                ;</div>
<div class="line"> </div>
<div class="line">        eo_ctx-&gt;oneshot.tmo[msgin-&gt;index].appeared = <a name="a64"></a><a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;tmr);</div>
<div class="line">        clock_gettime(APP_LINUX_CLOCK_SRC, &amp;eo_ctx-&gt;oneshot.tmo[msgin-&gt;index].linux_appeared);</div>
<div class="line">        atomic_flag_clear_explicit(&amp;eo_ctx-&gt;oneshot.tmo[msgin-&gt;index].lock, memory_order_release);</div>
<div class="line">        atomic_fetch_add_explicit(&amp;eo_ctx-&gt;oneshot.received, 1, memory_order_relaxed);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!eo_ctx-&gt;nocancel)</div>
<div class="line">                random_cancel(eo_ctx);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> handle_periodic_event(app_eo_ctx_t *eo_ctx, em_event_t event,</div>
<div class="line">                          app_msg_t *msgin)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> reuse = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (msgin-&gt;index &lt; 0 || msgin-&gt;index &gt;= APP_MAX_PERIODIC) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;ERR: Periodic tmo index out of range\n&quot;</span>);</div>
<div class="line">                eo_ctx-&gt;errors++;</div>
<div class="line">                <span class="keywordflow">return</span> reuse;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordtype">int</span> state = atomic_load_explicit(&amp;eo_ctx-&gt;state, memory_order_acquire);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (state != APP_STATE_RUNNING &amp;&amp; state != APP_STATE_STOPPING) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;ERR: Periodic tmo received after test finish\n&quot;</span>);</div>
<div class="line">                eo_ctx-&gt;errors++;</div>
<div class="line">                <span class="keywordflow">return</span> reuse;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">while</span> (atomic_flag_test_and_set_explicit(&amp;eo_ctx-&gt;periodic.tmo[msgin-&gt;index].lock,</div>
<div class="line">                                                 memory_order_acquire))</div>
<div class="line">                ;</div>
<div class="line"> </div>
<div class="line">        eo_ctx-&gt;periodic.tmo[msgin-&gt;index].appeared = <a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;tmr);</div>
<div class="line">        atomic_flag_clear_explicit(&amp;eo_ctx-&gt;periodic.tmo[msgin-&gt;index].lock, memory_order_release);</div>
<div class="line">        atomic_fetch_add_explicit(&amp;eo_ctx-&gt;periodic.received, 1, memory_order_relaxed);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* periodic tmo may keep coming a while after end of round */</span></div>
<div class="line">        <span class="keywordflow">if</span> (atomic_load_explicit(&amp;eo_ctx-&gt;state, memory_order_acquire) == APP_STATE_STOPPING)</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">        reuse = 1;</div>
<div class="line">        <span class="keywordflow">if</span> (APP_INCREASING_DLY &amp;&amp; msgin-&gt;dummy_delay) {</div>
<div class="line">                <span class="comment">/* add delay before ack() to test late ack */</span></div>
<div class="line">                dummy_processing(msgin-&gt;dummy_delay);</div>
<div class="line">                msgin-&gt;dummy_delay += APP_INCREASING_DLY;</div>
<div class="line">                eo_ctx-&gt;periodic.tmo[msgin-&gt;index].max_dummy = msgin-&gt;dummy_delay;</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret = <a class="code" href="../../de/dc2/group__em__timer.html#gaf65f50c383b579720a31154b04ea610e">em_tmo_ack</a>(eo_ctx-&gt;periodic.tmo[msgin-&gt;index].tmo, event);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ret == <a name="a65"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a740919266fbb41b8a8127a9ef215eea0a5e2e63f7ddf4a916caa09f43a07d9fb3">EM_ERR_CANCELED</a>) {</div>
<div class="line">                <span class="keywordflow">if</span> (!eo_ctx-&gt;periodic.tmo[msgin-&gt;index].canceled &amp;&amp;</div>
<div class="line">                    !eo_ctx-&gt;periodic.tmo[msgin-&gt;index].waitevt) {</div>
<div class="line">                        eo_ctx-&gt;ack_errors++;</div>
<div class="line">                        reuse = 0;</div>
<div class="line">                }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">if</span> (ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>) {</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;em_tmo_ack error:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;\n&quot;</span>, ret);</div>
<div class="line">                        eo_ctx-&gt;ack_errors++;</div>
<div class="line">                        reuse = 0;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (!eo_ctx-&gt;nocancel) {</div>
<div class="line">                <span class="keywordflow">if</span> (random_cancel_periodic(eo_ctx) == event)</div>
<div class="line">                        reuse = 1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> reuse;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* handle beartbeat, i.e. run state machine */</span></div>
<div class="line"><span class="keywordtype">void</span> handle_heartbeat(app_eo_ctx_t *eo_ctx, em_queue_t queue)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (queue != eo_ctx-&gt;my_q) {</div>
<div class="line">                test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                           <span class="stringliteral">&quot;heartbeat from wrong queue!\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        eo_ctx-&gt;heartbeat_count++;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (APP_PRINT_DOTS) {</div>
<div class="line">                <span class="keywordtype">char</span> ch = dot_marks[eo_ctx-&gt;state];</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (ch != <span class="charliteral">&#39; &#39;</span>)</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;%c&quot;</span>, ch);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* reached next state change */</span></div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;heartbeat_count &gt;= eo_ctx-&gt;heartbeat_target) {</div>
<div class="line">                <span class="keywordflow">switch</span> (atomic_load_explicit(&amp;eo_ctx-&gt;state, memory_order_acquire)) {</div>
<div class="line">                <span class="keywordflow">case</span> APP_STATE_IDLE:</div>
<div class="line">                        start_test(eo_ctx);</div>
<div class="line">                        eo_ctx-&gt;heartbeat_target = eo_ctx-&gt;heartbeat_count + APP_CHECK_LIMIT;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> APP_STATE_RUNNING:</div>
<div class="line">                        stop_test(eo_ctx);</div>
<div class="line">                        eo_ctx-&gt;heartbeat_target = eo_ctx-&gt;heartbeat_count + APP_CHECK_GUARD;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> APP_STATE_STOPPING:</div>
<div class="line">                        check_test(eo_ctx);</div>
<div class="line">                        eo_ctx-&gt;heartbeat_target = eo_ctx-&gt;heartbeat_count + APP_CHECK_GUARD;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> APP_STATE_CHECKING:</div>
<div class="line">                        cleanup_test(eo_ctx);</div>
<div class="line">                        eo_ctx-&gt;heartbeat_target = eo_ctx-&gt;heartbeat_count + APP_CHECK_GUARD;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* new random timeout APP_TIMEOUT_MIN_US ... APP_TIMEOUT_MAX_US in ticks */</span></div>
<div class="line"><a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a> rand_timeout(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *seed, app_eo_ctx_t *eo_ctx,</div>
<div class="line">                             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fixed)</div>
<div class="line">{</div>
<div class="line">        uint64_t us;</div>
<div class="line">        <span class="keywordtype">double</span> tick_ns = 1000000000.0 / (double)eo_ctx-&gt;hz;</div>
<div class="line"> </div>
<div class="line">        if (fixed) {</div>
<div class="line">                us = fixed;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                us = (uint64_t)rand_r(seed) % (APP_TIMEOUT_MAX_US - APP_TIMEOUT_MIN_US + 1);</div>
<div class="line">                us += APP_TIMEOUT_MIN_US;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> (<a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a>)((double)us * 1000.0 / tick_ns);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* start new batch of random timeouts */</span></div>
<div class="line"><span class="keywordtype">void</span> set_timeouts(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        app_msg_t *msg;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        uint64_t t1, t2;</div>
<div class="line">        <span class="keyword">struct </span>timespec ts1, ts2;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* timeouts allocate new events every time (could reuse old ones).</span></div>
<div class="line"><span class="comment">         * Do this first so we can time just the tmo creation</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; APP_MAX_TMOS; i++) {</div>
<div class="line">                em_event_t <span class="keyword">event</span> = <a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(app_msg_t), <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>,</div>
<div class="line">                                            m_shm-&gt;pool);</div>
<div class="line">                <span class="keywordflow">if</span> (event == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>)</div>
<div class="line">                        test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                                   <span class="stringliteral">&quot;Can&#39;t allocate event nr %d!&quot;</span>, i + 1);</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* prepare as timeout event */</span></div>
<div class="line">                msg = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line">                msg-&gt;command = APP_CMD_TMO_SINGLE;</div>
<div class="line">                msg-&gt;index = i;</div>
<div class="line">                msg-&gt;dummy_delay = 0;</div>
<div class="line">                memset(&amp;eo_ctx-&gt;oneshot.tmo[i], 0, <span class="keyword">sizeof</span>(app_tmo_data_t));</div>
<div class="line">                eo_ctx-&gt;oneshot.tmo[i].event = event;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        t1 = <a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;tmr);</div>
<div class="line">        clock_gettime(APP_LINUX_CLOCK_SRC, &amp;ts1);</div>
<div class="line">        <span class="comment">/* allocate new tmos every time (could reuse) */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; APP_MAX_TMOS; i++) {</div>
<div class="line">                <a class="code" href="../../dd/d32/structem__timer__timeout__t.html">em_tmo_t</a> tmo = <a class="code" href="../../de/dc2/group__em__timer.html#ga4fc3dd338b784ce9b122eeb3fbf4ea07">em_tmo_create</a>(m_shm-&gt;tmr, <a name="a66"></a><a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#gaade0f99e694a2f999abe467bc05fde61a8e5343b756922a7d6527d8ddff10ff14">EM_TMO_FLAG_ONESHOT</a>,</div>
<div class="line">                                             eo_ctx-&gt;my_prio_q);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (unlikely(tmo == <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>))</div>
<div class="line">                        test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                                   <span class="stringliteral">&quot;Can&#39;t allocate tmo nr %d!&quot;</span>, i + 1);</div>
<div class="line"> </div>
<div class="line">                eo_ctx-&gt;oneshot.tmo[i].tmo = tmo;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        t2 = <a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;tmr);</div>
<div class="line">        clock_gettime(APP_LINUX_CLOCK_SRC, &amp;ts2);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Timer: Creating %d timeouts took %&quot;</span> PRIu64 <span class="stringliteral">&quot; ns (%&quot;</span> PRIu64</div>
<div class="line">                   <span class="stringliteral">&quot; ns each)\n&quot;</span>, i,</div>
<div class="line">                   tick_diff_ns(t1, t2, eo_ctx-&gt;hz),</div>
<div class="line">                   tick_diff_ns(t1, t2, eo_ctx-&gt;hz) / APP_MAX_TMOS);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Linux: Creating %d timeouts took %&quot;</span> PRIu64 <span class="stringliteral">&quot; ns (%&quot;</span> PRIu64</div>
<div class="line">                   <span class="stringliteral">&quot; ns each)\n&quot;</span>, i, ts_diff_ns(&amp;ts1, &amp;ts2),</div>
<div class="line">                   ts_diff_ns(&amp;ts1, &amp;ts2) / APP_MAX_TMOS);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* start them all. Some might be served before this loop ends! */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; APP_MAX_TMOS; i++) {</div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fixed = 0;</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* always test min and max tmo */</span></div>
<div class="line">                <span class="keywordflow">if</span> (i == 0)</div>
<div class="line">                        fixed = APP_TIMEOUT_MAX_US;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 1)</div>
<div class="line">                        fixed = APP_TIMEOUT_MIN_US;</div>
<div class="line"> </div>
<div class="line">                eo_ctx-&gt;oneshot.tmo[i].howmuch = rand_timeout(&amp;m_randseed,</div>
<div class="line">                                                              eo_ctx, fixed);</div>
<div class="line">                eo_ctx-&gt;oneshot.tmo[i].when = <a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;tmr);</div>
<div class="line">                clock_gettime(APP_LINUX_CLOCK_SRC,</div>
<div class="line">                              &amp;eo_ctx-&gt;oneshot.tmo[i].linux_when);</div>
<div class="line">                <span class="keywordflow">if</span> (<a name="a67"></a><a class="code" href="../../de/dc2/group__em__timer.html#gabe6b4e51cd71d86d0e60534ba00cbac2">em_tmo_set_rel</a>(eo_ctx-&gt;oneshot.tmo[i].tmo,</div>
<div class="line">                                   eo_ctx-&gt;oneshot.tmo[i].howmuch,</div>
<div class="line">                                   eo_ctx-&gt;oneshot.tmo[i].event) != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                        test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                                   <span class="stringliteral">&quot;Can&#39;t activate tmo!\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (APP_MAX_TMOS)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;Started single shots\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* then periodic */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; APP_MAX_PERIODIC; i++) {</div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fixed = 0;</div>
<div class="line"> </div>
<div class="line">                em_event_t <span class="keyword">event</span> = <a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(app_msg_t), <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>,</div>
<div class="line">                                            m_shm-&gt;pool);</div>
<div class="line">                <span class="keywordflow">if</span> (event == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>)</div>
<div class="line">                        test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                                   <span class="stringliteral">&quot;Can&#39;t allocate event!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                msg = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line">                msg-&gt;command = APP_CMD_TMO_PERIODIC;</div>
<div class="line">                msg-&gt;index = i;</div>
<div class="line">                msg-&gt;dummy_delay = (i % APP_INC_DLY_MODULO) ?</div>
<div class="line">                                    0 : APP_INCREASING_DLY;</div>
<div class="line">                memset(&amp;eo_ctx-&gt;periodic.tmo[i], 0, <span class="keyword">sizeof</span>(app_tmo_data_t));</div>
<div class="line">                eo_ctx-&gt;periodic.tmo[i].event = event;</div>
<div class="line"> </div>
<div class="line">                <a class="code" href="../../dd/d32/structem__timer__timeout__t.html">em_tmo_t</a> tmo = <a class="code" href="../../de/dc2/group__em__timer.html#ga4fc3dd338b784ce9b122eeb3fbf4ea07">em_tmo_create</a>(m_shm-&gt;tmr, <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#gaade0f99e694a2f999abe467bc05fde61aac8e81389e6feaf233eff357c4ece5f0">EM_TMO_FLAG_PERIODIC</a>,</div>
<div class="line">                                             eo_ctx-&gt;my_prio_q);</div>
<div class="line">                <span class="keywordflow">if</span> (unlikely(tmo == <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>))</div>
<div class="line">                        test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                                   <span class="stringliteral">&quot;Can&#39;t allocate periodic tmo nr %d!&quot;</span>, i + 1);</div>
<div class="line">                eo_ctx-&gt;periodic.tmo[i].tmo = tmo;</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* always test min and max tmo */</span></div>
<div class="line">                <span class="keywordflow">if</span> (i == 0)</div>
<div class="line">                        fixed = APP_TIMEOUT_MAX_US;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 1)</div>
<div class="line">                        fixed = APP_TIMEOUT_MIN_US;</div>
<div class="line">                eo_ctx-&gt;periodic.tmo[i].howmuch = rand_timeout(&amp;m_randseed,</div>
<div class="line">                                                               eo_ctx, fixed);</div>
<div class="line">                eo_ctx-&gt;periodic.tmo[i].when = <a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;tmr);</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="../../de/dc2/group__em__timer.html#ga8f1f88a05b9e366f3b31447dead90b5e">em_tmo_set_periodic</a>(eo_ctx-&gt;periodic.tmo[i].tmo,</div>
<div class="line">                                        0,</div>
<div class="line">                                        eo_ctx-&gt;periodic.tmo[i].howmuch,</div>
<div class="line">                                        eo_ctx-&gt;periodic.tmo[i].event) != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                        test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                                   <span class="stringliteral">&quot;Can&#39;t activate periodic tmo nr %d!\n&quot;</span>, i + 1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (APP_MAX_PERIODIC)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;Started periodic\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> start_test(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        eo_ctx-&gt;oneshot.received = 0;</div>
<div class="line">        eo_ctx-&gt;oneshot.cancelled = 0;</div>
<div class="line">        eo_ctx-&gt;oneshot.cancel_fail = 0;</div>
<div class="line"> </div>
<div class="line">        eo_ctx-&gt;periodic.received = 0;</div>
<div class="line">        eo_ctx-&gt;periodic.cancelled = 0;</div>
<div class="line">        eo_ctx-&gt;periodic.cancel_fail = 0;</div>
<div class="line"> </div>
<div class="line">        time_t t = time(NULL);</div>
<div class="line">        <span class="keyword">struct </span>tm *tm = localtime(&amp;t);</div>
<div class="line">        <span class="keywordtype">char</span> s[40];</div>
<div class="line"> </div>
<div class="line">        strftime(s, <span class="keyword">sizeof</span>(s), <span class="stringliteral">&quot;%b-%d %H:%M:%S&quot;</span>, tm);</div>
<div class="line">        eo_ctx-&gt;rounds++;</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\n\n%s ROUND %&quot;</span> PRIu64 <span class="stringliteral">&quot; ************\n&quot;</span>,</div>
<div class="line">                   s, eo_ctx-&gt;rounds);</div>
<div class="line"> </div>
<div class="line">        eo_ctx-&gt;nocancel = 1;</div>
<div class="line">        <span class="comment">/* do this before starting tmo as some could be received while still here */</span></div>
<div class="line">        atomic_store_explicit(&amp;eo_ctx-&gt;state, APP_STATE_RUNNING, memory_order_release);</div>
<div class="line"> </div>
<div class="line">        set_timeouts(eo_ctx);   <span class="comment">/* timeouts start coming */</span></div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Running\n&quot;</span>);</div>
<div class="line">        eo_ctx-&gt;nocancel = 0;   <span class="comment">/* after all timeouts are completely created */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> stop_test(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        em_event_t event;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* test assumes all oneshots are received,</span></div>
<div class="line"><span class="comment">         * but this will stop possible periodic timeout processing</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        atomic_store_explicit(&amp;eo_ctx-&gt;state, APP_STATE_STOPPING, memory_order_release);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* cancel ongoing periodic */</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; APP_MAX_PERIODIC; i++) {</div>
<div class="line">                <span class="keyword">event</span> = <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>;</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* lock tmo to avoid race with possible unfinished random cancel */</span></div>
<div class="line">                <span class="keywordflow">while</span> (atomic_flag_test_and_set_explicit(&amp;eo_ctx-&gt;periodic.tmo[i].lock,</div>
<div class="line">                                                         memory_order_acquire))</div>
<div class="line">                        ;</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* double cancel is an error */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!eo_ctx-&gt;periodic.tmo[i].canceled &amp;&amp; !eo_ctx-&gt;periodic.tmo[i].waitevt) {</div>
<div class="line">                        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret = <a class="code" href="../../de/dc2/group__em__timer.html#ga786f0cc89e9bdfda1c1274165600f0ef">em_tmo_cancel</a>(eo_ctx-&gt;periodic.tmo[i].tmo, &amp;event);</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span> (ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a> &amp;&amp; ret != <a name="a68"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a740919266fbb41b8a8127a9ef215eea0ae173e1529a1b79dedd05c6eb5d15e24c">EM_ERR_TOONEAR</a>) {</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;%s: cancel returned %u!\n&quot;</span>, __func__, ret);</div>
<div class="line">                                eo_ctx-&gt;errors++;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">                atomic_flag_clear_explicit(&amp;eo_ctx-&gt;periodic.tmo[i].lock, memory_order_release);</div>
<div class="line">                <span class="keywordflow">if</span> (event != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>)</div>
<div class="line">                        <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> cleanup_test(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        uint64_t t1, t2;</div>
<div class="line">        <span class="keyword">struct </span>timespec ts1, ts2;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\nCleaning up\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        t1 = <a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;tmr);</div>
<div class="line">        clock_gettime(APP_LINUX_CLOCK_SRC, &amp;ts1);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; APP_MAX_TMOS; i++) {</div>
<div class="line">                em_event_t evt = <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (eo_ctx-&gt;oneshot.tmo[i].tmo == <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>)</div>
<div class="line">                        <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="../../de/dc2/group__em__timer.html#ga66476f77546996eea9acebaa471c1b52">em_tmo_get_state</a>(eo_ctx-&gt;oneshot.tmo[i].tmo) == <a class="code" href="../../de/dc2/group__em__timer.html#gga3857ab06946e6b4047352d5d84ffff4daa54abf62265d1c2beaeeadb6a1ee240f">EM_TMO_STATE_ACTIVE</a>)</div>
<div class="line">                        <a class="code" href="../../de/dc2/group__em__timer.html#ga786f0cc89e9bdfda1c1274165600f0ef">em_tmo_cancel</a>(eo_ctx-&gt;oneshot.tmo[i].tmo, &amp;evt);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="../../de/dc2/group__em__timer.html#ga67d2db5f72ccdd285649ce05b0a22a92">em_tmo_delete</a>(eo_ctx-&gt;oneshot.tmo[i].tmo) != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                        test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                                   <span class="stringliteral">&quot;Can&#39;t free tmo!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                eo_ctx-&gt;oneshot.tmo[i].tmo = <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (evt != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a> &amp;&amp; !appl_shm-&gt;exit_flag) {</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;WARN - tmo_delete returned event,\n&quot;</span></div>
<div class="line">                                   <span class="stringliteral">&quot;       should be received or canceled!\n&quot;</span>);</div>
<div class="line">                        <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(evt);</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        t2 = <a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;tmr);</div>
<div class="line">        clock_gettime(APP_LINUX_CLOCK_SRC, &amp;ts2);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Timer: Deleting %d timeouts took %&quot;</span> PRIu64</div>
<div class="line">                   <span class="stringliteral">&quot; ns (%&quot;</span> PRIu64 <span class="stringliteral">&quot; ns each)\n&quot;</span>, i,</div>
<div class="line">                   tick_diff_ns(t1, t2, eo_ctx-&gt;hz),</div>
<div class="line">                   tick_diff_ns(t1, t2, eo_ctx-&gt;hz) / APP_MAX_TMOS);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Linux: Deleting %d timeouts took %&quot;</span> PRIu64 <span class="stringliteral">&quot; ns (%&quot;</span> PRIu64</div>
<div class="line">                   <span class="stringliteral">&quot; ns each)\n&quot;</span>, i, ts_diff_ns(&amp;ts1, &amp;ts2),</div>
<div class="line">                   ts_diff_ns(&amp;ts1, &amp;ts2) / APP_MAX_TMOS);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; APP_MAX_PERIODIC; i++) {</div>
<div class="line">                em_event_t evt = <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (eo_ctx-&gt;periodic.tmo[i].tmo == <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>)</div>
<div class="line">                        <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="../../de/dc2/group__em__timer.html#ga66476f77546996eea9acebaa471c1b52">em_tmo_get_state</a>(eo_ctx-&gt;periodic.tmo[i].tmo) == <a class="code" href="../../de/dc2/group__em__timer.html#gga3857ab06946e6b4047352d5d84ffff4daa54abf62265d1c2beaeeadb6a1ee240f">EM_TMO_STATE_ACTIVE</a>)</div>
<div class="line">                        <a class="code" href="../../de/dc2/group__em__timer.html#ga786f0cc89e9bdfda1c1274165600f0ef">em_tmo_cancel</a>(eo_ctx-&gt;periodic.tmo[i].tmo, &amp;evt);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="../../de/dc2/group__em__timer.html#ga67d2db5f72ccdd285649ce05b0a22a92">em_tmo_delete</a>(eo_ctx-&gt;periodic.tmo[i].tmo) != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                        test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xDEAD), 0xBEEF,</div>
<div class="line">                                   <span class="stringliteral">&quot;Can&#39;t delete periodic tmo!\n&quot;</span>);</div>
<div class="line">                eo_ctx-&gt;periodic.tmo[i].tmo = <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (evt != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>)</div>
<div class="line">                        <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(evt);</div>
<div class="line">        }</div>
<div class="line">        atomic_store_explicit(&amp;eo_ctx-&gt;state, APP_STATE_IDLE, memory_order_release);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> check_test(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> errors;</div>
<div class="line"> </div>
<div class="line">        atomic_store_explicit(&amp;eo_ctx-&gt;state, APP_STATE_CHECKING, memory_order_release);</div>
<div class="line">        eo_ctx-&gt;nocancel = 1;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\nHeartbeat count %&quot;</span> PRIu64 <span class="stringliteral">&quot;\n&quot;</span>, eo_ctx-&gt;heartbeat_count);</div>
<div class="line"> </div>
<div class="line">        errors = check_single(eo_ctx);</div>
<div class="line">        errors += check_periodic(eo_ctx);</div>
<div class="line">        eo_ctx-&gt;errors += errors;</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Errors: %u\n\n&quot;</span>, errors);</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;TOTAL RUNTIME/US: min %&quot;</span> PRIi64 <span class="stringliteral">&quot;, max %&quot;</span> PRIi64 <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">                   tick_diff_ns(0, eo_ctx-&gt;min_diff, eo_ctx-&gt;hz) / 1000,</div>
<div class="line">                   tick_diff_ns(0, eo_ctx-&gt;max_diff, eo_ctx-&gt;hz) / 1000);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;TOTAL RUNTIME LINUX/US: min %&quot;</span> PRIi64 <span class="stringliteral">&quot;, max %&quot;</span> PRIi64 <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">                   eo_ctx-&gt;min_diff_l / 1000, eo_ctx-&gt;max_diff_l / 1000);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;TOTAL ERRORS: %u\n&quot;</span>, eo_ctx-&gt;errors);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;TOTAL ACK FAILS (OK): %u\n&quot;</span>, eo_ctx-&gt;ack_errors);</div>
<div class="line">        <span class="keywordflow">if</span> (APP_INCREASING_DLY)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;TOTAL MAX DUMMY PROCESSING/US: %u\n&quot;</span>,</div>
<div class="line">                           eo_ctx-&gt;max_dummy);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* timespec diff to ns */</span></div>
<div class="line">int64_t ts_diff_ns(<span class="keyword">struct</span> timespec *ts1, <span class="keyword">struct</span> timespec *ts2)</div>
<div class="line">{</div>
<div class="line">        uint64_t t1 = ts1-&gt;tv_nsec + (ts1-&gt;tv_sec * 1000000000ULL);</div>
<div class="line">        uint64_t t2 = ts2-&gt;tv_nsec + (ts2-&gt;tv_sec * 1000000000ULL);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> (t2 - t1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* timer tick diff to ns */</span></div>
<div class="line">int64_t tick_diff_ns(<a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a> t1, <a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a> t2, uint64_t hz)</div>
<div class="line">{</div>
<div class="line">        int64_t ticks = (int64_t)t2 - (int64_t)t1;</div>
<div class="line">        <span class="keywordtype">double</span> tick_ns = 1000000000.0 / (double)hz;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> (int64_t)((double)ticks * tick_ns);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> random_cancel(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = (<span class="keywordtype">unsigned</span> int)rand_r(&amp;m_randseed) %</div>
<div class="line">                           (APP_CANCEL_MODULO ? APP_CANCEL_MODULO : 1);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (idx &gt;= APP_MAX_TMOS || idx == 0)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* This is tricky as we&#39;re possibly canceling a timeout that might be under work</span></div>
<div class="line"><span class="comment">         * on another core, so lock tmo state before trying cancel to avoid race</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">while</span> (atomic_flag_test_and_set_explicit(&amp;eo_ctx-&gt;oneshot.tmo[idx].lock,</div>
<div class="line">                                                 memory_order_acquire))</div>
<div class="line">                ;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!eo_ctx-&gt;oneshot.tmo[idx].canceled &amp;&amp; !eo_ctx-&gt;oneshot.tmo[idx].waitevt &amp;&amp;</div>
<div class="line">            eo_ctx-&gt;oneshot.tmo[idx].tmo != <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>) {</div>
<div class="line">                <span class="comment">/* try to cancel (Tmo might have been fired already) */</span></div>
<div class="line">                em_event_t evt = <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>;</div>
<div class="line">                <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> retval;</div>
<div class="line">                <a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a> now;</div>
<div class="line"> </div>
<div class="line">                retval = <a class="code" href="../../de/dc2/group__em__timer.html#ga786f0cc89e9bdfda1c1274165600f0ef">em_tmo_cancel</a>(eo_ctx-&gt;oneshot.tmo[idx].tmo, &amp;evt);</div>
<div class="line">                now = <a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;tmr);</div>
<div class="line">                <span class="keywordflow">if</span> (retval == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>) {</div>
<div class="line">                        eo_ctx-&gt;oneshot.tmo[idx].canceled = now;</div>
<div class="line">                        eo_ctx-&gt;oneshot.cancelled++;</div>
<div class="line">                        <span class="keywordflow">if</span> (evt == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>) { <span class="comment">/* cancel ok but no event returned */</span></div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;ERR: cancel ok but no event!\n&quot;</span>);</div>
<div class="line">                                eo_ctx-&gt;errors++;</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">if</span> (eo_ctx-&gt;oneshot.tmo[idx].appeared) {</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;ERR: cancel ok after event received!\n&quot;</span>);</div>
<div class="line">                                eo_ctx-&gt;errors++;</div>
<div class="line">                        }</div>
<div class="line">                } <span class="keywordflow">else</span> { <span class="comment">/* cancel fail, too late */</span></div>
<div class="line">                        eo_ctx-&gt;oneshot.cancel_fail += 1;</div>
<div class="line">                        <span class="keywordflow">if</span> (evt != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>) { <span class="comment">/* cancel fail but event returned */</span></div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;ERR: cancel fail but event return (rv %u)!\n&quot;</span>, retval);</div>
<div class="line">                                eo_ctx-&gt;errors++;</div>
<div class="line">                        } <span class="keywordflow">else</span> { <span class="comment">/* event should appear later */</span></div>
<div class="line">                                eo_ctx-&gt;oneshot.tmo[idx].waitevt = now;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (evt != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>) <span class="comment">/* cancelled in time, free event */</span></div>
<div class="line">                        <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(evt);</div>
<div class="line"> </div>
<div class="line">                VISUAL_DBG(<span class="stringliteral">&quot;c&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        atomic_flag_clear_explicit(&amp;eo_ctx-&gt;oneshot.tmo[idx].lock, memory_order_release);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">em_event_t random_cancel_periodic(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = ((<span class="keywordtype">unsigned</span> int)rand_r(&amp;m_randseed)) %</div>
<div class="line">                           (APP_CANCEL_MODULO_P ? APP_CANCEL_MODULO_P : 1);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (idx &gt;= APP_MAX_PERIODIC || idx == 0)</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* lock tmo state before trying cancel to avoid race on receive */</span></div>
<div class="line">        <span class="keywordflow">while</span> (atomic_flag_test_and_set_explicit(&amp;eo_ctx-&gt;periodic.tmo[idx].lock,</div>
<div class="line">                                                 memory_order_acquire))</div>
<div class="line">                ;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!eo_ctx-&gt;periodic.tmo[idx].canceled &amp;&amp; !eo_ctx-&gt;periodic.tmo[idx].waitevt &amp;&amp;</div>
<div class="line">            eo_ctx-&gt;periodic.tmo[idx].tmo != <a class="code" href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a>) {</div>
<div class="line">                <span class="comment">/* try to cancel (Tmo might have been fired already) */</span></div>
<div class="line">                em_event_t evt = <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="../../de/dc2/group__em__timer.html#ga786f0cc89e9bdfda1c1274165600f0ef">em_tmo_cancel</a>(eo_ctx-&gt;periodic.tmo[idx].tmo, &amp;evt) == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>) {</div>
<div class="line">                        eo_ctx-&gt;periodic.tmo[idx].canceled = <a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;tmr);</div>
<div class="line">                        eo_ctx-&gt;periodic.cancelled++;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                        eo_ctx-&gt;periodic.cancel_fail++;</div>
<div class="line">                        <span class="keywordflow">if</span> (evt == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>) {<span class="comment">/* cancel failed, event should appear */</span></div>
<div class="line">                                eo_ctx-&gt;periodic.tmo[idx].waitevt =</div>
<div class="line">                                        <a class="code" href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a>(m_shm-&gt;tmr);</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">                eo_ctx-&gt;periodic.tmo[idx].appeared = 0;</div>
<div class="line">                VISUAL_DBG(<span class="stringliteral">&quot;C&quot;</span>);</div>
<div class="line">                <span class="keywordflow">if</span> (evt != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>) {</div>
<div class="line">                        atomic_flag_clear_explicit(&amp;eo_ctx-&gt;periodic.tmo[idx].lock,</div>
<div class="line">                                                   memory_order_release);</div>
<div class="line">                        <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(evt);</div>
<div class="line">                        <span class="keywordflow">return</span> evt; <span class="comment">/* to skip wrong free in receive */</span></div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        atomic_flag_clear_explicit(&amp;eo_ctx-&gt;periodic.tmo[idx].lock, memory_order_release);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> check_single(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> errors = 0;</div>
<div class="line">        int64_t min_diff = INT64_MAX;</div>
<div class="line">        int64_t max_diff = 0;</div>
<div class="line">        int64_t avg_diff = 0;</div>
<div class="line">        int64_t min_linux = INT64_MAX;</div>
<div class="line">        int64_t max_linux = 0;</div>
<div class="line">        int64_t avg_linux = 0;</div>
<div class="line">        <span class="keyword">struct </span>timespec zerot;</div>
<div class="line"> </div>
<div class="line">        memset(&amp;zerot, 0, <span class="keyword">sizeof</span>(zerot)); <span class="comment">/* 0 to use diff*/</span></div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;ONESHOT:\n&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Received: %&quot;</span> PRIu64 <span class="stringliteral">&quot;, expected %lu\n&quot;</span>,</div>
<div class="line">                   eo_ctx-&gt;oneshot.received,</div>
<div class="line">                   APP_MAX_TMOS - eo_ctx-&gt;oneshot.cancelled);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Cancelled OK: %&quot;</span> PRIu64 <span class="stringliteral">&quot;\n&quot;</span>, eo_ctx-&gt;oneshot.cancelled);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Cancel failed (too late): %&quot;</span> PRIu64 <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">                   eo_ctx-&gt;oneshot.cancel_fail);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; APP_MAX_TMOS; i++) {</div>
<div class="line">                <span class="comment">/* missing any? */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!eo_ctx-&gt;oneshot.tmo[i].canceled &amp;&amp; !eo_ctx-&gt;oneshot.tmo[i].waitevt &amp;&amp;</div>
<div class="line">                    !eo_ctx-&gt;oneshot.tmo[i].appeared) {</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot; ERR: TMO %d event missing!\n&quot;</span>, i);</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;    - to %lu ticks\n&quot;</span>, eo_ctx-&gt;oneshot.tmo[i].howmuch);</div>
<div class="line">                        errors++;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* calculate timing */</span></div>
<div class="line">                <span class="keywordflow">if</span> (eo_ctx-&gt;oneshot.tmo[i].appeared) {</div>
<div class="line">                        <span class="comment">/* timer ticks */</span></div>
<div class="line">                        uint64_t target = eo_ctx-&gt;oneshot.tmo[i].when +</div>
<div class="line">                                        eo_ctx-&gt;oneshot.tmo[i].howmuch;</div>
<div class="line">                        int64_t diff = (int64_t)eo_ctx-&gt;oneshot.tmo[i].appeared - (int64_t)target;</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span> (APP_PRINT_EACH_TMO)</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;Timeout #%u: diff %&quot;</span> PRIi64</div>
<div class="line">                                                <span class="stringliteral">&quot; ticks\n&quot;</span>, i + 1, diff);</div>
<div class="line">                        <span class="keywordflow">if</span> (min_diff &gt; diff)</div>
<div class="line">                                min_diff = diff;</div>
<div class="line">                        <span class="keywordflow">if</span> (max_diff &lt; diff)</div>
<div class="line">                                max_diff = diff;</div>
<div class="line">                        avg_diff += diff;</div>
<div class="line"> </div>
<div class="line">                        <span class="comment">/* linux time in ns*/</span></div>
<div class="line">                        int64_t ldiff;</div>
<div class="line"> </div>
<div class="line">                        ldiff = tick_diff_ns(0, eo_ctx-&gt;oneshot.tmo[i].howmuch, eo_ctx-&gt;hz);</div>
<div class="line">                        target = ts_diff_ns(&amp;zerot, &amp;eo_ctx-&gt;oneshot.tmo[i].linux_when) + ldiff;</div>
<div class="line">                        diff = (int64_t)ts_diff_ns(&amp;zerot, &amp;eo_ctx-&gt;oneshot.tmo[i].linux_appeared)</div>
<div class="line">                                        - (int64_t)target;</div>
<div class="line">                        <span class="keywordflow">if</span> (APP_PRINT_EACH_TMO)</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;Timeout #%d: diff %&quot;</span> PRIi64</div>
<div class="line">                                                <span class="stringliteral">&quot; linux ns\n&quot;</span>, i + 1, diff);</div>
<div class="line">                        <span class="keywordflow">if</span> (min_linux &gt; diff)</div>
<div class="line">                                min_linux = diff;</div>
<div class="line">                        <span class="keywordflow">if</span> (max_linux &lt; diff)</div>
<div class="line">                                max_linux = diff;</div>
<div class="line">                        avg_linux += diff;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* canceled ok but still appeared */</span></div>
<div class="line">                <span class="keywordflow">if</span> (eo_ctx-&gt;oneshot.tmo[i].canceled &amp;&amp; eo_ctx-&gt;oneshot.tmo[i].appeared) {</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot; ERR: TMO %d cancel ok but event appeared!\n&quot;</span>, i);</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;  - expire %lu, cancel ok at %lu\n&quot;</span>,</div>
<div class="line">                                   eo_ctx-&gt;oneshot.tmo[i].when,</div>
<div class="line">                                   eo_ctx-&gt;oneshot.tmo[i].canceled);</div>
<div class="line">                        errors++;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* cancel failed as too late, but event did not appear */</span></div>
<div class="line">                <span class="keywordflow">if</span> (eo_ctx-&gt;oneshot.tmo[i].waitevt &amp;&amp; !eo_ctx-&gt;oneshot.tmo[i].appeared) {</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot; ERR: TMO %d cancel fail but event never appeared!\n&quot;</span>, i);</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;  - expire %lu, cancel fail at %lu\n&quot;</span>,</div>
<div class="line">                                   eo_ctx-&gt;oneshot.tmo[i].when,</div>
<div class="line">                                   eo_ctx-&gt;oneshot.tmo[i].waitevt);</div>
<div class="line">                        errors++;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* cancel failed but should have succeeded? */</span></div>
<div class="line">                <span class="keywordflow">if</span> (eo_ctx-&gt;oneshot.tmo[i].waitevt) {</div>
<div class="line">                        <a class="code" href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a> exp_tick = eo_ctx-&gt;oneshot.tmo[i].when +</div>
<div class="line">                                                   eo_ctx-&gt;oneshot.tmo[i].howmuch;</div>
<div class="line">                        int64_t diff = tick_diff_ns(eo_ctx-&gt;oneshot.tmo[i].waitevt, exp_tick,</div>
<div class="line">                                                    eo_ctx-&gt;hz);</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span> (diff &gt; (int64_t)eo_ctx-&gt;min_tmo +</div>
<div class="line">                            (int64_t)eo_ctx-&gt;res_ns + APP_CANCEL_MARGIN_NS) {</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;ERR: cancel should have worked, &quot;</span>);</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;%ldns before target(min %lu)\n&quot;</span>, diff, eo_ctx-&gt;min_tmo);</div>
<div class="line">                                errors++;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        avg_diff /= (int64_t)eo_ctx-&gt;oneshot.received;</div>
<div class="line">        avg_linux /= (int64_t)eo_ctx-&gt;oneshot.received;</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; SUMMARY/TICKS: min %&quot;</span> PRIi64 <span class="stringliteral">&quot;, max %&quot;</span> PRIi64</div>
<div class="line">                        <span class="stringliteral">&quot;, avg %&quot;</span> PRIi64 <span class="stringliteral">&quot;\n&quot;</span>, min_diff, max_diff,</div>
<div class="line">                        avg_diff);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;        /US: min %&quot;</span> PRIi64 <span class="stringliteral">&quot;, max %&quot;</span> PRIi64</div>
<div class="line">                        <span class="stringliteral">&quot;, avg %&quot;</span> PRIi64 <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">                        tick_diff_ns(0, min_diff, eo_ctx-&gt;hz) / 1000,</div>
<div class="line">                        tick_diff_ns(0, max_diff, eo_ctx-&gt;hz) / 1000,</div>
<div class="line">                        tick_diff_ns(0, avg_diff, eo_ctx-&gt;hz) / 1000);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; SUMMARY/LINUX US: min %&quot;</span> PRIi64 <span class="stringliteral">&quot;, max %&quot;</span> PRIi64</div>
<div class="line">                <span class="stringliteral">&quot;, avg %&quot;</span> PRIi64 <span class="stringliteral">&quot;\n&quot;</span>, min_linux / 1000, max_linux / 1000,</div>
<div class="line">                avg_linux / 1000);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* over total runtime */</span></div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;min_diff &gt; min_diff)</div>
<div class="line">                eo_ctx-&gt;min_diff = min_diff;</div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;max_diff &lt; max_diff)</div>
<div class="line">                eo_ctx-&gt;max_diff = max_diff;</div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;min_diff_l &gt; min_linux)</div>
<div class="line">                eo_ctx-&gt;min_diff_l = min_linux;</div>
<div class="line">        <span class="keywordflow">if</span> (eo_ctx-&gt;max_diff_l &lt; max_linux)</div>
<div class="line">                eo_ctx-&gt;max_diff_l = max_linux;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> errors;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> check_periodic(app_eo_ctx_t *eo_ctx)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> errors = 0;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_dummy = 0;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;PERIODIC:\n&quot;</span>);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Received: %&quot;</span> PRIu64 <span class="stringliteral">&quot;\n&quot;</span>, eo_ctx-&gt;periodic.received);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Cancelled: %&quot;</span> PRIu64 <span class="stringliteral">&quot;\n&quot;</span>, eo_ctx-&gt;periodic.cancelled);</div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot; Cancel failed (too late): %&quot;</span> PRIu64 <span class="stringliteral">&quot;\n&quot;</span>, eo_ctx-&gt;periodic.cancel_fail);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; APP_MAX_PERIODIC; i++) {</div>
<div class="line">                <span class="comment">/* missing? */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!eo_ctx-&gt;periodic.tmo[i].canceled &amp;&amp; !eo_ctx-&gt;periodic.tmo[i].waitevt &amp;&amp;</div>
<div class="line">                    !eo_ctx-&gt;periodic.tmo[i].appeared) {</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot; ERR: No periodic TMO %d event(s)!\n&quot;</span>, i);</div>
<div class="line">                        errors++;</div>
<div class="line">                }</div>
<div class="line">                <span class="comment">/* appeared after successful cancel? */</span></div>
<div class="line">                <span class="keywordflow">if</span> (eo_ctx-&gt;periodic.tmo[i].canceled &amp;&amp; eo_ctx-&gt;periodic.tmo[i].appeared) {</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot; ERR: periodic TMO %d event(s) after successful cancel!\n&quot;</span>, i);</div>
<div class="line">                        errors++;</div>
<div class="line">                }</div>
<div class="line">                <span class="comment">/* did not appear after failed cancel? */</span></div>
<div class="line">                <span class="keywordflow">if</span> (APP_PER_CANCEL_CHK) {</div>
<div class="line">                        <span class="keywordflow">if</span> (eo_ctx-&gt;periodic.tmo[i].waitevt &amp;&amp; !eo_ctx-&gt;periodic.tmo[i].appeared) {</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot; ERR: periodic TMO %d no event after failed cancel!\n&quot;</span>,</div>
<div class="line">                                           i);</div>
<div class="line">                                errors++;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (max_dummy &lt; eo_ctx-&gt;periodic.tmo[i].max_dummy)</div>
<div class="line">                        max_dummy = eo_ctx-&gt;periodic.tmo[i].max_dummy;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (max_dummy) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot; Max extra processing delay before ack (us): %u\n&quot;</span>, max_dummy);</div>
<div class="line">                <span class="keywordflow">if</span> (eo_ctx-&gt;max_dummy &lt; max_dummy)</div>
<div class="line">                        eo_ctx-&gt;max_dummy = max_dummy;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> errors;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* emulate processing delay */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> dummy_processing(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> us)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">struct </span>timespec now, sample;</div>
<div class="line"> </div>
<div class="line">        VISUAL_DBG(<span class="stringliteral">&quot;D&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        clock_gettime(APP_LINUX_CLOCK_SRC, &amp;now);</div>
<div class="line">        <span class="keywordflow">do</span> {</div>
<div class="line">                clock_gettime(APP_LINUX_CLOCK_SRC, &amp;sample);</div>
<div class="line">        } <span class="keywordflow">while</span> (ts_diff_ns(&amp;now, &amp;sample) / 1000ULL &lt; us);</div>
<div class="line">        VISUAL_DBG(<span class="stringliteral">&quot;d&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="aenvironment_8h_html"><div class="ttname"><a href="../../de/d26/environment_8h.html">environment.h</a></div></div>
<div class="ttc" id="aenvironment_8h_html_a13093fb72d4f1f0be2f85cf449f4d543"><div class="ttname"><a href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a></div><div class="ttdeci">#define ENV_CACHE_LINE_ALIGNED</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/environment_8h_source.html#l00076">environment.h:76</a></div></div>
<div class="ttc" id="aenvironment_8h_html_a2b2462b2491461a5c14adb1eb4493a8c"><div class="ttname"><a href="../../de/d26/environment_8h.html#a2b2462b2491461a5c14adb1eb4493a8c">ENV_LOCAL</a></div><div class="ttdeci">#define ENV_LOCAL</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/environment_8h_source.html#l00057">environment.h:57</a></div></div>
<div class="ttc" id="aevent__machine_8h_html"><div class="ttname"><a href="../../d7/d5e/event__machine_8h.html">event_machine.h</a></div></div>
<div class="ttc" id="aevent__machine__hw__config_8h_html_aaa0a290a45f4b1280f3330fadde6bfde"><div class="ttname"><a href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a></div><div class="ttdeci">#define EM_POOL_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6d/event__machine__hw__config_8h_source.html#l00191">event_machine_hw_config.h:191</a></div></div>
<div class="ttc" id="aevent__machine__hw__config_8h_html_ae56af1c575498ec19f0836ee916d0eb9"><div class="ttname"><a href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a></div><div class="ttdeci">#define EM_QUEUE_GROUP_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6d/event__machine__hw__config_8h_source.html#l00147">event_machine_hw_config.h:147</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a368b59e8c18f57c4034420e3ba44e965a43e0ef6f7a63caf0b225a52412ef3032"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965a43e0ef6f7a63caf0b225a52412ef3032">EM_QUEUE_TYPE_ATOMIC</a></div><div class="ttdeci">@ EM_QUEUE_TYPE_ATOMIC</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00112">event_machine_hw_types.h:112</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea">EM_QUEUE_TYPE_PARALLEL</a></div><div class="ttdeci">@ EM_QUEUE_TYPE_PARALLEL</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00117">event_machine_hw_types.h:117</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a5f1ebfb654b7ec3169e068aa3776ff79"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a5f1ebfb654b7ec3169e068aa3776ff79">PRI_POOL</a></div><div class="ttdeci">#define PRI_POOL</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00062">event_machine_hw_types.h:62</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a67fed61187c93569c92da0647970a29f"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a67fed61187c93569c92da0647970a29f">EM_POOL_UNDEF</a></div><div class="ttdeci">#define EM_POOL_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00060">event_machine_hw_types.h:60</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a740919266fbb41b8a8127a9ef215eea0a5d88fb8b70a4b3edf790b3d650e7213e"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a740919266fbb41b8a8127a9ef215eea0a5d88fb8b70a4b3edf790b3d650e7213e">EM_ERR_BAD_ID</a></div><div class="ttdeci">@ EM_ERR_BAD_ID</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00265">event_machine_hw_types.h:265</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a740919266fbb41b8a8127a9ef215eea0a5e2e63f7ddf4a916caa09f43a07d9fb3"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a740919266fbb41b8a8127a9ef215eea0a5e2e63f7ddf4a916caa09f43a07d9fb3">EM_ERR_CANCELED</a></div><div class="ttdeci">@ EM_ERR_CANCELED</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00309">event_machine_hw_types.h:309</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a740919266fbb41b8a8127a9ef215eea0ae173e1529a1b79dedd05c6eb5d15e24c"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a740919266fbb41b8a8127a9ef215eea0ae173e1529a1b79dedd05c6eb5d15e24c">EM_ERR_TOONEAR</a></div><div class="ttdeci">@ EM_ERR_TOONEAR</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00305">event_machine_hw_types.h:305</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca">EM_QUEUE_PRIO_NORMAL</a></div><div class="ttdeci">@ EM_QUEUE_PRIO_NORMAL</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00153">event_machine_hw_types.h:153</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a8171ccd1b7a0df99a6c7d0f3ec82e52fa621ca7c9a90044e11dad3060006dc450"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa621ca7c9a90044e11dad3060006dc450">EM_QUEUE_PRIO_HIGHEST</a></div><div class="ttdeci">@ EM_QUEUE_PRIO_HIGHEST</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00156">event_machine_hw_types.h:155</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_ac341b7db29d8127e864a45c9bd2a4aa3"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a></div><div class="ttdeci">#define EM_ERROR_SET_FATAL(error)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00428">event_machine_hw_types.h:428</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a></div><div class="ttdeci">@ EM_EVENT_TYPE_SW</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00072">event_machine_hw_types.h:72</a></div></div>
<div class="ttc" id="aevent__machine__timer__hw__specific_8h_html_a31cd14adb32c94ed0f2e27d263ad6eb1"><div class="ttname"><a href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#a31cd14adb32c94ed0f2e27d263ad6eb1">PRI_TMR</a></div><div class="ttdeci">#define PRI_TMR</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1f/event__machine__timer__hw__specific_8h_source.html#l00049">event_machine_timer_hw_specific.h:49</a></div></div>
<div class="ttc" id="aevent__machine__timer__hw__specific_8h_html_aa373a94a9084c3bd6c5b23ac6bd6b176"><div class="ttname"><a href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#aa373a94a9084c3bd6c5b23ac6bd6b176">EM_TIMER_UNDEF</a></div><div class="ttdeci">#define EM_TIMER_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1f/event__machine__timer__hw__specific_8h_source.html#l00120">event_machine_timer_hw_specific.h:120</a></div></div>
<div class="ttc" id="aevent__machine__timer__hw__specific_8h_html_ad2afe10951c01b6511a18d9e82f2c0a3"><div class="ttname"><a href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#ad2afe10951c01b6511a18d9e82f2c0a3">EM_TIMER_CLKSRC_DEFAULT</a></div><div class="ttdeci">#define EM_TIMER_CLKSRC_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1f/event__machine__timer__hw__specific_8h_source.html#l00106">event_machine_timer_hw_specific.h:106</a></div></div>
<div class="ttc" id="aevent__machine__timer__hw__specific_8h_html_af7917fb5bc546e1339ad6e1135fd8c6d"><div class="ttname"><a href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#af7917fb5bc546e1339ad6e1135fd8c6d">EM_TMO_UNDEF</a></div><div class="ttdeci">#define EM_TMO_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1f/event__machine__timer__hw__specific_8h_source.html#l00125">event_machine_timer_hw_specific.h:125</a></div></div>
<div class="ttc" id="aevent__machine__timer__hw__specific_8h_html_gaade0f99e694a2f999abe467bc05fde61a8e5343b756922a7d6527d8ddff10ff14"><div class="ttname"><a href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#gaade0f99e694a2f999abe467bc05fde61a8e5343b756922a7d6527d8ddff10ff14">EM_TMO_FLAG_ONESHOT</a></div><div class="ttdeci">@ EM_TMO_FLAG_ONESHOT</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1f/event__machine__timer__hw__specific_8h_source.html#l00081">event_machine_timer_hw_specific.h:81</a></div></div>
<div class="ttc" id="aevent__machine__timer__hw__specific_8h_html_gaade0f99e694a2f999abe467bc05fde61aac8e81389e6feaf233eff357c4ece5f0"><div class="ttname"><a href="../../d7/d1f/event__machine__timer__hw__specific_8h.html#gaade0f99e694a2f999abe467bc05fde61aac8e81389e6feaf233eff357c4ece5f0">EM_TMO_FLAG_PERIODIC</a></div><div class="ttdeci">@ EM_TMO_FLAG_PERIODIC</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1f/event__machine__timer__hw__specific_8h_source.html#l00082">event_machine_timer_hw_specific.h:82</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a03546e6a7e93665c52d479831e0a6dca"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a></div><div class="ttdeci">#define EM_OK</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00329">event_machine_types.h:329</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a0bf4a25d46e18ee918e684e5deb27fa4"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a></div><div class="ttdeci">#define PRI_EO</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00097">event_machine_types.h:97</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a0c0a929399ae33b615f8ca8018d2a69d"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a0c0a929399ae33b615f8ca8018d2a69d">em_escope_t</a></div><div class="ttdeci">uint32_t em_escope_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00348">event_machine_types.h:348</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a419c8373b72a8c5ed1c3e3ded3e262e0"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a419c8373b72a8c5ed1c3e3ded3e262e0">EM_TRUE</a></div><div class="ttdeci">#define EM_TRUE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00053">event_machine_types.h:53</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a49fd700da185b0f64834bf967479a992"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a></div><div class="ttdeci">uint32_t em_event_type_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00085">event_machine_types.h:85</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a8542d9c2c9a29e35ff042b1d59cc479b"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a></div><div class="ttdeci">#define EM_EVENT_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00062">event_machine_types.h:62</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_adddd88868f7aa0d32b3e40245eb4ef8f"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div><div class="ttdeci">uint32_t em_status_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00321">event_machine_types.h:321</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_af28fb8daf62b942ced417e158ed7e1c7"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#af28fb8daf62b942ced417e158ed7e1c7">EM_EO_UNDEF</a></div><div class="ttdeci">#define EM_EO_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00095">event_machine_types.h:95</a></div></div>
<div class="ttc" id="agroup__em__core_html_ga13d21af31382ec2c3d45010645707e9c"><div class="ttname"><a href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a></div><div class="ttdeci">int em_core_id(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df9/event__machine__core_8c_source.html#l00034">event_machine_core.c:34</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga1020917f6061bf56da36773946eece72"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga1020917f6061bf56da36773946eece72">em_eo_register_error_handler</a></div><div class="ttdeci">em_status_t em_eo_register_error_handler(em_eo_t eo, em_error_handler_t handler)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00566">event_machine_eo.c:566</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga10cf8094caa56026eb0a402d3d22da23"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga10cf8094caa56026eb0a402d3d22da23">em_eo_remove_queue_all_sync</a></div><div class="ttdeci">em_status_t em_eo_remove_queue_all_sync(em_eo_t eo, int delete_queues)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00517">event_machine_eo.c:517</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga196c7caa1177575fd424e9a0d2854da6"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga196c7caa1177575fd424e9a0d2854da6">em_eo_create</a></div><div class="ttdeci">em_eo_t em_eo_create(const char *name, em_start_func_t start, em_start_local_func_t local_start, em_stop_func_t stop, em_stop_local_func_t local_stop, em_receive_func_t receive, const void *eo_ctx)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00040">event_machine_eo.c:40</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga9ac21d82f671fff3e31e83410e72d406"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga9ac21d82f671fff3e31e83410e72d406">em_eo_find</a></div><div class="ttdeci">em_eo_t em_eo_find(const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00265">event_machine_eo.c:265</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gabe4f7a789ec9523367c086793061562d"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gabe4f7a789ec9523367c086793061562d">em_eo_start_sync</a></div><div class="ttdeci">em_status_t em_eo_start_sync(em_eo_t eo, em_status_t *result, const em_eo_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00725">event_machine_eo.c:725</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gac9b818edd466228b6fb653bd9337da3e"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a></div><div class="ttdeci">em_status_t em_eo_add_queue_sync(em_eo_t eo, em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00344">event_machine_eo.c:344</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gadce026621953114bd26e5836d9693465"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gadce026621953114bd26e5836d9693465">em_eo_stop_sync</a></div><div class="ttdeci">em_status_t em_eo_stop_sync(em_eo_t eo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00897">event_machine_eo.c:897</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gae769b19e613b24487beb943cfb926977"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gae769b19e613b24487beb943cfb926977">em_eo_delete</a></div><div class="ttdeci">em_status_t em_eo_delete(em_eo_t eo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00205">event_machine_eo.c:205</a></div></div>
<div class="ttc" id="agroup__em__error_html_gab6b469100e5f60670a742d944a6f530b"><div class="ttname"><a href="../../db/da0/group__em__error.html#gab6b469100e5f60670a742d944a6f530b">em_unregister_error_handler</a></div><div class="ttdeci">em_status_t em_unregister_error_handler(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/de9/event__machine__error_8c_source.html#l00050">event_machine_error.c:50</a></div></div>
<div class="ttc" id="agroup__em__error_html_gaf7332965c5deaa69411136e8d36089c6"><div class="ttname"><a href="../../db/da0/group__em__error.html#gaf7332965c5deaa69411136e8d36089c6">em_register_error_handler</a></div><div class="ttdeci">em_status_t em_register_error_handler(em_error_handler_t handler)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/de9/event__machine__error_8c_source.html#l00034">event_machine_error.c:34</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga5f0e40f1b0b4892ee16aafe07ba4c90c"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a></div><div class="ttdeci">em_event_t em_alloc(uint32_t size, em_event_type_t type, em_pool_t pool)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00033">event_machine_event.c:33</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga8f701c3a5901fc81d922b9d1d02691e3"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a></div><div class="ttdeci">void * em_event_pointer(em_event_t event)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00750">event_machine_event.c:750</a></div></div>
<div class="ttc" id="agroup__em__event_html_gad4f97ba217518d967f8078c56023c4d4"><div class="ttname"><a href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a></div><div class="ttdeci">void em_free(em_event_t event)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00261">event_machine_event.c:261</a></div></div>
<div class="ttc" id="agroup__em__queue_html_gaef257858d1fa660524f198dba20fa9eb"><div class="ttname"><a href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a></div><div class="ttdeci">em_queue_t em_queue_create(const char *name, em_queue_type_t type, em_queue_prio_t prio, em_queue_group_t group, const em_queue_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dba/event__machine__queue_8c_source.html#l00041">event_machine_queue.c:41</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga01e680281f0ae40bce6c6786fc0bcdc3"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga01e680281f0ae40bce6c6786fc0bcdc3">em_timer_get_attr</a></div><div class="ttdeci">em_status_t em_timer_get_attr(em_timer_t tmr, em_timer_attr_t *tmr_attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01752">event_machine_timer.c:1752</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga25b88dbbb772090d6caa5622c7017889"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga25b88dbbb772090d6caa5622c7017889">em_timer_get_all</a></div><div class="ttdeci">int em_timer_get_all(em_timer_t *tmr_list, int max)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01728">event_machine_timer.c:1728</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga2bac1530b021bbbd1f0f924414c2485e"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga2bac1530b021bbbd1f0f924414c2485e">em_timer_delete</a></div><div class="ttdeci">em_status_t em_timer_delete(em_timer_t tmr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l00980">event_machine_timer.c:980</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga4fc3dd338b784ce9b122eeb3fbf4ea07"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga4fc3dd338b784ce9b122eeb3fbf4ea07">em_tmo_create</a></div><div class="ttdeci">em_tmo_t em_tmo_create(em_timer_t tmr, em_tmo_flag_t flags, em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01056">event_machine_timer.c:1056</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga56968bda0ecacf996d6ce623e3e372ab"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga56968bda0ecacf996d6ce623e3e372ab">em_timer_create</a></div><div class="ttdeci">em_timer_t em_timer_create(const em_timer_attr_t *tmr_attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l00616">event_machine_timer.c:616</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga66476f77546996eea9acebaa471c1b52"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga66476f77546996eea9acebaa471c1b52">em_tmo_get_state</a></div><div class="ttdeci">em_tmo_state_t em_tmo_get_state(em_tmo_t tmo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01837">event_machine_timer.c:1837</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga67d2db5f72ccdd285649ce05b0a22a92"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga67d2db5f72ccdd285649ce05b0a22a92">em_tmo_delete</a></div><div class="ttdeci">em_status_t em_tmo_delete(em_tmo_t tmo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01161">event_machine_timer.c:1161</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga786f0cc89e9bdfda1c1274165600f0ef"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga786f0cc89e9bdfda1c1274165600f0ef">em_tmo_cancel</a></div><div class="ttdeci">em_status_t em_tmo_cancel(em_tmo_t tmo, em_event_t *cur_event)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01533">event_machine_timer.c:1533</a></div></div>
<div class="ttc" id="agroup__em__timer_html_ga8f1f88a05b9e366f3b31447dead90b5e"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#ga8f1f88a05b9e366f3b31447dead90b5e">em_tmo_set_periodic</a></div><div class="ttdeci">em_status_t em_tmo_set_periodic(em_tmo_t tmo, em_timer_tick_t start_abs, em_timer_tick_t period, em_event_t tmo_ev)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01372">event_machine_timer.c:1372</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gaabb77ed31727a32d041f9d308a0a3886"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gaabb77ed31727a32d041f9d308a0a3886">em_timer_current_tick</a></div><div class="ttdeci">em_timer_tick_t em_timer_current_tick(em_timer_t tmr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01045">event_machine_timer.c:1045</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gabe6b4e51cd71d86d0e60534ba00cbac2"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gabe6b4e51cd71d86d0e60534ba00cbac2">em_tmo_set_rel</a></div><div class="ttdeci">em_status_t em_tmo_set_rel(em_tmo_t tmo, em_timer_tick_t ticks_rel, em_event_t tmo_ev)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01300">event_machine_timer.c:1300</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gad6023dd3c79d0a45221d9245c604c2e3"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gad6023dd3c79d0a45221d9245c604c2e3">em_timer_attr_init</a></div><div class="ttdeci">void em_timer_attr_init(em_timer_attr_t *tmr_attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l00378">event_machine_timer.c:378</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gae97b08e2b1468de76a7d92342a5860ed"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gae97b08e2b1468de76a7d92342a5860ed">em_timer_get_freq</a></div><div class="ttdeci">uint64_t em_timer_get_freq(em_timer_t tmr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01797">event_machine_timer.c:1797</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gaf65f50c383b579720a31154b04ea610e"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gaf65f50c383b579720a31154b04ea610e">em_tmo_ack</a></div><div class="ttdeci">em_status_t em_tmo_ack(em_tmo_t tmo, em_event_t next_tmo_ev)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l01612">event_machine_timer.c:1612</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gafe7128676f8f4ad4800fd204a34ac8d3"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gafe7128676f8f4ad4800fd204a34ac8d3">em_timer_tick_t</a></div><div class="ttdeci">uint64_t em_timer_tick_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00255">api/event_machine_timer.h:255</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gafe76b458292862809030194da9462b4c"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gafe76b458292862809030194da9462b4c">em_timer_res_capability</a></div><div class="ttdeci">em_status_t em_timer_res_capability(em_timer_res_param_t *res, em_timer_clksrc_t clk_src)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/event__machine__timer_8c_source.html#l00544">event_machine_timer.c:544</a></div></div>
<div class="ttc" id="agroup__em__timer_html_gga3857ab06946e6b4047352d5d84ffff4daa54abf62265d1c2beaeeadb6a1ee240f"><div class="ttname"><a href="../../de/dc2/group__em__timer.html#gga3857ab06946e6b4047352d5d84ffff4daa54abf62265d1c2beaeeadb6a1ee240f">EM_TMO_STATE_ACTIVE</a></div><div class="ttdeci">@ EM_TMO_STATE_ACTIVE</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00237">api/event_machine_timer.h:237</a></div></div>
<div class="ttc" id="astructem__eo__conf__t_html"><div class="ttname"><a href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00242">event_machine_types.h:242</a></div></div>
<div class="ttc" id="astructem__timer__attr__t_html"><div class="ttname"><a href="../../d4/d00/structem__timer__attr__t.html">em_timer_attr_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00332">api/event_machine_timer.h:332</a></div></div>
<div class="ttc" id="astructem__timer__attr__t_html_a03fc2b0569742931ed610f0bd1af43ad"><div class="ttname"><a href="../../d4/d00/structem__timer__attr__t.html#a03fc2b0569742931ed610f0bd1af43ad">em_timer_attr_t::name</a></div><div class="ttdeci">char name[EM_TIMER_NAME_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00346">api/event_machine_timer.h:346</a></div></div>
<div class="ttc" id="astructem__timer__attr__t_html_adf7a24e643b381f39fec354caf5a4bc0"><div class="ttname"><a href="../../d4/d00/structem__timer__attr__t.html#adf7a24e643b381f39fec354caf5a4bc0">em_timer_attr_t::resparam</a></div><div class="ttdeci">em_timer_res_param_t resparam</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00339">api/event_machine_timer.h:339</a></div></div>
<div class="ttc" id="astructem__timer__attr__t_html_ae6afcdeed8fe620636b1f0391f908afc"><div class="ttname"><a href="../../d4/d00/structem__timer__attr__t.html#ae6afcdeed8fe620636b1f0391f908afc">em_timer_attr_t::num_tmo</a></div><div class="ttdeci">uint32_t num_tmo</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00342">api/event_machine_timer.h:342</a></div></div>
<div class="ttc" id="astructem__timer__res__param__t_html"><div class="ttname"><a href="../../d8/d93/structem__timer__res__param__t.html">em_timer_res_param_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00281">api/event_machine_timer.h:281</a></div></div>
<div class="ttc" id="astructem__timer__res__param__t_html_a07ed3b3b2e89e83ca36fb2efbc731c45"><div class="ttname"><a href="../../d8/d93/structem__timer__res__param__t.html#a07ed3b3b2e89e83ca36fb2efbc731c45">em_timer_res_param_t::clk_src</a></div><div class="ttdeci">em_timer_clksrc_t clk_src</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00283">api/event_machine_timer.h:283</a></div></div>
<div class="ttc" id="astructem__timer__res__param__t_html_a6a48acfe30394982686a96f1f402ac0c"><div class="ttname"><a href="../../d8/d93/structem__timer__res__param__t.html#a6a48acfe30394982686a96f1f402ac0c">em_timer_res_param_t::res_ns</a></div><div class="ttdeci">uint64_t res_ns</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00285">api/event_machine_timer.h:285</a></div></div>
<div class="ttc" id="astructem__timer__res__param__t_html_a94b92c7b60c5a8cd9ac357b488292fa4"><div class="ttname"><a href="../../d8/d93/structem__timer__res__param__t.html#a94b92c7b60c5a8cd9ac357b488292fa4">em_timer_res_param_t::min_tmo</a></div><div class="ttdeci">uint64_t min_tmo</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00289">api/event_machine_timer.h:289</a></div></div>
<div class="ttc" id="astructem__timer__res__param__t_html_ab8065c326f16df1abfbb756ae50038cb"><div class="ttname"><a href="../../d8/d93/structem__timer__res__param__t.html#ab8065c326f16df1abfbb756ae50038cb">em_timer_res_param_t::res_hz</a></div><div class="ttdeci">uint64_t res_hz</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00287">api/event_machine_timer.h:287</a></div></div>
<div class="ttc" id="astructem__timer__res__param__t_html_abb8211175d76213b77c952c1608fbded"><div class="ttname"><a href="../../d8/d93/structem__timer__res__param__t.html#abb8211175d76213b77c952c1608fbded">em_timer_res_param_t::max_tmo</a></div><div class="ttdeci">uint64_t max_tmo</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df3/api_2event__machine__timer_8h_source.html#l00291">api/event_machine_timer.h:291</a></div></div>
<div class="ttc" id="astructem__timer__timeout__t_html"><div class="ttname"><a href="../../dd/d32/structem__timer__timeout__t.html">em_timer_timeout_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d2f/em__timer__types_8h_source.html#l00076">em_timer_types.h:76</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
  <div id="footer" class="tabs">
   <div class="headertitle"> 
     &copy; 2017 Nokia Networks
   </div>
  </div>
 </body>
</html>
