<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EM-ODP: fractal.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doc-stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EM-ODP
   &#160;<span id="projectnumber">3.8.0-1</span>
   </div>
   <div id="projectbrief">Event Machine on ODP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d1/d25/fractal_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">fractal.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> *   Copyright (c) 2015, Nokia Solutions and Networks</span></div>
<div class="line"><span class="comment"> *   All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> *   modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment"> *   are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer in the</span></div>
<div class="line"><span class="comment"> *       documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment"> *     * Neither the name of the copyright holder nor the names of its</span></div>
<div class="line"><span class="comment"> *       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment"> *       from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment"> *   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment"> *   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment"> *   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment"> *   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment"> *   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment"> *   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment"> *   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @file</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Event Machine fractal (Mandelbrot set) drawer.</span></div>
<div class="line"><span class="comment"> * Generate Mandelbroth fractal images and for each image zoom deeper into the</span></div>
<div class="line"><span class="comment"> * fractal. Prints frames-per-second and the frame range. Modify defined values</span></div>
<div class="line"><span class="comment"> * for different resolution, zoom point, starting frame, ending frame and</span></div>
<div class="line"><span class="comment"> * the precision of the fractal calculation.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Creates three Execution Objects (EO) to form a pipeline:</span></div>
<div class="line"><span class="comment"> *  --&gt; ](Pixel_handler) --&gt; ](Worker) --&gt; ](Imager) -==&gt; IMAGE</span></div>
<div class="line"><span class="comment"> *  \_____________________________________________/</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The image is divided into horizontal pixel blocks which are processed as</span></div>
<div class="line"><span class="comment"> * events. All the data events are allocated once at startup and reused for</span></div>
<div class="line"><span class="comment"> * every image frame.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Every image frame begins when the Pixel_handler EO receives a new frame</span></div>
<div class="line"><span class="comment"> * event from the Imager EO.</span></div>
<div class="line"><span class="comment"> * The Pixel_handler EO changes the frame value in the preallocated pixel block</span></div>
<div class="line"><span class="comment"> * events and sends them to the Worker EO&#39;s parallel queue.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The worker calculates the iteration values for every pixel in the block</span></div>
<div class="line"><span class="comment"> * using the mandelbrot algorithm and forwards the events to the Imager EO&#39;s</span></div>
<div class="line"><span class="comment"> * parallel queue. The Imager writes color values into the image buffer for the</span></div>
<div class="line"><span class="comment"> * given pixel block. The red, blue and green values are calculated using the</span></div>
<div class="line"><span class="comment"> * iteration value and for green additionally the frame value is used for</span></div>
<div class="line"><span class="comment"> * increased visuals.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The Worker EO sends events using an event group that eventually triggers a</span></div>
<div class="line"><span class="comment"> * notification event to be sent to the atomic queue of the Imager EO. Using</span></div>
<div class="line"><span class="comment"> * the EVENTS_PER_IMAGE value as the event group count, Imager receives the</span></div>
<div class="line"><span class="comment"> * notification event once all the data events received through Imager&#39;s</span></div>
<div class="line"><span class="comment"> * parallel queue have been processed - one fractal image is now complete.</span></div>
<div class="line"><span class="comment"> * The Imager EO switches the active frame buffer to a non-active buffer during</span></div>
<div class="line"><span class="comment"> * notification event handling and sends a new frame event to the Pixel_handler</span></div>
<div class="line"><span class="comment"> * EO to start the processing of a new frame.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Having sent the new frame event, Imager writes the ready buffer into a tmp</span></div>
<div class="line"><span class="comment"> * file and renames it to &#39;IMAGE_NAME&#39;. The &#39;IMAGE_NAME&#39; file is constantly</span></div>
<div class="line"><span class="comment"> * being displayed by the &#39;feh&#39; image viewer and renaming avoids tearing caused</span></div>
<div class="line"><span class="comment"> * by displaying an incomplete file.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Note: The test creates and mounts a ramdisk for the images and starts the</span></div>
<div class="line"><span class="comment"> *       &#39;feh&#39; image viewer as a background process to refresh the constantly</span></div>
<div class="line"><span class="comment"> *       updated fractal image file.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef _GNU_SOURCE</span></div>
<div class="line"><span class="preprocessor">#define _GNU_SOURCE</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d5e/event__machine_8h.html">event_machine.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/d26/environment_8h.html">event_machine/platform/env/environment.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;cm_setup.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;cm_error_handler.h&quot;</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Test configuration</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/** Images and paths */</span></div>
<div class="line"><span class="preprocessor">#define IMAGE_NAME      &quot;fractal.ppm&quot;</span></div>
<div class="line"><span class="preprocessor">#define TMP_IMAGE_NAME  &quot;tmp.ppm&quot;</span></div>
<div class="line"><span class="preprocessor">#define IMAGE_DIR       &quot;/tmp/em-frac_ramdisk/&quot;</span></div>
<div class="line"><span class="preprocessor">#define IMAGE_PATH       (IMAGE_DIR IMAGE_NAME)</span></div>
<div class="line"><span class="preprocessor">#define TMP_IMAGE_PATH   (IMAGE_DIR TMP_IMAGE_NAME)</span></div>
<div class="line"><span class="preprocessor">#define REMOUNT_RAMDISK_FMT \</span></div>
<div class="line"><span class="preprocessor">        &quot;(umount %s; mount -t tmpfs -o size=%dM tmpfs %s) 2&gt; /dev/null&quot;</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/** Resolution of the image: width */</span></div>
<div class="line"><span class="preprocessor">#define WIDTH  640</span><span class="comment"></span></div>
<div class="line"><span class="comment">/** Resolution of the image: height */</span></div>
<div class="line"><span class="preprocessor">#define HEIGHT 480</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/** Coordinates where the image zooms in. */</span></div>
<div class="line"><span class="preprocessor">#define ZOOM_POINT_X -1.401155</span></div>
<div class="line"><span class="preprocessor">#define ZOOM_POINT_Y  0.00002</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/** Greater the frame, deeper the image */</span></div>
<div class="line"><span class="preprocessor">#define START_FROM_FRAME 0</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/** Stop after amount of frames and print elapsed time. 0 for endless zoom. */</span></div>
<div class="line"><span class="preprocessor">#define STOP_AFTER_FRAMES 0</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/** Mandelbrot algorithm precision. Smaller value, less precise fractal. */</span></div>
<div class="line"><span class="preprocessor">#define MAX_ITERATIONS 1000</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/** Image viewer refresh rate in seconds. Match to FPS for smoother image. */</span></div>
<div class="line"><span class="preprocessor">#define IMAGE_VIEW_RATE 0.05</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Amount of horizontal pixels per image data event</span></div>
<div class="line"><span class="comment"> * Max event size 2KB with image_block_size 1019</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#define IMAGE_BLOCK_SIZE 80</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * How many events is needed for one full image</span></div>
<div class="line"><span class="comment"> * Depends on the image and block size</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#define EVENTS_PER_IMAGE ((ROUND_UP(WIDTH, IMAGE_BLOCK_SIZE) \</span></div>
<div class="line"><span class="preprocessor">                          / IMAGE_BLOCK_SIZE) * HEIGHT)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define ALLOC_EVENTS     ((WIDTH / IMAGE_BLOCK_SIZE + 1) * HEIGHT)</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Define how many events are sent per em_send_multi() call</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#define SEND_MULTI_MAX 32</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Single horizontal line of the image.</span></div>
<div class="line"><span class="comment"> * Every pixel requires red, green and blue (3) bytes</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        <span class="keywordtype">char</span> col[WIDTH * 3];</div>
<div class="line">} h_line_t;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Image buffer consisting of &#39;HEIGHT&#39; horizontal lines</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        h_line_t line[HEIGHT];</div>
<div class="line">        <span class="comment">/* Pad size to a multiple of cache line size */</span></div>
<div class="line">        <span class="keywordtype">void</span> *end[0] <a name="a0"></a><a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">} buffer_t;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * EVENTS:</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/** Pixel handler event */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        uint32_t frame;</div>
<div class="line">} pixel_handler_event_t;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/** Data events contain a block of horizontal pixels */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        uint16_t y;</div>
<div class="line">        uint16_t x_start;</div>
<div class="line">        uint16_t x_len;</div>
<div class="line">        uint16_t pix_iter_array[IMAGE_BLOCK_SIZE];</div>
<div class="line">        uint32_t frame;<span class="comment"></span></div>
<div class="line"><span class="comment">        /** storage location index in fractal_shm-&gt;data_event_tbl[] */</span></div>
<div class="line">        uint32_t data_evtbl_idx;</div>
<div class="line">} imager_data_event_t;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/** Notification event */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        uint64_t seq;</div>
<div class="line">} notif_event_t;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/** Union of all events for easy alloc&amp;reuse */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">union </span>{</div>
<div class="line">        pixel_handler_event_t pixel_handler_event;</div>
<div class="line">        imager_data_event_t imager_data_event;</div>
<div class="line">        notif_event_t notif_event;</div>
<div class="line">} fractal_event_t;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * EO contexts:</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/** My EO context */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        <span class="keywordtype">char</span> name[16];</div>
<div class="line">        em_eo_t eo;</div>
<div class="line">} my_eo_context_t;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/** Imager EO context holds the buffer which limits very large images */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        <span class="keywordtype">char</span> name[16];</div>
<div class="line">        em_eo_t eo;</div>
<div class="line">        <span class="keyword">struct </span>timespec start_time;</div>
<div class="line">        <span class="keyword">struct </span>timespec next_print_time;</div>
<div class="line">        uint32_t prev_print_frame;</div>
<div class="line">        uint32_t frame;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">int</span> buf_idx; <span class="comment">/**&lt; Index of active image buffer: buf[buf_idx] */</span></div>
<div class="line">        buffer_t buf[2] <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>; <span class="comment">/**&lt; Fractal image buffer */</span></div>
<div class="line">} imager_eo_context_t;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Verify that the image buffers don&#39;t share cache lines */</span></div>
<div class="line">COMPILE_TIME_ASSERT((offsetof(imager_eo_context_t, buf[1]) -</div>
<div class="line">                     offsetof(imager_eo_context_t, buf[0])) %</div>
<div class="line">                    <a name="a1"></a><a class="code" href="../../de/d26/environment_8h.html#aba71635a146e563689c50f1be15cb267">ENV_CACHE_LINE_SIZE</a> == 0,</div>
<div class="line">                    IMAGER_EO_CONTEXT_T__SIZE_ERROR);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Queue context data</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        <span class="comment">/* Queue identifications */</span></div>
<div class="line"><span class="preprocessor">        #define DATA_QUEUE  0</span></div>
<div class="line"><span class="preprocessor">        #define NOTIF_QUEUE  1</span></div>
<div class="line">        uint8_t id;</div>
<div class="line">} imager_queue_context_t;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Fractal shared memory</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        <span class="comment">/* Event pool used by this application */</span></div>
<div class="line">        em_pool_t pool;</div>
<div class="line">        <span class="comment">/* Allocate pixel handler EO context from shared memory region */</span></div>
<div class="line">        my_eo_context_t eo_context_pixel_handler <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">        <span class="comment">/* Allocate worker EO context from shared memory region */</span></div>
<div class="line">        my_eo_context_t eo_context_worker <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">        <span class="comment">/* Allocate imager EO context from shared memory region */</span></div>
<div class="line">        imager_eo_context_t eo_context_imager <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">        <span class="comment">/* Imager data queue context */</span></div>
<div class="line">        imager_queue_context_t imager_data_queue_ctx <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">        <span class="comment">/* Imager notification queue context */</span></div>
<div class="line">        imager_queue_context_t imager_notif_queue_ctx <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line"> </div>
<div class="line">        em_event_t data_event_tbl[ALLOC_EVENTS] <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">struct </span>{</div>
<div class="line">                <span class="comment">/* EO queues */</span></div>
<div class="line">                em_queue_t queue_pixel;</div>
<div class="line">                em_queue_t queue_worker;</div>
<div class="line">                em_queue_t queue_data_imager;</div>
<div class="line">                em_queue_t queue_notif_imager;</div>
<div class="line">                <span class="comment">/* Event group for tracking the nbr of completed data events */</span></div>
<div class="line">                em_event_group_t egrp_imager;</div>
<div class="line">        } <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">} fractal_shm_t;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* EM-core local pointer to shared memory */</span></div>
<div class="line"><span class="keyword">static</span> <a name="a2"></a><a class="code" href="../../de/d26/environment_8h.html#a2b2462b2491461a5c14adb1eb4493a8c">ENV_LOCAL</a> fractal_shm_t *fractal_shm;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">pixel_handler_start(my_eo_context_t *eo_ctx, em_eo_t eo,</div>
<div class="line">                    <span class="keyword">const</span> <a name="_a3"></a><a class="code" href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a> *conf);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">pixel_handler_stop(my_eo_context_t *eo_ctx, em_eo_t eo);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">pixel_handler_receive_event(my_eo_context_t *eo_ctx, em_event_t event,</div>
<div class="line">                            <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> type, em_queue_t queue,</div>
<div class="line">                            <span class="keywordtype">void</span> *q_ctx);</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">worker_start(my_eo_context_t *eo_ctx, em_eo_t eo, <span class="keyword">const</span> <a class="code" href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a> *conf);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">worker_stop(my_eo_context_t *eo_ctx, em_eo_t eo);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">worker_receive_event(my_eo_context_t *eo_ctx, em_event_t event,</div>
<div class="line">                     <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> type, em_queue_t queue, <span class="keywordtype">void</span> *q_ctx);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">imager_start(imager_eo_context_t *eo_ctx, em_eo_t eo,</div>
<div class="line">             <span class="keyword">const</span> <a class="code" href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a> *conf);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">imager_stop(imager_eo_context_t *eo_ctx, em_eo_t eo);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">imager_receive_event(imager_eo_context_t *eo_ctx, em_event_t event,</div>
<div class="line">                     <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> type, em_queue_t queue,</div>
<div class="line">                     imager_queue_context_t *q_ctx);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">snprintf_check(<span class="keywordtype">int</span> cmd_size, <span class="keywordtype">int</span> ret);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">run_system_cmds(<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">create_data_events(<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">free_data_events(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Main function</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Call cm_setup() to perform test &amp; EM setup common for all the</span></div>
<div class="line"><span class="comment"> * test applications.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * cm_setup() will call test_init() and test_start() and launch</span></div>
<div class="line"><span class="comment"> * the EM dispatch loop on every EM-core.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">return</span> cm_setup(argc, argv);</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Init of the Fractal test application.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @attention Run on all cores.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @see cm_setup() for setup and dispatch.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> test_init(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        (void)appl_conf;</div>
<div class="line">        <span class="keywordtype">int</span> core = <a name="a4"></a><a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (core == 0) {</div>
<div class="line">                fractal_shm = env_shared_reserve(<span class="stringliteral">&quot;FractalShMem&quot;</span>,</div>
<div class="line">                                                 <span class="keyword">sizeof</span>(fractal_shm_t));</div>
<div class="line">                <a name="a5"></a><a class="code" href="../../db/da0/group__em__error.html#gaf7332965c5deaa69411136e8d36089c6">em_register_error_handler</a>(test_error_handler);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                fractal_shm = env_shared_lookup(<span class="stringliteral">&quot;FractalShMem&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (fractal_shm == NULL)</div>
<div class="line">                test_error(<a name="a6"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xec0de), 0xdead,</div>
<div class="line">                           <span class="stringliteral">&quot;Fractal init failed on EM-core: %u&quot;</span>,</div>
<div class="line">                           <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>());</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (core == 0)</div>
<div class="line">                memset(fractal_shm, 0, <span class="keyword">sizeof</span>(fractal_shm_t));</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Startup of the fractal test application.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param appl_conf Application configuration</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @see cm_setup() for setup and dispatch.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> test_start(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        em_eo_t eo_pixel_handler, eo_worker, eo_imager;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret, start_ret = <a name="a7"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a1f9dbd41491db385bd4a3813e2f030a5">EM_ERROR</a>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Store the event pool to use, use the EM default pool if no other</span></div>
<div class="line"><span class="comment">         * pool is provided through the appl_conf.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">if</span> (appl_conf-&gt;num_pools &gt;= 1)</div>
<div class="line">                fractal_shm-&gt;pool = appl_conf-&gt;pools[0];</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                fractal_shm-&gt;pool = <a name="a8"></a><a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a>;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;***********************************************************\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;EM APPLICATION: &#39;%s&#39; initializing:\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;  %s: %s() - EM-core:%d\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;  Application running on %u EM-cores (procs:%u, threads:%u)\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;  using event pool:%&quot;</span> <a name="a9"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a5f1ebfb654b7ec3169e068aa3776ff79">PRI_POOL</a> <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;***********************************************************\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">                   appl_conf-&gt;name, NO_PATH(__FILE__), __func__, <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>(),</div>
<div class="line">                   appl_conf-&gt;core_count, appl_conf-&gt;num_procs, appl_conf-&gt;num_threads,</div>
<div class="line">                   fractal_shm-&gt;pool);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(fractal_shm-&gt;pool == <a name="a10"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a67fed61187c93569c92da0647970a29f">EM_POOL_UNDEF</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;Undefined application event pool!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Create EOs */</span></div>
<div class="line">        eo_pixel_handler =</div>
<div class="line">                <a name="a11"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga196c7caa1177575fd424e9a0d2854da6">em_eo_create</a>(<span class="stringliteral">&quot;Pixel handler&quot;</span>,</div>
<div class="line">                             (<a name="a12"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gad339451d68d77127ac2b7ba806f95c03">em_start_func_t</a>)pixel_handler_start, NULL,</div>
<div class="line">                             (<a name="a13"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga71defe535ba0c4e16bf2cddfd4a4f8db">em_stop_func_t</a>)pixel_handler_stop, NULL,</div>
<div class="line">                             (<a name="a14"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga63161b6f46fb08a1708bad6c1fde2622">em_receive_func_t</a>)pixel_handler_receive_event,</div>
<div class="line">                             &amp;fractal_shm-&gt;eo_context_pixel_handler);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(eo_pixel_handler == <a name="a15"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#af28fb8daf62b942ced417e158ed7e1c7">EM_EO_UNDEF</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;pixel handler creation failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        eo_worker = <a class="code" href="../../d8/d5f/group__em__eo.html#ga196c7caa1177575fd424e9a0d2854da6">em_eo_create</a>(<span class="stringliteral">&quot;Worker&quot;</span>,</div>
<div class="line">                                 (<a class="code" href="../../d8/d5f/group__em__eo.html#gad339451d68d77127ac2b7ba806f95c03">em_start_func_t</a>)worker_start, NULL,</div>
<div class="line">                                 (<a class="code" href="../../d8/d5f/group__em__eo.html#ga71defe535ba0c4e16bf2cddfd4a4f8db">em_stop_func_t</a>)worker_stop, NULL,</div>
<div class="line">                                 (<a class="code" href="../../d8/d5f/group__em__eo.html#ga63161b6f46fb08a1708bad6c1fde2622">em_receive_func_t</a>)worker_receive_event,</div>
<div class="line">                                 &amp;fractal_shm-&gt;eo_context_worker);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(eo_worker == <a class="code" href="../../d4/d11/event__machine__types_8h.html#af28fb8daf62b942ced417e158ed7e1c7">EM_EO_UNDEF</a>, <span class="stringliteral">&quot;Worker creation failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        eo_imager = <a class="code" href="../../d8/d5f/group__em__eo.html#ga196c7caa1177575fd424e9a0d2854da6">em_eo_create</a>(<span class="stringliteral">&quot;Imager&quot;</span>,</div>
<div class="line">                                 (<a class="code" href="../../d8/d5f/group__em__eo.html#gad339451d68d77127ac2b7ba806f95c03">em_start_func_t</a>)imager_start, NULL,</div>
<div class="line">                                 (<a class="code" href="../../d8/d5f/group__em__eo.html#ga71defe535ba0c4e16bf2cddfd4a4f8db">em_stop_func_t</a>)imager_stop, NULL,</div>
<div class="line">                                 (<a class="code" href="../../d8/d5f/group__em__eo.html#ga63161b6f46fb08a1708bad6c1fde2622">em_receive_func_t</a>)imager_receive_event,</div>
<div class="line">                                 &amp;fractal_shm-&gt;eo_context_imager);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(eo_imager == <a class="code" href="../../d4/d11/event__machine__types_8h.html#af28fb8daf62b942ced417e158ed7e1c7">EM_EO_UNDEF</a>, <span class="stringliteral">&quot;Imager creation failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        fractal_shm-&gt;eo_context_pixel_handler.eo = eo_pixel_handler;</div>
<div class="line">        fractal_shm-&gt;eo_context_worker.eo = eo_worker;</div>
<div class="line">        fractal_shm-&gt;eo_context_imager.eo = eo_imager;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Create event group to use with the imager data queue */</span></div>
<div class="line">        fractal_shm-&gt;egrp_imager = <a name="a16"></a><a class="code" href="../../d8/d4c/group__em__event__group.html#ga59755895fbc8f370c6904610326b2594">em_event_group_create</a>();</div>
<div class="line">        test_fatal_if(fractal_shm-&gt;egrp_imager == <a name="a17"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#adb766a36099bdc633d8aa36e82e889a2">EM_EVENT_GROUP_UNDEF</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;Event group creation failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Run system commands */</span></div>
<div class="line">        run_system_cmds();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Allocates all data events */</span></div>
<div class="line">        create_data_events();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Start EO pixel_handler */</span></div>
<div class="line">        ret = <a name="a18"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gabe4f7a789ec9523367c086793061562d">em_eo_start_sync</a>(eo_pixel_handler, &amp;start_ret, NULL);</div>
<div class="line">        test_fatal_if(ret != <a name="a19"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a> || start_ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO pixel handler start:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; %&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                      ret, start_ret);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Start EO worker */</span></div>
<div class="line">        ret = <a class="code" href="../../d8/d5f/group__em__eo.html#gabe4f7a789ec9523367c086793061562d">em_eo_start_sync</a>(eo_worker, &amp;start_ret, NULL);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a> || start_ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO worker start:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; %&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                      ret, start_ret);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Start EO imager */</span></div>
<div class="line">        ret = <a class="code" href="../../d8/d5f/group__em__eo.html#gabe4f7a789ec9523367c086793061562d">em_eo_start_sync</a>(eo_imager, &amp;start_ret, NULL);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a> || start_ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO imager start:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; %&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                      ret, start_ret);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test_stop(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line">        <span class="keyword">const</span> em_eo_t eo_pixel_handler =</div>
<div class="line">              fractal_shm-&gt;eo_context_pixel_handler.eo;</div>
<div class="line">        <span class="keyword">const</span> em_eo_t eo_worker = fractal_shm-&gt;eo_context_worker.eo;</div>
<div class="line">        <span class="keyword">const</span> em_eo_t eo_imager = fractal_shm-&gt;eo_context_imager.eo;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> stat;</div>
<div class="line">        em_event_group_t egrp;</div>
<div class="line">        <a name="_a20"></a><a class="code" href="../../d8/db3/structem__notif__t.html">em_notif_t</a> notif_tbl[1] = { {.<a name="a21"></a><a class="code" href="../../d8/db3/structem__notif__t.html#af11de4e82ee78d6222a18ba93ffefa11">event</a> = <a name="a22"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>} };</div>
<div class="line">        <span class="keywordtype">int</span> num_notifs;</div>
<div class="line"> </div>
<div class="line">        (void)appl_conf;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%s() on EM-core %d\n&quot;</span>, __func__, core);</div>
<div class="line"> </div>
<div class="line">        stat = <a name="a23"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gadce026621953114bd26e5836d9693465">em_eo_stop_sync</a>(eo_pixel_handler);</div>
<div class="line">        <span class="keywordflow">if</span> (stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                APPL_EXIT_FAILURE(<span class="stringliteral">&quot;EO pixel handler stop failed!&quot;</span>);</div>
<div class="line">        stat = <a name="a24"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gae769b19e613b24487beb943cfb926977">em_eo_delete</a>(eo_pixel_handler);</div>
<div class="line">        <span class="keywordflow">if</span> (stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                APPL_EXIT_FAILURE(<span class="stringliteral">&quot;EO pixel handler delete failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        stat = <a class="code" href="../../d8/d5f/group__em__eo.html#gadce026621953114bd26e5836d9693465">em_eo_stop_sync</a>(eo_worker);</div>
<div class="line">        <span class="keywordflow">if</span> (stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                APPL_EXIT_FAILURE(<span class="stringliteral">&quot;EO worker stop failed!&quot;</span>);</div>
<div class="line">        stat = <a class="code" href="../../d8/d5f/group__em__eo.html#gae769b19e613b24487beb943cfb926977">em_eo_delete</a>(eo_worker);</div>
<div class="line">        <span class="keywordflow">if</span> (stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                APPL_EXIT_FAILURE(<span class="stringliteral">&quot;EO worker delete failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        stat = <a class="code" href="../../d8/d5f/group__em__eo.html#gadce026621953114bd26e5836d9693465">em_eo_stop_sync</a>(eo_imager);</div>
<div class="line">        <span class="keywordflow">if</span> (stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                APPL_EXIT_FAILURE(<span class="stringliteral">&quot;EO imager stop failed!&quot;</span>);</div>
<div class="line">        stat = <a class="code" href="../../d8/d5f/group__em__eo.html#gae769b19e613b24487beb943cfb926977">em_eo_delete</a>(eo_imager);</div>
<div class="line">        <span class="keywordflow">if</span> (stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)</div>
<div class="line">                APPL_EXIT_FAILURE(<span class="stringliteral">&quot;EO imager delete failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* No more dispatching of the EO&#39;s events, egrp can be freed */</span></div>
<div class="line"> </div>
<div class="line">        egrp = fractal_shm-&gt;egrp_imager;</div>
<div class="line">        <span class="keywordflow">if</span> (!<a name="a25"></a><a class="code" href="../../d8/d4c/group__em__event__group.html#ga3088eff7f06c9d1c621a01eab3601fe5">em_event_group_is_ready</a>(egrp)) {</div>
<div class="line">                num_notifs = <a name="a26"></a><a class="code" href="../../d8/d4c/group__em__event__group.html#ga4119a66ac9ed21b11288602e6b68827a">em_event_group_get_notif</a>(egrp, 1, notif_tbl);</div>
<div class="line">                stat = <a name="a27"></a><a class="code" href="../../d8/d4c/group__em__event__group.html#ga5b2619e0d19c4a958b06d5f15b652ba3">em_event_group_abort</a>(egrp);</div>
<div class="line">                <span class="keywordflow">if</span> (stat == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a> &amp;&amp; num_notifs == 1)</div>
<div class="line">                        <a name="a28"></a><a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(notif_tbl[0].event);</div>
<div class="line">        }</div>
<div class="line">        stat = <a name="a29"></a><a class="code" href="../../d8/d4c/group__em__event__group.html#ga221c47c47f119b44eec0b0a85b7c11ed">em_event_group_delete</a>(egrp);</div>
<div class="line">        test_fatal_if(stat != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;egrp:%&quot;</span> <a name="a30"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#adca2f2f8040040218a3ec6795a9f1864">PRI_EGRP</a> <span class="stringliteral">&quot; delete:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                      egrp, stat);</div>
<div class="line"> </div>
<div class="line">        free_data_events();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test_term(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        (void)appl_conf;</div>
<div class="line">        <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%s() on EM-core %d\n&quot;</span>, __func__, core);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (core == 0) {</div>
<div class="line">                env_shared_free(fractal_shm);</div>
<div class="line">                <a name="a31"></a><a class="code" href="../../db/da0/group__em__error.html#gab6b469100e5f60670a742d944a6f530b">em_unregister_error_handler</a>();</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">snprintf_check(<span class="keywordtype">int</span> cmd_size, <span class="keywordtype">int</span> ret)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (ret &lt; 0 || ret &gt;= cmd_size)</div>
<div class="line">                APPL_EXIT_FAILURE(<span class="stringliteral">&quot;snprintf(): ret=%d, errno(%i)=%s&quot;</span>,</div>
<div class="line">                                  ret, errno, strerror(errno));</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Mounts ramdisk and opens feh as a background process.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">run_system_cmds(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> ret;</div>
<div class="line">        <span class="keywordtype">char</span> cmd[256];</div>
<div class="line">        <span class="keywordtype">int</span> ramdisk_size = (WIDTH * HEIGHT * 6) / 1000000 + 1;</div>
<div class="line">        <span class="keyword">struct </span>sigaction sa, old_sa;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Change to default signal handler for SIGCHLD during system calls */</span></div>
<div class="line">        sigemptyset(&amp;sa.sa_mask);</div>
<div class="line">        sa.sa_flags = 0;</div>
<div class="line">        sa.sa_handler = SIG_DFL;</div>
<div class="line">        <span class="keywordflow">if</span> (sigaction(SIGCHLD, &amp;sa, &amp;old_sa) == -1)</div>
<div class="line">                APPL_EXIT_FAILURE(<span class="stringliteral">&quot;sigaction(): errno(%i)=%s&quot;</span>, errno,</div>
<div class="line">                                  strerror(errno));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Create output directory */</span></div>
<div class="line">        ret = snprintf(cmd, <span class="keyword">sizeof</span>(cmd), <span class="stringliteral">&quot;mkdir -p %s&quot;</span>, IMAGE_DIR);</div>
<div class="line">        snprintf_check(<span class="keyword">sizeof</span>(cmd), ret);</div>
<div class="line"> </div>
<div class="line">        ret = system(cmd);</div>
<div class="line">        <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">                APPL_EXIT_FAILURE(<span class="stringliteral">&quot;Failed to create output dir: %s\n&quot;</span>, cmd);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Remount ramdisk if it already exists*/</span></div>
<div class="line">        ret = snprintf(cmd, <span class="keyword">sizeof</span>(cmd), REMOUNT_RAMDISK_FMT,</div>
<div class="line">                       IMAGE_DIR, ramdisk_size, IMAGE_DIR);</div>
<div class="line"> </div>
<div class="line">        snprintf_check(<span class="keyword">sizeof</span>(cmd), ret);</div>
<div class="line"> </div>
<div class="line">        ret = system(cmd);</div>
<div class="line">        <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;Ramdisk mount failed.\n&quot;</span></div>
<div class="line">                           <span class="stringliteral">&quot;Run as root/sudo for better performance.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Check and start image viewer  */</span></div>
<div class="line">        ret = system(<span class="stringliteral">&quot;feh -v &gt; /dev/null&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (ret != 0) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;NOTE: Install &#39;feh&#39; or open %s\n&quot;</span>, IMAGE_PATH);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                ret = snprintf(cmd, <span class="keyword">sizeof</span>(cmd),</div>
<div class="line">                               <span class="stringliteral">&quot;echo \&quot;P6\n1 1\n255\n\&quot; &gt; %s; feh %s -R %f &amp;&quot;</span>,</div>
<div class="line">                               IMAGE_PATH, IMAGE_PATH, IMAGE_VIEW_RATE);</div>
<div class="line"> </div>
<div class="line">                snprintf_check(<span class="keyword">sizeof</span>(cmd), ret);</div>
<div class="line"> </div>
<div class="line">                ret = system(cmd);</div>
<div class="line">                <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;NOTE: &#39;feh&#39; unable to display %s\n&quot;</span>,</div>
<div class="line">                                   IMAGE_PATH);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (sigaction(SIGCHLD, &amp;old_sa, NULL) == -1)</div>
<div class="line">                APPL_EXIT_FAILURE(<span class="stringliteral">&quot;sigaction(): errno(%i)=%s&quot;</span>, errno,</div>
<div class="line">                                  strerror(errno));</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Creates all imager data events and calculates block values</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">create_data_events(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        imager_data_event_t *image_data_event;</div>
<div class="line">        em_event_t event;</div>
<div class="line">        <span class="keywordtype">int</span> y, x_start, x_len;</div>
<div class="line">        <span class="keywordtype">int</span> index;</div>
<div class="line"> </div>
<div class="line">        index = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Start filling event array */</span></div>
<div class="line">        <span class="keywordflow">for</span> (y = 0; y &lt; HEIGHT; y++) {</div>
<div class="line">                <span class="comment">/* Pixels in curr horizontal line divided into smaller blocks*/</span></div>
<div class="line">                x_start = 0;</div>
<div class="line">                <span class="keywordflow">while</span> (x_start &lt; WIDTH) {</div>
<div class="line">                        <span class="keywordflow">if</span> (x_start + IMAGE_BLOCK_SIZE &gt; WIDTH - 1)</div>
<div class="line">                                x_len = WIDTH - x_start;</div>
<div class="line">                        <span class="keywordflow">else</span></div>
<div class="line">                                x_len = IMAGE_BLOCK_SIZE;</div>
<div class="line"> </div>
<div class="line">                        <span class="keyword">event</span> = <a name="a32"></a><a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(fractal_event_t),</div>
<div class="line">                                         <a name="a33"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>,</div>
<div class="line">                                         fractal_shm-&gt;pool);</div>
<div class="line">                        test_fatal_if(event == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>,</div>
<div class="line">                                      <span class="stringliteral">&quot;Event alloc failed!&quot;</span>);</div>
<div class="line">                        image_data_event = <a name="a34"></a><a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line"> </div>
<div class="line">                        image_data_event-&gt;y = y;</div>
<div class="line">                        image_data_event-&gt;x_len = x_len;</div>
<div class="line">                        image_data_event-&gt;x_start = x_start;</div>
<div class="line">                        image_data_event-&gt;frame = 0;</div>
<div class="line">                        <span class="comment">/* Store array storage index into the event */</span></div>
<div class="line">                        image_data_event-&gt;data_evtbl_idx = index;</div>
<div class="line">                        <span class="comment">/* Add to array */</span></div>
<div class="line">                        test_fatal_if(index &gt;= ALLOC_EVENTS,</div>
<div class="line">                                      <span class="stringliteral">&quot;Event-tbl too small&quot;</span>);</div>
<div class="line">                        fractal_shm-&gt;data_event_tbl[index++] = event;</div>
<div class="line">                        image_data_event = NULL;</div>
<div class="line">                        x_start += IMAGE_BLOCK_SIZE;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Frees all imager data events</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">free_data_events(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        em_event_t event;</div>
<div class="line">        <span class="keywordtype">int</span> y, x_start;</div>
<div class="line">        <span class="keywordtype">int</span> index = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Free event array */</span></div>
<div class="line">        <span class="keywordflow">for</span> (y = 0; y &lt; HEIGHT; y++) {</div>
<div class="line">                <span class="comment">/* Pixels in curr horizontal line divided into smaller blocks*/</span></div>
<div class="line">                <span class="keywordflow">for</span> (x_start = 0; x_start &lt; WIDTH;</div>
<div class="line">                     x_start += IMAGE_BLOCK_SIZE) {</div>
<div class="line">                        test_fatal_if(index &gt;= ALLOC_EVENTS,</div>
<div class="line">                                      <span class="stringliteral">&quot;Event-tbl too small&quot;</span>);</div>
<div class="line">                        <span class="keyword">event</span> = fractal_shm-&gt;data_event_tbl[index++];</div>
<div class="line">                        <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO start function.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">pixel_handler_start(my_eo_context_t *eo_ctx, em_eo_t eo,</div>
<div class="line">                    <span class="keyword">const</span> <a class="code" href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a> *conf)</div>
<div class="line">{</div>
<div class="line">        em_queue_t queue;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> status;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *queue_name;</div>
<div class="line"> </div>
<div class="line">        (void)conf;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Copy EO name */</span></div>
<div class="line">        <a name="a35"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gae4fbadae4cc0158b24fdcdb6cf5e04fe">em_eo_get_name</a>(eo, eo_ctx-&gt;name, <span class="keyword">sizeof</span>(eo_ctx-&gt;name));</div>
<div class="line"> </div>
<div class="line">        queue_name = <span class="stringliteral">&quot;queue Pixel handler&quot;</span>;</div>
<div class="line"> </div>
<div class="line">        queue = <a name="a36"></a><a class="code" href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a>(queue_name, <a name="a37"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea">EM_QUEUE_TYPE_PARALLEL</a>,</div>
<div class="line">                                <a name="a38"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca">EM_QUEUE_PRIO_NORMAL</a>, <a name="a39"></a><a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a>,</div>
<div class="line">                                NULL);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(queue == <a name="a40"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#ae8ba676fb5528d220363edad0aeef1ff">EM_QUEUE_UNDEF</a>, <span class="stringliteral">&quot;%s creation failed!&quot;</span>,</div>
<div class="line">                      queue_name);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Store the queue handle */</span></div>
<div class="line">        fractal_shm-&gt;queue_pixel = queue;</div>
<div class="line"> </div>
<div class="line">        status = <a name="a41"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a>(eo, queue);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(status != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;EO add queue:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;EO:%&quot;</span> <a name="a42"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; Q:%&quot;</span> <a name="a43"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                      status, eo, queue);</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Started %s - EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot;. Q:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;.\n&quot;</span>,</div>
<div class="line">                   eo_ctx-&gt;name, eo, queue);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Pixel Handler EO receive function.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Receives a new frame event from Imager EO.</span></div>
<div class="line"><span class="comment"> * Changes the frame value in the preallocated events and sends them to Worker</span></div>
<div class="line"><span class="comment"> * EO for processing.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">pixel_handler_receive_event(my_eo_context_t *eo_ctx, em_event_t event,</div>
<div class="line">                            <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> type, em_queue_t queue,</div>
<div class="line">                            <span class="keywordtype">void</span> *q_ctx)</div>
<div class="line">{</div>
<div class="line">        pixel_handler_event_t *<span class="keyword">const</span> pixel = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line">        <span class="keyword">const</span> uint32_t frame = pixel-&gt;frame;</div>
<div class="line">        <span class="keywordtype">int</span> num_sent = 0;</div>
<div class="line">        <span class="keywordtype">int</span> i, j;</div>
<div class="line"> </div>
<div class="line">        (void)eo_ctx;</div>
<div class="line">        (void)type;</div>
<div class="line">        (void)queue;</div>
<div class="line">        (void)q_ctx;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">        <span class="keywordflow">if</span> (unlikely(appl_shm-&gt;exit_flag))</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Start filling worker queue */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; EVENTS_PER_IMAGE; i++) {</div>
<div class="line">                imager_data_event_t *data;</div>
<div class="line"> </div>
<div class="line">                data = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(fractal_shm-&gt;data_event_tbl[i]);</div>
<div class="line">                data-&gt;frame = frame;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> send_rounds = EVENTS_PER_IMAGE / SEND_MULTI_MAX;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> left_over = EVENTS_PER_IMAGE % SEND_MULTI_MAX;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0, j = 0; i &lt; send_rounds; i++, j += SEND_MULTI_MAX) {</div>
<div class="line">                num_sent += <a name="a44"></a><a class="code" href="../../d5/d33/group__em__event.html#ga272587cb3a55dd241332fd13b6e19054">em_send_multi</a>(&amp;fractal_shm-&gt;data_event_tbl[j],</div>
<div class="line">                                          SEND_MULTI_MAX,</div>
<div class="line">                                          fractal_shm-&gt;queue_worker);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (left_over)</div>
<div class="line">                num_sent += <a class="code" href="../../d5/d33/group__em__event.html#ga272587cb3a55dd241332fd13b6e19054">em_send_multi</a>(&amp;fractal_shm-&gt;data_event_tbl[j],</div>
<div class="line">                                          left_over,</div>
<div class="line">                                          fractal_shm-&gt;queue_worker);</div>
<div class="line">        <span class="keywordflow">if</span> (unlikely(num_sent != EVENTS_PER_IMAGE)) {</div>
<div class="line">                <span class="keywordflow">for</span> (i = num_sent; i &lt; EVENTS_PER_IMAGE; i++)</div>
<div class="line">                        <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(fractal_shm-&gt;data_event_tbl[i]);</div>
<div class="line">                test_fatal_if(!appl_shm-&gt;exit_flag,</div>
<div class="line">                              <span class="stringliteral">&quot;em_send_multi(): num_sent:%d Q:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                              num_sent, fractal_shm-&gt;queue_worker);</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO stop functions.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">pixel_handler_stop(my_eo_context_t *eo_ctx, em_eo_t eo)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;pixel handler stop (%s, eo id %&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                   eo_ctx-&gt;name, eo);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* remove and delete all of the EO&#39;s queues */</span></div>
<div class="line">        ret = <a name="a45"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga10cf8094caa56026eb0a402d3d22da23">em_eo_remove_queue_all_sync</a>(eo, <a name="a46"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a419c8373b72a8c5ed1c3e3ded3e262e0">EM_TRUE</a>);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO remove queue all:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                      ret, eo);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">worker_stop(my_eo_context_t *eo_ctx, em_eo_t eo)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;worker stop (%s, eo id %&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                   eo_ctx-&gt;name, eo);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* remove and delete all of the EO&#39;s queues */</span></div>
<div class="line">        ret = <a class="code" href="../../d8/d5f/group__em__eo.html#ga10cf8094caa56026eb0a402d3d22da23">em_eo_remove_queue_all_sync</a>(eo, <a class="code" href="../../d4/d11/event__machine__types_8h.html#a419c8373b72a8c5ed1c3e3ded3e262e0">EM_TRUE</a>);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO remove queue all:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                      ret, eo);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">imager_stop(imager_eo_context_t *eo_ctx, em_eo_t eo)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;imager stop (%s, eo id %&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                   eo_ctx-&gt;name, eo);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* remove and delete all of the EO&#39;s queues */</span></div>
<div class="line">        ret = <a class="code" href="../../d8/d5f/group__em__eo.html#ga10cf8094caa56026eb0a402d3d22da23">em_eo_remove_queue_all_sync</a>(eo, <a class="code" href="../../d4/d11/event__machine__types_8h.html#a419c8373b72a8c5ed1c3e3ded3e262e0">EM_TRUE</a>);</div>
<div class="line">        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO remove queue all:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                      ret, eo);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Worker EO receive function.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Calculates color values for the pixels in the given block.</span></div>
<div class="line"><span class="comment"> * Fills the values in the received event and forwards the event to Imager EO.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">worker_receive_event(my_eo_context_t *eo_ctx, em_event_t event,</div>
<div class="line">                     <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> type, em_queue_t queue, <span class="keywordtype">void</span> *q_ctx)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> status;</div>
<div class="line">        em_event_group_t event_group;</div>
<div class="line">        imager_data_event_t *<span class="keyword">const</span> block = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line">        <span class="keywordtype">double</span> frame = block-&gt;frame;</div>
<div class="line"> </div>
<div class="line">        (void)eo_ctx;</div>
<div class="line">        (void)type;</div>
<div class="line">        (void)queue;</div>
<div class="line">        (void)q_ctx;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (unlikely(appl_shm-&gt;exit_flag)) {</div>
<div class="line">                <span class="comment">/*</span></div>
<div class="line"><span class="comment">                 * Store the event into the same fractal_shm-&gt;data_event_tbl[]</span></div>
<div class="line"><span class="comment">                 * location it originally was allocated &amp; stored in - this needs</span></div>
<div class="line"><span class="comment">                 * to be done if the event-handle is updated as it passes</span></div>
<div class="line"><span class="comment">                 * between the user and EM for event-state verification (debug).</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                fractal_shm-&gt;data_event_tbl[block-&gt;data_evtbl_idx] = event;</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Each iteration, it calculates: newz = oldz*oldz + p, where p is the</span></div>
<div class="line"><span class="comment">         * current pixel, and oldz stars at the origin</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="comment">/* real and imaginary part of the pixel p */</span></div>
<div class="line">        <span class="keywordtype">double</span> pr, pi;</div>
<div class="line">        <span class="comment">/* real and imag parts of new and old z */</span></div>
<div class="line">        <span class="keywordtype">double</span> new_re, new_im, old_re, old_im;</div>
<div class="line">        <span class="comment">/* you can change the following to zoom and change position */</span></div>
<div class="line">        <span class="keywordtype">double</span> zoom = pow(frame, 2) / 1000;</div>
<div class="line">        <span class="keywordtype">double</span> move_x = ZOOM_POINT_X;</div>
<div class="line">        <span class="keywordtype">double</span> move_y = -ZOOM_POINT_Y;</div>
<div class="line">        <span class="keywordtype">int</span> x;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (x = block-&gt;x_start; x &lt; (block-&gt;x_len + block-&gt;x_start); x++) {<span class="comment"></span></div>
<div class="line"><span class="comment">                /**</span></div>
<div class="line"><span class="comment">                 * Calculate the initial real and imaginary part of z, based</span></div>
<div class="line"><span class="comment">                 * on the pixel location and zoom and position values</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                pr = 1.5 * (x - WIDTH / 2) / (0.5 * zoom * WIDTH) + move_x;</div>
<div class="line">                pi = (block-&gt;y - HEIGHT / 2) / (0.5 * zoom * HEIGHT) + move_y;</div>
<div class="line">                <span class="comment">/* these should start at 0,0 */</span></div>
<div class="line">                new_re = 0, new_im = 0, old_re = 0, old_im = 0;</div>
<div class="line">                <span class="comment">/* &quot;i&quot; will represent the number of iterations */</span></div>
<div class="line">                <span class="keywordtype">int</span> i;</div>
<div class="line">                <span class="comment">/* Start the iteration process */</span></div>
<div class="line">                <span class="keywordflow">for</span> (i = 0; i &lt; MAX_ITERATIONS; i++) {</div>
<div class="line">                        <span class="comment">/* Remember value of previous iteration */</span></div>
<div class="line">                        old_re = new_re;</div>
<div class="line">                        old_im = new_im;</div>
<div class="line">                        <span class="comment">/* Calculate the real and imaginary part */</span></div>
<div class="line">                        new_re = old_re * old_re - old_im * old_im + pr;</div>
<div class="line">                        new_im = 2 * old_re * old_im + pi;</div>
<div class="line">                        <span class="comment">/* Stop if point is outside of circle with radius 2 */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (new_re * new_re + new_im * new_im &gt; 4)</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                block-&gt;pix_iter_array[x - block-&gt;x_start] = i;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        event_group = fractal_shm-&gt;egrp_imager;</div>
<div class="line">        status = <a name="a47"></a><a class="code" href="../../d8/d4c/group__em__event__group.html#gab1ecab5cd71642d3909ffb6a907fd9a5">em_send_group</a>(event, fractal_shm-&gt;queue_data_imager,</div>
<div class="line">                               event_group);</div>
<div class="line">        <span class="keywordflow">if</span> (unlikely(status != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)) {</div>
<div class="line">                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">                test_fatal_if(!appl_shm-&gt;exit_flag,</div>
<div class="line">                              <span class="stringliteral">&quot;em_send_group():%&quot;</span> PRI_STAT <span class="stringliteral">&quot; Q:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                              status, fractal_shm-&gt;queue_data_imager);</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO start function.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">worker_start(my_eo_context_t *eo_ctx, em_eo_t eo, <span class="keyword">const</span> <a class="code" href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a> *conf)</div>
<div class="line">{</div>
<div class="line">        em_queue_t queue;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> status;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *queue_name;</div>
<div class="line"> </div>
<div class="line">        (void)conf;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Copy EO name */</span></div>
<div class="line">        <a class="code" href="../../d8/d5f/group__em__eo.html#gae4fbadae4cc0158b24fdcdb6cf5e04fe">em_eo_get_name</a>(eo, eo_ctx-&gt;name, <span class="keyword">sizeof</span>(eo_ctx-&gt;name));</div>
<div class="line"> </div>
<div class="line">        queue_name = <span class="stringliteral">&quot;queue Worker&quot;</span>;</div>
<div class="line"> </div>
<div class="line">        queue = <a class="code" href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a>(queue_name, <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea">EM_QUEUE_TYPE_PARALLEL</a>,</div>
<div class="line">                                <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca">EM_QUEUE_PRIO_NORMAL</a>, <a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a>,</div>
<div class="line">                                NULL);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(queue == <a class="code" href="../../d4/d11/event__machine__types_8h.html#ae8ba676fb5528d220363edad0aeef1ff">EM_QUEUE_UNDEF</a>, <span class="stringliteral">&quot;%s creation failed!&quot;</span>,</div>
<div class="line">                      queue_name);</div>
<div class="line">        <span class="comment">/* Store the queue handle */</span></div>
<div class="line">        fractal_shm-&gt;queue_worker = queue;</div>
<div class="line"> </div>
<div class="line">        status = <a class="code" href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a>(eo, queue);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(status != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;EO add queue:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; Queue:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                      status, eo, queue);</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Started %s - EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot;. Q:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;.\n&quot;</span>,</div>
<div class="line">                   eo_ctx-&gt;name, eo, queue);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Imager EO receive function.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Data queue: Writes pixel blocks to buffer in memory.</span></div>
<div class="line"><span class="comment"> * Notif queue: Image is now ready so writes buffer to file and sends a new</span></div>
<div class="line"><span class="comment"> * frame event to Pixel Handler EO.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">imager_receive_event(imager_eo_context_t *eo_ctx, em_event_t event,</div>
<div class="line">                     <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> type, em_queue_t queue,</div>
<div class="line">                     imager_queue_context_t *q_ctx)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> status;</div>
<div class="line"> </div>
<div class="line">        (void)type;</div>
<div class="line">        (void)queue;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">switch</span> (q_ctx-&gt;id) {</div>
<div class="line">        <span class="keywordflow">case</span> DATA_QUEUE: {</div>
<div class="line">                imager_data_event_t *<span class="keyword">const</span> block = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/*</span></div>
<div class="line"><span class="comment">                 * Store the event into the same fractal_shm-&gt;data_event_tbl[]</span></div>
<div class="line"><span class="comment">                 * location it originally was allocated &amp; stored in - this needs</span></div>
<div class="line"><span class="comment">                 * to be done if the event-handle is updated as it passes</span></div>
<div class="line"><span class="comment">                 * between the user and EM for event-state verification (debug).</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                fractal_shm-&gt;data_event_tbl[block-&gt;data_evtbl_idx] = event;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (unlikely(appl_shm-&gt;exit_flag))</div>
<div class="line">                        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y = block-&gt;y;</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x_start = block-&gt;x_start;</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x_len = block-&gt;x_len;</div>
<div class="line">                buffer_t *<span class="keyword">const</span> buf = &amp;eo_ctx-&gt;buf[eo_ctx-&gt;buf_idx];</div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (i = 0; i &lt; x_len; i++) {</div>
<div class="line">                        <span class="comment">/* 3 =&gt; x, x+1, x+2 */</span></div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x = (x_start + i) * 3;</div>
<div class="line">                        <span class="keyword">const</span> uint16_t pix_iter = block-&gt;pix_iter_array[i];</div>
<div class="line">                        <span class="comment">/* RED */</span></div>
<div class="line">                        buf-&gt;line[y].col[x] = pix_iter % 256;</div>
<div class="line">                        <span class="comment">/* GREEN */</span></div>
<div class="line">                        buf-&gt;line[y].col[x + 1] =</div>
<div class="line">                                (eo_ctx-&gt;frame * pix_iter) % 256;</div>
<div class="line">                        <span class="comment">/* BLUE */</span></div>
<div class="line">                        buf-&gt;line[y].col[x + 2] =</div>
<div class="line">                                255 * (pix_iter &lt; MAX_ITERATIONS);</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* Notification: Current frame is ready */</span></div>
<div class="line">        <span class="keywordflow">case</span> NOTIF_QUEUE: {</div>
<div class="line">                <span class="keywordflow">if</span> (unlikely(appl_shm-&gt;exit_flag)) {</div>
<div class="line">                        <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">                        <span class="keywordflow">return</span>;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                em_event_group_t event_group;</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* store the image buffer index to write into file */</span></div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">int</span> buf_idx = eo_ctx-&gt;buf_idx;</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* Reapply event group used by data queue and reuse event */</span></div>
<div class="line">                <a class="code" href="../../d8/db3/structem__notif__t.html">em_notif_t</a> notif_tbl[1];</div>
<div class="line"> </div>
<div class="line">                notif_tbl[0].<a class="code" href="../../d8/db3/structem__notif__t.html#af11de4e82ee78d6222a18ba93ffefa11">event</a> = event; <span class="comment">/* == imager_notif */</span></div>
<div class="line">                notif_tbl[0].<a name="a48"></a><a class="code" href="../../d8/db3/structem__notif__t.html#a1264d8b918729d1c703571289ea56f25">queue</a> = fractal_shm-&gt;queue_notif_imager;</div>
<div class="line">                notif_tbl[0].<a name="a49"></a><a class="code" href="../../d8/db3/structem__notif__t.html#a756240ca99311d0b6daf6d3b235aeb93">egroup</a> = <a class="code" href="../../d4/d11/event__machine__types_8h.html#adb766a36099bdc633d8aa36e82e889a2">EM_EVENT_GROUP_UNDEF</a>;</div>
<div class="line"> </div>
<div class="line">                event_group = fractal_shm-&gt;egrp_imager;</div>
<div class="line">                status = <a name="a50"></a><a class="code" href="../../d8/d4c/group__em__event__group.html#ga6dea07585453ebe66afad458dde5eec5">em_event_group_apply</a>(event_group, EVENTS_PER_IMAGE,</div>
<div class="line">                                              1, notif_tbl);</div>
<div class="line">                test_fatal_if(status != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                              <span class="stringliteral">&quot;em_event_group_apply():%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                              status);</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* Start new frame by sending event to Pixel handler */</span></div>
<div class="line">                eo_ctx-&gt;frame++;</div>
<div class="line">                em_event_t new_pixel_event = <a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(fractal_event_t),</div>
<div class="line">                                                      <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>,</div>
<div class="line">                                                      fractal_shm-&gt;pool);</div>
<div class="line">                test_fatal_if(new_pixel_event == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>,</div>
<div class="line">                              <span class="stringliteral">&quot;Event allocation failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                pixel_handler_event_t *<span class="keyword">const</span> new_pixel =</div>
<div class="line">                                      <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(new_pixel_event);</div>
<div class="line">                new_pixel-&gt;frame = eo_ctx-&gt;frame;</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* Modify image buffer index for the next round */</span></div>
<div class="line">                eo_ctx-&gt;buf_idx = (eo_ctx-&gt;buf_idx + 1) % 2; <span class="comment">/* 0,1,0,1,...*/</span></div>
<div class="line"> </div>
<div class="line">                status = <a name="a51"></a><a class="code" href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a>(new_pixel_event, fractal_shm-&gt;queue_pixel);</div>
<div class="line">                <span class="keywordflow">if</span> (unlikely(status != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)) {</div>
<div class="line">                        <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(new_pixel_event);</div>
<div class="line">                        test_fatal_if(!appl_shm-&gt;exit_flag,</div>
<div class="line">                                      <span class="stringliteral">&quot;em_send:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; Q:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                                      status, fractal_shm-&gt;queue_pixel);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/*</span></div>
<div class="line"><span class="comment">                 * After requesting a new frame, write the currently ready</span></div>
<div class="line"><span class="comment">                 * one from the buffer into the ramdisk file at</span></div>
<div class="line"><span class="comment">                 * &#39;TMP_IMAGE_PATH&#39; and then rename it to &#39;IMAGE_PATH&#39;</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                FILE *fp = fopen(TMP_IMAGE_PATH, <span class="stringliteral">&quot;wb+&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                test_fatal_if(fp == NULL, <span class="stringliteral">&quot;Can&#39;t open output file %s&quot;</span>,</div>
<div class="line">                              TMP_IMAGE_PATH);</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* Write image header */</span></div>
<div class="line">                fprintf(fp, <span class="stringliteral">&quot;P6\n%d %d\n255\n&quot;</span>, WIDTH, HEIGHT);</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* Write image buffer to file */</span></div>
<div class="line">                fwrite(&amp;eo_ctx-&gt;buf[buf_idx].line[0].col[0],</div>
<div class="line">                       <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), WIDTH * HEIGHT * 3, fp);</div>
<div class="line">                fclose(fp);</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* Rename file to avoid tearing in the image */</span></div>
<div class="line">                test_fatal_if(rename(TMP_IMAGE_PATH, IMAGE_PATH) != 0,</div>
<div class="line">                              <span class="stringliteral">&quot;Failed to rename file %s to %s.&quot;</span>,</div>
<div class="line">                              TMP_IMAGE_PATH, IMAGE_PATH);</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* Print time taken for frame */</span></div>
<div class="line">                <span class="keyword">struct </span>timespec cur_time;</div>
<div class="line"> </div>
<div class="line">                clock_gettime(CLOCK_MONOTONIC, &amp;cur_time);</div>
<div class="line">                <span class="keywordflow">if</span> (eo_ctx-&gt;next_print_time.tv_sec &lt;= cur_time.tv_sec) {</div>
<div class="line">                        <span class="keywordtype">int</span> fps = eo_ctx-&gt;frame - eo_ctx-&gt;prev_print_frame;</div>
<div class="line"> </div>
<div class="line">                        fprintf(stdout,</div>
<div class="line">                                <span class="stringliteral">&quot;Frames per second: %02d | frames %d - %d\n&quot;</span>,</div>
<div class="line">                                fps, eo_ctx-&gt;prev_print_frame,</div>
<div class="line">                                eo_ctx-&gt;frame - 1);</div>
<div class="line">                        eo_ctx-&gt;prev_print_frame = eo_ctx-&gt;frame;</div>
<div class="line">                        eo_ctx-&gt;next_print_time.tv_sec = cur_time.tv_sec + 1;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/*</span></div>
<div class="line"><span class="comment">                 * Prints the time taken and ends if STOP_AFTER_FRAMES is</span></div>
<div class="line"><span class="comment">                 * greater than 0.</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                <span class="keywordflow">if</span> (START_FROM_FRAME + STOP_AFTER_FRAMES == eo_ctx-&gt;frame) {</div>
<div class="line">                        <span class="keywordtype">double</span> ms = 0;</div>
<div class="line"> </div>
<div class="line">                        ms += (cur_time.tv_sec - eo_ctx-&gt;start_time.tv_sec) *</div>
<div class="line">                              1000;</div>
<div class="line">                        ms += (cur_time.tv_nsec - eo_ctx-&gt;start_time.tv_nsec) /</div>
<div class="line">                              1000000;</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;%d frames in %.3f seconds.\n&quot;</span>,</div>
<div class="line">                                   STOP_AFTER_FRAMES, ms / 1000);</div>
<div class="line">                        exit(EXIT_SUCCESS);</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">                test_error(<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xec0de), 0xdead,</div>
<div class="line">                           <span class="stringliteral">&quot;Unknown queue id(%u)!&quot;</span>, q_ctx-&gt;id);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO start function.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">imager_start(imager_eo_context_t *eo_ctx, em_eo_t eo, <span class="keyword">const</span> <a class="code" href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a> *conf)</div>
<div class="line">{</div>
<div class="line">        em_queue_t queue;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> status;</div>
<div class="line">        imager_queue_context_t *q_ctx;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *queue_name;</div>
<div class="line">        <a class="code" href="../../d8/db3/structem__notif__t.html">em_notif_t</a> notif_tbl[1];</div>
<div class="line">        em_event_group_t event_group;</div>
<div class="line">        em_event_t event;</div>
<div class="line"> </div>
<div class="line">        (void)conf;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Copy EO name */</span></div>
<div class="line">        <a class="code" href="../../d8/d5f/group__em__eo.html#gae4fbadae4cc0158b24fdcdb6cf5e04fe">em_eo_get_name</a>(eo, eo_ctx-&gt;name, <span class="keyword">sizeof</span>(eo_ctx-&gt;name));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Create data queue */</span></div>
<div class="line">        queue_name = <span class="stringliteral">&quot;data queue imager&quot;</span>;</div>
<div class="line">        queue = <a class="code" href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a>(queue_name, <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea">EM_QUEUE_TYPE_PARALLEL</a>,</div>
<div class="line">                                <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca">EM_QUEUE_PRIO_NORMAL</a>, <a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a>,</div>
<div class="line">                                NULL);</div>
<div class="line">        test_fatal_if(queue == <a class="code" href="../../d4/d11/event__machine__types_8h.html#ae8ba676fb5528d220363edad0aeef1ff">EM_QUEUE_UNDEF</a>, <span class="stringliteral">&quot;%s creation failed!&quot;</span>,</div>
<div class="line">                      queue_name);</div>
<div class="line"> </div>
<div class="line">        status = <a class="code" href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a>(eo, queue);</div>
<div class="line">        test_fatal_if(status != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;EO add queue:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; Queue:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>, status, eo, queue);</div>
<div class="line"> </div>
<div class="line">        fractal_shm-&gt;queue_data_imager = queue;</div>
<div class="line"> </div>
<div class="line">        q_ctx = &amp;fractal_shm-&gt;imager_data_queue_ctx;</div>
<div class="line">        q_ctx-&gt;id = DATA_QUEUE;</div>
<div class="line">        status = <a name="a52"></a><a class="code" href="../../de/d3c/group__em__queue.html#ga83e001b62c2a87bf862fbf695c5e84fa">em_queue_set_context</a>(queue, q_ctx);</div>
<div class="line">        test_fatal_if(status != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO set queue context:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; Queue:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>, status, eo, queue);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Create notification queue */</span></div>
<div class="line">        queue_name = <span class="stringliteral">&quot;notif queue imager&quot;</span>;</div>
<div class="line">        queue = <a class="code" href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a>(queue_name, <a name="a53"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965a43e0ef6f7a63caf0b225a52412ef3032">EM_QUEUE_TYPE_ATOMIC</a>,</div>
<div class="line">                                <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca">EM_QUEUE_PRIO_NORMAL</a>, <a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a>,</div>
<div class="line">                                NULL);</div>
<div class="line">        test_fatal_if(queue == <a class="code" href="../../d4/d11/event__machine__types_8h.html#ae8ba676fb5528d220363edad0aeef1ff">EM_QUEUE_UNDEF</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;%s creation failed!&quot;</span>, queue_name);</div>
<div class="line"> </div>
<div class="line">        q_ctx = &amp;fractal_shm-&gt;imager_notif_queue_ctx;</div>
<div class="line">        q_ctx-&gt;id = NOTIF_QUEUE;</div>
<div class="line">        status = <a class="code" href="../../de/d3c/group__em__queue.html#ga83e001b62c2a87bf862fbf695c5e84fa">em_queue_set_context</a>(queue, q_ctx);</div>
<div class="line">        test_fatal_if(status != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;Set queue context:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; Queue:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                      status, eo, queue);</div>
<div class="line"> </div>
<div class="line">        status = <a class="code" href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a>(eo, queue);</div>
<div class="line">        test_fatal_if(status != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EO add queue:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; Queue:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>, status, eo, queue);</div>
<div class="line"> </div>
<div class="line">        fractal_shm-&gt;queue_notif_imager = queue;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;Started %s - EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot;. Q:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;.\n&quot;</span>,</div>
<div class="line">                   eo_ctx-&gt;name, eo, queue);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Set event group notification */</span></div>
<div class="line">        <span class="keyword">event</span> = <a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(fractal_event_t), <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>,</div>
<div class="line">                         fractal_shm-&gt;pool);</div>
<div class="line">        test_fatal_if(event == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;Event allocation failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        notif_tbl[0].<a class="code" href="../../d8/db3/structem__notif__t.html#af11de4e82ee78d6222a18ba93ffefa11">event</a> = event;</div>
<div class="line">        notif_tbl[0].<a class="code" href="../../d8/db3/structem__notif__t.html#a1264d8b918729d1c703571289ea56f25">queue</a> = fractal_shm-&gt;queue_notif_imager;</div>
<div class="line">        notif_tbl[0].<a class="code" href="../../d8/db3/structem__notif__t.html#a756240ca99311d0b6daf6d3b235aeb93">egroup</a> = <a class="code" href="../../d4/d11/event__machine__types_8h.html#adb766a36099bdc633d8aa36e82e889a2">EM_EVENT_GROUP_UNDEF</a>;</div>
<div class="line"> </div>
<div class="line">        event_group = fractal_shm-&gt;egrp_imager;</div>
<div class="line">        status = <a class="code" href="../../d8/d4c/group__em__event__group.html#ga6dea07585453ebe66afad458dde5eec5">em_event_group_apply</a>(event_group, EVENTS_PER_IMAGE, 1,</div>
<div class="line">                                      notif_tbl);</div>
<div class="line">        test_fatal_if(status != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;em_event_group_apply():%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>, status);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Init EO context */</span></div>
<div class="line">        clock_gettime(CLOCK_MONOTONIC, &amp;eo_ctx-&gt;start_time);</div>
<div class="line">        eo_ctx-&gt;frame = START_FROM_FRAME;</div>
<div class="line">        eo_ctx-&gt;next_print_time = eo_ctx-&gt;start_time;</div>
<div class="line">        eo_ctx-&gt;next_print_time.tv_sec += 1;</div>
<div class="line">        eo_ctx-&gt;prev_print_frame = eo_ctx-&gt;frame;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Send the first event to pixel_handler to start */</span></div>
<div class="line">        pixel_handler_event_t *pixel;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">event</span> = <a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(fractal_event_t), <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>,</div>
<div class="line">                         fractal_shm-&gt;pool);</div>
<div class="line">        test_fatal_if(event == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;Event allocation failed!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        pixel = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line">        pixel-&gt;frame  = eo_ctx-&gt;frame;</div>
<div class="line"> </div>
<div class="line">        status = <a class="code" href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a>(event, fractal_shm-&gt;queue_pixel);</div>
<div class="line">        test_fatal_if(status != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>, <span class="stringliteral">&quot;em_send():%&quot;</span> PRI_STAT <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; Queue:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                      status, eo, fractal_shm-&gt;queue_pixel);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="ttc" id="aenvironment_8h_html"><div class="ttname"><a href="../../de/d26/environment_8h.html">environment.h</a></div></div>
<div class="ttc" id="aenvironment_8h_html_a13093fb72d4f1f0be2f85cf449f4d543"><div class="ttname"><a href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a></div><div class="ttdeci">#define ENV_CACHE_LINE_ALIGNED</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/environment_8h_source.html#l00076">environment.h:76</a></div></div>
<div class="ttc" id="aenvironment_8h_html_a2b2462b2491461a5c14adb1eb4493a8c"><div class="ttname"><a href="../../de/d26/environment_8h.html#a2b2462b2491461a5c14adb1eb4493a8c">ENV_LOCAL</a></div><div class="ttdeci">#define ENV_LOCAL</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/environment_8h_source.html#l00057">environment.h:57</a></div></div>
<div class="ttc" id="aenvironment_8h_html_aba71635a146e563689c50f1be15cb267"><div class="ttname"><a href="../../de/d26/environment_8h.html#aba71635a146e563689c50f1be15cb267">ENV_CACHE_LINE_SIZE</a></div><div class="ttdeci">#define ENV_CACHE_LINE_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/environment_8h_source.html#l00062">environment.h:62</a></div></div>
<div class="ttc" id="aevent__machine_8h_html"><div class="ttname"><a href="../../d7/d5e/event__machine_8h.html">event_machine.h</a></div></div>
<div class="ttc" id="aevent__machine__hw__config_8h_html_aaa0a290a45f4b1280f3330fadde6bfde"><div class="ttname"><a href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a></div><div class="ttdeci">#define EM_POOL_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6d/event__machine__hw__config_8h_source.html#l00191">event_machine_hw_config.h:191</a></div></div>
<div class="ttc" id="aevent__machine__hw__config_8h_html_ae56af1c575498ec19f0836ee916d0eb9"><div class="ttname"><a href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a></div><div class="ttdeci">#define EM_QUEUE_GROUP_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6d/event__machine__hw__config_8h_source.html#l00147">event_machine_hw_config.h:147</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a368b59e8c18f57c4034420e3ba44e965a43e0ef6f7a63caf0b225a52412ef3032"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965a43e0ef6f7a63caf0b225a52412ef3032">EM_QUEUE_TYPE_ATOMIC</a></div><div class="ttdeci">@ EM_QUEUE_TYPE_ATOMIC</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00112">event_machine_hw_types.h:112</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965aa3f46c70193d0a7d9bb8fc149a3179ea">EM_QUEUE_TYPE_PARALLEL</a></div><div class="ttdeci">@ EM_QUEUE_TYPE_PARALLEL</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00117">event_machine_hw_types.h:117</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a5f1ebfb654b7ec3169e068aa3776ff79"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a5f1ebfb654b7ec3169e068aa3776ff79">PRI_POOL</a></div><div class="ttdeci">#define PRI_POOL</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00062">event_machine_hw_types.h:62</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a67fed61187c93569c92da0647970a29f"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a67fed61187c93569c92da0647970a29f">EM_POOL_UNDEF</a></div><div class="ttdeci">#define EM_POOL_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00060">event_machine_hw_types.h:60</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca">EM_QUEUE_PRIO_NORMAL</a></div><div class="ttdeci">@ EM_QUEUE_PRIO_NORMAL</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00153">event_machine_hw_types.h:153</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_ac341b7db29d8127e864a45c9bd2a4aa3"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a></div><div class="ttdeci">#define EM_ERROR_SET_FATAL(error)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00428">event_machine_hw_types.h:428</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a></div><div class="ttdeci">@ EM_EVENT_TYPE_SW</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00072">event_machine_hw_types.h:72</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a0331964318f921644a88d3cc38c122e5"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a></div><div class="ttdeci">#define PRI_QUEUE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00109">event_machine_types.h:109</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a03546e6a7e93665c52d479831e0a6dca"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a></div><div class="ttdeci">#define EM_OK</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00329">event_machine_types.h:329</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a0bf4a25d46e18ee918e684e5deb27fa4"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a></div><div class="ttdeci">#define PRI_EO</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00097">event_machine_types.h:97</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a1f9dbd41491db385bd4a3813e2f030a5"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a1f9dbd41491db385bd4a3813e2f030a5">EM_ERROR</a></div><div class="ttdeci">#define EM_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00337">event_machine_types.h:337</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a419c8373b72a8c5ed1c3e3ded3e262e0"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a419c8373b72a8c5ed1c3e3ded3e262e0">EM_TRUE</a></div><div class="ttdeci">#define EM_TRUE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00053">event_machine_types.h:53</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a49fd700da185b0f64834bf967479a992"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a></div><div class="ttdeci">uint32_t em_event_type_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00085">event_machine_types.h:85</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a8542d9c2c9a29e35ff042b1d59cc479b"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a></div><div class="ttdeci">#define EM_EVENT_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00062">event_machine_types.h:62</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_adb766a36099bdc633d8aa36e82e889a2"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#adb766a36099bdc633d8aa36e82e889a2">EM_EVENT_GROUP_UNDEF</a></div><div class="ttdeci">#define EM_EVENT_GROUP_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00141">event_machine_types.h:141</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_adca2f2f8040040218a3ec6795a9f1864"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#adca2f2f8040040218a3ec6795a9f1864">PRI_EGRP</a></div><div class="ttdeci">#define PRI_EGRP</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00143">event_machine_types.h:143</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_adddd88868f7aa0d32b3e40245eb4ef8f"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div><div class="ttdeci">uint32_t em_status_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00321">event_machine_types.h:321</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_ae8ba676fb5528d220363edad0aeef1ff"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#ae8ba676fb5528d220363edad0aeef1ff">EM_QUEUE_UNDEF</a></div><div class="ttdeci">#define EM_QUEUE_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00107">event_machine_types.h:107</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_af28fb8daf62b942ced417e158ed7e1c7"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#af28fb8daf62b942ced417e158ed7e1c7">EM_EO_UNDEF</a></div><div class="ttdeci">#define EM_EO_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00095">event_machine_types.h:95</a></div></div>
<div class="ttc" id="agroup__em__core_html_ga13d21af31382ec2c3d45010645707e9c"><div class="ttname"><a href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a></div><div class="ttdeci">int em_core_id(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df9/event__machine__core_8c_source.html#l00034">event_machine_core.c:34</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga10cf8094caa56026eb0a402d3d22da23"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga10cf8094caa56026eb0a402d3d22da23">em_eo_remove_queue_all_sync</a></div><div class="ttdeci">em_status_t em_eo_remove_queue_all_sync(em_eo_t eo, int delete_queues)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00517">event_machine_eo.c:517</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga196c7caa1177575fd424e9a0d2854da6"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga196c7caa1177575fd424e9a0d2854da6">em_eo_create</a></div><div class="ttdeci">em_eo_t em_eo_create(const char *name, em_start_func_t start, em_start_local_func_t local_start, em_stop_func_t stop, em_stop_local_func_t local_stop, em_receive_func_t receive, const void *eo_ctx)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00040">event_machine_eo.c:40</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga63161b6f46fb08a1708bad6c1fde2622"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga63161b6f46fb08a1708bad6c1fde2622">em_receive_func_t</a></div><div class="ttdeci">void(* em_receive_func_t)(void *eo_ctx, em_event_t event, em_event_type_t type, em_queue_t queue, void *q_ctx)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5e/event__machine__eo_8h_source.html#l00149">event_machine_eo.h:149</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga71defe535ba0c4e16bf2cddfd4a4f8db"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga71defe535ba0c4e16bf2cddfd4a4f8db">em_stop_func_t</a></div><div class="ttdeci">em_status_t(* em_stop_func_t)(void *eo_ctx, em_eo_t eo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5e/event__machine__eo_8h_source.html#l00301">event_machine_eo.h:301</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gabe4f7a789ec9523367c086793061562d"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gabe4f7a789ec9523367c086793061562d">em_eo_start_sync</a></div><div class="ttdeci">em_status_t em_eo_start_sync(em_eo_t eo, em_status_t *result, const em_eo_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00725">event_machine_eo.c:725</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gac9b818edd466228b6fb653bd9337da3e"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a></div><div class="ttdeci">em_status_t em_eo_add_queue_sync(em_eo_t eo, em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00344">event_machine_eo.c:344</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gad339451d68d77127ac2b7ba806f95c03"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gad339451d68d77127ac2b7ba806f95c03">em_start_func_t</a></div><div class="ttdeci">em_status_t(* em_start_func_t)(void *eo_ctx, em_eo_t eo, const em_eo_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5e/event__machine__eo_8h_source.html#l00227">event_machine_eo.h:227</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gadce026621953114bd26e5836d9693465"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gadce026621953114bd26e5836d9693465">em_eo_stop_sync</a></div><div class="ttdeci">em_status_t em_eo_stop_sync(em_eo_t eo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00897">event_machine_eo.c:897</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gae4fbadae4cc0158b24fdcdb6cf5e04fe"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gae4fbadae4cc0158b24fdcdb6cf5e04fe">em_eo_get_name</a></div><div class="ttdeci">size_t em_eo_get_name(em_eo_t eo, char *name, size_t maxlen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00236">event_machine_eo.c:236</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gae769b19e613b24487beb943cfb926977"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gae769b19e613b24487beb943cfb926977">em_eo_delete</a></div><div class="ttdeci">em_status_t em_eo_delete(em_eo_t eo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00205">event_machine_eo.c:205</a></div></div>
<div class="ttc" id="agroup__em__error_html_gab6b469100e5f60670a742d944a6f530b"><div class="ttname"><a href="../../db/da0/group__em__error.html#gab6b469100e5f60670a742d944a6f530b">em_unregister_error_handler</a></div><div class="ttdeci">em_status_t em_unregister_error_handler(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/de9/event__machine__error_8c_source.html#l00050">event_machine_error.c:50</a></div></div>
<div class="ttc" id="agroup__em__error_html_gaf7332965c5deaa69411136e8d36089c6"><div class="ttname"><a href="../../db/da0/group__em__error.html#gaf7332965c5deaa69411136e8d36089c6">em_register_error_handler</a></div><div class="ttdeci">em_status_t em_register_error_handler(em_error_handler_t handler)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/de9/event__machine__error_8c_source.html#l00034">event_machine_error.c:34</a></div></div>
<div class="ttc" id="agroup__em__event__group_html_ga221c47c47f119b44eec0b0a85b7c11ed"><div class="ttname"><a href="../../d8/d4c/group__em__event__group.html#ga221c47c47f119b44eec0b0a85b7c11ed">em_event_group_delete</a></div><div class="ttdeci">em_status_t em_event_group_delete(em_event_group_t event_group)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd2/event__machine__event__group_8c_source.html#l00057">event_machine_event_group.c:57</a></div></div>
<div class="ttc" id="agroup__em__event__group_html_ga3088eff7f06c9d1c621a01eab3601fe5"><div class="ttname"><a href="../../d8/d4c/group__em__event__group.html#ga3088eff7f06c9d1c621a01eab3601fe5">em_event_group_is_ready</a></div><div class="ttdeci">int em_event_group_is_ready(em_event_group_t event_group)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd2/event__machine__event__group_8c_source.html#l00212">event_machine_event_group.c:212</a></div></div>
<div class="ttc" id="agroup__em__event__group_html_ga4119a66ac9ed21b11288602e6b68827a"><div class="ttname"><a href="../../d8/d4c/group__em__event__group.html#ga4119a66ac9ed21b11288602e6b68827a">em_event_group_get_notif</a></div><div class="ttdeci">int em_event_group_get_notif(em_event_group_t event_group, int max_notif, em_notif_t notif_tbl[])</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd2/event__machine__event__group_8c_source.html#l00735">event_machine_event_group.c:735</a></div></div>
<div class="ttc" id="agroup__em__event__group_html_ga59755895fbc8f370c6904610326b2594"><div class="ttname"><a href="../../d8/d4c/group__em__event__group.html#ga59755895fbc8f370c6904610326b2594">em_event_group_create</a></div><div class="ttdeci">em_event_group_t em_event_group_create(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd2/event__machine__event__group_8c_source.html#l00037">event_machine_event_group.c:37</a></div></div>
<div class="ttc" id="agroup__em__event__group_html_ga5b2619e0d19c4a958b06d5f15b652ba3"><div class="ttname"><a href="../../d8/d4c/group__em__event__group.html#ga5b2619e0d19c4a958b06d5f15b652ba3">em_event_group_abort</a></div><div class="ttdeci">em_status_t em_event_group_abort(em_event_group_t event_group)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd2/event__machine__event__group_8c_source.html#l00685">event_machine_event_group.c:685</a></div></div>
<div class="ttc" id="agroup__em__event__group_html_ga6dea07585453ebe66afad458dde5eec5"><div class="ttname"><a href="../../d8/d4c/group__em__event__group.html#ga6dea07585453ebe66afad458dde5eec5">em_event_group_apply</a></div><div class="ttdeci">em_status_t em_event_group_apply(em_event_group_t event_group, int count, int num_notif, const em_notif_t notif_tbl[])</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd2/event__machine__event__group_8c_source.html#l00093">event_machine_event_group.c:93</a></div></div>
<div class="ttc" id="agroup__em__event__group_html_gab1ecab5cd71642d3909ffb6a907fd9a5"><div class="ttname"><a href="../../d8/d4c/group__em__event__group.html#gab1ecab5cd71642d3909ffb6a907fd9a5">em_send_group</a></div><div class="ttdeci">em_status_t em_send_group(em_event_t event, em_queue_t queue, em_event_group_t event_group)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd2/event__machine__event__group_8c_source.html#l00474">event_machine_event_group.c:474</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga272587cb3a55dd241332fd13b6e19054"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga272587cb3a55dd241332fd13b6e19054">em_send_multi</a></div><div class="ttdeci">int em_send_multi(const em_event_t events[], int num, em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00710">event_machine_event.c:710</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga5f0e40f1b0b4892ee16aafe07ba4c90c"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a></div><div class="ttdeci">em_event_t em_alloc(uint32_t size, em_event_type_t type, em_pool_t pool)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00033">event_machine_event.c:33</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga8f701c3a5901fc81d922b9d1d02691e3"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a></div><div class="ttdeci">void * em_event_pointer(em_event_t event)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00750">event_machine_event.c:750</a></div></div>
<div class="ttc" id="agroup__em__event_html_gaca4584a01b71429dfbb045342454b464"><div class="ttname"><a href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a></div><div class="ttdeci">em_status_t em_send(em_event_t event, em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00661">event_machine_event.c:661</a></div></div>
<div class="ttc" id="agroup__em__event_html_gad4f97ba217518d967f8078c56023c4d4"><div class="ttname"><a href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a></div><div class="ttdeci">void em_free(em_event_t event)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00261">event_machine_event.c:261</a></div></div>
<div class="ttc" id="agroup__em__queue_html_ga83e001b62c2a87bf862fbf695c5e84fa"><div class="ttname"><a href="../../de/d3c/group__em__queue.html#ga83e001b62c2a87bf862fbf695c5e84fa">em_queue_set_context</a></div><div class="ttdeci">em_status_t em_queue_set_context(em_queue_t queue, const void *context)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dba/event__machine__queue_8c_source.html#l00112">event_machine_queue.c:112</a></div></div>
<div class="ttc" id="agroup__em__queue_html_gaef257858d1fa660524f198dba20fa9eb"><div class="ttname"><a href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a></div><div class="ttdeci">em_queue_t em_queue_create(const char *name, em_queue_type_t type, em_queue_prio_t prio, em_queue_group_t group, const em_queue_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dba/event__machine__queue_8c_source.html#l00041">event_machine_queue.c:41</a></div></div>
<div class="ttc" id="astructem__eo__conf__t_html"><div class="ttname"><a href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00242">event_machine_types.h:242</a></div></div>
<div class="ttc" id="astructem__notif__t_html"><div class="ttname"><a href="../../d8/db3/structem__notif__t.html">em_notif_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00268">event_machine_types.h:268</a></div></div>
<div class="ttc" id="astructem__notif__t_html_a1264d8b918729d1c703571289ea56f25"><div class="ttname"><a href="../../d8/db3/structem__notif__t.html#a1264d8b918729d1c703571289ea56f25">em_notif_t::queue</a></div><div class="ttdeci">em_queue_t queue</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00270">event_machine_types.h:270</a></div></div>
<div class="ttc" id="astructem__notif__t_html_a756240ca99311d0b6daf6d3b235aeb93"><div class="ttname"><a href="../../d8/db3/structem__notif__t.html#a756240ca99311d0b6daf6d3b235aeb93">em_notif_t::egroup</a></div><div class="ttdeci">em_event_group_t egroup</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00271">event_machine_types.h:271</a></div></div>
<div class="ttc" id="astructem__notif__t_html_af11de4e82ee78d6222a18ba93ffefa11"><div class="ttname"><a href="../../d8/db3/structem__notif__t.html#af11de4e82ee78d6222a18ba93ffefa11">em_notif_t::event</a></div><div class="ttdeci">em_event_t event</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00269">event_machine_types.h:269</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
  <div id="footer" class="tabs">
   <div class="headertitle"> 
     &copy; 2017 Nokia Networks
   </div>
  </div>
 </body>
</html>
