<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EM-ODP: queues_unscheduled.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doc-stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EM-ODP
   &#160;<span id="projectnumber">3.8.0-1</span>
   </div>
   <div id="projectbrief">Event Machine on ODP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d1/ddd/queues_unscheduled_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">queues_unscheduled.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> *   Copyright (c) 2012, Nokia Siemens Networks</span></div>
<div class="line"><span class="comment"> *   Copyright (c) 2014, Nokia Solutions and Networks</span></div>
<div class="line"><span class="comment"> *   All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> *   modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment"> *   are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer in the</span></div>
<div class="line"><span class="comment"> *       documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment"> *     * Neither the name of the copyright holder nor the names of its</span></div>
<div class="line"><span class="comment"> *       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment"> *       from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment"> *   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment"> *   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment"> *   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment"> *   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment"> *   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment"> *   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment"> *   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @file</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Event Machine performance test</span></div>
<div class="line"><span class="comment"> * (based on the queues.c test and extends it to use also unscheduled</span></div>
<div class="line"><span class="comment"> * queues)</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Measures the average cycles consumed during an event send-sched-receive loop</span></div>
<div class="line"><span class="comment"> * for a certain number of queues and events in the system. The test increases</span></div>
<div class="line"><span class="comment"> * the number of queues[+events] for each measurement round and prints the</span></div>
<div class="line"><span class="comment"> * results. The test will stop if the maximum number of supported queues by the</span></div>
<div class="line"><span class="comment"> * system  is reached.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Each normal scheduled queue is accompanied by an unscheduled queue that is</span></div>
<div class="line"><span class="comment"> * dequeued from at each event receive. Both the received event and the</span></div>
<div class="line"><span class="comment"> * dequeued event is sent to the next queue at the end of the receive function.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The measured cycles contain the scheduled event send-sched-receive cycles as</span></div>
<div class="line"><span class="comment"> * well as the unscheduled event dequeue</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Plot the cycles/event to get an idea of how the system scales with an</span></div>
<div class="line"><span class="comment"> * increasing number of queues.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d5e/event__machine_8h.html">event_machine.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/d26/environment_8h.html">event_machine/platform/env/environment.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;cm_setup.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;cm_error_handler.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Test options:</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Alloc and free per event */</span></div>
<div class="line"><span class="preprocessor">#define ALLOC_FREE_PER_EVENT 0 </span><span class="comment">/* false=0 or true=1 */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Create all EM queues at startup or create the queues during</span></div>
<div class="line"><span class="comment"> * the test in steps.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#define CREATE_ALL_QUEUES_AT_STARTUP 0 </span><span class="comment">/* false=0 or true=1 */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Measure the send-enqueue-schedule-receive latency. Measured separately for</span></div>
<div class="line"><span class="comment"> * &#39;high priority and &#39;low priority&#39; queues (ratio 1:4).</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#define MEASURE_LATENCY 1 </span><span class="comment">/* false=0 or true=1 */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Keep the number of events constant while increasing the number of queues.</span></div>
<div class="line"><span class="comment"> * Should be dividable by or factor of queue_step.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#define CONST_NUM_EVENTS 4096 </span><span class="comment">/* true&gt;0 or false=0 */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Test configuration:</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_CORES  64</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Number of EO&#39;s and scheduled queues in a loop */</span></div>
<div class="line"><span class="preprocessor">#define NUM_EOS  4</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Number of events per queue */</span></div>
<div class="line"><span class="preprocessor">#define NUM_EVENTS  4</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if CONST_NUM_EVENTS &gt; 0</span></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Total number of queues when using a constant number of events.</span></div>
<div class="line"><span class="comment"> * Make sure that all queues, both scheduled and unscheduled (hence /2),</span></div>
<div class="line"><span class="comment"> * get &#39;NUM_EVENTS&#39; events per queue.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#define NUM_QUEUES  ((CONST_NUM_EVENTS / NUM_EVENTS) / 2)</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Total number of queues when increasing the total event count for each queue</span></div>
<div class="line"><span class="comment"> * step.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#define NUM_QUEUES  (NUM_EOS * 16 * 1024)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Number of data bytes in an event */</span></div>
<div class="line"><span class="preprocessor">#define DATA_SIZE  128</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Samples before adding more queues */</span></div>
<div class="line"><span class="preprocessor">#define NUM_SAMPLES  (1 + 8) </span><span class="comment">/* setup(1) + measure(N) */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Num events a core processes between samples */</span></div>
<div class="line"><span class="preprocessor">#define EVENTS_PER_SAMPLE  0x400000</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* EM queue type */</span></div>
<div class="line"><span class="preprocessor">#define QUEUE_TYPE EM_QUEUE_TYPE_ATOMIC</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Core states during test. */</span></div>
<div class="line"><span class="preprocessor">#define CORE_STATE_MEASURE 0</span></div>
<div class="line"><span class="preprocessor">#define CORE_STATE_IDLE    1</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Result APPL_PRINT() format string */</span></div>
<div class="line"><span class="preprocessor">#define RESULT_PRINTF_HDR  &quot;Cycles/Event  Events/s  cpu-freq\n&quot;</span></div>
<div class="line"><span class="preprocessor">#define RESULT_PRINTF_FMT  &quot;%12.0f %7.0f M %5.0f MHz  %&quot;</span> PRIu64 &quot;\n&quot;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Result APPL_PRINT() format string when MEASURE_LATENCY is used */</span></div>
<div class="line"><span class="preprocessor">#define RESULT_PRINTF_LATENCY_HDR \</span></div>
<div class="line"><span class="preprocessor">&quot;Cycles/  Events/  Latency:\n&quot;</span> \</div>
<div class="line">&quot; Event     Sec     hi-ave  hi-max  lo-ave  lo-max  cpu-freq\n&quot;</div>
<div class="line"><span class="preprocessor">#define RESULT_PRINTF_LATENCY_FMT \</span></div>
<div class="line"><span class="preprocessor">&quot;%6.0f %7.2f M %8.0f %7&quot;</span> PRIu64 &quot; %7.0f %7&quot; PRIu64 &quot; %5.0f MHz  %&quot; PRIu64 &quot;\n&quot;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * The number of scheduled queues to use in each test step.</span></div>
<div class="line"><span class="comment"> * Additional unscheduled queues are also created for each step.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * NOTE: The max queue step is always &#39;NUM_QUEUES&#39;, even if the value of</span></div>
<div class="line"><span class="comment"> *       &#39;NUM_QUEUES&#39; would be smaller than a listed queue step (then just stop</span></div>
<div class="line"><span class="comment"> *       before reaching the end of the list).</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> queue_steps[] = {8, 16, 32, 64, 128, 256, 512, 1024, 2048,</div>
<div class="line">                                  4096, 8192, 16384, 32768, 65536, NUM_QUEUES};</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Test state,</span></div>
<div class="line"><span class="comment"> * cache line alignment and padding handled in &#39;perf_shm_t&#39;</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        <span class="keywordtype">int</span> queues;</div>
<div class="line">        <span class="keywordtype">int</span> step;</div>
<div class="line">        <span class="keywordtype">int</span> samples;</div>
<div class="line">        <span class="keywordtype">int</span> num_cores;</div>
<div class="line">        <span class="keywordtype">int</span> reset_flag;</div>
<div class="line">        <span class="keywordtype">double</span> cpu_mhz;</div>
<div class="line">        uint64_t cpu_hz;</div>
<div class="line">        uint64_t print_count;</div>
<div class="line">        <a name="_a0"></a><a class="code" href="../../d5/dcc/struct__env__atomic64.html">env_atomic64_t</a> ready_count;</div>
<div class="line">        <span class="comment">/*  if using CONST_NUM_EVENTS:*/</span></div>
<div class="line">        <span class="keywordtype">int</span> free_flag;</div>
<div class="line">        <a class="code" href="../../d5/dcc/struct__env__atomic64.html">env_atomic64_t</a> freed_count;</div>
<div class="line">} test_status_t;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Performance test statistics (per core)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        uint64_t events;</div>
<div class="line">        env_time_t begin_time;</div>
<div class="line">        env_time_t end_time;</div>
<div class="line">        env_time_t diff_time;</div>
<div class="line">        <span class="keyword">struct </span>{</div>
<div class="line">                uint64_t events;</div>
<div class="line">                env_time_t hi_prio_ave;</div>
<div class="line">                env_time_t hi_prio_max;</div>
<div class="line">                env_time_t lo_prio_ave;</div>
<div class="line">                env_time_t lo_prio_max;</div>
<div class="line">        } latency;</div>
<div class="line">        <span class="comment">/* Pad size to a multiple of cache line size */</span></div>
<div class="line">        <span class="keywordtype">void</span> *end[0] <a name="a1"></a><a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">} core_stat_t;</div>
<div class="line"> </div>
<div class="line">COMPILE_TIME_ASSERT(<span class="keyword">sizeof</span>(core_stat_t) % <a name="a2"></a><a class="code" href="../../de/d26/environment_8h.html#aba71635a146e563689c50f1be15cb267">ENV_CACHE_LINE_SIZE</a> == 0,</div>
<div class="line">                    CORE_STAT_SIZE_ERROR);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * EO context data</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        em_eo_t eo_id;</div>
<div class="line">        <span class="comment">/* Pad size to a multiple of cache line size */</span></div>
<div class="line">        <span class="keywordtype">void</span> *end[0] <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">} eo_context_t;</div>
<div class="line"> </div>
<div class="line">COMPILE_TIME_ASSERT(<span class="keyword">sizeof</span>(eo_context_t) % <a class="code" href="../../de/d26/environment_8h.html#aba71635a146e563689c50f1be15cb267">ENV_CACHE_LINE_SIZE</a> == 0,</div>
<div class="line">                    EO_CONTEXT_T__SIZE_ERROR);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Queue context data</span></div>
<div class="line"><span class="comment"> * Keep the scheduled queue context and the associated unscheduled queue</span></div>
<div class="line"><span class="comment"> * context data in the same cache line for faster access - also eliminates</span></div>
<div class="line"><span class="comment"> * the need to call em_queue_get_context() for the unscheduled queues.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        <span class="keyword">struct </span>scheduled_queue_context {<span class="comment"></span></div>
<div class="line"><span class="comment">                /** This queue */</span></div>
<div class="line">                em_queue_t this_queue;<span class="comment"></span></div>
<div class="line"><span class="comment">                /** Next queue */</span></div>
<div class="line">                em_queue_t next_queue;<span class="comment"></span></div>
<div class="line"><span class="comment">                /** Priority of &#39;this_queue&#39; */</span></div>
<div class="line">                <a class="code" href="../../d4/d11/event__machine__types_8h.html#a58ebf797967a820c57ced595c2b291e9">em_queue_prio_t</a> prio;</div>
<div class="line">        } sch_q;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">struct </span>unscheduled_queue_context {<span class="comment"></span></div>
<div class="line"><span class="comment">                /** This unscheduled queue */</span></div>
<div class="line">                em_queue_t this_queue;<span class="comment"></span></div>
<div class="line"><span class="comment">                /** Next unscheduled queue */</span></div>
<div class="line">                em_queue_t next_queue;</div>
<div class="line">        } unsch_q;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">        /** Pad to multiple of cache line size  */</span></div>
<div class="line">        <span class="keywordtype">void</span> *end[0] <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">} queue_context_t;</div>
<div class="line"> </div>
<div class="line">COMPILE_TIME_ASSERT(<span class="keyword">sizeof</span>(queue_context_t) % <a class="code" href="../../de/d26/environment_8h.html#aba71635a146e563689c50f1be15cb267">ENV_CACHE_LINE_SIZE</a> == 0,</div>
<div class="line">                    QUEUE_CONTEXT_SIZE_ERROR);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Performance test event</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        <span class="comment">/* Send time stamp */</span></div>
<div class="line">        env_time_t send_time;</div>
<div class="line">        <span class="comment">/* Sequence number */</span></div>
<div class="line">        <span class="keywordtype">int</span> seq;</div>
<div class="line">        <span class="comment">/* Test data */</span></div>
<div class="line">        uint8_t data[DATA_SIZE];</div>
<div class="line">} perf_event_t;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Test shared memory</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        <span class="comment">/* Event pool used by this application */</span></div>
<div class="line">        em_pool_t pool;</div>
<div class="line"> </div>
<div class="line">        test_status_t test_status <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line"> </div>
<div class="line">        core_stat_t core_stat[MAX_CORES] <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line"> </div>
<div class="line">        eo_context_t eo_context_tbl[NUM_EOS] <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line"> </div>
<div class="line">        queue_context_t queue_context_tbl[NUM_QUEUES] <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">        <span class="comment">/* EO ID&#39;s */</span></div>
<div class="line">        em_eo_t eo[NUM_EOS] <a class="code" href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a>;</div>
<div class="line">} perf_shm_t;</div>
<div class="line"> </div>
<div class="line">COMPILE_TIME_ASSERT(<span class="keyword">sizeof</span>(perf_shm_t) % <a class="code" href="../../de/d26/environment_8h.html#aba71635a146e563689c50f1be15cb267">ENV_CACHE_LINE_SIZE</a> == 0,</div>
<div class="line">                    PERF_SHM_T__SIZE_ERROR);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* EM-core local pointer to shared memory */</span></div>
<div class="line"><span class="keyword">static</span> <a name="a3"></a><a class="code" href="../../de/d26/environment_8h.html#a2b2462b2491461a5c14adb1eb4493a8c">ENV_LOCAL</a> perf_shm_t *perf_shm;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* EM-core local state */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../de/d26/environment_8h.html#a2b2462b2491461a5c14adb1eb4493a8c">ENV_LOCAL</a> <span class="keywordtype">int</span> core_state = CORE_STATE_MEASURE;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">error_handler(em_eo_t eo, <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> error, <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0c0a929399ae33b615f8ca8018d2a69d">em_escope_t</a> escope, va_list args);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">queue_step(<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">start(<span class="keywordtype">void</span> *eo_context, em_eo_t eo, <span class="keyword">const</span> <a name="_a4"></a><a class="code" href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a> *conf);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">stop(<span class="keywordtype">void</span> *eo_context, em_eo_t eo);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">receive_func(<span class="keywordtype">void</span> *eo_context, em_event_t event, <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> type,</div>
<div class="line">             em_queue_t queue, <span class="keywordtype">void</span> *q_context);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">update_test_state(em_event_t event, em_event_t unsch_event);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">create_and_link_queues(<span class="keywordtype">int</span> start_queue, <span class="keywordtype">int</span> num_queues);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_test_statistics(test_status_t *test_status, <span class="keywordtype">int</span> print_header,</div>
<div class="line">                      core_stat_t core_stat[]);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> em_event_t</div>
<div class="line">alloc_free_per_event(em_event_t event);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span></div>
<div class="line">measure_latency(perf_event_t *<span class="keyword">const</span> perf_event, queue_context_t *<span class="keyword">const</span> q_ctx,</div>
<div class="line">                env_time_t recv_time);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Main function</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Call cm_setup() to perform test &amp; EM setup common for all the</span></div>
<div class="line"><span class="comment"> * test applications.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * cm_setup() will call test_init() and test_start() and launch</span></div>
<div class="line"><span class="comment"> * the EM dispatch loop on every EM-core.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">return</span> cm_setup(argc, argv);</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Test error handler</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param eo            Execution object id</span></div>
<div class="line"><span class="comment"> * @param error         The error code</span></div>
<div class="line"><span class="comment"> * @param escope        Error scope</span></div>
<div class="line"><span class="comment"> * @param args          List of arguments (__FILE__, __func__, __LINE__,</span></div>
<div class="line"><span class="comment"> *                                         (format), ## __VA_ARGS__)</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return The original error code.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">error_handler(em_eo_t eo, <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> error, <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0c0a929399ae33b615f8ca8018d2a69d">em_escope_t</a> escope, va_list args)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (escope == EM_ESCOPE_QUEUE_CREATE &amp;&amp; !<a name="a5"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a51d9a0346d8b8ad48bf58b9b9cba187f">EM_ERROR_IS_FATAL</a>(error)) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;\nUnable to create more queues\n\n&quot;</span></div>
<div class="line">                           <span class="stringliteral">&quot;Test finished\n&quot;</span>);</div>
<div class="line">                <span class="keyword">raise</span>(SIGINT);</div>
<div class="line">                <span class="keywordflow">return</span> error;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (appl_shm-&gt;exit_flag &amp;&amp; <a name="a6"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a962bb467f721a89bbc8469f7c171aaca">EM_ESCOPE</a>(escope) &amp;&amp;</div>
<div class="line">            !<a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a51d9a0346d8b8ad48bf58b9b9cba187f">EM_ERROR_IS_FATAL</a>(error)) {</div>
<div class="line">                <span class="comment">/* Suppress non-fatal EM-error logs during tear-down */</span></div>
<div class="line">                <span class="keywordflow">if</span> (escope == EM_ESCOPE_EO_ADD_QUEUE_SYNC) {</div>
<div class="line">                        APPL_PRINT(<span class="stringliteral">&quot;\nExit: suppress queue setup error\n\n&quot;</span>);</div>
<div class="line">                        <span class="keywordflow">return</span> error;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> test_error_handler(eo, error, escope, args);</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Init of the  Queues performance test application.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @attention Run on all cores.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @see cm_setup() for setup and dispatch.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> test_init(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        (void)appl_conf;</div>
<div class="line">        <span class="keywordtype">int</span> core = <a name="a7"></a><a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (core == 0) {</div>
<div class="line">                perf_shm = env_shared_reserve(<span class="stringliteral">&quot;PerfQueuesSharedMem&quot;</span>,</div>
<div class="line">                                              <span class="keyword">sizeof</span>(perf_shm_t));</div>
<div class="line">                <a name="a8"></a><a class="code" href="../../db/da0/group__em__error.html#gaf7332965c5deaa69411136e8d36089c6">em_register_error_handler</a>(error_handler);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                perf_shm = env_shared_lookup(<span class="stringliteral">&quot;PerfQueuesSharedMem&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (perf_shm == NULL)</div>
<div class="line">                test_error(<a name="a9"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a>(0xec0de), 0xdead,</div>
<div class="line">                           <span class="stringliteral">&quot;Perf test queues init failed on EM-core: %u\n&quot;</span>,</div>
<div class="line">                           <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>());</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (core == 0)</div>
<div class="line">                memset(perf_shm, 0, <span class="keyword">sizeof</span>(perf_shm_t));</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Startup of the Queues performance test application.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @attention Run only on EM core 0.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @param appl_conf Application configuration</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @see cm_setup() for setup and dispatch.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> test_start(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        eo_context_t *eo_ctx;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret, start_ret = <a name="a10"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a1f9dbd41491db385bd4a3813e2f030a5">EM_ERROR</a>;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> q_ctx_size = <span class="keyword">sizeof</span>(perf_shm-&gt;queue_context_tbl);</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Store the event pool to use, use the EM default pool if no other</span></div>
<div class="line"><span class="comment">         * pool is provided through the appl_conf.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">if</span> (appl_conf-&gt;num_pools &gt;= 1)</div>
<div class="line">                perf_shm-&gt;pool = appl_conf-&gt;pools[0];</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                perf_shm-&gt;pool = <a name="a11"></a><a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a>;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;***********************************************************\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;EM APPLICATION: &#39;%s&#39; initializing:\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;  %s: %s() - EM-core:%d\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;  Application running on %u EM-cores (procs:%u, threads:%u)\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;  using event pool:%&quot;</span> <a name="a12"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a5f1ebfb654b7ec3169e068aa3776ff79">PRI_POOL</a> <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;    Max. NUM_QUEUES:          %i\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;    sizeof queue_context_tbl: %i kB\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;***********************************************************\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">                   appl_conf-&gt;name, NO_PATH(__FILE__), __func__, <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>(),</div>
<div class="line">                   appl_conf-&gt;core_count, appl_conf-&gt;num_procs, appl_conf-&gt;num_threads,</div>
<div class="line">                   perf_shm-&gt;pool, NUM_QUEUES, q_ctx_size / 1024);</div>
<div class="line"> </div>
<div class="line">        test_fatal_if(perf_shm-&gt;pool == <a name="a13"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a67fed61187c93569c92da0647970a29f">EM_POOL_UNDEF</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;Undefined application event pool!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        perf_shm-&gt;test_status.cpu_hz = env_core_hz();</div>
<div class="line">        perf_shm-&gt;test_status.cpu_mhz = (double)perf_shm-&gt;test_status.cpu_hz /</div>
<div class="line">                                         1000000.0;</div>
<div class="line">        perf_shm-&gt;test_status.reset_flag = 0;</div>
<div class="line">        perf_shm-&gt;test_status.num_cores = appl_conf-&gt;core_count;</div>
<div class="line">        perf_shm-&gt;test_status.free_flag = 0;</div>
<div class="line"> </div>
<div class="line">        env_atomic64_init(&amp;perf_shm-&gt;test_status.ready_count);</div>
<div class="line">        env_atomic64_init(&amp;perf_shm-&gt;test_status.freed_count);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Create EOs */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; NUM_EOS; i++) {</div>
<div class="line">                eo_ctx = &amp;perf_shm-&gt;eo_context_tbl[i];</div>
<div class="line">                perf_shm-&gt;eo[i] = <a name="a14"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga196c7caa1177575fd424e9a0d2854da6">em_eo_create</a>(<span class="stringliteral">&quot;perf test eo&quot;</span>, start, NULL,</div>
<div class="line">                                               stop, NULL, receive_func,</div>
<div class="line">                                               eo_ctx);</div>
<div class="line">                test_fatal_if(perf_shm-&gt;eo[i] == <a name="a15"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#af28fb8daf62b942ced417e158ed7e1c7">EM_EO_UNDEF</a>,</div>
<div class="line">                              <span class="stringliteral">&quot;EO create failed:%d&quot;</span>, i, NUM_EOS);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;  EOs created\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Create and link queues</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">if</span> (CREATE_ALL_QUEUES_AT_STARTUP) <span class="comment">/* Create ALL queues at once */</span></div>
<div class="line">                create_and_link_queues(0, NUM_QUEUES);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="comment">/* Create queues for the first step, then more before each step */</span></div>
<div class="line">                create_and_link_queues(0, queue_steps[0]);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Start EOs */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; NUM_EOS; i++) {</div>
<div class="line">                ret = <a name="a16"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gabe4f7a789ec9523367c086793061562d">em_eo_start_sync</a>(perf_shm-&gt;eo[i], &amp;start_ret, NULL);</div>
<div class="line">                test_fatal_if(ret != <a name="a17"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a> || start_ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                              <span class="stringliteral">&quot;EO start(%d):%&quot;</span> PRI_STAT <span class="stringliteral">&quot; %&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                              i, ret, start_ret);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        queue_step();</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Stop the test, only run on one core</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> test_stop(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line">        em_eo_t eo;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">        (void)appl_conf;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%s() on EM-core %d\n&quot;</span>, __func__, core);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Stop EOs */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; NUM_EOS; i++) {</div>
<div class="line">                eo = perf_shm-&gt;eo[i];</div>
<div class="line">                ret = <a name="a18"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gadce026621953114bd26e5836d9693465">em_eo_stop_sync</a>(eo);</div>
<div class="line">                test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                              <span class="stringliteral">&quot;EO:%&quot;</span> <a name="a19"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; stop:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                              eo, ret);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Remove and delete all of the EO&#39;s queues, then delete the EO */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; NUM_EOS; i++) {</div>
<div class="line">                eo = perf_shm-&gt;eo[i];</div>
<div class="line">                ret = <a name="a20"></a><a class="code" href="../../d8/d5f/group__em__eo.html#ga10cf8094caa56026eb0a402d3d22da23">em_eo_remove_queue_all_sync</a>(eo, <a name="a21"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a419c8373b72a8c5ed1c3e3ded3e262e0">EM_TRUE</a><span class="comment">/*delete Qs*/</span>);</div>
<div class="line">                test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                              <span class="stringliteral">&quot;EO remove queue all:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                              ret, eo);</div>
<div class="line">                ret = <a name="a22"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gae769b19e613b24487beb943cfb926977">em_eo_delete</a>(eo);</div>
<div class="line">                test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                              <span class="stringliteral">&quot;EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; delete:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                              eo, ret);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; NUM_QUEUES; i++) {</div>
<div class="line">                queue_context_t *q_ctx = &amp;perf_shm-&gt;queue_context_tbl[i];</div>
<div class="line">                em_queue_t unsch_queue = q_ctx-&gt;unsch_q.this_queue;</div>
<div class="line">                em_event_t unsch_event;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (unsch_queue == <a name="a23"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#ae8ba676fb5528d220363edad0aeef1ff">EM_QUEUE_UNDEF</a>)</div>
<div class="line">                        <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (;;) {</div>
<div class="line">                        unsch_event = <a name="a24"></a><a class="code" href="../../de/d3c/group__em__queue.html#ga14a77156789e322f55aafaac039684ee">em_queue_dequeue</a>(unsch_queue);</div>
<div class="line">                        <span class="keywordflow">if</span> (unsch_event == <a name="a25"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>)</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                        <a name="a26"></a><a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(unsch_event);</div>
<div class="line">                }</div>
<div class="line">                ret = <a name="a27"></a><a class="code" href="../../de/d3c/group__em__queue.html#ga2a28907b18b348cbb153431c35af5752">em_queue_delete</a>(unsch_queue);</div>
<div class="line">                test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                              <span class="stringliteral">&quot;Unsch-Queue:%&quot;</span> <a name="a28"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot; delete:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                              unsch_queue, ret);</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Terminate the test, only run on one core</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> test_term(<span class="keyword">const</span> appl_conf_t *appl_conf)</div>
<div class="line">{</div>
<div class="line">        (void)appl_conf;</div>
<div class="line">        <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;%s() on EM-core %d\n&quot;</span>, __func__, core);</div>
<div class="line"> </div>
<div class="line">        env_shared_free(perf_shm);</div>
<div class="line">        <a name="a29"></a><a class="code" href="../../db/da0/group__em__error.html#gab6b469100e5f60670a742d944a6f530b">em_unregister_error_handler</a>();</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Allocate, initialize and send test step events.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">queue_step(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        queue_context_t *q_ctx;</div>
<div class="line">        perf_event_t *perf_event;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> first = perf_shm-&gt;test_status.queues;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> step = perf_shm-&gt;test_status.step;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> queue_count = queue_steps[step];</div>
<div class="line">        <span class="keywordtype">int</span> i, j;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Allocate and send test events for the queues */</span></div>
<div class="line">        <span class="keywordflow">if</span> (CONST_NUM_EVENTS) {</div>
<div class="line">                <span class="keywordflow">for</span> (i = 0; i &lt; CONST_NUM_EVENTS / 2; i++) {</div>
<div class="line">                        em_event_t unsch_event;</div>
<div class="line"> </div>
<div class="line">                        unsch_event = <a name="a30"></a><a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(perf_event_t),</div>
<div class="line">                                               <a name="a31"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>,</div>
<div class="line">                                               perf_shm-&gt;pool);</div>
<div class="line">                        test_fatal_if(unsch_event == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>,</div>
<div class="line">                                      <span class="stringliteral">&quot;EM alloc failed (%i)&quot;</span>, i);</div>
<div class="line"> </div>
<div class="line">                        <span class="comment">/* Allocate events evenly to the queues */</span></div>
<div class="line">                        q_ctx = &amp;perf_shm-&gt;queue_context_tbl[i % queue_count];</div>
<div class="line"> </div>
<div class="line">                        ret = <a name="a32"></a><a class="code" href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a>(unsch_event, q_ctx-&gt;unsch_q.this_queue);</div>
<div class="line">                        <span class="keywordflow">if</span> (unlikely(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)) {</div>
<div class="line">                                test_fatal_if(!appl_shm-&gt;exit_flag,</div>
<div class="line">                                              <span class="stringliteral">&quot;EM send:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                                              <span class="stringliteral">&quot;Unsched-Q:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                                              ret, q_ctx-&gt;unsch_q.this_queue);</div>
<div class="line">                                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(unsch_event);</div>
<div class="line">                                <span class="keywordflow">return</span>;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">for</span> (i = 0; i &lt; CONST_NUM_EVENTS / 2; i++) {</div>
<div class="line">                        em_event_t event;</div>
<div class="line"> </div>
<div class="line">                        <span class="keyword">event</span> = <a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(perf_event_t),</div>
<div class="line">                                         <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>, perf_shm-&gt;pool);</div>
<div class="line">                        test_fatal_if(event == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a> ||</div>
<div class="line">                                      <span class="keyword">sizeof</span>(perf_event_t) !=</div>
<div class="line">                                      <a name="a33"></a><a class="code" href="../../d5/d33/group__em__event.html#gada9a8dda15cfef5cee0f99e4b6e63ba3">em_event_get_size</a>(event),</div>
<div class="line">                                      <span class="stringliteral">&quot;EM alloc failed (%i)&quot;</span>, i);</div>
<div class="line"> </div>
<div class="line">                        perf_event = <a name="a34"></a><a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line">                        perf_event-&gt;seq = i;</div>
<div class="line">                        perf_event-&gt;send_time = env_time_global();</div>
<div class="line"> </div>
<div class="line">                        <span class="comment">/* Allocate events evenly to the queues */</span></div>
<div class="line">                        q_ctx = &amp;perf_shm-&gt;queue_context_tbl[i % queue_count];</div>
<div class="line"> </div>
<div class="line">                        ret = <a class="code" href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a>(event, q_ctx-&gt;sch_q.this_queue);</div>
<div class="line">                        <span class="keywordflow">if</span> (unlikely(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)) {</div>
<div class="line">                                test_fatal_if(!appl_shm-&gt;exit_flag,</div>
<div class="line">                                              <span class="stringliteral">&quot;EM send:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                                              <span class="stringliteral">&quot;Queue:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                                               ret, q_ctx-&gt;sch_q.this_queue);</div>
<div class="line">                                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">                                <span class="keywordflow">return</span>;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">for</span> (i = first; i &lt; queue_count; i++) {</div>
<div class="line">                        em_event_t unsch_events[NUM_EVENTS];</div>
<div class="line">                        <span class="keywordtype">int</span> num;</div>
<div class="line"> </div>
<div class="line">                        q_ctx = &amp;perf_shm-&gt;queue_context_tbl[i];</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">for</span> (j = 0; j &lt; NUM_EVENTS; j++) {</div>
<div class="line">                                unsch_events[j] = <a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(perf_event_t),</div>
<div class="line">                                                           <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>,</div>
<div class="line">                                                           perf_shm-&gt;pool);</div>
<div class="line">                                test_fatal_if(unsch_events[j] == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a>,</div>
<div class="line">                                              <span class="stringliteral">&quot;EM alloc failed (%d, %d)&quot;</span>, i, j);</div>
<div class="line">                        }</div>
<div class="line">                        num = <a name="a35"></a><a class="code" href="../../d5/d33/group__em__event.html#ga272587cb3a55dd241332fd13b6e19054">em_send_multi</a>(unsch_events, NUM_EVENTS,</div>
<div class="line">                                            q_ctx-&gt;unsch_q.this_queue);</div>
<div class="line">                        <span class="keywordflow">if</span> (unlikely(num != NUM_EVENTS)) {</div>
<div class="line">                                test_fatal_if(!appl_shm-&gt;exit_flag,</div>
<div class="line">                                              <span class="stringliteral">&quot;EM send multi:%d\n&quot;</span></div>
<div class="line">                                              <span class="stringliteral">&quot;Unsched-Q:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                                              num, q_ctx-&gt;unsch_q.this_queue);</div>
<div class="line">                                <a name="a36"></a><a class="code" href="../../d5/d33/group__em__event.html#ga824c1dee097236d554918d6702431beb">em_free_multi</a>(&amp;unsch_events[num], NUM_EVENTS - num);</div>
<div class="line">                                <span class="keywordflow">return</span>;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">for</span> (i = first; i &lt; queue_count; i++) {</div>
<div class="line">                        em_event_t events[NUM_EVENTS];</div>
<div class="line">                        <span class="keywordtype">int</span> num;</div>
<div class="line"> </div>
<div class="line">                        q_ctx = &amp;perf_shm-&gt;queue_context_tbl[i];</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">for</span> (j = 0; j &lt; NUM_EVENTS; j++) {</div>
<div class="line">                                events[j] = <a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(<span class="keyword">sizeof</span>(perf_event_t),</div>
<div class="line">                                                     <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>,</div>
<div class="line">                                                     perf_shm-&gt;pool);</div>
<div class="line">                                test_fatal_if(events[j] == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a> ||</div>
<div class="line">                                              <span class="keyword">sizeof</span>(perf_event_t) !=</div>
<div class="line">                                              <a class="code" href="../../d5/d33/group__em__event.html#gada9a8dda15cfef5cee0f99e4b6e63ba3">em_event_get_size</a>(events[j]),</div>
<div class="line">                                              <span class="stringliteral">&quot;EM alloc failed (%d,%d)&quot;</span>, i, j);</div>
<div class="line"> </div>
<div class="line">                                perf_event = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(events[j]);</div>
<div class="line">                                perf_event-&gt;seq = i * NUM_EVENTS + j;</div>
<div class="line">                                perf_event-&gt;send_time = env_time_global();</div>
<div class="line">                        }</div>
<div class="line">                        num = <a class="code" href="../../d5/d33/group__em__event.html#ga272587cb3a55dd241332fd13b6e19054">em_send_multi</a>(events, NUM_EVENTS,</div>
<div class="line">                                            q_ctx-&gt;sch_q.this_queue);</div>
<div class="line">                        <span class="keywordflow">if</span> (unlikely(num != NUM_EVENTS)) {</div>
<div class="line">                                test_fatal_if(!appl_shm-&gt;exit_flag,</div>
<div class="line">                                              <span class="stringliteral">&quot;EM send multi:%d\n&quot;</span></div>
<div class="line">                                              <span class="stringliteral">&quot;Queue:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                                              num, q_ctx-&gt;sch_q.this_queue);</div>
<div class="line">                                <a class="code" href="../../d5/d33/group__em__event.html#ga824c1dee097236d554918d6702431beb">em_free_multi</a>(&amp;events[num], NUM_EVENTS - num);</div>
<div class="line">                                <span class="keywordflow">return</span>;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        perf_shm-&gt;test_status.queues = queue_count;</div>
<div class="line">        perf_shm-&gt;test_status.step++;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;Number of queues: %6.0d + %d\n&quot;</span>,</div>
<div class="line">                   queue_count, queue_count);</div>
<div class="line">        <span class="keywordflow">if</span> (CONST_NUM_EVENTS)</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;Number of events: %6.0d + %d\n&quot;</span>,</div>
<div class="line">                           CONST_NUM_EVENTS / 2, CONST_NUM_EVENTS / 2);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;Number of events: %6.0d + %d\n&quot;</span>,</div>
<div class="line">                           queue_count * NUM_EVENTS, queue_count * NUM_EVENTS);</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO start function.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">start(<span class="keywordtype">void</span> *eo_context, em_eo_t eo, <span class="keyword">const</span> <a class="code" href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a> *conf)</div>
<div class="line">{</div>
<div class="line">        eo_context_t *eo_ctx = eo_context;</div>
<div class="line"> </div>
<div class="line">        (void)conf;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;EO %&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; starting.\n&quot;</span>, eo);</div>
<div class="line"> </div>
<div class="line">        eo_ctx-&gt;eo_id = eo;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO stop function.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div>
<div class="line">stop(<span class="keywordtype">void</span> *eo_context, em_eo_t eo)</div>
<div class="line">{</div>
<div class="line">        (void)eo_context;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;EO %&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; stopping.\n&quot;</span>, eo);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @private</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * EO receive function.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Loops back events and calculates the event rate.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">receive_func(<span class="keywordtype">void</span> *eo_context, em_event_t event, <a class="code" href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a> type,</div>
<div class="line">             em_queue_t queue, <span class="keywordtype">void</span> *q_context)</div>
<div class="line">{</div>
<div class="line">        env_time_t recv_time;</div>
<div class="line">        perf_event_t *perf_event;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (MEASURE_LATENCY) {</div>
<div class="line">                recv_time = env_time_global();</div>
<div class="line">                perf_event = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        queue_context_t *q_ctx;</div>
<div class="line">        em_queue_t dst_queue;</div>
<div class="line">        em_queue_t src_unsch_queue;</div>
<div class="line">        em_queue_t dst_unsch_queue;</div>
<div class="line">        em_event_t unsch_event;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line">        <span class="keywordtype">int</span> do_return;</div>
<div class="line"> </div>
<div class="line">        (void)eo_context;</div>
<div class="line">        (void)type;</div>
<div class="line"> </div>
<div class="line">        q_ctx = q_context;</div>
<div class="line">        src_unsch_queue = q_ctx-&gt;unsch_q.this_queue;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Dequeue an unscheduled event for every received scheduled event</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        unsch_event = <a class="code" href="../../de/d3c/group__em__queue.html#ga14a77156789e322f55aafaac039684ee">em_queue_dequeue</a>(src_unsch_queue);</div>
<div class="line">        test_fatal_if(unsch_event == <a class="code" href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a> &amp;&amp; !appl_shm-&gt;exit_flag,</div>
<div class="line">                      <span class="stringliteral">&quot;em_queue_dequeue() error&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Free all events if the exit-flag is set (program termination) */</span></div>
<div class="line">        <span class="keywordflow">if</span> (unlikely(appl_shm-&gt;exit_flag)) {</div>
<div class="line">                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(unsch_event);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Helper: Update the test state, count recv events,</span></div>
<div class="line"><span class="comment">         * calc &amp; print stats, prepare for next step</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        do_return = update_test_state(event, unsch_event);</div>
<div class="line">        <span class="keywordflow">if</span> (unlikely(do_return))</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ALLOC_FREE_PER_EVENT)</div>
<div class="line">                <span class="keyword">event</span> = alloc_free_per_event(event);</div>
<div class="line"> </div>
<div class="line">        dst_queue = q_ctx-&gt;sch_q.next_queue;</div>
<div class="line">        dst_unsch_queue = q_ctx-&gt;unsch_q.next_queue;</div>
<div class="line">        test_fatal_if(queue != q_ctx-&gt;sch_q.this_queue, <span class="stringliteral">&quot;Queue config error&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (MEASURE_LATENCY)</div>
<div class="line">                measure_latency(perf_event, q_ctx, recv_time);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Enqueue the unscheduled event to the next unscheduled queue */</span></div>
<div class="line">        ret = <a class="code" href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a>(unsch_event, dst_unsch_queue);</div>
<div class="line">        <span class="keywordflow">if</span> (unlikely(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)) {</div>
<div class="line">                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">                test_fatal_if(!appl_shm-&gt;exit_flag,</div>
<div class="line">                              <span class="stringliteral">&quot;EM send:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; Unsched-Q: %&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                              ret, dst_unsch_queue);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Send the scheduled event to the next scheduled queue */</span></div>
<div class="line">        <span class="keywordflow">if</span> (MEASURE_LATENCY)</div>
<div class="line">                perf_event-&gt;send_time = env_time_global();</div>
<div class="line">        ret = <a class="code" href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a>(event, dst_queue);</div>
<div class="line">        <span class="keywordflow">if</span> (unlikely(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)) {</div>
<div class="line">                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">                test_fatal_if(!appl_shm-&gt;exit_flag,</div>
<div class="line">                              <span class="stringliteral">&quot;EM send:%&quot;</span> PRI_STAT <span class="stringliteral">&quot; Queue:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                              ret, dst_queue);</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Receive function helper: Update the test state</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Calculates the number of received events, maintains &amp; prints test statistics</span></div>
<div class="line"><span class="comment"> * and restarts/reconfigures the test for the next queue/event-setup</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * @return  &#39;1&#39; if the caller receive function should immediately return,</span></div>
<div class="line"><span class="comment"> *          &#39;0&#39; otherwise</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line">update_test_state(em_event_t event, em_event_t unsch_event)</div>
<div class="line">{</div>
<div class="line">        uint64_t events;</div>
<div class="line">        uint64_t freed_count;</div>
<div class="line">        uint64_t ready_count;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line">        test_status_t *<span class="keyword">const</span> tstat = &amp;perf_shm-&gt;test_status;</div>
<div class="line">        core_stat_t *<span class="keyword">const</span> cstat = &amp;perf_shm-&gt;core_stat[core];</div>
<div class="line"> </div>
<div class="line">        events = cstat-&gt;events;</div>
<div class="line">        <span class="comment">/* one scheduled and one unscheduled event received */</span></div>
<div class="line">        events += 2;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (unlikely(tstat-&gt;reset_flag)) {</div>
<div class="line">                events = 0;</div>
<div class="line">                <span class="keywordflow">if</span> (CONST_NUM_EVENTS) {</div>
<div class="line">                        <span class="comment">/* Free all old events before allocating new ones. */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (unlikely(tstat-&gt;free_flag)) {</div>
<div class="line">                                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line">                                <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(unsch_event);</div>
<div class="line">                                freed_count =</div>
<div class="line">                                env_atomic64_add_return(&amp;tstat-&gt;freed_count, 2);</div>
<div class="line">                                <span class="keywordflow">if</span> (freed_count == CONST_NUM_EVENTS) {</div>
<div class="line">                                        <span class="comment">/* Last event */</span></div>
<div class="line">                                        env_atomic64_set(&amp;tstat-&gt;freed_count,</div>
<div class="line">                                                         0);</div>
<div class="line">                                        tstat-&gt;reset_flag = 0;</div>
<div class="line">                                        tstat-&gt;free_flag = 0;</div>
<div class="line">                                        queue_step();</div>
<div class="line">                                }</div>
<div class="line">                                <span class="comment">/* Req caller receive-func to return */</span></div>
<div class="line">                                <span class="keywordflow">return</span> 1;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (unlikely(core_state != CORE_STATE_IDLE)) {</div>
<div class="line">                        core_state = CORE_STATE_IDLE;</div>
<div class="line">                        cstat-&gt;begin_time = ENV_TIME_NULL;</div>
<div class="line"> </div>
<div class="line">                        ready_count =</div>
<div class="line">                        env_atomic64_add_return(&amp;tstat-&gt;ready_count, 1);</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span> (ready_count == (uint64_t)tstat-&gt;num_cores) {</div>
<div class="line">                                env_atomic64_set(&amp;tstat-&gt;ready_count, 0);</div>
<div class="line"> </div>
<div class="line">                                <span class="keywordflow">if</span> (CONST_NUM_EVENTS) {</div>
<div class="line">                                        <span class="keywordtype">int</span> sample = tstat-&gt;samples;</div>
<div class="line">                                        <span class="keywordtype">int</span> queues = tstat-&gt;queues;</div>
<div class="line"> </div>
<div class="line">                                        <span class="keywordflow">if</span> (sample == 0 &amp;&amp; queues &lt; NUM_QUEUES)</div>
<div class="line">                                                tstat-&gt;free_flag = 1;</div>
<div class="line">                                        <span class="keywordflow">else</span></div>
<div class="line">                                                tstat-&gt;reset_flag = 0;</div>
<div class="line">                                } <span class="keywordflow">else</span> {</div>
<div class="line">                                        tstat-&gt;reset_flag = 0;</div>
<div class="line">                                }</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unlikely(events == 2)) {</div>
<div class="line">                cstat-&gt;begin_time = env_time_global();</div>
<div class="line">                cstat-&gt;latency.events = 0;</div>
<div class="line">                cstat-&gt;latency.hi_prio_ave = ENV_TIME_NULL;</div>
<div class="line">                cstat-&gt;latency.hi_prio_max = ENV_TIME_NULL;</div>
<div class="line">                cstat-&gt;latency.lo_prio_ave = ENV_TIME_NULL;</div>
<div class="line">                cstat-&gt;latency.lo_prio_max = ENV_TIME_NULL;</div>
<div class="line"> </div>
<div class="line">                core_state = CORE_STATE_MEASURE;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unlikely(events == EVENTS_PER_SAMPLE)) {</div>
<div class="line">                <span class="comment">/*</span></div>
<div class="line"><span class="comment">                 * Measurements done for this step. Store results and continue</span></div>
<div class="line"><span class="comment">                 * receiving events until all cores are done.</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                env_time_t begin_time, end_time;</div>
<div class="line"> </div>
<div class="line">                cstat-&gt;end_time = env_time_global();</div>
<div class="line"> </div>
<div class="line">                end_time = cstat-&gt;end_time;</div>
<div class="line">                begin_time = cstat-&gt;begin_time;</div>
<div class="line">                cstat-&gt;diff_time = env_time_diff(end_time, begin_time);</div>
<div class="line"> </div>
<div class="line">                ready_count = env_atomic64_add_return(&amp;tstat-&gt;ready_count, 1);</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/*</span></div>
<div class="line"><span class="comment">                 * Check whether all cores are done with the step,</span></div>
<div class="line"><span class="comment">                 * and if done proceed to the next step</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                <span class="keywordflow">if</span> (unlikely((<span class="keywordtype">int</span>)ready_count == tstat-&gt;num_cores)) {</div>
<div class="line">                        <span class="comment">/* No real need for atomicity here, ran on last core*/</span></div>
<div class="line">                        env_atomic64_set(&amp;tstat-&gt;ready_count, 0);</div>
<div class="line"> </div>
<div class="line">                        tstat-&gt;reset_flag = 1;</div>
<div class="line">                        tstat-&gt;samples++;</div>
<div class="line"> </div>
<div class="line">                        <span class="comment">/*</span></div>
<div class="line"><span class="comment">                         * Print statistics.</span></div>
<div class="line"><span class="comment">                         * Omit prints for the first sample round to allow the</span></div>
<div class="line"><span class="comment">                         * test to stabilize after setups and teardowns.</span></div>
<div class="line"><span class="comment">                         */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (tstat-&gt;samples &gt; 1) {</div>
<div class="line">                                <span class="keywordtype">int</span> print_header = tstat-&gt;samples == 2 ? 1 : 0;</div>
<div class="line"> </div>
<div class="line">                                print_test_statistics(tstat, print_header,</div>
<div class="line">                                                      perf_shm-&gt;core_stat);</div>
<div class="line">                        }</div>
<div class="line"> </div>
<div class="line">                        <span class="comment">/*</span></div>
<div class="line"><span class="comment">                         * Start next test step - setup new queues</span></div>
<div class="line"><span class="comment">                         */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (tstat-&gt;samples == NUM_SAMPLES &amp;&amp;</div>
<div class="line">                            tstat-&gt;queues &lt; NUM_QUEUES) {</div>
<div class="line">                                <span class="keywordflow">if</span> (!CREATE_ALL_QUEUES_AT_STARTUP) {</div>
<div class="line">                                        <span class="keywordtype">int</span> step = tstat-&gt;step;</div>
<div class="line">                                        <span class="keywordtype">int</span> first_q = tstat-&gt;queues;</div>
<div class="line">                                        <span class="keywordtype">int</span> num_qs = queue_steps[step] -</div>
<div class="line">                                                     queue_steps[step - 1];</div>
<div class="line"> </div>
<div class="line">                                        create_and_link_queues(first_q, num_qs);</div>
<div class="line">                                }</div>
<div class="line"> </div>
<div class="line">                                <span class="keywordflow">if</span> (!CONST_NUM_EVENTS)</div>
<div class="line">                                        queue_step();</div>
<div class="line"> </div>
<div class="line">                                tstat-&gt;samples = 0;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        cstat-&gt;events = events;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Creates a number of EM queues, associates them with EOs, and links them.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">create_and_link_queues(<span class="keywordtype">int</span> start_queue, <span class="keywordtype">int</span> num_queues)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> i, j;</div>
<div class="line">        em_queue_t queue, next_queue;</div>
<div class="line">        em_queue_t queue_unscheduled, next_unscheduled;</div>
<div class="line">        <a name="_a37"></a><a class="code" href="../../d5/d76/structem__queue__conf__t.html">em_queue_conf_t</a> unsch_conf;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#a58ebf797967a820c57ced595c2b291e9">em_queue_prio_t</a> prio;</div>
<div class="line">        <a class="code" href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a> ret;</div>
<div class="line">        queue_context_t *q_ctx;</div>
<div class="line"> </div>
<div class="line">        APPL_PRINT(<span class="stringliteral">&quot;\nCreate new queues - scheduled:%d + unscheduled:%d\n&quot;</span>,</div>
<div class="line">                   num_queues, num_queues);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (num_queues % NUM_EOS != 0) {</div>
<div class="line">                APPL_PRINT(<span class="stringliteral">&quot;%s() arg &#39;num_queues&#39;=%d not multiple of NUM_EOS=%d\n&quot;</span>,</div>
<div class="line">                           __func__, num_queues, NUM_EOS);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        memset(&amp;unsch_conf, 0, <span class="keyword">sizeof</span>(unsch_conf));</div>
<div class="line">        <span class="keywordflow">if</span> (QUEUE_TYPE == <a name="a38"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965a43e0ef6f7a63caf0b225a52412ef3032">EM_QUEUE_TYPE_ATOMIC</a>) {</div>
<div class="line">                <span class="comment">/*</span></div>
<div class="line"><span class="comment">                 * If the EO receives are running with an atomic context then</span></div>
<div class="line"><span class="comment">                 * unsched queue enq/deq can be multithread unsafe to possibly</span></div>
<div class="line"><span class="comment">                 * boost perf.</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                unsch_conf.<a name="a39"></a><a class="code" href="../../d5/d76/structem__queue__conf__t.html#a281d884e2a021fa6510c125fcbcce0ce">flags</a> |= <a name="a40"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a15599dcca9dfe252fffc9425b0f98f29">EM_QUEUE_FLAG_ENQ_NOT_MTSAFE</a>;</div>
<div class="line">                unsch_conf.<a class="code" href="../../d5/d76/structem__queue__conf__t.html#a281d884e2a021fa6510c125fcbcce0ce">flags</a> |= <a name="a41"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#aba34479c892bf6745625f6e10bd37ead">EM_QUEUE_FLAG_DEQ_NOT_MTSAFE</a>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = start_queue; i &lt; (start_queue + num_queues); i += NUM_EOS) {</div>
<div class="line">                next_queue = <a class="code" href="../../d4/d11/event__machine__types_8h.html#ae8ba676fb5528d220363edad0aeef1ff">EM_QUEUE_UNDEF</a>;</div>
<div class="line">                next_unscheduled = <a class="code" href="../../d4/d11/event__machine__types_8h.html#ae8ba676fb5528d220363edad0aeef1ff">EM_QUEUE_UNDEF</a>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; NUM_EOS; j++) {</div>
<div class="line">                        prio = <a name="a42"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca">EM_QUEUE_PRIO_NORMAL</a>;</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span> (MEASURE_LATENCY) {</div>
<div class="line">                                <span class="keywordflow">if</span> (j == 0)</div>
<div class="line">                                        prio = <a name="a43"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fac38f313458eaca8b4a7f1c04fb20fdf1">EM_QUEUE_PRIO_HIGH</a>;</div>
<div class="line">                        }</div>
<div class="line"> </div>
<div class="line">                        q_ctx = &amp;perf_shm-&gt;queue_context_tbl[i + j];</div>
<div class="line"> </div>
<div class="line">                        <span class="comment">/*</span></div>
<div class="line"><span class="comment">                         * Create a new scheduled queue</span></div>
<div class="line"><span class="comment">                         */</span></div>
<div class="line">                        queue = <a name="a44"></a><a class="code" href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a>(<span class="stringliteral">&quot;queue&quot;</span>, QUEUE_TYPE, prio,</div>
<div class="line">                                                <a name="a45"></a><a class="code" href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a>, NULL);</div>
<div class="line">                        <span class="keywordflow">if</span> (queue == <a class="code" href="../../d4/d11/event__machine__types_8h.html#ae8ba676fb5528d220363edad0aeef1ff">EM_QUEUE_UNDEF</a>) {</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;Max nbr of supported queues: %d\n&quot;</span>,</div>
<div class="line">                                           2 * i);</div>
<div class="line">                                <span class="keywordflow">return</span>;</div>
<div class="line">                        }</div>
<div class="line">                        ret = <a name="a46"></a><a class="code" href="../../de/d3c/group__em__queue.html#ga83e001b62c2a87bf862fbf695c5e84fa">em_queue_set_context</a>(queue, q_ctx);</div>
<div class="line">                        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                                      <span class="stringliteral">&quot;em_queue_set_context:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                                      <span class="stringliteral">&quot;EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; Queue:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                                      perf_shm-&gt;eo[j], queue);</div>
<div class="line">                        <span class="comment">/* Add the scheduled queue to an EO and enable it */</span></div>
<div class="line">                        ret = <a name="a47"></a><a class="code" href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a>(perf_shm-&gt;eo[j], queue);</div>
<div class="line">                        <span class="keywordflow">if</span> (unlikely(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>)) {</div>
<div class="line">                                test_fatal_if(!appl_shm-&gt;exit_flag,</div>
<div class="line">                                              <span class="stringliteral">&quot;em_eo_add_queue_sync():%&quot;</span> PRI_STAT <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                                              <span class="stringliteral">&quot;EO:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a> <span class="stringliteral">&quot; Q:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                                              ret, perf_shm-&gt;eo[j], queue);</div>
<div class="line">                                <a class="code" href="../../de/d3c/group__em__queue.html#ga2a28907b18b348cbb153431c35af5752">em_queue_delete</a>(queue);</div>
<div class="line">                                <span class="keywordflow">return</span>;</div>
<div class="line">                        }</div>
<div class="line">                        <span class="comment">/* Link scheduled queues */</span></div>
<div class="line">                        q_ctx-&gt;sch_q.this_queue = queue;</div>
<div class="line">                        q_ctx-&gt;sch_q.next_queue = next_queue;</div>
<div class="line">                        q_ctx-&gt;sch_q.prio = prio;</div>
<div class="line"> </div>
<div class="line">                        <span class="comment">/*</span></div>
<div class="line"><span class="comment">                         * Create a new unscheduled queue</span></div>
<div class="line"><span class="comment">                         */</span></div>
<div class="line">                        queue_unscheduled =</div>
<div class="line">                                <a class="code" href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a>(<span class="stringliteral">&quot;unscheduled_queue&quot;</span>,</div>
<div class="line">                                                <a name="a48"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965a57dfc8af69d1d91fb9f4908fccdd0930">EM_QUEUE_TYPE_UNSCHEDULED</a>,</div>
<div class="line">                                                <a name="a49"></a><a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a4751fa890ae0dcf9ccd45841391d562e">EM_QUEUE_PRIO_UNDEF</a>,</div>
<div class="line">                                                <a name="a50"></a><a class="code" href="../../d4/d11/event__machine__types_8h.html#a3f2bef96eaf8b2855699d6adee7758f4">EM_QUEUE_GROUP_UNDEF</a>,</div>
<div class="line">                                                &amp;unsch_conf);</div>
<div class="line">                        <span class="keywordflow">if</span> (queue_unscheduled == <a class="code" href="../../d4/d11/event__machine__types_8h.html#ae8ba676fb5528d220363edad0aeef1ff">EM_QUEUE_UNDEF</a>) {</div>
<div class="line">                                APPL_PRINT(<span class="stringliteral">&quot;Max nbr of supported queues: %d\n&quot;</span>,</div>
<div class="line">                                           2 * i + 1);</div>
<div class="line">                                <span class="keywordflow">return</span>;</div>
<div class="line">                        }</div>
<div class="line"> </div>
<div class="line">                        <span class="comment">/* Link unscheduled queues */</span></div>
<div class="line">                        q_ctx-&gt;unsch_q.this_queue = queue_unscheduled;</div>
<div class="line">                        q_ctx-&gt;unsch_q.next_queue = next_unscheduled;</div>
<div class="line"> </div>
<div class="line">                        <span class="comment">/*</span></div>
<div class="line"><span class="comment">                         * Set the same top level queue context for both the</span></div>
<div class="line"><span class="comment">                         * scheduled and the unscheduled queue, access queue</span></div>
<div class="line"><span class="comment">                         * specific context by using q_ctx-&gt;sch_q.* or</span></div>
<div class="line"><span class="comment">                         * q_ctx-&gt;unsch_q.* - this eliminates the need to call</span></div>
<div class="line"><span class="comment">                         * em_queue_get_context() for each event for the</span></div>
<div class="line"><span class="comment">                         * unscheduled queues</span></div>
<div class="line"><span class="comment">                         */</span></div>
<div class="line">                        ret = <a class="code" href="../../de/d3c/group__em__queue.html#ga83e001b62c2a87bf862fbf695c5e84fa">em_queue_set_context</a>(queue_unscheduled, q_ctx);</div>
<div class="line">                        test_fatal_if(ret != <a class="code" href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a>,</div>
<div class="line">                                      <span class="stringliteral">&quot;em_queue_set_context:%&quot;</span> PRI_STAT <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                                      <span class="stringliteral">&quot;Unsched-Q:%&quot;</span> <a class="code" href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a> <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                                      ret, queue_unscheduled);</div>
<div class="line">                        <span class="comment">/* Sanity check */</span></div>
<div class="line">                        test_fatal_if(<a name="a51"></a><a class="code" href="../../de/d3c/group__em__queue.html#ga65850427f68c8c73e09fbf325190c31c">em_queue_get_context</a>(queue) !=</div>
<div class="line">                                      <a class="code" href="../../de/d3c/group__em__queue.html#ga65850427f68c8c73e09fbf325190c31c">em_queue_get_context</a>(queue_unscheduled),</div>
<div class="line">                                      <span class="stringliteral">&quot;em_queue_get_context failed.&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                        next_queue = queue;</div>
<div class="line">                        next_unscheduled = queue_unscheduled;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* Connect first scheduled queue to the last */</span></div>
<div class="line">                q_ctx = &amp;perf_shm-&gt;queue_context_tbl[i + 0];</div>
<div class="line">                q_ctx-&gt;sch_q.next_queue = next_queue;</div>
<div class="line">                q_ctx-&gt;unsch_q.next_queue = next_unscheduled;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Print test statistics</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_test_statistics(test_status_t *test_status, <span class="keywordtype">int</span> print_header,</div>
<div class="line">                      core_stat_t core_stat[])</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> num_cores = test_status-&gt;num_cores;</div>
<div class="line">        <span class="keyword">const</span> uint64_t cpu_hz = test_status-&gt;cpu_hz;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> cpu_mhz = test_status-&gt;cpu_mhz;</div>
<div class="line">        <span class="keyword">const</span> uint64_t total_events = (uint64_t)num_cores * EVENTS_PER_SAMPLE;</div>
<div class="line">        <span class="keyword">const</span> uint64_t print_count = test_status-&gt;print_count++;</div>
<div class="line">        env_time_t total_time = ENV_TIME_NULL;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num_cores; i++)</div>
<div class="line">                total_time = env_time_sum(total_time, core_stat[i].diff_time);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">double</span> cycles_per_event = 0.0;</div>
<div class="line">        <span class="keywordtype">double</span> events_per_sec = 0.0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (likely(total_events &gt; 0))</div>
<div class="line">                cycles_per_event = env_time_to_cycles(total_time, cpu_hz) /</div>
<div class="line">                                   (double)total_events;</div>
<div class="line">        <span class="keywordflow">if</span> (likely(cycles_per_event &gt; 0)) <span class="comment">/* Million events/s: */</span></div>
<div class="line">                events_per_sec = cpu_mhz * num_cores / cycles_per_event;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Print without latency statistics</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!MEASURE_LATENCY) {</div>
<div class="line">                <span class="keywordflow">if</span> (print_header)</div>
<div class="line">                        APPL_PRINT(RESULT_PRINTF_HDR);</div>
<div class="line">                APPL_PRINT(RESULT_PRINTF_FMT,</div>
<div class="line">                           cycles_per_event, events_per_sec,</div>
<div class="line">                           cpu_mhz, print_count);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Print with latency statistics</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        uint64_t latency_events = 0;</div>
<div class="line">        env_time_t latency_hi_ave = ENV_TIME_NULL;</div>
<div class="line">        env_time_t latency_hi_max = ENV_TIME_NULL;</div>
<div class="line">        env_time_t latency_lo_ave = ENV_TIME_NULL;</div>
<div class="line">        env_time_t latency_lo_max = ENV_TIME_NULL;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num_cores; i++) {</div>
<div class="line">                latency_events += core_stat[i].latency.events;</div>
<div class="line"> </div>
<div class="line">                latency_hi_ave = env_time_sum(latency_hi_ave,</div>
<div class="line">                                              core_stat[i].latency.hi_prio_ave);</div>
<div class="line">                latency_lo_ave = env_time_sum(latency_lo_ave,</div>
<div class="line">                                              core_stat[i].latency.lo_prio_ave);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (env_time_cmp(core_stat[i].latency.hi_prio_max,</div>
<div class="line">                                 latency_hi_max) &gt; 0) {</div>
<div class="line">                        latency_hi_max = core_stat[i].latency.hi_prio_max;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (env_time_cmp(core_stat[i].latency.lo_prio_max,</div>
<div class="line">                                 latency_lo_max) &gt; 0) {</div>
<div class="line">                        latency_lo_max = core_stat[i].latency.lo_prio_max;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">double</span> lat_per_hi_ave = 0.0;</div>
<div class="line">        <span class="keywordtype">double</span> lat_per_lo_ave = 0.0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (likely(latency_events &gt; 0)) {</div>
<div class="line">                lat_per_hi_ave = env_time_to_cycles(latency_hi_ave, cpu_hz) /</div>
<div class="line">                                 (double)latency_events;</div>
<div class="line">                lat_per_lo_ave = env_time_to_cycles(latency_lo_ave, cpu_hz) /</div>
<div class="line">                                 (double)latency_events;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (print_header)</div>
<div class="line">                APPL_PRINT(RESULT_PRINTF_LATENCY_HDR);</div>
<div class="line">        APPL_PRINT(RESULT_PRINTF_LATENCY_FMT,</div>
<div class="line">                   cycles_per_event, events_per_sec, lat_per_hi_ave,</div>
<div class="line">                   env_time_to_cycles(latency_hi_max, cpu_hz),</div>
<div class="line">                   lat_per_lo_ave,</div>
<div class="line">                   env_time_to_cycles(latency_lo_max, cpu_hz),</div>
<div class="line">                   cpu_mhz, print_count);</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Free the input event and allocate a new one instead</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> em_event_t</div>
<div class="line">alloc_free_per_event(em_event_t event)</div>
<div class="line">{</div>
<div class="line">        perf_event_t *perf_event = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line">        env_time_t send_time = perf_event-&gt;send_time;</div>
<div class="line">        <span class="keywordtype">int</span> seq = perf_event-&gt;seq;</div>
<div class="line">        uint32_t event_size = <a class="code" href="../../d5/d33/group__em__event.html#gada9a8dda15cfef5cee0f99e4b6e63ba3">em_event_get_size</a>(event);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a>(event);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">event</span> = <a class="code" href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a>(event_size, <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a>, perf_shm-&gt;pool);</div>
<div class="line"> </div>
<div class="line">        perf_event = <a class="code" href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a>(event);</div>
<div class="line"> </div>
<div class="line">        perf_event-&gt;send_time = send_time;</div>
<div class="line">        perf_event-&gt;seq = seq;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> event;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Measure the scheduling latency per event</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span></div>
<div class="line">measure_latency(perf_event_t *<span class="keyword">const</span> perf_event, queue_context_t *<span class="keyword">const</span> q_ctx,</div>
<div class="line">                env_time_t recv_time)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> core = <a class="code" href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a>();</div>
<div class="line">        core_stat_t *<span class="keyword">const</span> cstat = &amp;perf_shm-&gt;core_stat[core];</div>
<div class="line">        <span class="keyword">const</span> env_time_t send_time = perf_event-&gt;send_time;</div>
<div class="line">        env_time_t latency;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (perf_shm-&gt;test_status.reset_flag ||</div>
<div class="line">            cstat-&gt;events == 0 || cstat-&gt;events &gt;= EVENTS_PER_SAMPLE)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        cstat-&gt;latency.events++;</div>
<div class="line"> </div>
<div class="line">        latency = env_time_diff(recv_time, send_time);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (q_ctx-&gt;sch_q.prio == <a class="code" href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fac38f313458eaca8b4a7f1c04fb20fdf1">EM_QUEUE_PRIO_HIGH</a>) {</div>
<div class="line">                cstat-&gt;latency.hi_prio_ave =</div>
<div class="line">                env_time_sum(cstat-&gt;latency.hi_prio_ave, latency);</div>
<div class="line">                <span class="keywordflow">if</span> (env_time_cmp(latency, cstat-&gt;latency.hi_prio_max) &gt; 0)</div>
<div class="line">                        cstat-&gt;latency.hi_prio_max = latency;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                cstat-&gt;latency.lo_prio_ave =</div>
<div class="line">                env_time_sum(cstat-&gt;latency.lo_prio_ave, latency);</div>
<div class="line">                <span class="keywordflow">if</span> (env_time_cmp(latency, cstat-&gt;latency.lo_prio_max) &gt; 0)</div>
<div class="line">                        cstat-&gt;latency.lo_prio_max = latency;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="ttc" id="aenvironment_8h_html"><div class="ttname"><a href="../../de/d26/environment_8h.html">environment.h</a></div></div>
<div class="ttc" id="aenvironment_8h_html_a13093fb72d4f1f0be2f85cf449f4d543"><div class="ttname"><a href="../../de/d26/environment_8h.html#a13093fb72d4f1f0be2f85cf449f4d543">ENV_CACHE_LINE_ALIGNED</a></div><div class="ttdeci">#define ENV_CACHE_LINE_ALIGNED</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/environment_8h_source.html#l00076">environment.h:76</a></div></div>
<div class="ttc" id="aenvironment_8h_html_a2b2462b2491461a5c14adb1eb4493a8c"><div class="ttname"><a href="../../de/d26/environment_8h.html#a2b2462b2491461a5c14adb1eb4493a8c">ENV_LOCAL</a></div><div class="ttdeci">#define ENV_LOCAL</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/environment_8h_source.html#l00057">environment.h:57</a></div></div>
<div class="ttc" id="aenvironment_8h_html_aba71635a146e563689c50f1be15cb267"><div class="ttname"><a href="../../de/d26/environment_8h.html#aba71635a146e563689c50f1be15cb267">ENV_CACHE_LINE_SIZE</a></div><div class="ttdeci">#define ENV_CACHE_LINE_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/environment_8h_source.html#l00062">environment.h:62</a></div></div>
<div class="ttc" id="aevent__machine_8h_html"><div class="ttname"><a href="../../d7/d5e/event__machine_8h.html">event_machine.h</a></div></div>
<div class="ttc" id="aevent__machine__hw__config_8h_html_aaa0a290a45f4b1280f3330fadde6bfde"><div class="ttname"><a href="../../db/d6d/event__machine__hw__config_8h.html#aaa0a290a45f4b1280f3330fadde6bfde">EM_POOL_DEFAULT</a></div><div class="ttdeci">#define EM_POOL_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6d/event__machine__hw__config_8h_source.html#l00191">event_machine_hw_config.h:191</a></div></div>
<div class="ttc" id="aevent__machine__hw__config_8h_html_ae56af1c575498ec19f0836ee916d0eb9"><div class="ttname"><a href="../../db/d6d/event__machine__hw__config_8h.html#ae56af1c575498ec19f0836ee916d0eb9">EM_QUEUE_GROUP_DEFAULT</a></div><div class="ttdeci">#define EM_QUEUE_GROUP_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6d/event__machine__hw__config_8h_source.html#l00147">event_machine_hw_config.h:147</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a15599dcca9dfe252fffc9425b0f98f29"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a15599dcca9dfe252fffc9425b0f98f29">EM_QUEUE_FLAG_ENQ_NOT_MTSAFE</a></div><div class="ttdeci">#define EM_QUEUE_FLAG_ENQ_NOT_MTSAFE</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00216">event_machine_hw_types.h:216</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a368b59e8c18f57c4034420e3ba44e965a43e0ef6f7a63caf0b225a52412ef3032"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965a43e0ef6f7a63caf0b225a52412ef3032">EM_QUEUE_TYPE_ATOMIC</a></div><div class="ttdeci">@ EM_QUEUE_TYPE_ATOMIC</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00112">event_machine_hw_types.h:112</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a368b59e8c18f57c4034420e3ba44e965a57dfc8af69d1d91fb9f4908fccdd0930"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a368b59e8c18f57c4034420e3ba44e965a57dfc8af69d1d91fb9f4908fccdd0930">EM_QUEUE_TYPE_UNSCHEDULED</a></div><div class="ttdeci">@ EM_QUEUE_TYPE_UNSCHEDULED</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00127">event_machine_hw_types.h:127</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a4751fa890ae0dcf9ccd45841391d562e"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a4751fa890ae0dcf9ccd45841391d562e">EM_QUEUE_PRIO_UNDEF</a></div><div class="ttdeci">#define EM_QUEUE_PRIO_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00157">event_machine_hw_types.h:157</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a51d9a0346d8b8ad48bf58b9b9cba187f"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a51d9a0346d8b8ad48bf58b9b9cba187f">EM_ERROR_IS_FATAL</a></div><div class="ttdeci">#define EM_ERROR_IS_FATAL(error)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00423">event_machine_hw_types.h:423</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a5f1ebfb654b7ec3169e068aa3776ff79"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a5f1ebfb654b7ec3169e068aa3776ff79">PRI_POOL</a></div><div class="ttdeci">#define PRI_POOL</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00062">event_machine_hw_types.h:62</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a67fed61187c93569c92da0647970a29f"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a67fed61187c93569c92da0647970a29f">EM_POOL_UNDEF</a></div><div class="ttdeci">#define EM_POOL_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00060">event_machine_hw_types.h:60</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fa2311aaab5842cd6b78e4587be0fbf0ca">EM_QUEUE_PRIO_NORMAL</a></div><div class="ttdeci">@ EM_QUEUE_PRIO_NORMAL</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00153">event_machine_hw_types.h:153</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_a8171ccd1b7a0df99a6c7d0f3ec82e52fac38f313458eaca8b4a7f1c04fb20fdf1"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#a8171ccd1b7a0df99a6c7d0f3ec82e52fac38f313458eaca8b4a7f1c04fb20fdf1">EM_QUEUE_PRIO_HIGH</a></div><div class="ttdeci">@ EM_QUEUE_PRIO_HIGH</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00154">event_machine_hw_types.h:154</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_aba34479c892bf6745625f6e10bd37ead"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#aba34479c892bf6745625f6e10bd37ead">EM_QUEUE_FLAG_DEQ_NOT_MTSAFE</a></div><div class="ttdeci">#define EM_QUEUE_FLAG_DEQ_NOT_MTSAFE</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00229">event_machine_hw_types.h:229</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_ac341b7db29d8127e864a45c9bd2a4aa3"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#ac341b7db29d8127e864a45c9bd2a4aa3">EM_ERROR_SET_FATAL</a></div><div class="ttdeci">#define EM_ERROR_SET_FATAL(error)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00428">event_machine_hw_types.h:428</a></div></div>
<div class="ttc" id="aevent__machine__hw__types_8h_html_ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1"><div class="ttname"><a href="../../d0/d07/event__machine__hw__types_8h.html#ace0fe27049350469ff1be8188acfea89a2066feedf79f96d10ce9215fa5f37db1">EM_EVENT_TYPE_SW</a></div><div class="ttdeci">@ EM_EVENT_TYPE_SW</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d07/event__machine__hw__types_8h_source.html#l00072">event_machine_hw_types.h:72</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a0331964318f921644a88d3cc38c122e5"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a0331964318f921644a88d3cc38c122e5">PRI_QUEUE</a></div><div class="ttdeci">#define PRI_QUEUE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00109">event_machine_types.h:109</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a03546e6a7e93665c52d479831e0a6dca"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a03546e6a7e93665c52d479831e0a6dca">EM_OK</a></div><div class="ttdeci">#define EM_OK</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00329">event_machine_types.h:329</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a0bf4a25d46e18ee918e684e5deb27fa4"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a0bf4a25d46e18ee918e684e5deb27fa4">PRI_EO</a></div><div class="ttdeci">#define PRI_EO</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00097">event_machine_types.h:97</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a0c0a929399ae33b615f8ca8018d2a69d"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a0c0a929399ae33b615f8ca8018d2a69d">em_escope_t</a></div><div class="ttdeci">uint32_t em_escope_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00348">event_machine_types.h:348</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a1f9dbd41491db385bd4a3813e2f030a5"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a1f9dbd41491db385bd4a3813e2f030a5">EM_ERROR</a></div><div class="ttdeci">#define EM_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00337">event_machine_types.h:337</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a3f2bef96eaf8b2855699d6adee7758f4"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a3f2bef96eaf8b2855699d6adee7758f4">EM_QUEUE_GROUP_UNDEF</a></div><div class="ttdeci">#define EM_QUEUE_GROUP_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00127">event_machine_types.h:127</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a419c8373b72a8c5ed1c3e3ded3e262e0"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a419c8373b72a8c5ed1c3e3ded3e262e0">EM_TRUE</a></div><div class="ttdeci">#define EM_TRUE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00053">event_machine_types.h:53</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a49fd700da185b0f64834bf967479a992"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a49fd700da185b0f64834bf967479a992">em_event_type_t</a></div><div class="ttdeci">uint32_t em_event_type_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00085">event_machine_types.h:85</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a58ebf797967a820c57ced595c2b291e9"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a58ebf797967a820c57ced595c2b291e9">em_queue_prio_t</a></div><div class="ttdeci">uint32_t em_queue_prio_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00186">event_machine_types.h:186</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a8542d9c2c9a29e35ff042b1d59cc479b"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a8542d9c2c9a29e35ff042b1d59cc479b">EM_EVENT_UNDEF</a></div><div class="ttdeci">#define EM_EVENT_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00062">event_machine_types.h:62</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_a962bb467f721a89bbc8469f7c171aaca"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#a962bb467f721a89bbc8469f7c171aaca">EM_ESCOPE</a></div><div class="ttdeci">#define EM_ESCOPE(escope)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00365">event_machine_types.h:365</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_adddd88868f7aa0d32b3e40245eb4ef8f"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#adddd88868f7aa0d32b3e40245eb4ef8f">em_status_t</a></div><div class="ttdeci">uint32_t em_status_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00321">event_machine_types.h:321</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_ae8ba676fb5528d220363edad0aeef1ff"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#ae8ba676fb5528d220363edad0aeef1ff">EM_QUEUE_UNDEF</a></div><div class="ttdeci">#define EM_QUEUE_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00107">event_machine_types.h:107</a></div></div>
<div class="ttc" id="aevent__machine__types_8h_html_af28fb8daf62b942ced417e158ed7e1c7"><div class="ttname"><a href="../../d4/d11/event__machine__types_8h.html#af28fb8daf62b942ced417e158ed7e1c7">EM_EO_UNDEF</a></div><div class="ttdeci">#define EM_EO_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00095">event_machine_types.h:95</a></div></div>
<div class="ttc" id="agroup__em__core_html_ga13d21af31382ec2c3d45010645707e9c"><div class="ttname"><a href="../../d5/d69/group__em__core.html#ga13d21af31382ec2c3d45010645707e9c">em_core_id</a></div><div class="ttdeci">int em_core_id(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df9/event__machine__core_8c_source.html#l00034">event_machine_core.c:34</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga10cf8094caa56026eb0a402d3d22da23"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga10cf8094caa56026eb0a402d3d22da23">em_eo_remove_queue_all_sync</a></div><div class="ttdeci">em_status_t em_eo_remove_queue_all_sync(em_eo_t eo, int delete_queues)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00517">event_machine_eo.c:517</a></div></div>
<div class="ttc" id="agroup__em__eo_html_ga196c7caa1177575fd424e9a0d2854da6"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#ga196c7caa1177575fd424e9a0d2854da6">em_eo_create</a></div><div class="ttdeci">em_eo_t em_eo_create(const char *name, em_start_func_t start, em_start_local_func_t local_start, em_stop_func_t stop, em_stop_local_func_t local_stop, em_receive_func_t receive, const void *eo_ctx)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00040">event_machine_eo.c:40</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gabe4f7a789ec9523367c086793061562d"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gabe4f7a789ec9523367c086793061562d">em_eo_start_sync</a></div><div class="ttdeci">em_status_t em_eo_start_sync(em_eo_t eo, em_status_t *result, const em_eo_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00725">event_machine_eo.c:725</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gac9b818edd466228b6fb653bd9337da3e"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gac9b818edd466228b6fb653bd9337da3e">em_eo_add_queue_sync</a></div><div class="ttdeci">em_status_t em_eo_add_queue_sync(em_eo_t eo, em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00344">event_machine_eo.c:344</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gadce026621953114bd26e5836d9693465"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gadce026621953114bd26e5836d9693465">em_eo_stop_sync</a></div><div class="ttdeci">em_status_t em_eo_stop_sync(em_eo_t eo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00897">event_machine_eo.c:897</a></div></div>
<div class="ttc" id="agroup__em__eo_html_gae769b19e613b24487beb943cfb926977"><div class="ttname"><a href="../../d8/d5f/group__em__eo.html#gae769b19e613b24487beb943cfb926977">em_eo_delete</a></div><div class="ttdeci">em_status_t em_eo_delete(em_eo_t eo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/event__machine__eo_8c_source.html#l00205">event_machine_eo.c:205</a></div></div>
<div class="ttc" id="agroup__em__error_html_gab6b469100e5f60670a742d944a6f530b"><div class="ttname"><a href="../../db/da0/group__em__error.html#gab6b469100e5f60670a742d944a6f530b">em_unregister_error_handler</a></div><div class="ttdeci">em_status_t em_unregister_error_handler(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/de9/event__machine__error_8c_source.html#l00050">event_machine_error.c:50</a></div></div>
<div class="ttc" id="agroup__em__error_html_gaf7332965c5deaa69411136e8d36089c6"><div class="ttname"><a href="../../db/da0/group__em__error.html#gaf7332965c5deaa69411136e8d36089c6">em_register_error_handler</a></div><div class="ttdeci">em_status_t em_register_error_handler(em_error_handler_t handler)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/de9/event__machine__error_8c_source.html#l00034">event_machine_error.c:34</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga272587cb3a55dd241332fd13b6e19054"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga272587cb3a55dd241332fd13b6e19054">em_send_multi</a></div><div class="ttdeci">int em_send_multi(const em_event_t events[], int num, em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00710">event_machine_event.c:710</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga5f0e40f1b0b4892ee16aafe07ba4c90c"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga5f0e40f1b0b4892ee16aafe07ba4c90c">em_alloc</a></div><div class="ttdeci">em_event_t em_alloc(uint32_t size, em_event_type_t type, em_pool_t pool)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00033">event_machine_event.c:33</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga824c1dee097236d554918d6702431beb"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga824c1dee097236d554918d6702431beb">em_free_multi</a></div><div class="ttdeci">void em_free_multi(em_event_t events[], int num)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00370">event_machine_event.c:370</a></div></div>
<div class="ttc" id="agroup__em__event_html_ga8f701c3a5901fc81d922b9d1d02691e3"><div class="ttname"><a href="../../d5/d33/group__em__event.html#ga8f701c3a5901fc81d922b9d1d02691e3">em_event_pointer</a></div><div class="ttdeci">void * em_event_pointer(em_event_t event)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00750">event_machine_event.c:750</a></div></div>
<div class="ttc" id="agroup__em__event_html_gaca4584a01b71429dfbb045342454b464"><div class="ttname"><a href="../../d5/d33/group__em__event.html#gaca4584a01b71429dfbb045342454b464">em_send</a></div><div class="ttdeci">em_status_t em_send(em_event_t event, em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00661">event_machine_event.c:661</a></div></div>
<div class="ttc" id="agroup__em__event_html_gad4f97ba217518d967f8078c56023c4d4"><div class="ttname"><a href="../../d5/d33/group__em__event.html#gad4f97ba217518d967f8078c56023c4d4">em_free</a></div><div class="ttdeci">void em_free(em_event_t event)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00261">event_machine_event.c:261</a></div></div>
<div class="ttc" id="agroup__em__event_html_gada9a8dda15cfef5cee0f99e4b6e63ba3"><div class="ttname"><a href="../../d5/d33/group__em__event.html#gada9a8dda15cfef5cee0f99e4b6e63ba3">em_event_get_size</a></div><div class="ttdeci">uint32_t em_event_get_size(em_event_t event)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d32/event__machine__event_8c_source.html#l00818">event_machine_event.c:818</a></div></div>
<div class="ttc" id="agroup__em__queue_html_ga14a77156789e322f55aafaac039684ee"><div class="ttname"><a href="../../de/d3c/group__em__queue.html#ga14a77156789e322f55aafaac039684ee">em_queue_dequeue</a></div><div class="ttdeci">em_event_t em_queue_dequeue(em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dba/event__machine__queue_8c_source.html#l00232">event_machine_queue.c:232</a></div></div>
<div class="ttc" id="agroup__em__queue_html_ga2a28907b18b348cbb153431c35af5752"><div class="ttname"><a href="../../de/d3c/group__em__queue.html#ga2a28907b18b348cbb153431c35af5752">em_queue_delete</a></div><div class="ttdeci">em_status_t em_queue_delete(em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dba/event__machine__queue_8c_source.html#l00095">event_machine_queue.c:95</a></div></div>
<div class="ttc" id="agroup__em__queue_html_ga65850427f68c8c73e09fbf325190c31c"><div class="ttname"><a href="../../de/d3c/group__em__queue.html#ga65850427f68c8c73e09fbf325190c31c">em_queue_get_context</a></div><div class="ttdeci">void * em_queue_get_context(em_queue_t queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dba/event__machine__queue_8c_source.html#l00126">event_machine_queue.c:126</a></div></div>
<div class="ttc" id="agroup__em__queue_html_ga83e001b62c2a87bf862fbf695c5e84fa"><div class="ttname"><a href="../../de/d3c/group__em__queue.html#ga83e001b62c2a87bf862fbf695c5e84fa">em_queue_set_context</a></div><div class="ttdeci">em_status_t em_queue_set_context(em_queue_t queue, const void *context)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dba/event__machine__queue_8c_source.html#l00112">event_machine_queue.c:112</a></div></div>
<div class="ttc" id="agroup__em__queue_html_gaef257858d1fa660524f198dba20fa9eb"><div class="ttname"><a href="../../de/d3c/group__em__queue.html#gaef257858d1fa660524f198dba20fa9eb">em_queue_create</a></div><div class="ttdeci">em_queue_t em_queue_create(const char *name, em_queue_type_t type, em_queue_prio_t prio, em_queue_group_t group, const em_queue_conf_t *conf)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dba/event__machine__queue_8c_source.html#l00041">event_machine_queue.c:41</a></div></div>
<div class="ttc" id="astruct__env__atomic64_html"><div class="ttname"><a href="../../d5/dcc/struct__env__atomic64.html">_env_atomic64</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d11/env__atomic_8h_source.html#l00048">env_atomic.h:48</a></div></div>
<div class="ttc" id="astructem__eo__conf__t_html"><div class="ttname"><a href="../../de/dc0/structem__eo__conf__t.html">em_eo_conf_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00242">event_machine_types.h:242</a></div></div>
<div class="ttc" id="astructem__queue__conf__t_html"><div class="ttname"><a href="../../d5/d76/structem__queue__conf__t.html">em_queue_conf_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00212">event_machine_types.h:212</a></div></div>
<div class="ttc" id="astructem__queue__conf__t_html_a281d884e2a021fa6510c125fcbcce0ce"><div class="ttname"><a href="../../d5/d76/structem__queue__conf__t.html#a281d884e2a021fa6510c125fcbcce0ce">em_queue_conf_t::flags</a></div><div class="ttdeci">em_queue_flag_t flags</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/event__machine__types_8h_source.html#l00218">event_machine_types.h:218</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
  <div id="footer" class="tabs">
   <div class="headertitle"> 
     &copy; 2017 Nokia Networks
   </div>
  </div>
 </body>
</html>
