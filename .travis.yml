language: c
dist: xenial
sudo: required

arch:
    - amd64

addons:
    apt:
        packages:
            - asciidoctor
            - automake
            - autoconf
            - doxygen
            - graphviz
            - libconfig-dev
            - libssl-dev
            - libtool
            - mscgen
            - pkg-config
            - python3-pip
            - hugepages

install:
  - sudo pip3 install robotframework

compiler:
    - gcc

script: skip

jobs:
    include:
        - stage: Build
          script:
              - ./scripts/build.sh
        - stage: Robot Tests
          script:
              - ./scripts/build.sh
              - git clone https://github.com/openeventmachine/ci.git
              - ./ci/test.sh
        - stage: Documentation
          env: TEST=documentation
          script:
              - ./scripts/build.sh
              - make doxygen-doc
          before_deploy:
              - pushd doc
              - mkdir gh-pages
              - cp -r event_machine_api/html/* gh-pages/
              - popd
          deploy:
              provider: pages
              skip_cleanup: true
              local_dir: doc/gh-pages
              github_token: $GH_REPO_TOKEN
              on:
                  branch: master
                  condition: "x$GH_REPO_TOKEN != x"
